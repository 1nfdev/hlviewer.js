{"version":3,"sources":["webpack://HLViewer/webpack/universalModuleDefinition","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/vec3.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat2.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/common.js","webpack://HLViewer/./src/Game.ts","webpack://HLViewer/./src/Reader.ts","webpack://HLViewer/webpack/bootstrap","webpack://HLViewer/./node_modules/typestyle/lib.es2015/internal/formatting.js","webpack://HLViewer/./node_modules/typestyle/lib.es2015/internal/utilities.js","webpack://HLViewer/./node_modules/typestyle/lib.es2015/index.js","webpack://HLViewer/./node_modules/typestyle/lib.es2015/internal/typestyle.js","webpack://HLViewer/./node_modules/preact/dist/preact.umd.js","webpack://HLViewer/./src/PlayerInterface/Controls.style.ts","webpack://HLViewer/./node_modules/events/events.js","webpack://HLViewer/./node_modules/free-style/dist/free-style.js","webpack://HLViewer/./node_modules/path-browserify/index.js","webpack://HLViewer/./src/Parsers/Util.ts","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat2d.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat3.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat4.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/vec4.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/quat.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/quat2.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/vec2.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix.js","webpack://HLViewer/./src/Time.ts","webpack://HLViewer/./node_modules/process/browser.js","webpack://HLViewer/./src/Replay.ts","webpack://HLViewer/./src/SoundSystem.ts","webpack://HLViewer/./src/Parsers/Sprite.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/SettingsButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/FullscreenButton/index.tsx","webpack://HLViewer/./src/Fullscreen.ts","webpack://HLViewer/./src/index.ts","webpack://HLViewer/./src/Mouse.ts","webpack://HLViewer/./src/Vector.ts","webpack://HLViewer/./src/Loader.ts","webpack://HLViewer/./src/Parsers/BspParser.ts","webpack://HLViewer/./src/Parsers/Vdf.ts","webpack://HLViewer/./src/Parsers/BspLightmapParser.ts","webpack://HLViewer/./src/Bsp.ts","webpack://HLViewer/./src/BitReader.ts","webpack://HLViewer/./src/Sound.ts","webpack://HLViewer/./src/Parsers/Tga.ts","webpack://HLViewer/./src/Parsers/Wad.ts","webpack://HLViewer/./src/Xhr.ts","webpack://HLViewer/./src/Keyboard.ts","webpack://HLViewer/./src/ReplayPlayer.ts","webpack://HLViewer/./src/Graphics/Camera.ts","webpack://HLViewer/./src/Graphics/Context.ts","webpack://HLViewer/./src/Graphics/Renderer.ts","webpack://HLViewer/./src/Graphics/SkyScene.ts","webpack://HLViewer/./src/Graphics/SkyShader/SkyShader.ts","webpack://HLViewer/./src/Graphics/WorldScene.ts","webpack://HLViewer/./src/Graphics/WorldShader/WorldShader.ts","webpack://HLViewer/./src/Parsers/BspEntityParser.ts","webpack://HLViewer/./src/Graphics/Util.ts","webpack://HLViewer/./src/Config.ts","webpack://HLViewer/./src/PlayerInterface/index.tsx","webpack://HLViewer/./src/PlayerInterface/Root.tsx","webpack://HLViewer/./src/PlayerInterface/Loading/index.tsx","webpack://HLViewer/./src/PlayerInterface/Loading/style.ts","webpack://HLViewer/./src/PlayerInterface/FreeMode/index.tsx","webpack://HLViewer/./src/PlayerInterface/FreeMode/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/SettingsButton/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/FullscreenButton/style.ts","webpack://HLViewer/./src/PlayerInterface/ReplayMode/index.tsx","webpack://HLViewer/./src/PlayerInterface/Time/index.tsx","webpack://HLViewer/./src/PlayerInterface/Time/style.ts","webpack://HLViewer/./src/PlayerInterface/TimeLine/index.tsx","webpack://HLViewer/./src/PlayerInterface/TimeLine/style.ts","webpack://HLViewer/./src/PlayerInterface/VolumeControl/index.tsx","webpack://HLViewer/./src/PlayerInterface/VolumeControl/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/PlayButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/PauseButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/VolumeButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/VolumeButton/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/SpeedUpButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/SpeedDownButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/SpeedDownButton/style.ts","webpack://HLViewer/./src/PlayerInterface/Root.style.ts"],"names":["Math","sin","cos","min","PI","String","fromCharCode","max","e","i","v","ControlsStyle","stylesheet","controls","zIndex","position","width","bottom","padding","boxSizing","backgroundColor","userSelect","opacity","transition","controlsVisible","buttons","height","display","justifyContent","marginBottom","alignItems","button","cursor","left","$nest","marginRight","right","UByte","Byte","UShort","Short","UInt","Int","Float","Double","NString","ReaderDataType","byteLength","Error","this","data","DataView","offset","seek","tell","getInt8","skip","getUint8","getInt16","getUint16","getInt32","getUint32","getFloat32","getFloat64","ub","bind","push","Uint8Array","buffer","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","Float32Array","Float64Array","nstr","str","EventEmitter","Object","defineProperty","FREE","REPLAY","PlayerMode","pauseTime","isPaused","lastTime","accumTime","timeStep","pointerLocked","entities","draw","requestAnimationFrame","canvas","parentElement","clientWidth","clientHeight","camera","aspect","updateProjectionMatrix","context","gl","viewport","drawingBufferWidth","drawingBufferHeight","now","update","renderer","mapName","skyScene","worldScene","mouseMove","mouse","delta","x","movementX","y","movementY","pageX","pageY","keyDown","keyboard","keys","which","preventDefault","keyUp","onVisibilityChange","document","hidden","window","WebGLRenderingContext","hasSupport","message","createElement","getContext","error","errorMessage","Mouse","Keyboard","soundSystem","SoundSystem","sounds","config","loader","Loader","events","addListener","replay","changeReplay","map","skies","forEach","isDone","entries","sprites","length","changeMap","t","emit","addEventListener","getCanvas","Camera","init","Context","Renderer","WorldScene","SkyScene","mode","player","ReplayPlayer","load","toLowerCase","name","find","origin","rotation","title","KEYS","W","S","A","D","C","SPACE","removeListener","f","o","performance","mozNow","msNow","oNow","webkitNow","Date","getTime","formatTime","toString","readBits","flags","bits","divisor","readString","reason","BitStream","index","packetIndex","fireTime","version","ui","entityIndex","s","volume","attenuation","channel","soundIndex","xPosition","yPosition","zPosition","pitch","time","commands","split","replace","trim","filter","func","params","slice","yaw","roll","protocol","spawnCount","mapCrc","clientDllHash","arrx","maxPlayers","playerIndex","isDeathmatch","gameDir","hostName","mapFileName","mapCycle","lightInfo","clientIndex","clientUserId","clientUserInfo","clientCdKeyHash","fields","us","r","delta_description_t","clientData","slot","ping","loss","direction","b","count","color","modelIndex","sequence","frame","colorMap","skin","renderMode","renderAmt","renderColor","renderFx","d","eventIndex","eventData","delayBit","delay","extraData","effect","textColor","effectColor","fadeInTime","fadeOutTime","holdTime","effectTime","sign","text","track","loopTrack","saveName","maps","sequenceNumber","weaponModelBodyGroup","positionIndex","decalName","type","angleToAdd","size","entityStates","gravity","stopSpeed","maxSpeed","spectatorMaxSpeed","acceleration","airAcceleration","waterAcceleration","friction","edgeFriction","waterFriction","entityGravity","bounce","stepSize","maxVelocity","zMax","waveHeight","footsteps","rollAngle","rollSpeed","skyColor","skyVec","skyName","n","downloadSize","md5hash","initialPercent","filename","flag","codecName","quality","fallbackDir","canCheat","timeScale","url","requestId","handlers","bad","nop","disconnect","event","setView","sound","print","stuffText","setAngle","serverInfo","lightStyle","updateUserInfo","deltaDescription","stopSound","pings","particle","damage","spawnStatic","eventReliable","spawnBaseLine","tempEntity","setPause","signOnNum","centerPrint","killedMonster","foundSecret","spawnStaticSound","intermission","finale","cdTrack","restore","cutscene","weaponAnim","roomType","addAngle","newUserMsg","packetEntities","deltaPacketEntities","choke","resourceList","newMoveVars","resourceRequest","customization","crosshairAngle","soundFade","fileTxferFailed","hltv","director","voiceInit","voiceData","sendExtraInfo","resourceLocation","sendCvarValue","sendCvarValue2","FrameDataReader","BAD","NOP","DISCONNECT","EVENT","VERSION","SETVIEW","SOUND","TIME","PRINT","STUFFTEXT","SETANGLE","SERVERINFO","LIGHTSTYLE","UPDATEUSERINFO","DELTADESCRIPTION","CLIENTDATA","STOPSOUND","PINGS","PARTICLE","DAMAGE","SPAWNSTATIC","EVENT_RELIABLE","SPAWNBASELINE","TEMPENTITY","SETPAUSE","SIGNONNUM","CENTERPRINT","KILLEDMONSTER","FOUNDSECRET","SPAWNSTATICSOUND","INTERMISSION","FINALE","CDTRACK","RESTORE","CUTSCENE","WEAPONANIM","DECALNAME","ROOMTYPE","ADDANGLE","NEWUSERMSG","PACKETENTITIES","DELTAPACKETENTITIES","CHOKE","RESOURCELIST","NEWMOVEVARS","RESOURCEREQUEST","CUSTOMIZATION","CROSSHAIRANGLE","SOUNDFADE","FILETXFERFAILED","HLTV","DIRECTOR","VOICEINIT","VOICEDATA","SENDEXTRAINFO","TIMESCALE","RESOURCELOCATION","SENDCVARVALUE","SENDCVARVALUE2","SVC","demoProtocol","netProtocol","modName","dirOffset","id","frames","tick","orientation","read","command","sample","assign","R","cameraPos","JSON","parse","stringify","cameraRot","ReplayState","header","directories","Reader","macros","join","forward","up","RefParams","frametime","paused","spectator","onground","waterlevel","velocity","viewHeight","idealPitch","viewAngles","health","viewSize","punchAngle","maxClients","viewEntity","playerCount","maxEntities","demoPlayback","hardware","smoothing","ptr_cmd","ptr_movevars","nextView","onlyClientDraw","UserCmd","lerp_msec","msec","UNUSED1","forwardMove","sideMove","upMove","lightLevel","UNUSED2","impulse","weaponSelect","UNUSED","impactIndex","impactPosition","MoveVars","view","viewModel","incoming_sequence","incoming_acknowledged","incoming_reliable_acknowledged","incoming_reliable_sequence","outgoing_sequence","reliable_sequence","last_reliable_sequence","frameData","weaponFlags","fov","args","ducking","fparam1","fparam2","iparam1","iparam2","bparam1","bparam2","weaponAnimation","animation","body","feedFrame","setResources","addChunk","startTime","timeLength","setData","resources","used","deltaDecoders","customMessages","Replay","state","clone","reader","basename","chunks","skins","models","decals","custom","AudioContext","webkitAudioContext","parseFloat","localStorage","getItem","setItem","channels","preMuteVolume","masterGain","createGain","gain","value","connect","destination","source","stop","createBufferSource","start","getVolume","setVolume","VP_PARALLEL_UPRIGHT","FACING_UPRIGHT","VP_PARALLEL","ORIENTED","VP_PARALLEL_ORIENTED","SpriteType","SPR_NORMAL","SPR_ADDITIVE","SPR_INDEXALPHA","SPR_ALPHTEST","SpriteAlphaType","SYNCHRONIZED","RANDOM","SpriteSyncType","alphaType","radius","frameCount","beamLength","syncType","group","paletteWithLastTransToRGBA","paletteToRGBA","Component","onFreeModeClick","props","game","changeMode","pause","onReplayModeClick","toggleMenu","setState","isOpen","class","settings","classes","onClick","xmlns","viewBox","fill","menuOpen","menu","menuItemTitle","menuItemSelected","menuItem","isInFullscreen","Fullscreen","exit","enter","root","onFullscreen","onChange","onChangeRemove","a","enabled","element","request","change","removeEventListener","Config","Game","interface","PlayerInterface","setTitle","getTitle","click","leftClick","rightClick","Vector2","z","Loading","Skipped","Done","progress","status","wads","console","isLoading","extname","loadReplay","loadMap","getReplaysPath","xhr","method","isBinary","progressCallback","catch","isError","parseIntoChunks","done","loadSound","checkStatus","getMapsPath","BspParser","model","indexOf","loadSprite","skyname","loadSky","textures","isExternal","wad","loadWad","Promise","all","getBasePath","Sprite","getSkiesPath","Tga","getWadsPath","Wad","getSoundsPath","Sound","create","p","m","maxs","mins","firstFace","faceCount","edgeCount","textureIndex","textureInfo","firstEdge","sShift","tShift","l","processFace","lightmapOffset","faces","Entities","Planes","Textures","Vertices","Visibility","Nodes","TexInfo","Faces","Lighting","ClipNodes","Leaves","MarkSurfaces","Edges","SurfEdges","Models","BspLumpIndex","loadEntities","loadTextures","loadModels","loadFaces","loadEdges","loadSurfEdges","loadVertices","loadTexInfo","loadLightmap","BspLightmapParser","Bsp","TEXTURE_SIZE","getTexture","plane","planeSide","styles","headNodes","visLeaves","loadTextureData","vdf","classname","Number","renderamt","rendermode","renderfx","rendercolor","test","block","lightmap","texture","getDimensions","readLightmap","minU","minV","findFreeSpace","getBits","scratch","setUint32","ArrayBuffer","BitView","readUint8","apply","decodeURIComponent","decodeAudioData","idLength","colorMapType","imageType","firstEntryIndex","image","xOrigin","yOrigin","depth","descriptor","rowCount","rowHeight","glyphs","diskLength","isCompressed","XMLHttpRequest","responseType","lengthComputable","loaded","total","getResponseHeader","target","readyState","response","open","send","B","E","F","G","H","I","J","K","L","M","N","O","P","Q","T","U","V","X","Y","Z","CTRL","ALT","glMatrix","toRadian","currentMap","currentChunk","currentTime","currentTick","isPlaying","speed","reset","on","readFrame","play","isNaN","projectionMatrix","mat4","near","far","viewMatrix","vec3","perspective","identity","rotateX","rotateZ","translate","VERTEX","FRAGMENT","ShaderType","alpha","log","createProgram","createShader","vertexShaderSrc","fragmentShaderSrc","attachShader","linkProgram","validateProgram","getProgramParameter","LINK_STATUS","deleteProgram","deleteShader","getProgramInfoLog","debug","VALIDATE_STATUS","useProgram","attributeNames","getAttribLocation","uniformNames","getUniformLocation","handle","attributes","uniforms","VERTEX_SHADER","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","getExtension","getParameter","MAX_TEXTURE_MAX_ANISOTROPY_EXT","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","clearColor","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","CULL_FACE","cullFace","FRONT","isReady","shader","SkyShader","createBuffer","createTexture","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","ELEMENT_ARRAY_BUFFER","rt","dn","ft","lf","bk","getImageData","putImageData","drawImage","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","generateMipmap","texParameteri","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","texParameterf","TEXTURE_MAG_FILTER","LINEAR","getAnisotropyExtension","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","vertexBuffer","indexBuffer","enableVertexAttribs","setVertexAttribPointers","setDiffuse","updateViewMatrix","setViewMatrix","setProjectionMatrix","drawElements","TRIANGLES","program","aPosition","aTexCoord","uViewMx","uProjectionMx","uDiffuse","uniformMatrix4fv","uniform1i","vertexAttribPointer","FLOAT","atan2","modelMatrix","sceneInfo","MainShader","fillBuffer","loadSpriteTextures","bsp","isTransparent","sort","isPowerOfTwo","nextPowerOfTwo","resizeTexture","setLightmap","activeTexture","TEXTURE1","TEXTURE0","RenderMode","Normal","Solid","Additive","parseInt","substr","setOpacity","renderWorldSpawn","renderOpaqueEntities","depthMask","renderTransparentEntities","setModelMatrix","drawArrays","angles","fromValues","add","scale","rotateY","Color","Texture","Glow","DST_ALPHA","distance","dist","aTexCoord2","uModelMx","uLightmap","uOpacity","uniform1f","No","Yes","WorldSpawnStartDark","WorldSpawnGameTitle","WorldSpawnNewUnit","FewestPlayers","FirstTeam","WorldSpawnDefaultTeam","Walk","Run","Instantaneous","No_TurnToFace","AiScriptedSequenceMoveTo","DefaultAI","Ambush","AiScriptedSequenceFinishSchedule","Repeatable","LeaveCorpse","AiScriptedSequenceSpawnflags","None","HugeMachine","BigMachine","Machine","SlowFadeIn","FadeIn","QuickFadeIn","SlowPulse","Pulse","QuickPulse","SlowOscillator","Oscillator","QuickOscillator","GrungePitch","VeryLowPitch","LowPitch","HighPitch","VeryHighPitch","ScreamingPitch","OscillateSpinUpDown","PulseSpinUpDown","RandomPitch","RandomPitchFast","IncrementalSpinup","Alien","Bizzare","PlanetX","Haunted","AmbientGenericPreset","PlayEverywhere","SmallRadius","MediumRadius","LargeRadius","StartSilent","NotToggled","AmbientGenericSpawnFlags","UseActivates","StartOn","ButtonTargetSpawnFlags","NoTrigger","SeePlayerMadAtPlayer","TakeDamage","HalfHealthRemaining","Death","HearWorld","HearPlayer","HearCombat","SeePlayerUnconditional","SeePlayerNotInCombat","CyclerWeaponTriggerCondition","Toggle","RandomStrike","Ring","StartSparks","EndSparks","DecalEnd","FadeStart","FadeEnd","EnvBeamSpawnFlags","EmbeddedFix","OpaqueBlockLight","OpaqueEmbeddedFix","OpaqueConcaveFix","ZHLTLightFlags","FastPulse","SlowWidePulse","FastWidePulse","SlowFadeAway","FastFadeAway","SlowBecomeSolid","FastBecomeSolid","SlowStrobe","FastStrobe","FasterStrobe","SlowFlicker","FastFlicker","ConstantGlow","DistortModels","HologramDistort","RenderEffect","worldspawn","mapversion","maxRange","MaxRange","light","WaveHeight","startDark","startdark","newUnit","newunit","defaultTeam","defaultteam","gameTitle","gametitle","aiscripted_sequence","spawnflags","m_iszEntity","m_iszPlay","m_flRadius","m_flRepeat","m_fMoveTo","m_iFinishSchedule","ambient_generic","targetName","targetname","preset","startVolume","volstart","fadeIn","fadein","fadeOut","fadeout","pitchStart","pitchstart","spinUp","spinup","spinDown","spindown","lfoType","lfotype","lfoRate","lforate","lfoModPitch","lfomodpitch","lfoModVolume","lfomodvolume","cSpinUp","cspinup","spawnFlags","ammo_357","killTarget","killtarget","ammo_9mmAR","ammo_9mmbox","ammo_9mmclip","ammo_ARgrenades","ammo_buckshot","ammo_crossbow","ammo_gaussclip","ammo_rpgclip","button_target","master","renderEffect","renderAmmount","zhltLightFlags","zhlt_lightflags","lightOrigin","light_origin","cycler","cycler_sprite","framerate","cyclear_weapon","triggerTarget","TriggerTarget","triggerCondition","TriggerCondition","cyclear_wreckage","env_beam","Radius","life","boltWidth","BoltWidth","noiseAmplitude","NoiseAmplitude","textureScroll","TextureScroll","frameRate","frameStart","framestart","strikeTime","StrikeTime","originalClassname","createImageData","paths","base","replays","rootNode","querySelector","render","Root","super","onPointerLockChange","pointerLockElement","onContextMenu","onWindowClick","isActive","onRootClick","stopPropagation","fadeReset","onKeyDown","toggleMute","onModeChange","forceUpdate","onLoadStart","onLoadEnd","onTitleChange","onMouseEnter","isMouseOver","onMouseMove","onMouseLeave","isVisible","clearTimeout","setTimeout","onScreenClick","requestPointerLock","onScreenDblClick","node","appendChild","off","rootVisible","titleVisible","visible","screen","ref","onDblClick","FreeMode","ReplayMode","sky","sprite","items","onItemLoad","onItemProgress","addLoadStartListener","addProgressListener","removeLoadStartListener","removeProgressListener","Array","loading","loadingHidden","spinner","xmlSpace","key","logItem","formatItem","reduce","LoadingStyle","top","marginLeft","marginTop","animationName","keyframes","from","transform","to","background","fontFamily","margin","paddingLeft","listStyle","SettingsButton","FullscreenButton","active","FreeModeStyle","SettingsButtonStyle","fontSize","flexFlow","minWidth","borderBottom","fontWeight","FullscreenButtonStyle","onPlayClick","onPauseClick","onSpeedDown","speedDown","onSpeedUp","speedUp","onVolumeClick","onPlayStateChange","TimeLine","SpeedDownButton","PlayButton","PauseButton","SpeedUpButton","VolumeButton","VolumeControl","Time","onPlay","onPauseOrStop","onPostUpdate","currentTarget","getClientRects","seekByPercent","ghostKnobActive","ghostKnobPos","timeline","ghostLine","line","style","knob","ghostKnob","borderRadius","onVolumeChange","control","SpeedDownButtonStyle","RootStyle"],"mappings":"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AAmB,IAAW,KAE9B,OAEA,OAHA,QAGA,IACA,WACA,mBACA,OACA,YACA,UAEM,GAAD,IACL,QAAmB,IAAiB,IACpC,iCACA,IACA,YACA,aACA,WACA,MAKA,aAEA,OACA,kBACA,QACA,iBACM,kBACN,KAEA,qBAMA,KACA,oBACA,qBAtEA,KA0EA,WACA,wBAIA,gBACA,mBADA,EAGA,MAEA,+BAEA,oBACA,KAGA,MAIA,kBACA,cADA,GAEA,CACA,wBACA,QACA,KAIA,kBAGA,eACA,2BACA,0BAIA,WACA,wFACA,wBAOA,kBACA,MACA,WAFA,IAIA,iCACA,aACA,iBAEA,cACA,cACA,YAGA,KACA,wBAGA,OAFA,yBACA,cACA,EAIA,SAGA,kBACA,6BAGA,sBACA,aACA,cAEA,cACA,qBACA,aACA,WAEA,8CACA,UACA,6CACI,6BACJ,kCAIA,oBACA,yCACA,cAGA,mCACA,UAEA,cAEA,QACA,2CAGA,KAFA,UAMA,cAGA,oBACA,gBAEA,IAYA,EACA,EACA,EAdA,UACA,UACA,YACA,iBACA,iBACA,mBACA,SACA,aACA,OACA,eACA,KACA,IA2BA,GAtBA,yCACA,YAA2B,6CAC3B,WAoBA,IAhBA,UACA,UACA,YACA,oEACA,KACI,uBACJ,6BAEA,UACA,UACA,aAGA,sDACA,aAEA,GACA,kBAEA,oBACA,YAA8B,sBAG9B,+BACA,kCAGA,IACA,EACA,EAFA,gBAIA,yBAEA,YACA,MAEA,kCACA,eAEA,IAEA,wBACA,yBACA,qBACA,cACA,aAGA,cAEA,KAEA,OAEA,sBAGA,YA1BA,IA2BA,mBACA,qCAIA,oBACA,mBACA,WACA,qBAEA,IACA,kBACA,UAUA,MAJA,KAGA,SACA,WACA,QACA,IACA,uBACA,YAEA,eACA,uCA/GA,KAmHA,KACA,WACG,IAEH,sBACA,4BAEA,iCAGA,2BACA,iCACG,GAAAC,GAAA,KAGH,wBACA,sBACA,IACA,IACA,0CACA,IACA,OACA,+BACA,6BA2BA,OAxBA,0BACA,aACA,WAEA,QACA,KACA,UAGA,oBACA,iBACA,aAEA,QAEA,aACA,SAEA,WACA,kBA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D,yCACA,aACA,6CACA,cACA,6BACA,SAEA,gBAA6C,WAAyB,SAEtE,EADC,EAAD,mDAEA,EADA,mCACA,WACA,UAMA,SAAS,EAAT,GAEA,QADC,EAAD,GACA,IAAmB,WAAgB,IACnC,QACA,SApOA,IAAI,EAAJ,iCACA,oBAIA,OAHC,EAAD,uBACA,CAAc,wBAAiB,OAAD,cAAsC,gBACpE,cAA6B,kDAC7B,MAEA,qBAEA,aAAuB,mBADvB,OAEA,uEAVA,GAaAD,OAAOC,eAAe,EAAtB,cAA8C,WAI9C,IAAI,EAAJ,EAIA,sCA2DA,UA1DA,WACA,SACA,OACA,yCACA,cAA8B,2BAM9B,GACA,+BACA,yBACA,wBACA,wBACA,cACA,oBACA,uBACA,kBACA,WACA,uBACA,mBACA,QACA,eACA,mBACA,iBACA,mBACA,gBACA,iBACA,eACA,iBACA,qBACA,sBACA,uBACA,cACA,kBACA,mBACA,oBACA,gBACA,iBACA,WACA,SACA,WACA,cACA,UACA,aACA,QAEA,kBACA,mBACA,kBACA,sBACA,uBACA,uBACA,oBACA,mBAGA,qBAA8C,WAAgB,OAC9D,KACA,mDAAmE,WAAgB,IAEnF,EADA,KACA,MAMA,kBAAAxE,GAAiC,4BASjC,cAWA,eA/GA,IA0OA,GACA,iBACA,oBACA,qBAKA,aACA,mBACA,QAAiC,KACjC,eACA,cACA,gBACA,cACA,mCACA,mCAuEA,OArEC,EAAD,8BACC,EAAD,wBACA,kCAEA,GADA,yBACA,MACA,uBACA,sBACA,+BACA,gBACA,6CAEC,GAAD,oCACC,EAAD,yBACA,aACA,WACA,iBACA,qCACA,gBACA,4BAGA,UAEA,+BACA,2BACA,oBACA,yBADA,IAEC,EAAD,qBACA,2BACA,gBACA,4BACA,qBACA,uBACA,uBACA,gBACA,8BAEC,GAAD,gCACA,iBACA,aACA,iBACA,qCACA,gBACA,+BAKA,8BACA,WACA,kCAA8C,yBAE9C,8BACA,2BAA6C,WAAgB,IAA7D,EACA,KACA,YAEA,aAEA,gCACA,2BAA6C,WAAgB,IAA7D,EACA,KACA,eAEA,aAEA,6BACA,2BAEA,EA/EA,GAiFA,UAIA,IAAI,EAAJ,WACA,gBACA,gBACA,UAQA,OANC,EAAD,+BACA,sBAEA,6BACA,qCAEA,EAXA,GAaA,aAIA,IAAI,EAAJ,YAEA,gBACA,yBAGA,OAFC,EAAD,QACA,OACA,EAQA,OAbC,EAAD,KAOA,iCACA,gCAAwC,gBAExC,6BACA,8CAEA,EAdA,IAgBA,UAIA,IAAI,EAAJ,YAEA,kBACA,yBAIA,OAHC,EAAD,OACA,UACA,OACA,EAQA,OAdC,EAAD,KAQA,iCACA,qBAA6B,8BAE7B,6BACA,wDAEA,EAfA,IAiBA,SAIA,IAAI,EAAJ,YAEA,oBACA,2BAIA,OAHC,EAAD,OACA,UACA,OACA,EAwCA,OA9CC,EAAD,KAQA,4CACC,EAAD,GACA,KACA,eACA,mBACA,0BAEA,OADC,EAAD,+BACA,GAEA,4CACA,gDAEA,iDACC,EAAD,GACA,KACA,cACA,mBACA,0BACA,6CAGA,OAFC,EAAD,eACA,YACA,GAEA,2CACC,EAAD,GACA,KAEA,OADA,WACA,YAEA,oCACA,gCAEA,iCACA,sBAEA,6BACA,qEAEA,EA/CA,IAiDA,cAUA,SANA,gBAIA,YAHC,IAAD,IAA0B,UAC1B,QAA2B,uBAC3B,QAA6B,KAC7B,uC,sGV1bA,OAEA,QACA,QAEA,QAEA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QAuCA,IAAY,GAAZ,SAAAA,GACE,IAAAyE,KAAA,UACA,IAAAC,OAAA,YAFF,CAAY,IAAAC,aAAA,EAAAA,WAAU,KAKtB,aAmCE,YAAY,GAEV,GAhCF,KAAAC,UAAoB,EACpB,KAAAC,UAAA,EACA,KAAAC,SAAmB,EACnB,KAAAC,UAAoB,EACX,KAAAC,SAAmB,EAAI,GAIhC,KAAAC,eAAA,EAMA,KAAAC,SAAkB,GAmLlB,KAAAC,KAAO,KACLC,sBAAsB3C,KAAK0C,MADjB,MAGJ,EAAS1C,KAAK4C,OACd,EAAS,EAAOC,cACtB,KAAY,CAAC,MACL,EAAK,EAAOC,YACZ,EAAK,EAAOC,cACd,EAAOhF,QAAP,GAAuB,EAAOU,SAAP,KACzB,EAAOV,MAAP,EACA,EAAOU,OAAP,EACAuB,KAAKgD,OAAOC,OAAS,EAAOH,YAAc,EAAOC,aACjD/C,KAAKgD,OAAOE,yBACZlD,KAAKmD,QAAQC,GAAGC,SACd,EACA,EACArD,KAAKmD,QAAQC,GAAGE,mBAChBtD,KAAKmD,QAAQC,GAAGG,uBAKlB,EAAOT,cAAgB,EAAO/E,OAC9B,EAAOgF,eAAiB,EAAOtE,UAE/B,EAAOV,MAAQ,EAAO+E,YACtB,EAAOrE,OAAS,EAAOsE,aACvB/C,KAAKgD,OAAOC,OAAS,EAAOH,YAAc,EAAOC,aACjD/C,KAAKgD,OAAOE,yBACZlD,KAAKmD,QAAQC,GAAGC,SACd,EACA,EACArD,KAAKmD,QAAQC,GAAGE,mBAChBtD,KAAKmD,QAAQC,GAAGG,sBAjCZ,MAsCJ,EAAW,EAAKC,MAAQ,IACxB,EAAK,EAAWxD,KAAKqC,SAvCjB,IAwCVrC,KAAKsC,WAAL,EAEOtC,KAAKsC,UAAYtC,KAAKuC,UAC3BvC,KAAKyD,OAAOzD,KAAKuC,UACjBvC,KAAKsC,WAAatC,KAAKuC,SAGzBvC,KAAK0D,SAAShB,OACO,KAAjB1C,KAAK2D,UACP3D,KAAK4D,SAASlB,KAAK1C,KAAKgD,QACxBhD,KAAK6D,WAAWnB,KAAK1C,KAAKgD,OAAQhD,KAAKyC,WAGzCzC,KAAKqC,SAAL,GAuEF,KAAAyB,UAAa,IACX9D,KAAK+D,MAAMC,MAAMC,EAAkB,GAAd,EAAEC,UACvBlE,KAAK+D,MAAMC,MAAMG,EAAkB,GAAd,EAAEC,UAEvBpE,KAAK+D,MAAMjG,SAASmG,EAAI,EAAEI,MAC1BrE,KAAK+D,MAAMjG,SAASqG,EAAI,EAAEG,OAG5B,KAAAC,QAAW,IACTvE,KAAKwE,SAASC,KAAK,EAAEC,OAAS,GAE1B1E,KAAKwC,gBACP,EAAEmC,kBAJI,IAWV,KAAAC,MAAS,IACP5E,KAAKwE,SAASC,KAAK,EAAEC,OAAS,GAE1B1E,KAAKwC,gBACP,EAAEmC,kBAJE,IAWR,KAAAE,mBAAqB,KACnB,GAAIC,SAASC,OAAQ,CACnB,GAAI/E,KAAKoC,SACP,OAGFpC,KAAKmC,UAAY,EAAKqB,MAAQ,IAC9BxD,KAAKoC,UAAL,MACK,CACL,IAAKpC,KAAKoC,SACR,OAGFpC,KAAKqC,SAAW,EAAKmB,MAAQ,IAAOxD,KAAKmC,UAAYnC,KAAKqC,SAC1DrC,KAAKoC,UAAL,KAvZoB,MAAK,MACvB,EACS,8CADT,EAEK,oDAIX,IADiB4C,OACRC,sBACP,MAAO,CACLC,YAAW,EACXC,QAAS,GAIb,MAAM,EAAIL,SAASM,cAAc,UACjC,IAAI,OACU,EAAEC,WAAW,UAAY,EAAEA,WAAW,sBAEzC,CACLH,YAAW,EACXC,QAAS,IAGJ,CACLD,YAAW,EACXC,QAAS,GAGb,SACA,MAAO,CACLD,YAAW,EACXC,QAAS,KA8CI,GACHD,WAIV,OAHAlF,KAAKsF,OAAL,OACAtF,KAAKuF,aAAe,qBAIpBvF,KAAKsF,OAAL,EACAtF,KAAKuF,aAAe,GAGtBvF,KAAK+D,MAAQ,IAAI,EAAAyB,MACjBxF,KAAKwE,SAAW,IAAI,EAAAiB,SACpBzF,KAAK0F,YAAc,IAAI,EAAAC,YACvB3F,KAAK4F,OAAS,GAEd5F,KAAK6F,OAAL,EACA7F,KAAK8F,OAAS,IAAI,EAAAC,OAAO/F,MACzBA,KAAK8F,OAAOE,OAAOC,YAAY,UAAY,IAKzC,GAJI,GAAU,EAAOC,QACnBlG,KAAKmG,aAAa,EAAOD,OAAOjG,OAG7B,EAAOmG,MAAQ,EAAOA,IAAInG,KAC7B,OANyD,MASrD,EAAM,EAAOmG,IAAInG,KACjB,EAAQ,EAAOoG,MACrB,IAAI,KACJ,EAAMC,QAAQ,IACZ,EAAa,GAAc,EAAIC,WAb0B,GAgBzD,EAAMD,QAAQ,GAAQ,EAAIrG,KAAO,EAAIoG,MAAMpF,KAAK,EAAIhB,MAAQ,GAI9D6B,OAAO0E,QAAQ,EAAOC,SAASH,QAAQ,EAAE,EAAD,MAClC,EAAKrG,OACP,EAAIwG,QAAJ,GAAoB,EAAKxG,QAIF,EAAvB,EAAO2F,OAAOc,QAChB,EAAOd,OAAOU,QAAQ,IAChB,EAAMrG,MACRD,KAAK4F,OAAO3E,KAAK,EAAMhB,QAK7BD,KAAK2G,UAALC,GAEA5G,KAAKgG,OAAOa,KAAK,OAAjB,KAGF/B,SAASgC,iBAAiB,YAAa9G,KAAK8D,WAA5C,GACAkB,OAAO8B,iBAAiB,UAAW9G,KAAKuE,SACxCS,OAAO8B,iBAAiB,QAAS9G,KAAK4E,OACtCI,OAAO8B,iBAAiB,mBAAoB9G,KAAK6E,oBAEjD,MAAM,EAAS7E,KAAK+G,YAEpB/G,KAAKgD,OAAS,EAAAgE,OAAOC,KAAK,EAAOlJ,MAAQ,EAAOU,QAEhD,MAAM,EAAU,EAAAyI,QAAQD,KAAR,GAChB,IAAK,EACH,MAAM,IAAIlH,MAAM,cAElBC,KAAKmD,QAAL,EAEA,MAAM,EAAW,EAAAgE,SAASF,KAAT,GACjB,IAAK,EACH,MAAM,IAAIlH,MAAM,iCAElBC,KAAK0D,SAAL,EAEA,MAAM,EAAa,EAAA0D,WAAWH,KAAX,GACnB,IAAK,EACH,MAAM,IAAIlH,MAAM,oCAElBC,KAAK6D,WAAL,EAEA,MAAM,EAAW,EAAAwD,SAASJ,KAAT,GACjB,IAAK,EACH,MAAM,IAAIlH,MAAM,kCAElBC,KAAK4D,SAAL,EAEA5D,KAAKsH,KAAO,EAAWtF,KAEvBhC,KAAKuH,OAAS,IAAI,EAAAC,aAAaxH,MAC/BA,KAAKgG,OAAS,IAAI,EAAAnE,aAElB7B,KAAK2D,QAAU,GAGjB,YAKE,OAJK3D,KAAK4C,SACR5C,KAAK4C,OAASkC,SAASM,cAAc,WAGhCpF,KAAK4C,OAGd,KAAK,GACH5C,KAAKgG,OAAOa,KAAK,aACjB7G,KAAK8F,OAAO2B,KAAZ,GAGF,UAAU,GACR,GAAIzH,KAAK2D,QAAQ+D,gBAAkB,EAAIC,KAAKD,cAA5C,CAIA1H,KAAK2D,QAAU,EAAIgE,KAEnB3H,KAAK6D,WAAW8C,UAAhB,GACA3G,KAAK4D,SAAS+C,UAAd,GAEA3G,KAAKyC,SAAW,EAAIA,SAEpB,MAAM,EAAQ,EAAIA,SAASmF,KAAK,GAAwB,sBAAnB,aAXrC,GAcE5H,KAAKgD,OAAOlF,SAAS,GAAK,EAAM+J,OAAO,GACvC7H,KAAKgD,OAAOlF,SAAS,GAAK,EAAM+J,OAAO,GACvC7H,KAAKgD,OAAOlF,SAAS,GAAK,EAAM+J,OAAO,KAEvC7H,KAAKgD,OAAOlF,SAAS,GAAK,EAC1BkC,KAAKgD,OAAOlF,SAAS,GAAK,EAC1BkC,KAAKgD,OAAOlF,SAAS,GAAK,GAG5BkC,KAAKgD,OAAO8E,SAAS,GAAK,EAC1B9H,KAAKgD,OAAO8E,SAAS,GAAK,EAC1B9H,KAAKgD,OAAO8E,SAAS,GAAK,GAG5B,aAAa,GACX9H,KAAKgG,OAAOa,KAAK,kBAAmB7G,KAApC,GAEAA,KAAKuH,OAAOpB,aAAZ,GAEAnG,KAAKgG,OAAOa,KAAK,mBAAoB7G,KAArC,GAGF,WAAW,GACTA,KAAKsH,KAAL,EACAtH,KAAKgG,OAAOa,KAAK,aAAjB,GAGF,SAAS,GACP7G,KAAK+H,MAAL,EACA/H,KAAKgG,OAAOa,KAAK,cAAjB,GAGF,WACE,OAAO7G,KAAK+H,MA2Dd,OAAO,GACL/H,KAAKgG,OAAOa,KAAK,YAAa7G,MADf,MAGT,EAASA,KAAKgD,OACd,EAAWhD,KAAKwE,SAChB,EAAQxE,KAAK+D,MAEnB,GAAI/D,KAAKsH,OAAS,EAAWrF,OAC3BjC,KAAKuH,OAAO9D,OAAZ,QACK,GAAIzD,KAAKsH,OAAS,EAAWtF,MAAQhC,KAAKwC,cAAe,CAC9D,EAAOsF,SAAS,GAAK,EACnB,EAAS,EAAOA,SAAS,GAAK,EAAM9D,MAAMG,EAAI,KAAM,EAAU,GAC9D,EAAU,GAGZ,EAAO2D,SAAS,IAAM,EAAM9D,MAAMC,EAAI,IANwB,MASxD,EADQ,IACH,EACL,EAAQ,EAAAwB,SAASuC,KAAKC,EACtB,EAAQ,EAAAxC,SAASuC,KAAKE,EACtB,EAAQ,EAAAzC,SAASuC,KAAKG,EACtB,EAAQ,EAAA1C,SAASuC,KAAKI,EACtB,EAAU,EAAA3C,SAASuC,KAAKK,EACxB,EAAQ,EAAA5C,SAASuC,KAAKM,MACxB,EAAS7D,KAAT,KAAyB,EAASA,KAAT,KACvB,EAASA,KAAT,IACF,EAAO3G,SAAS,IAAM,EAAS,EAAOgK,SAAS,GAAK,EAAU,GAAxC,EACtB,EAAOhK,SAAS,IAAM,EAAS,EAAOgK,SAAS,GAAK,EAAU,GAAxC,GACb,EAASrD,KAAT,KACT,EAAO3G,SAAS,IAAM,EAAS,EAAOgK,SAAS,GAAK,EAAU,GAAxC,EACtB,EAAOhK,SAAS,IAAM,EAAS,EAAOgK,SAAS,GAAK,EAAU,GAAxC,IAItB,EAASrD,KAAT,KAAyB,EAASA,KAAT,KACvB,EAASA,KAAT,IACF,EAAO3G,SAAS,IAAM,EAAS,EAAOgK,SAAS,IAAzB,EACtB,EAAOhK,SAAS,IAAM,EAAS,EAAOgK,SAAS,IAAzB,GACb,EAASrD,KAAT,KACT,EAAO3G,SAAS,IAAM,EAAS,EAAOgK,SAAS,IAAzB,EACtB,EAAOhK,SAAS,IAAM,EAAS,EAAOgK,SAAS,IAAzB,IAItB,EAASrD,KAAT,KAAyB,EAASA,KAAT,KACvB,EAASA,KAAT,GACF,EAAO3G,SAAS,IAAhB,EACS,EAAS2G,KAAT,KACT,EAAO3G,SAAS,IAAhB,IAKN,EAAMkG,MAAMC,EAAI,EAChB,EAAMD,MAAMG,EAAI,EAEhBnE,KAAKgG,OAAOa,KAAK,aAAc7G,MAGjC,GAAGzC,EAAH,GACE,OAAOyC,KAAKgG,OAAOC,YAAZ,EAAAW,GAGT,IAAIrJ,EAAJ,GACEyC,KAAKgG,OAAOuC,eAAZ,EAAA3B,M,iBWzXJ,YA4BA,SAAS,EAAT,KAGA,UADC,EAAD,EACA,aAAgC,KAAQ,IAExC,OAFA,EACA,MAEA,cACK,UACL,cACA,KANA,IAQA,cACA,KAKA,KACA,KAAU,IAAV,EACA,gBAIA,SA0OA,SAAS,EAAT,KACA,+BAEA,QADC,EAAD,GACA,IAAmB,WAAe,IAClC,0BAEA,SA3OA,qBAIA,UAHC,EAAD,GACA,KAEA,sBAAoC,SAA8B,KAIlE,sBAHA,2BAIA,iEACK,IAIL,UACA,qBAWA,kBAJC,EAAD,6BACA,aACG,eAEH,KAKA,qBAAArJ,GACA,sBACA,gBAcA,OAXC,EAAD,6BACA,aACG,eAEH,IACA,OAEA,OACA,SAGA,aAIA,sBAAAA,GACA,yBAIA,kBACA,8CACA,mCACA,sBACA,8DAEA,WACG,YAMH,oBAAAA,EAAA,GAIA,cAEA,IADA,QACU,YACV,UAD8B,KAK9B,IADA,iBACU,MACV,UADoB,KAPpB,OAWC,EAAD,KACA,iBAfA,yBACA,yBAsBA,QALC,EAAD,gBACA,kBAEA,uBACA,IACA,IAAiB,IAAY,IAC7B,gBACA,IACA,MAKA,IADC,EAAD,GACA,QAA+B,WAAsB,IACrD,aAKA,OAFC,EAAD,sBAEA,WAGA,UACA,gBAEA,mBAAAA,GAEA,GADA,qBACA,GADA,IACA,uBAKA,QAJC,EAAD,gBACA,SACA,KACA,KACA,aAA+B,OAAQ,EAEvC,SADA,mBAQA,UANC,IAAD,GACA,IACA,MAZA,OAoBA,gBACA,SAGA,IAEA,cAiCA,oBAAAA,EAAA,GACA,MA/BA,YACA,qBADA,GACA,IADA,IAMA,EAHC,EAAD,EACA,KACA,KAGA,iBAA2B,OAAQ,EACnC,yBAOO,OAGP,KACA,YARC,IAAD,GACA,MACA,MAdA,OAwBA,SACA,aAMA,IAIA,OAHC,GAAD,4BACA,iCAEA,GAGA,mBAAAA,GACA,qBADAA,GACA,IAQA,UAPC,GAAD,EACA,IACA,KACA,KAGA,IACA,aAA+B,OAAQ,EAEvC,WADA,kBAUA,OAGA,KACA,OAEA,QAEA,MACA,IACA,OACA,MACK,QAGL,WArBA,OACA,MACA,MAhBA,OAuCA,eAEA,MAEA,uBACA,GAEA,cAaA,IAAI,EACJ,gBAAkC,wB,8FCxSlC,yBAAAA,EAAA,GAEqB,MAEb,EAAO,IAAI2D,WAA2B,EAAhB,EAAOwF,QAE7B,EAAM,EAAOA,OACnB,IAAK,IAAI,EAAI,EAAG,MAAW,EACzB,EAAS,EAAJ,GAAS,EAAoB,EAAZ,MACtB,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,IAGpB,OAAO,GAGT,sCAAAnJ,EAAA,GAEqB,MAEb,EAAO,IAAI2D,WAA2B,EAAhB,EAAOwF,QAE7B,EAAM,EAAOA,OACnB,IAAK,IAAI,EAAI,EAAG,MAAW,EACP,MAAd,KACF,EAAS,EAAJ,EAAQ,GAAK,GAElB,EAAS,EAAJ,GAAS,EAAoB,EAAZ,MACtB,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,KAItB,OAAO,I,6BbpBF,SAAS,EAAT,GACP,KAUO,SAAS,EAAT,GACP,YAYO,SAAS,EAAT,KACP,iCD5BO,SAAS,IAChB,aAAmC,GAOnC,OANM,IAAmB,eACzB,OACA,QAEA,OACA,OACA,EASO,SAAS,EAAT,GACP,aAAmC,GAKnC,OAJC,EAAD,QACA,UACA,UACA,UACA,EAUO,SAAS,EAAT,KAKP,OAJC,EAAD,QACA,UACA,UACA,UACA,EASO,SAAS,EAAT,GAKP,OAJC,EAAD,KACA,OACA,OACA,OACA,EAYO,SAAS,EAAT,SACP,aAAmC,GAKnC,OAJC,EAAD,KACA,OACA,OACA,OACA,EAaO,SAAS,EAAT,WAKP,OAJC,EAAD,KACA,OACA,OACA,OACA,EAUO,SAAS,EAAT,KAGP,UACA,WACA,UACA,YAEC,EAAD,QACA,UACA,UACA,UAGA,SAUO,SAAS,EAAT,SACN,EAAD,KACA,OACA,OACA,OAGA,UAPO,UAYP,MAEA,SACA,UACA,UACA,SAjBO,GAUP,KAmBO,SAAS,EAAT,KAEP,WAMA,OALC,EAAD,QACA,WACA,WACA,OAEA,EASO,SAAS,EAAT,GACP,2BAWO,SAAS,EAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAKA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAWO,SAAS,EAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OAKA,OAJC,EAAD,WACA,aACA,cACA,cACA,EAWO,SAAS,EAAT,OAAc,IACpB,EAAD,KACA,OACA,OACA,OACA,OACA,OAKA,OAJC,EAAD,OACA,SACA,SACA,SACA,EAcO,SAAS,EAAT,SACN,EAAD,KACA,OAKA,OAJC,EAAD,KACA,OACA,QACA,OACA,EAcO,SAAS,EAAT,KAKP,OAJC,EAAD,QACA,OACA,OACA,UACA,EASO,SAAS,EAAT,GACP,qDASO,SAAS,EAAT,GACP,kDAWO,SAAS,EAAT,SAKP,OAJC,EAAD,aACA,UACA,UACA,oBACA,QAWO,SAAS,EAAT,OAKP,OAJC,EAAD,aACA,eACA,eACA,eACA,EAWO,SAAS,EAAT,OAKP,OAJC,EAAD,aACA,eACA,eACA,eACA,EAUO,SAAS,EAAT,KACP,0DAUO,SAAS,EAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eAWtS,SAAS,EAAT,OAKP,OAJC,EAAD,UACA,YACA,YACA,YACA,EAYO,SAAS,EAAT,SAKP,OAJC,EAAD,eACA,iBACA,iBACA,iBACA,Ee1YO,SAAS,IAChB,aAAmC,GASnC,OARM,IAAmB,eACzB,OACA,OACA,OACA,QAEA,OACA,OACA,EASO,SAAS,EAAT,GACP,aAAmC,GAOnC,OANC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,EAUO,SAAS,EAAT,KAOP,OANC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,EASO,SAAS,EAAT,GAOP,OANC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,EAcO,SAAS,EAAT,aACP,aAAmC,GAOnC,OANC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,EAeO,SAAS,EAAT,eAOP,OANC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,EAUO,SAAS,EAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OAEA,UARsB,UAYtB,MAEA,SACA,UACA,UACA,SACA,iBACA,iBAnBsB,GAUtB,KAmBO,SAAS,EAAT,GACP,2BAWO,SAAS,EAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,WACA,aACA,aACA,aACA,eACA,eACA,EAWO,SAAS,EAAT,OAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,WACA,aACA,cACA,cACA,OACA,OACA,EAWO,SAAS,EAAT,OAAc,IACpB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,OACA,SACA,SACA,SACA,OACA,OACA,EAWO,SAAS,EAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,KACA,OACA,OACA,OACA,eACA,eACA,EAcO,SAAS,EAAT,KACP,WACA,OAOA,OANC,EAAD,KACA,OACA,QACA,OACA,OACA,OACA,EAcO,SAAS,GAAT,KAOP,OANC,EAAD,QACA,OACA,OACA,UACA,OACA,OACA,EAcO,SAAS,GAAT,KAOP,OANC,EAAD,KACA,OACA,OACA,OACA,UACA,UACA,EASO,SAAS,GAAT,GACP,0EASO,SAAS,GAAT,GACP,wEAWO,SAAS,GAAT,OAOP,OANC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAOP,OANC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAOP,OANC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,EAYO,SAAS,GAAT,SAOP,OANC,EAAD,eACA,iBACA,iBACA,iBACA,iBACA,iBACA,EAUO,SAAS,GAAT,KACP,oFAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eC1chd,SAAS,KAChB,aAAmC,GAYnC,OAXM,IAAmB,eACzB,OACA,OACA,OACA,OACA,OACA,QAEA,OACA,OACA,OACA,EAUO,SAAS,GAAT,KAUP,OATC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WACA,EASO,SAAS,GAAT,GACP,aAAmC,GAUnC,OATC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EAUO,SAAS,GAAT,KAUP,OATC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EAiBO,SAAS,GAAT,mBACP,aAAmC,GAUnC,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAkBO,SAAS,GAAT,qBAUP,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EASO,SAAS,GAAT,GAUP,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAUO,SAAS,GAAT,KAEP,UACA,WACA,OACA,OACA,UACA,UACA,OACA,UACA,OACA,YAEC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAGA,SAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,UACA,WACA,UAGA,cAhBsB,UAqBtB,MAEA,SACA,kBACA,iBACA,SACA,iBACA,kBACA,SACA,kBACA,iBA/BsB,GAmBtB,KAuBO,SAAS,GAAT,KAAgB,IACtB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAWA,OATC,EAAD,WACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,EASO,SAAS,GAAT,GAAoB,IAC1B,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,4CAWO,SAAS,GAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAaA,OAXC,EAAD,eACA,iBACA,iBAEA,iBACA,iBACA,iBAEA,iBACA,iBACA,iBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAaA,OAXC,EAAD,KACA,OACA,OAEA,OACA,OACA,OAEA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAaA,OAXC,EAAD,WACA,aACA,aAEA,aACA,aACA,aAEA,OACA,OACA,OACA,EAWO,SAAS,GAAT,OACP,WACA,OAaA,OAXC,EAAD,UACA,YACA,YAEA,YACA,YACA,YAEA,UACA,UACA,UACA,EAcO,SAAS,GAAT,KAUP,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,UACA,UACA,OACA,EAcO,SAAS,GAAT,KACP,WACA,OAaA,OAXC,EAAD,KACA,OACA,OAEA,QACA,OACA,OAEA,OACA,OACA,OACA,EAcO,SAAS,GAAT,KAYP,OAXC,EAAD,QACA,OACA,OAEA,OACA,UACA,OAEA,OACA,OACA,OACA,EAUO,SAAS,GAAT,KAYP,OAXC,EAAD,QACA,UACA,OAEA,UACA,UACA,OAEA,UACA,UACA,OACA,EAWO,SAAS,GAAT,SACN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAcA,OAZC,EAAD,SACA,SACA,SAEA,SACA,WACA,SAEA,SACA,SACA,WAEA,EAWO,SAAS,GAAT,SACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAEA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAGA,0BAhCO,UAqCP,MAEA,qBACA,qBACA,qBAEA,qBACA,qBACA,qBAEA,qBACA,qBACA,qBAjDO,GAmCP,KA2BO,SAAS,GAAT,OAUP,OATC,EAAD,OACA,OACA,OACA,OACA,UACA,OACA,QACA,OACA,OACA,EASO,SAAS,GAAT,GACP,uGASO,SAAS,GAAT,GACP,oGAWO,SAAS,GAAT,OAUP,OATC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAUP,OATC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAUP,OATC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,EAYO,SAAS,GAAT,SAUP,OATC,EAAD,eACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,EAUO,SAAS,GAAT,KACP,2HAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eChxB/sB,SAAS,KAChB,aAAmC,IAmBnC,OAlBM,IAAmB,eACzB,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,SAEA,OACA,OACA,QACA,QACA,EASO,SAAS,GAAT,GACP,aAAmC,IAiBnC,OAhBC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,EAUO,SAAS,GAAT,KAiBP,OAhBC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,EAwBO,SAAS,GAAT,8BAAA8B,GACP,aAAmC,IAiBnC,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAyBO,SAAS,GAAT,8BAAAA,EAAA,GAiBP,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EASO,SAAS,GAAT,GAiBP,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAUO,SAAS,GAAT,KAEP,cACC,EAAD,KACA,OACA,OACA,OACA,OACA,QAEA,UACA,UACA,WACA,OACA,UACA,WACA,OACA,OACA,YACA,QACA,QACA,aAEC,EAAD,QACA,UACA,UACA,WACA,UACA,UACA,UACA,WACA,UACA,UACA,YACA,YACA,WACA,WACA,YACA,YAGA,SAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAEA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAGA,0BAhCsB,UAqCtB,MAEA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBAtDsB,GAmCtB,KA+BO,SAAS,GAAT,KAAgB,IACtB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAkBA,OAhBC,EAAD,uCACA,4CACA,yCACA,4CACA,4CACA,yCACA,4CACA,yCACA,yCACA,4CACA,0CACA,6CACA,6CACA,0CACA,6CACA,0CACA,EASO,SAAS,GAAT,GAAoB,IAC1B,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAgBA,OAdA,UAWA,UAVA,UASA,UARA,UAOA,UANA,UAKA,UAJA,UAGA,UAFA,UACA,SAmBO,SAAS,GAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAGA,OACA,OACA,OACA,OAuBA,OAtBC,EAAD,mBACA,qBACA,qBACA,qBAEA,OAAY,OAAU,OAAU,OAChC,qBACA,qBACA,qBACA,qBAEA,OAAY,OAAU,QAAW,QACjC,qBACA,qBACA,sBACA,sBAEA,QAAa,QAAW,QAAW,QACnC,sBACA,sBACA,sBACA,sBACA,EAWO,SAAS,GAAT,OAAkB,IACxB,EAAD,KACA,OACA,OACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SAsBA,OApBC,IAAD,GACA,iCACA,iCACA,kCACA,oCAEA,OAAe,OAAW,OAAW,OACrC,OAAe,OAAW,OAAW,OACrC,OAAe,OAAW,QAAY,QAEtC,OAAiB,KAAAC,EAAa,OAAa,OAC3C,OAAiB,OAAa,OAAa,OAC3C,OAAiB,OAAa,QAAc,QAE5C,wBACA,wBACA,wBACA,yBAGA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OAkBA,OAhBC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,cACA,cACA,YACA,YACA,YACA,YACA,EAYO,SAAS,GAAT,SAAe,IACrB,EAAD,KACA,OACA,OACA,iBACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SA5BsB,OA8BrB,EAAD,GACA,MAIA,GADA,MAEA,KACA,KAEA,OAEA,KADA,QAGA,OAAa,OAAW,OAAW,OACnC,OAAa,OAAW,OAAW,OACnC,OAAa,OAAW,QAAY,QAGpC,UAAsB,YAAwB,YAC9C,YAA0B,UAAoB,YAC9C,YAA0B,YAAwB,UAGlD,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,kBACA,kBAEA,QAEA,YACA,YACA,YACA,aAvEsB,GAoFf,SAAS,GAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QAuBA,OArBC,IAAD,IAEA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,aAIA,aACA,aACA,aACA,aACA,aACA,aACA,cACA,cACA,EAWO,SAAS,GAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QAuBA,OArBC,IAAD,IAEA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,aAIA,aACA,aACA,aACA,aACA,aACA,aACA,cACA,cACA,EAWO,SAAS,GAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAuBA,OArBC,IAAD,IAEA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,aAIA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,EAcO,SAAS,GAAT,KAiBP,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,WACA,WACA,WACA,QACA,EAcO,SAAS,GAAT,KAiBP,OAhBC,EAAD,QACA,OACA,OACA,OACA,OACA,UACA,OACA,OACA,OACA,OACA,WACA,QACA,QACA,QACA,QACA,QACA,EAeO,SAAS,GAAT,OAAqB,IAC3B,EAAD,KACA,OACA,OACA,iBACA,SACA,SACA,SAP4B,OAS3B,EAAD,GACA,MAIA,GADA,MAEA,KACA,KAEA,OAEA,KADA,QAIA,aACA,eACA,eACA,OACA,eACA,aACA,eACA,OACA,eACA,eACA,cACA,QACA,QACA,QACA,QACA,QAtC4B,GAqDrB,SAAS,GAAT,SACN,EAAD,KACA,OAmBA,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,EAcO,SAAS,GAAT,SACN,EAAD,KACA,OAmBA,OAhBC,EAAD,KACA,OACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAcO,SAAS,GAAT,SACN,EAAD,KACA,OAmBA,OAhBC,EAAD,KACA,OACA,OACA,OACA,QACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAkBO,SAAS,GAAT,WAEN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAmBA,OAjBC,EAAD,WACA,SACA,SACA,OACA,SACA,aACA,SACA,OACA,SACA,SACA,cACA,QACA,WACA,WACA,WACA,QAEA,EAUO,SAAS,GAAT,SACN,EAAD,OAA2C,GAC3C,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OAEA,kBAYA,OAVC,EAAD,GACA,2BACA,2BACA,6BAEA,yBACA,yBACA,0BAEA,UACA,EAYO,SAAS,GAAT,KAKP,OAJC,EAAD,SACA,WACA,WAEA,EAaO,SAAS,GAAT,SACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QAMA,OAJC,EAAD,kBACA,oBACA,oBAEA,EAYO,SAAS,GAAT,SAEN,EAAD,gBACA,IA4BA,OA1BC,EAAD,GACA,WACA,WACA,mBACA,mBACA,oBACG,uBACH,yBACA,mBACA,WACA,mBACA,oBACG,YACH,yBACA,mBACA,mBACA,WACA,qBAEA,yBACA,mBACA,mBACA,mBACA,YAGA,EAoBO,SAAS,GAAT,aAEN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,OAmBA,OAjBC,EAAD,eACA,aACA,aACA,OACA,aACA,iBACA,aACA,OACA,aACA,aACA,kBACA,QACA,WACA,WACA,WACA,QAEA,EAuBO,SAAS,GAAT,eAEN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAEA,OACA,OACA,OAEA,OACA,OACA,OAEA,cACA,UACA,UACA,UACA,cACA,UACA,UACA,UACA,cAmBA,OAjBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,2BACA,2BACA,2BACA,QAEA,EAWO,SAAS,GAAT,KAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAsBA,OApBC,EAAD,SACA,SACA,SACA,OAEA,SACA,WACA,SACA,OAEA,SACA,SACA,YACA,QAEA,QACA,QACA,QACA,QAEA,EAeO,SAAS,GAAT,mBACN,EAAD,QACA,UACA,UAiBA,OAhBC,EAAD,SACA,OACA,OACA,OACA,OACA,WACA,OACA,OACA,aACA,aACA,cACA,SACA,QACA,QACA,cACA,QACA,EAcO,SAAS,GAAT,WACP,IACA,EADA,YAwBA,OAtBC,EAAD,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,SACA,QACA,QACA,QACA,kBACA,UACA,cACA,gBAEA,SACA,YAEA,EAcO,SAAS,GAAT,aACN,EAAD,sBACA,0BACA,0BACA,2BACA,UACA,UAkBA,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,iBACA,gBACA,cACA,SACA,QACA,QACA,gBACA,QACA,EAeO,SAAS,GAAT,mBACN,EAAD,QACA,UACA,UAiBA,OAhBC,EAAD,QACA,OACA,OACA,OACA,OACA,UACA,OACA,OACA,OACA,OACA,UACA,QACA,cACA,cACA,cACA,QACA,EAaO,SAAS,GAAT,aACN,OAAD,EACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAnBO,OAqBN,EAAD,SAAiD,WAA+C,UACrF,OAOX,OAJA,OAIA,GAHA,OAGA,GAFA,OAEA,IAQA,KAHA,KAFA,MAEA,GAHA,OAMA,GAFA,KALA,MAKA,KAEA,GADA,WACA,KAOA,GADA,MAEA,KACA,OAPA,IACA,IACA,MAYA,KAJA,WAIA,GAHA,WAGA,GAFA,WAEA,KAOA,GADA,MAEA,KACA,OAPA,IACA,IACA,KAQA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,qBACA,qBACA,qBACA,QAhFO,GA8FA,SAAS,GAAT,aACN,EAAD,KACA,OACA,OACA,OACA,OACA,OAEA,SACA,SACA,SAEA,cACA,MAEA,GADA,SAEA,KACA,MAGA,cACA,UACA,UA0BA,OAvBA,GADC,EAAD,eAGA,GADA,SAEA,KACA,MAGA,OACA,OACA,OACA,OACA,aACA,aACA,aACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EASO,SAAS,GAAT,GACP,mLASO,SAAS,GAAT,GACP,gLAWO,SAAS,GAAT,OAiBP,OAhBC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,EAWO,SAAS,GAAT,OAiBP,OAhBC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,EAWO,SAAS,GAAT,OAiBP,OAhBC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,cACA,cAC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A,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eCjgBtS,SAAS,KAChB,aAAmC,GAOnC,OANM,IAAmB,eACzB,OACA,OACA,QAEA,OACA,EASO,SAAS,GAAT,GAKP,OAJC,EAAD,KACA,OACA,OACA,OACA,EAYO,SAAS,GAAT,OAEP,QAFO,GACP,IAMA,OAJC,EAAD,UACA,YACA,YACA,UACA,EAgBO,SAAS,GAAT,SACN,EAAD,WACA,SAWA,OAVC,EAAD,IACA,YACA,YACA,cAGA,OACA,OACA,QAEA,EAWO,SAAS,GAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,mBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,MADuB,IAGtB,EAAD,KACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAWO,SAAS,GAAT,OACP,MADuB,IAGtB,EAAD,KACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAWO,SAAS,GAAT,OACP,MADuB,IAGtB,EAAD,KACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAYO,SAAS,GAAT,KACP,WACA,OACA,OAMA,OAJC,EAAD,KACA,OACA,OACA,yBACA,EAYO,SAAS,GAAT,aAGN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,SACA,SACA,SACA,SACA,SA+BA,OA1BA,GAFC,EAAD,mBAGA,KACA,KACA,KACA,KACA,MAGA,QAEA,QACA,OACA,eACA,aAIA,MACA,KAGA,aACA,aACA,aACA,aAEA,EASO,SAAS,GAAT,GAAe,IAGrB,EAAU,KACX,EAAW,KACX,EAAW,KAEX,SACA,OAMA,OAJC,EAAD,cACA,gBACA,gBACA,gBACA,EAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,kBACA,UAQA,OAJC,EAAD,QACA,UACA,UACA,SACA,EAWO,SAAS,GAAT,KAKP,OAJC,EAAD,SACA,WACA,WACA,UACA,EAcO,SAAS,GAAT,SAGN,EAAD,eACA,SAEA,OAEA,SACA,UACA,OACA,mBACA,mBACA,uBACG,CAEH,QACA,iBACA,qBAJG,IAKF,GAAD,OACA,UAEA,kCACA,UACA,OACA,2BACA,2BACA,2BAGA,SAaO,SAAS,GAAT,SACP,eAEA,KACA,KAJO,IAMN,EAAD,EAJA,MAKA,OACA,OACA,OACA,OACA,OAOA,OALC,EAAD,eACA,iBACA,iBACA,iBAEA,EASO,SAAS,GAAT,GACP,qDC5YO,SAAS,KAChB,aAAkC,GAWlC,OAVM,IAAmB,eACzB,OACA,OACA,OACA,OACA,OACA,OACA,QAEA,OACA,EAUO,SAAS,GAAT,GACP,aAAkC,GASlC,OARC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EAiBO,SAAS,GAAT,iBACP,aAAkC,GASlC,OARC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAgBO,SAAS,GAAT,eACP,aAAkC,GAClC,OACA,OACA,OACA,OACA,WACA,OACA,OAKA,OAJC,EAAD,eACA,iBACA,iBACA,kBACA,EAYO,SAAS,GAAT,OACP,cACA,UACA,UACA,OACA,OACA,OACA,OASA,OARC,EAAD,KACA,OACA,OACA,OACA,iBACA,iBACA,iBACA,kBACA,EAWO,SAAS,GAAT,KASP,OARC,EAAD,KACA,OACA,OACA,OACA,aACA,aACA,aACA,OACA,EAWO,SAAS,GAAT,KASP,OARC,EAAD,QACA,UACA,UACA,UACA,OACA,OACA,OACA,OACA,EAWO,SAAS,GAAT,KAEP,MAAc,KACZ,QACF,aAAiC,GAGjC,OAFE,QACA,UACF,EAWO,SAAS,GAAT,KASP,OARC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EASO,SAAS,GAAT,GASP,OARC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAkBO,SAAS,GAAT,mBAUP,OATC,EAAD,KACA,OACA,OACA,OAEA,OACA,OACA,OACA,OACA,EAiBO,SAAS,GAAT,KAKP,OAJC,EAAD,QACA,UACA,UACA,UACA,EAqBO,SAAS,GAAT,KAKP,OAJC,EAAD,QACA,UACA,UACA,UACA,EASO,SAAS,GAAT,KACP,WACA,OACA,OACA,OACA,QACA,QACA,QACA,OAIA,OAHC,EAAD,uBACA,yBACA,yBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,UACA,UACA,UACA,OACA,OACA,OACA,OASA,OARC,EAAD,KACA,OACA,OACA,OACA,mBACA,mBACA,mBACA,oBACA,EAWO,SAAS,GAAT,OACP,YACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,kBACA,kBACA,kBACA,kBAUA,OATE,UACF,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,YACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,kBACA,kBACA,kBACA,kBAUA,OATE,UACF,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,YACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,kBACA,kBACA,kBACA,kBAUA,OATE,UACF,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OAcA,OAZC,EAAD,mBACA,qBACA,qBACA,qBACA,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OAcA,OAZC,EAAD,mBACA,qBACA,qBACA,qBACA,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAYO,SAAS,GAAT,SAEP,WACA,OAAW,QAEX,uCAGC,EAAD,EARO,GAOP,IAEA,WACA,WACA,WACA,OAEA,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBAEA,WACA,OACA,OACA,OAMA,OALC,EAAD,mBACA,qBACA,qBACA,qBAEA,EAYO,SAAS,GAAT,OASP,OARC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OASA,OARC,EAAD,mBACA,qBACA,qBACA,qBACA,qCACA,qCACA,qCACA,qCACA,EAkBO,SAAS,GAAT,OASP,OARC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,EAuBO,SAAS,GAAT,SACP,UAYA,OAXS,EAAH,UAAG,MAET,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBAEA,EAUO,SAAS,GAAT,KACP,MAAc,MASd,OARC,EAAD,WACA,aACA,aACA,YACA,aACA,aACA,aACA,YACA,EAWO,SAAS,GAAT,KASP,OARC,EAAD,SACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,EAyCO,SAAS,GAAT,KACP,MAAkB,MAClB,QACA,OADA,IAGC,EAAD,OACA,SACA,SACA,SAEA,OACA,OACA,OACA,OAEA,kBAEA,OACA,OACA,OACA,OAEA,eACA,eACA,eACA,eAEA,SASO,SAAS,GAAT,GACP,8FAUO,SAAS,GAAT,KACP,8GAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eC9zB1nB,SAAS,KAChB,aAAmC,GAKnC,OAJM,IAAmB,eACzB,OACA,QAEA,EASO,SAAS,GAAT,GACP,aAAmC,GAGnC,OAFC,EAAD,QACA,UACA,EAUO,SAAS,GAAT,KACP,aAAmC,GAGnC,OAFC,EAAD,KACA,OACA,EAUO,SAAS,GAAT,KAGP,OAFC,EAAD,QACA,UACA,EAWO,SAAS,GAAT,OAGP,OAFC,EAAD,KACA,OACA,EAWO,SAAS,GAAT,OAGP,OAFC,EAAD,aACA,eACA,EAWO,SAA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","file":"hlviewer.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"HLViewer\"] = factory();\n\telse\n\t\troot[\"HLViewer\"] = factory();\n})(window, function() {\nreturn ","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 3 Dimensional Vector\r\n * @module vec3\r\n */\r\n\r\n/**\r\n * Creates a new, empty vec3\r\n *\r\n * @returns {vec3} a new 3D vector\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(3);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec3 initialized with values from an existing vector\r\n *\r\n * @param {vec3} a vector to clone\r\n * @returns {vec3} a new 3D vector\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(3);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the length of a vec3\r\n *\r\n * @param {vec3} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport function length(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  return Math.sqrt(x * x + y * y + z * z);\r\n}\r\n\r\n/**\r\n * Creates a new vec3 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @returns {vec3} a new 3D vector\r\n */\r\nexport function fromValues(x, y, z) {\r\n  var out = new glMatrix.ARRAY_TYPE(3);\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one vec3 to another\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the source vector\r\n * @returns {vec3} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec3 to the given values\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @returns {vec3} out\r\n */\r\nexport function set(out, x, y, z) {\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  out[0] = a[0] * b[0];\r\n  out[1] = a[1] * b[1];\r\n  out[2] = a[2] * b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Divides two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function divide(out, a, b) {\r\n  out[0] = a[0] / b[0];\r\n  out[1] = a[1] / b[1];\r\n  out[2] = a[2] / b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.ceil the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to ceil\r\n * @returns {vec3} out\r\n */\r\nexport function ceil(out, a) {\r\n  out[0] = Math.ceil(a[0]);\r\n  out[1] = Math.ceil(a[1]);\r\n  out[2] = Math.ceil(a[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.floor the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to floor\r\n * @returns {vec3} out\r\n */\r\nexport function floor(out, a) {\r\n  out[0] = Math.floor(a[0]);\r\n  out[1] = Math.floor(a[1]);\r\n  out[2] = Math.floor(a[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the minimum of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function min(out, a, b) {\r\n  out[0] = Math.min(a[0], b[0]);\r\n  out[1] = Math.min(a[1], b[1]);\r\n  out[2] = Math.min(a[2], b[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the maximum of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function max(out, a, b) {\r\n  out[0] = Math.max(a[0], b[0]);\r\n  out[1] = Math.max(a[1], b[1]);\r\n  out[2] = Math.max(a[2], b[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.round the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to round\r\n * @returns {vec3} out\r\n */\r\nexport function round(out, a) {\r\n  out[0] = Math.round(a[0]);\r\n  out[1] = Math.round(a[1]);\r\n  out[2] = Math.round(a[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales a vec3 by a scalar number\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec3} out\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec3's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec3} out\r\n */\r\nexport function scaleAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nexport function distance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  return Math.sqrt(x * x + y * y + z * z);\r\n}\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nexport function squaredDistance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  return x * x + y * y + z * z;\r\n}\r\n\r\n/**\r\n * Calculates the squared length of a vec3\r\n *\r\n * @param {vec3} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nexport function squaredLength(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  return x * x + y * y + z * z;\r\n}\r\n\r\n/**\r\n * Negates the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to negate\r\n * @returns {vec3} out\r\n */\r\nexport function negate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the inverse of the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to invert\r\n * @returns {vec3} out\r\n */\r\nexport function inverse(out, a) {\r\n  out[0] = 1.0 / a[0];\r\n  out[1] = 1.0 / a[1];\r\n  out[2] = 1.0 / a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Normalize a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to normalize\r\n * @returns {vec3} out\r\n */\r\nexport function normalize(out, a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var len = x * x + y * y + z * z;\r\n  if (len > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len = 1 / Math.sqrt(len);\r\n    out[0] = a[0] * len;\r\n    out[1] = a[1] * len;\r\n    out[2] = a[2] * len;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nexport function dot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n}\r\n\r\n/**\r\n * Computes the cross product of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function cross(out, a, b) {\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2];\r\n  var bx = b[0],\r\n      by = b[1],\r\n      bz = b[2];\r\n\r\n  out[0] = ay * bz - az * by;\r\n  out[1] = az * bx - ax * bz;\r\n  out[2] = ax * by - ay * bx;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation between two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec3} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var ax = a[0];\r\n  var ay = a[1];\r\n  var az = a[2];\r\n  out[0] = ax + t * (b[0] - ax);\r\n  out[1] = ay + t * (b[1] - ay);\r\n  out[2] = az + t * (b[2] - az);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a hermite interpolation with two control points\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {vec3} c the third operand\r\n * @param {vec3} d the fourth operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec3} out\r\n */\r\nexport function hermite(out, a, b, c, d, t) {\r\n  var factorTimes2 = t * t;\r\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\r\n  var factor2 = factorTimes2 * (t - 2) + t;\r\n  var factor3 = factorTimes2 * (t - 1);\r\n  var factor4 = factorTimes2 * (3 - 2 * t);\r\n\r\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\r\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\r\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a bezier interpolation with two control points\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {vec3} c the third operand\r\n * @param {vec3} d the fourth operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec3} out\r\n */\r\nexport function bezier(out, a, b, c, d, t) {\r\n  var inverseFactor = 1 - t;\r\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\r\n  var factorTimes2 = t * t;\r\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\r\n  var factor2 = 3 * t * inverseFactorTimesTwo;\r\n  var factor3 = 3 * factorTimes2 * inverseFactor;\r\n  var factor4 = factorTimes2 * t;\r\n\r\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\r\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\r\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec3} out\r\n */\r\nexport function random(out, scale) {\r\n  scale = scale || 1.0;\r\n\r\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\r\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\r\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\r\n\r\n  out[0] = Math.cos(r) * zScale;\r\n  out[1] = Math.sin(r) * zScale;\r\n  out[2] = z * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec3 with a mat4.\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec3} out\r\n */\r\nexport function transformMat4(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\r\n  w = w || 1.0;\r\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\r\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\r\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec3 with a mat3.\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {mat3} m the 3x3 matrix to transform with\r\n * @returns {vec3} out\r\n */\r\nexport function transformMat3(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  out[0] = x * m[0] + y * m[3] + z * m[6];\r\n  out[1] = x * m[1] + y * m[4] + z * m[7];\r\n  out[2] = x * m[2] + y * m[5] + z * m[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec3 with a quat\r\n * Can also be used for dual quaternions. (Multiply it with the real part)\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec3} out\r\n */\r\nexport function transformQuat(out, a, q) {\r\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3];\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  // var qvec = [qx, qy, qz];\r\n  // var uv = vec3.cross([], qvec, a);\r\n  var uvx = qy * z - qz * y,\r\n      uvy = qz * x - qx * z,\r\n      uvz = qx * y - qy * x;\r\n  // var uuv = vec3.cross([], qvec, uv);\r\n  var uuvx = qy * uvz - qz * uvy,\r\n      uuvy = qz * uvx - qx * uvz,\r\n      uuvz = qx * uvy - qy * uvx;\r\n  // vec3.scale(uv, uv, 2 * w);\r\n  var w2 = qw * 2;\r\n  uvx *= w2;\r\n  uvy *= w2;\r\n  uvz *= w2;\r\n  // vec3.scale(uuv, uuv, 2);\r\n  uuvx *= 2;\r\n  uuvy *= 2;\r\n  uuvz *= 2;\r\n  // return vec3.add(out, a, vec3.add(out, uv, uuv));\r\n  out[0] = x + uvx + uuvx;\r\n  out[1] = y + uvy + uuvy;\r\n  out[2] = z + uvz + uuvz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 3D vector around the x-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nexport function rotateX(out, a, b, c) {\r\n  var p = [],\r\n      r = [];\r\n  //Translate point to the origin\r\n  p[0] = a[0] - b[0];\r\n  p[1] = a[1] - b[1];\r\n  p[2] = a[2] - b[2];\r\n\r\n  //perform rotation\r\n  r[0] = p[0];\r\n  r[1] = p[1] * Math.cos(c) - p[2] * Math.sin(c);\r\n  r[2] = p[1] * Math.sin(c) + p[2] * Math.cos(c);\r\n\r\n  //translate to correct position\r\n  out[0] = r[0] + b[0];\r\n  out[1] = r[1] + b[1];\r\n  out[2] = r[2] + b[2];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 3D vector around the y-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nexport function rotateY(out, a, b, c) {\r\n  var p = [],\r\n      r = [];\r\n  //Translate point to the origin\r\n  p[0] = a[0] - b[0];\r\n  p[1] = a[1] - b[1];\r\n  p[2] = a[2] - b[2];\r\n\r\n  //perform rotation\r\n  r[0] = p[2] * Math.sin(c) + p[0] * Math.cos(c);\r\n  r[1] = p[1];\r\n  r[2] = p[2] * Math.cos(c) - p[0] * Math.sin(c);\r\n\r\n  //translate to correct position\r\n  out[0] = r[0] + b[0];\r\n  out[1] = r[1] + b[1];\r\n  out[2] = r[2] + b[2];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 3D vector around the z-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nexport function rotateZ(out, a, b, c) {\r\n  var p = [],\r\n      r = [];\r\n  //Translate point to the origin\r\n  p[0] = a[0] - b[0];\r\n  p[1] = a[1] - b[1];\r\n  p[2] = a[2] - b[2];\r\n\r\n  //perform rotation\r\n  r[0] = p[0] * Math.cos(c) - p[1] * Math.sin(c);\r\n  r[1] = p[0] * Math.sin(c) + p[1] * Math.cos(c);\r\n  r[2] = p[2];\r\n\r\n  //translate to correct position\r\n  out[0] = r[0] + b[0];\r\n  out[1] = r[1] + b[1];\r\n  out[2] = r[2] + b[2];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Get the angle between two 3D vectors\r\n * @param {vec3} a The first operand\r\n * @param {vec3} b The second operand\r\n * @returns {Number} The angle in radians\r\n */\r\nexport function angle(a, b) {\r\n  var tempA = fromValues(a[0], a[1], a[2]);\r\n  var tempB = fromValues(b[0], b[1], b[2]);\r\n\r\n  normalize(tempA, tempA);\r\n  normalize(tempB, tempB);\r\n\r\n  var cosine = dot(tempA, tempB);\r\n\r\n  if (cosine > 1.0) {\r\n    return 0;\r\n  } else if (cosine < -1.0) {\r\n    return Math.PI;\r\n  } else {\r\n    return Math.acos(cosine);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec3} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'vec3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec3} a The first vector.\r\n * @param {vec3} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec3} a The first vector.\r\n * @param {vec3} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\r\n}\r\n\r\n/**\r\n * Alias for {@link vec3.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;\r\n\r\n/**\r\n * Alias for {@link vec3.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link vec3.divide}\r\n * @function\r\n */\r\nexport var div = divide;\r\n\r\n/**\r\n * Alias for {@link vec3.distance}\r\n * @function\r\n */\r\nexport var dist = distance;\r\n\r\n/**\r\n * Alias for {@link vec3.squaredDistance}\r\n * @function\r\n */\r\nexport var sqrDist = squaredDistance;\r\n\r\n/**\r\n * Alias for {@link vec3.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Alias for {@link vec3.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Perform some operation over an array of vec3s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nexport var forEach = function () {\r\n  var vec = create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i = void 0,\r\n        l = void 0;\r\n    if (!stride) {\r\n      stride = 3;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min(count * stride + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec[0] = a[i];vec[1] = a[i + 1];vec[2] = a[i + 2];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec[0];a[i + 1] = vec[1];a[i + 2] = vec[2];\r\n    }\r\n\r\n    return a;\r\n  };\r\n}();","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 2x2 Matrix\r\n * @module mat2\r\n */\r\n\r\n/**\r\n * Creates a new identity mat2\r\n *\r\n * @returns {mat2} a new 2x2 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat2 initialized with values from an existing matrix\r\n *\r\n * @param {mat2} a matrix to clone\r\n * @returns {mat2} a new 2x2 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat2 to another\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat2 to the identity matrix\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @returns {mat2} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat2 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 2)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 3)\r\n * @returns {mat2} out A new 2x2 matrix\r\n */\r\nexport function fromValues(m00, m01, m10, m11) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m10;\r\n  out[3] = m11;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat2 to the given values\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 2)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 3)\r\n * @returns {mat2} out\r\n */\r\nexport function set(out, m00, m01, m10, m11) {\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m10;\r\n  out[3] = m11;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transpose the values of a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function transpose(out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache\r\n  // some values\r\n  if (out === a) {\r\n    var a1 = a[1];\r\n    out[1] = a[2];\r\n    out[2] = a1;\r\n  } else {\r\n    out[0] = a[0];\r\n    out[1] = a[2];\r\n    out[2] = a[1];\r\n    out[3] = a[3];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function invert(out, a) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n\r\n  // Calculate the determinant\r\n  var det = a0 * a3 - a2 * a1;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = a3 * det;\r\n  out[1] = -a1 * det;\r\n  out[2] = -a2 * det;\r\n  out[3] = a0 * det;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the adjugate of a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function adjoint(out, a) {\r\n  // Caching this value is nessecary if out == a\r\n  var a0 = a[0];\r\n  out[0] = a[3];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = a0;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat2\r\n *\r\n * @param {mat2} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  return a[0] * a[3] - a[2] * a[1];\r\n}\r\n\r\n/**\r\n * Multiplies two mat2's\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  out[0] = a0 * b0 + a2 * b1;\r\n  out[1] = a1 * b0 + a3 * b1;\r\n  out[2] = a0 * b2 + a2 * b3;\r\n  out[3] = a1 * b2 + a3 * b3;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat2 by the given angle\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2} out\r\n */\r\nexport function rotate(out, a, rad) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  out[0] = a0 * c + a2 * s;\r\n  out[1] = a1 * c + a3 * s;\r\n  out[2] = a0 * -s + a2 * c;\r\n  out[3] = a1 * -s + a3 * c;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales the mat2 by the dimensions in the given vec2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to rotate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat2} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var v0 = v[0],\r\n      v1 = v[1];\r\n  out[0] = a0 * v0;\r\n  out[1] = a1 * v0;\r\n  out[2] = a2 * v1;\r\n  out[3] = a3 * v1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2.identity(dest);\r\n *     mat2.rotate(dest, dest, rad);\r\n *\r\n * @param {mat2} out mat2 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2} out\r\n */\r\nexport function fromRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = -s;\r\n  out[3] = c;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2.identity(dest);\r\n *     mat2.scale(dest, dest, vec);\r\n *\r\n * @param {mat2} out mat2 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat2} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = v[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a mat2\r\n *\r\n * @param {mat2} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat2(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat2\r\n *\r\n * @param {mat2} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2));\r\n}\r\n\r\n/**\r\n * Returns L, D and U matrices (Lower triangular, Diagonal and Upper triangular) by factorizing the input matrix\r\n * @param {mat2} L the lower triangular matrix\r\n * @param {mat2} D the diagonal matrix\r\n * @param {mat2} U the upper triangular matrix\r\n * @param {mat2} a the input matrix to factorize\r\n */\r\n\r\nexport function LDU(L, D, U, a) {\r\n  L[2] = a[2] / a[0];\r\n  U[0] = a[0];\r\n  U[1] = a[1];\r\n  U[3] = a[3] - L[2] * U[1];\r\n  return [L, D, U];\r\n}\r\n\r\n/**\r\n * Adds two mat2's\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat2} a The first matrix.\r\n * @param {mat2} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat2} a The first matrix.\r\n * @param {mat2} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat2} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat2's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat2} out the receiving vector\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat2} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Alias for {@link mat2.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat2.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","/**\r\n * Common utilities\r\n * @module glMatrix\r\n */\r\n\r\n// Configuration Constants\r\nexport var EPSILON = 0.000001;\r\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\r\nexport var RANDOM = Math.random;\r\n\r\n/**\r\n * Sets the type of array used when creating new vectors and matrices\r\n *\r\n * @param {Type} type Array type, such as Float32Array or Array\r\n */\r\nexport function setMatrixArrayType(type) {\r\n  ARRAY_TYPE = type;\r\n}\r\n\r\nvar degree = Math.PI / 180;\r\n\r\n/**\r\n * Convert Degree To Radian\r\n *\r\n * @param {Number} a Angle in Degrees\r\n */\r\nexport function toRadian(a) {\r\n  return a * degree;\r\n}\r\n\r\n/**\r\n * Tests whether or not the arguments have approximately the same value, within an absolute\r\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\r\n * than or equal to 1.0, and a relative tolerance is used for larger values)\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\r\n}","import { EventEmitter } from 'events'\r\nimport { Bsp } from './Bsp'\r\nimport * as Time from './Time'\r\nimport { Mouse } from './Mouse'\r\nimport { Sound } from './Sound'\r\nimport { Loader } from './Loader'\r\nimport { Replay } from './Replay'\r\nimport { Keyboard } from './Keyboard'\r\nimport { SoundSystem } from './SoundSystem'\r\nimport { ReplayPlayer } from './ReplayPlayer'\r\nimport { Camera } from './Graphics/Camera'\r\nimport { Context } from './Graphics/Context'\r\nimport { Renderer } from './Graphics/Renderer'\r\nimport { SkyScene } from './Graphics/SkyScene'\r\nimport { WorldScene } from './Graphics/WorldScene'\r\nimport { Config } from './Config';\r\n\r\nconst checkWebGLSupport = () => {\r\n  const MESSAGES = {\r\n    BAD_BROWSER: 'Your browser does not seem to support WebGL',\r\n    BAD_GPU: 'Your graphics card does not seem to support WebGL'\r\n  }\r\n\r\n  const wnd: any = window\r\n  if (!wnd.WebGLRenderingContext) {\r\n    return {\r\n      hasSupport: false,\r\n      message: MESSAGES.BAD_BROWSER\r\n    }\r\n  }\r\n\r\n  const c = document.createElement('canvas')\r\n  try {\r\n    const ctx = c.getContext('webgl') || c.getContext('experimental-webgl')\r\n    if (ctx) {\r\n      return {\r\n        hasSupport: true,\r\n        message: ''\r\n      }\r\n    } else {\r\n      return {\r\n        hasSupport: false,\r\n        message: MESSAGES.BAD_GPU\r\n      }\r\n    }\r\n  } catch (e) {\r\n    return {\r\n      hasSupport: false,\r\n      message: MESSAGES.BAD_GPU\r\n    }\r\n  }\r\n}\r\n\r\nexport enum PlayerMode {\r\n  FREE,\r\n  REPLAY\r\n}\r\n\r\nexport class Game {\r\n  error: boolean\r\n  errorMessage: string\r\n  config: Config\r\n\r\n  pauseTime: number = 0\r\n  isPaused: boolean = false\r\n  lastTime: number = 0\r\n  accumTime: number = 0\r\n  readonly timeStep: number = 1 / 60\r\n\r\n  title: string\r\n  mode: PlayerMode\r\n  pointerLocked: boolean = false\r\n\r\n  mouse: Mouse\r\n  keyboard: Keyboard\r\n\r\n  loader: Loader\r\n  entities: any[] = []\r\n  soundSystem: SoundSystem\r\n  sounds: Sound[]\r\n  events: EventEmitter\r\n  player: ReplayPlayer\r\n\r\n  canvas: HTMLCanvasElement\r\n  width: number\r\n  height: number\r\n  mapName: string\r\n  context: Context\r\n  camera: Camera\r\n  renderer: Renderer\r\n  worldScene: WorldScene\r\n  skyScene: SkyScene\r\n\r\n  constructor(config: Config) {\r\n    const status = checkWebGLSupport()\r\n    if (!status.hasSupport) {\r\n      this.error = true\r\n      this.errorMessage = 'No WebGL support!'\r\n\r\n      return\r\n    } else {\r\n      this.error = false\r\n      this.errorMessage = ''\r\n    }\r\n\r\n    this.mouse = new Mouse()\r\n    this.keyboard = new Keyboard()\r\n    this.soundSystem = new SoundSystem()\r\n    this.sounds = []\r\n\r\n    this.config = config\r\n    this.loader = new Loader(this)\r\n    this.loader.events.addListener('loadall', (loader: Loader) => {\r\n      if (loader && loader.replay) {\r\n        this.changeReplay(loader.replay.data)\r\n      }\r\n\r\n      if (!loader.map || !loader.map.data) {\r\n        return\r\n      }\r\n\r\n      const map = loader.map.data\r\n      const skies = loader.skies\r\n      let skiesValid = true\r\n      skies.forEach(sky => {\r\n        skiesValid = skiesValid && sky.isDone()\r\n      })\r\n      if (skiesValid) {\r\n        skies.forEach(sky => (sky.data ? map.skies.push(sky.data) : 0))\r\n      }\r\n\r\n      // add sprites\r\n      Object.entries(loader.sprites).forEach(([name, item]) => {\r\n        if (item.data) {\r\n          map.sprites[name] = item.data\r\n        }\r\n      })\r\n\r\n      if (loader.sounds.length > 0) {\r\n        loader.sounds.forEach(sound => {\r\n          if (sound.data) {\r\n            this.sounds.push(sound.data)\r\n          }\r\n        })\r\n      }\r\n\r\n      this.changeMap(map)\r\n\r\n      this.events.emit('load', loader)\r\n    })\r\n\r\n    document.addEventListener('mousemove', this.mouseMove, false)\r\n    window.addEventListener('keydown', this.keyDown)\r\n    window.addEventListener('keyup', this.keyUp)\r\n    window.addEventListener('visibilitychange', this.onVisibilityChange)\r\n\r\n    const canvas = this.getCanvas()\r\n\r\n    this.camera = Camera.init(canvas.width / canvas.height)\r\n\r\n    const context = Context.init(canvas)\r\n    if (!context) {\r\n      throw new Error(`contextn\\'t`)\r\n    }\r\n    this.context = context\r\n\r\n    const renderer = Renderer.init(context)\r\n    if (!renderer) {\r\n      throw new Error('Failed to initialize renderer')\r\n    }\r\n    this.renderer = renderer\r\n\r\n    const worldScene = WorldScene.init(context)\r\n    if (!worldScene) {\r\n      throw new Error('Failed to initialize world scene')\r\n    }\r\n    this.worldScene = worldScene\r\n\r\n    const skyScene = SkyScene.init(context)\r\n    if (!skyScene) {\r\n      throw new Error('Failed to initialize sky scene')\r\n    }\r\n    this.skyScene = skyScene\r\n\r\n    this.mode = PlayerMode.FREE\r\n\r\n    this.player = new ReplayPlayer(this)\r\n    this.events = new EventEmitter()\r\n\r\n    this.mapName = ''\r\n  }\r\n\r\n  getCanvas() {\r\n    if (!this.canvas) {\r\n      this.canvas = document.createElement('canvas')\r\n    }\r\n\r\n    return this.canvas\r\n  }\r\n\r\n  load(name: string) {\r\n    this.events.emit('loadstart')\r\n    this.loader.load(name)\r\n  }\r\n\r\n  changeMap(map: Bsp) {\r\n    if (this.mapName.toLowerCase() === map.name.toLowerCase()) {\r\n      return\r\n    }\r\n\r\n    this.mapName = map.name\r\n\r\n    this.worldScene.changeMap(map)\r\n    this.skyScene.changeMap(map)\r\n\r\n    this.entities = map.entities\r\n\r\n    const spawn = map.entities.find(e => e['classname'] === 'info_player_start')\r\n\r\n    if (spawn) {\r\n      this.camera.position[0] = spawn.origin[0]\r\n      this.camera.position[1] = spawn.origin[1]\r\n      this.camera.position[2] = spawn.origin[2]\r\n    } else {\r\n      this.camera.position[0] = 0\r\n      this.camera.position[1] = 0\r\n      this.camera.position[2] = 0\r\n    }\r\n\r\n    this.camera.rotation[0] = 0 // Math.PI / 2\r\n    this.camera.rotation[1] = 0\r\n    this.camera.rotation[2] = 0\r\n  }\r\n\r\n  changeReplay(replay: Replay) {\r\n    this.events.emit('prereplaychange', this, replay)\r\n\r\n    this.player.changeReplay(replay)\r\n\r\n    this.events.emit('postreplaychange', this, replay)\r\n  }\r\n\r\n  changeMode(mode: PlayerMode) {\r\n    this.mode = mode\r\n    this.events.emit('modechange', mode)\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this.title = title\r\n    this.events.emit('titlechange', title)\r\n  }\r\n\r\n  getTitle() {\r\n    return this.title\r\n  }\r\n\r\n  draw = () => {\r\n    requestAnimationFrame(this.draw)\r\n\r\n    const canvas = this.canvas\r\n    const parent = canvas.parentElement\r\n    if (parent) {\r\n      const pw = parent.clientWidth\r\n      const ph = parent.clientHeight\r\n      if (canvas.width !== pw || canvas.height !== ph) {\r\n        canvas.width = pw\r\n        canvas.height = ph\r\n        this.camera.aspect = canvas.clientWidth / canvas.clientHeight\r\n        this.camera.updateProjectionMatrix()\r\n        this.context.gl.viewport(\r\n          0,\r\n          0,\r\n          this.context.gl.drawingBufferWidth,\r\n          this.context.gl.drawingBufferHeight\r\n        )\r\n      }\r\n\r\n      if (\r\n        canvas.clientWidth !== canvas.width ||\r\n        canvas.clientHeight !== canvas.height\r\n      ) {\r\n        canvas.width = canvas.clientWidth\r\n        canvas.height = canvas.clientHeight\r\n        this.camera.aspect = canvas.clientWidth / canvas.clientHeight\r\n        this.camera.updateProjectionMatrix()\r\n        this.context.gl.viewport(\r\n          0,\r\n          0,\r\n          this.context.gl.drawingBufferWidth,\r\n          this.context.gl.drawingBufferHeight\r\n        )\r\n      }\r\n    }\r\n\r\n    const currTime = Time.now() / 1000\r\n    const dt = currTime - this.lastTime\r\n    this.accumTime += dt\r\n\r\n    while (this.accumTime > this.timeStep) {\r\n      this.update(this.timeStep)\r\n      this.accumTime -= this.timeStep\r\n    }\r\n\r\n    this.renderer.draw()\r\n    if (this.mapName !== '') {\r\n      this.skyScene.draw(this.camera)\r\n      this.worldScene.draw(this.camera, this.entities)\r\n    }\r\n\r\n    this.lastTime = currTime\r\n  }\r\n\r\n  update(dt: number) {\r\n    this.events.emit('preupdate', this)\r\n\r\n    const camera = this.camera\r\n    const keyboard = this.keyboard\r\n    const mouse = this.mouse\r\n\r\n    if (this.mode === PlayerMode.REPLAY) {\r\n      this.player.update(dt)\r\n    } else if (this.mode === PlayerMode.FREE && this.pointerLocked) {\r\n      camera.rotation[0] = Math.min(\r\n        Math.max(camera.rotation[0] + mouse.delta.y / 100, -Math.PI / 2),\r\n        Math.PI / 2\r\n      )\r\n\r\n      camera.rotation[1] -= mouse.delta.x / 100\r\n\r\n      const speed = 500\r\n      const ds = speed * dt\r\n      const KEY_W = Keyboard.KEYS.W\r\n      const KEY_S = Keyboard.KEYS.S\r\n      const KEY_A = Keyboard.KEYS.A\r\n      const KEY_D = Keyboard.KEYS.D\r\n      const downKey = Keyboard.KEYS.C\r\n      const upKey = Keyboard.KEYS.SPACE\r\n      if (keyboard.keys[KEY_W] !== keyboard.keys[KEY_S]) {\r\n        if (keyboard.keys[KEY_W]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1] + Math.PI / 2) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1] + Math.PI / 2) * ds\r\n        } else if (keyboard.keys[KEY_S]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1] - Math.PI / 2) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1] - Math.PI / 2) * ds\r\n        }\r\n      }\r\n\r\n      if (keyboard.keys[KEY_A] !== keyboard.keys[KEY_D]) {\r\n        if (keyboard.keys[KEY_A]) {\r\n          camera.position[1] += Math.cos(camera.rotation[1]) * ds\r\n          camera.position[0] -= Math.sin(camera.rotation[1]) * ds\r\n        } else if (keyboard.keys[KEY_D]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1]) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1]) * ds\r\n        }\r\n      }\r\n\r\n      if (keyboard.keys[upKey] !== keyboard.keys[downKey]) {\r\n        if (keyboard.keys[upKey]) {\r\n          camera.position[2] += ds\r\n        } else if (keyboard.keys[downKey]) {\r\n          camera.position[2] -= ds\r\n        }\r\n      }\r\n    }\r\n\r\n    mouse.delta.x = 0\r\n    mouse.delta.y = 0\r\n\r\n    this.events.emit('postupdate', this)\r\n  }\r\n\r\n  on(eventName: string, callback: (...args: any[]) => void) {\r\n    return this.events.addListener(eventName, callback)\r\n  }\r\n\r\n  off(eventName: string, callback: (...args: any[]) => void) {\r\n    this.events.removeListener(eventName, callback)\r\n  }\r\n\r\n  mouseMove = (e: MouseEvent) => {\r\n    this.mouse.delta.x = e.movementX * 0.5 // mul 0.5 to lower sensitivity\r\n    this.mouse.delta.y = e.movementY * 0.5 //\r\n\r\n    this.mouse.position.x = e.pageX\r\n    this.mouse.position.y = e.pageY\r\n  }\r\n\r\n  keyDown = (e: KeyboardEvent) => {\r\n    this.keyboard.keys[e.which] = 1\r\n\r\n    if (this.pointerLocked) {\r\n      e.preventDefault()\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  keyUp = (e: KeyboardEvent) => {\r\n    this.keyboard.keys[e.which] = 0\r\n\r\n    if (this.pointerLocked) {\r\n      e.preventDefault()\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  onVisibilityChange = () => {\r\n    if (document.hidden) {\r\n      if (this.isPaused) {\r\n        return\r\n      }\r\n\r\n      this.pauseTime = Time.now() / 1000\r\n      this.isPaused = true\r\n    } else {\r\n      if (!this.isPaused) {\r\n        return\r\n      }\r\n\r\n      this.lastTime = Time.now() / 1000 - this.pauseTime + this.lastTime\r\n      this.isPaused = false\r\n    }\r\n  }\r\n}\r\n","export enum ReaderDataType {\r\n  UByte = 0,\r\n  Byte = 1,\r\n  UShort = 2,\r\n  Short = 3,\r\n  UInt = 4,\r\n  Int = 5,\r\n  Float = 6,\r\n  Double = 7,\r\n  NString = 8,\r\n  String = 9\r\n}\r\n\r\nexport class Reader {\r\n  data: DataView\r\n  offset: number\r\n\r\n  constructor(data: ArrayBuffer) {\r\n    if (data.byteLength === 0) {\r\n      throw new Error('ArrayBuffer must have size greater than zero')\r\n    }\r\n\r\n    this.data = new DataView(data)\r\n    this.offset = 0\r\n  }\r\n\r\n  length() {\r\n    return this.data.byteLength\r\n  }\r\n\r\n  tell() {\r\n    return this.offset\r\n  }\r\n\r\n  seek(offset: number) {\r\n    this.offset = Math.max(0, offset)\r\n  }\r\n\r\n  skip(offset: number) {\r\n    this.seek(this.tell() + offset)\r\n  }\r\n\r\n  b() {\r\n    const r = this.data.getInt8(this.offset)\r\n    this.skip(1)\r\n    return r\r\n  }\r\n\r\n  ub() {\r\n    const r = this.data.getUint8(this.offset)\r\n    this.skip(1)\r\n    return r\r\n  }\r\n\r\n  s(isLittleEndian = true) {\r\n    const r = this.data.getInt16(this.offset, isLittleEndian)\r\n    this.skip(2)\r\n    return r\r\n  }\r\n\r\n  us(isLittleEndian = true) {\r\n    const r = this.data.getUint16(this.offset, isLittleEndian)\r\n    this.skip(2)\r\n    return r\r\n  }\r\n\r\n  i(isLittleEndian = true) {\r\n    const r = this.data.getInt32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  ui(isLittleEndian = true) {\r\n    const r = this.data.getUint32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  f(isLittleEndian = true) {\r\n    const r = this.data.getFloat32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  lf(isLittleEndian = true) {\r\n    const r = this.data.getFloat64(this.tell(), isLittleEndian)\r\n    this.skip(8)\r\n    return r\r\n  }\r\n\r\n  str() {\r\n    let t = this.ub()\r\n    let r = ''\r\n    while (t !== 0) {\r\n      r += String.fromCharCode(t)\r\n      t = this.ub()\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  nstr(n: number) {\r\n    if (n < 0) {\r\n      throw new Error('Invalid string length')\r\n    }\r\n\r\n    let r = ''\r\n    while (n > 0) {\r\n      n -= 1\r\n      const charCode = this.ub()\r\n      if (charCode === 0) {\r\n        break\r\n      }\r\n\r\n      r += String.fromCharCode(charCode)\r\n    }\r\n\r\n    if (n !== 0) {\r\n      this.skip(n)\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  arr(n: number, f: () => any) {\r\n    f.bind(this)\r\n    const r = []\r\n    while (n-- > 0) {\r\n      r.push(f())\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  arrx(n: number, type: ReaderDataType, nstrlen = 0) {\r\n    let r: any\r\n\r\n    switch (type) {\r\n      case ReaderDataType.UByte: {\r\n        r = new Uint8Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n)\r\n        break\r\n      }\r\n\r\n      case ReaderDataType.Byte: {\r\n        r = new Int8Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n)\r\n        break\r\n      }\r\n\r\n      case ReaderDataType.UShort:\r\n        r = new Uint16Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 2)\r\n        break\r\n\r\n      case ReaderDataType.Short:\r\n        r = new Int16Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 2)\r\n        break\r\n\r\n      case ReaderDataType.UInt:\r\n        r = new Uint32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Int:\r\n        r = new Int32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Float:\r\n        r = new Float32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Double:\r\n        r = new Float64Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 8)\r\n        break\r\n\r\n      case ReaderDataType.NString:\r\n        r = []\r\n        while (n-- > 0) {\r\n          r.push(r.nstr(nstrlen))\r\n        }\r\n        break\r\n\r\n      case ReaderDataType.String:\r\n        r = []\r\n        while (n-- > 0) {\r\n          r.push(r.str())\r\n        }\r\n        break\r\n    }\r\n\r\n    return r\r\n  }\r\n}\r\n"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","import * as FreeStyle from 'free-style';\n/**\n * We need to do the following to *our* objects before passing to freestyle:\n * - For any `$nest` directive move up to FreeStyle style nesting\n * - For any `$unique` directive map to FreeStyle Unique\n * - For any `$debugName` directive return the debug name\n */\nexport function ensureStringObj(object) {\n    /** The final result we will return */\n    var result = {};\n    var debugName = '';\n    for (var key in object) {\n        /** Grab the value upfront */\n        var val = object[key];\n        /** TypeStyle configuration options */\n        if (key === '$unique') {\n            result[FreeStyle.IS_UNIQUE] = val;\n        }\n        else if (key === '$nest') {\n            var nested = val;\n            for (var selector in nested) {\n                var subproperties = nested[selector];\n                result[selector] = ensureStringObj(subproperties).result;\n            }\n        }\n        else if (key === '$debugName') {\n            debugName = val;\n        }\n        else {\n            result[key] = val;\n        }\n    }\n    return { result: result, debugName: debugName };\n}\n// todo: better name here\nexport function explodeKeyframes(frames) {\n    var result = { $debugName: undefined, keyframes: {} };\n    for (var offset in frames) {\n        var val = frames[offset];\n        if (offset === '$debugName') {\n            result.$debugName = val;\n        }\n        else {\n            result.keyframes[offset] = val;\n        }\n    }\n    return result;\n}\n","/** Raf for node + browser */\nexport var raf = typeof requestAnimationFrame === 'undefined'\n    /**\n     * Make sure setTimeout is always invoked with\n     * `this` set to `window` or `global` automatically\n     **/\n    ? function (cb) { return setTimeout(cb); }\n    /**\n     * Make sure window.requestAnimationFrame is always invoked with `this` window\n     * We might have raf without window in case of `raf/polyfill` (recommended by React)\n     **/\n    : typeof window === 'undefined'\n        ? requestAnimationFrame\n        : requestAnimationFrame.bind(window);\n/**\n * Utility to join classes conditionally\n */\nexport function classes() {\n    var classes = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        classes[_i] = arguments[_i];\n    }\n    return classes\n        .map(function (c) { return c && typeof c === 'object' ? Object.keys(c).map(function (key) { return !!c[key] && key; }) : [c]; })\n        .reduce(function (flattened, c) { return flattened.concat(c); }, [])\n        .filter(function (c) { return !!c; })\n        .join(' ');\n}\n/**\n * Merges various styles into a single style object.\n * Note: if two objects have the same property the last one wins\n */\nexport function extend() {\n    var objects = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        objects[_i] = arguments[_i];\n    }\n    /** The final result we will return */\n    var result = {};\n    for (var _a = 0, objects_1 = objects; _a < objects_1.length; _a++) {\n        var object = objects_1[_a];\n        if (object == null || object === false) {\n            continue;\n        }\n        for (var key in object) {\n            /** Falsy values except a explicit 0 is ignored */\n            var val = object[key];\n            if (!val && val !== 0) {\n                continue;\n            }\n            /** if nested media or pseudo selector */\n            if (key === '$nest' && val) {\n                result[key] = result['$nest'] ? extend(result['$nest'], val) : val;\n            }\n            else if ((key.indexOf('&') !== -1 || key.indexOf('@media') === 0)) {\n                result[key] = result[key] ? extend(result[key], val) : val;\n            }\n            else {\n                result[key] = val;\n            }\n        }\n    }\n    return result;\n}\n/**\n * Utility to help customize styles with media queries. e.g.\n * ```\n * style(\n *  media({maxWidth:500}, {color:'red'})\n * )\n * ```\n */\nexport var media = function (mediaQuery) {\n    var objects = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        objects[_i - 1] = arguments[_i];\n    }\n    var mediaQuerySections = [];\n    if (mediaQuery.type)\n        mediaQuerySections.push(mediaQuery.type);\n    if (mediaQuery.orientation)\n        mediaQuerySections.push(\"(orientation: \" + mediaQuery.orientation + \")\");\n    if (mediaQuery.minWidth)\n        mediaQuerySections.push(\"(min-width: \" + mediaLength(mediaQuery.minWidth) + \")\");\n    if (mediaQuery.maxWidth)\n        mediaQuerySections.push(\"(max-width: \" + mediaLength(mediaQuery.maxWidth) + \")\");\n    if (mediaQuery.minHeight)\n        mediaQuerySections.push(\"(min-height: \" + mediaLength(mediaQuery.minHeight) + \")\");\n    if (mediaQuery.maxHeight)\n        mediaQuerySections.push(\"(max-height: \" + mediaLength(mediaQuery.maxHeight) + \")\");\n    var stringMediaQuery = \"@media \" + mediaQuerySections.join(' and ');\n    var object = {\n        $nest: (_a = {},\n            _a[stringMediaQuery] = extend.apply(void 0, objects),\n            _a)\n    };\n    return object;\n    var _a;\n};\nvar mediaLength = function (value) {\n    return typeof value === 'string' ? value : value + \"px\";\n};\n","import { TypeStyle } from './internal/typestyle';\nexport { TypeStyle };\n/**\n * All the CSS types in the 'types' namespace\n */\nimport * as types from './types';\nexport { types };\n/**\n * Export certain utilities\n */\nexport { extend, classes, media } from './internal/utilities';\n/** Zero configuration, default instance of TypeStyle */\nvar ts = new TypeStyle({ autoGenerateTag: true });\n/** Sets the target tag where we write the css on style updates */\nexport var setStylesTarget = ts.setStylesTarget;\n/**\n * Insert `raw` CSS as a string. This is useful for e.g.\n * - third party CSS that you are customizing with template strings\n * - generating raw CSS in JavaScript\n * - reset libraries like normalize.css that you can use without loaders\n */\nexport var cssRaw = ts.cssRaw;\n/**\n * Takes CSSProperties and registers it to a global selector (body, html, etc.)\n */\nexport var cssRule = ts.cssRule;\n/**\n * Renders styles to the singleton tag imediately\n * NOTE: You should only call it on initial render to prevent any non CSS flash.\n * After that it is kept sync using `requestAnimationFrame` and we haven't noticed any bad flashes.\n **/\nexport var forceRenderStyles = ts.forceRenderStyles;\n/**\n * Utility function to register an @font-face\n */\nexport var fontFace = ts.fontFace;\n/**\n * Allows use to use the stylesheet in a node.js environment\n */\nexport var getStyles = ts.getStyles;\n/**\n * Takes keyframes and returns a generated animationName\n */\nexport var keyframes = ts.keyframes;\n/**\n * Helps with testing. Reinitializes FreeStyle + raw\n */\nexport var reinit = ts.reinit;\n/**\n * Takes CSSProperties and return a generated className you can use on your component\n */\nexport var style = ts.style;\n/**\n * Takes an object where property names are ideal class names and property values are CSSProperties, and\n * returns an object where property names are the same ideal class names and the property values are\n * the actual generated class names using the ideal class name as the $debugName\n */\nexport var stylesheet = ts.stylesheet;\n/**\n * Creates a new instance of TypeStyle separate from the default instance.\n *\n * - Use this for creating a different typestyle instance for a shadow dom component.\n * - Use this if you don't want an auto tag generated and you just want to collect the CSS.\n *\n * NOTE: styles aren't shared between different instances.\n */\nexport function createTypeStyle(target) {\n    var instance = new TypeStyle({ autoGenerateTag: false });\n    if (target) {\n        instance.setStylesTarget(target);\n    }\n    return instance;\n}\n","import * as FreeStyle from \"free-style\";\nimport { ensureStringObj, explodeKeyframes } from './formatting';\nimport { extend, raf } from './utilities';\n/**\n * Creates an instance of free style with our options\n */\nvar createFreeStyle = function () { return FreeStyle.create(\n/** Use the default hash function */\nundefined, \n/** Preserve $debugName values */\ntrue); };\n/**\n * Maintains a single stylesheet and keeps it in sync with requested styles\n */\nvar TypeStyle = /** @class */ (function () {\n    function TypeStyle(_a) {\n        var autoGenerateTag = _a.autoGenerateTag;\n        var _this = this;\n        /**\n         * Insert `raw` CSS as a string. This is useful for e.g.\n         * - third party CSS that you are customizing with template strings\n         * - generating raw CSS in JavaScript\n         * - reset libraries like normalize.css that you can use without loaders\n         */\n        this.cssRaw = function (mustBeValidCSS) {\n            if (!mustBeValidCSS) {\n                return;\n            }\n            _this._raw += mustBeValidCSS || '';\n            _this._pendingRawChange = true;\n            _this._styleUpdated();\n        };\n        /**\n         * Takes CSSProperties and registers it to a global selector (body, html, etc.)\n         */\n        this.cssRule = function (selector) {\n            var objects = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                objects[_i - 1] = arguments[_i];\n            }\n            var object = ensureStringObj(extend.apply(void 0, objects)).result;\n            _this._freeStyle.registerRule(selector, object);\n            _this._styleUpdated();\n            return;\n        };\n        /**\n         * Renders styles to the singleton tag imediately\n         * NOTE: You should only call it on initial render to prevent any non CSS flash.\n         * After that it is kept sync using `requestAnimationFrame` and we haven't noticed any bad flashes.\n         **/\n        this.forceRenderStyles = function () {\n            var target = _this._getTag();\n            if (!target) {\n                return;\n            }\n            target.textContent = _this.getStyles();\n        };\n        /**\n         * Utility function to register an @font-face\n         */\n        this.fontFace = function () {\n            var fontFace = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                fontFace[_i] = arguments[_i];\n            }\n            var freeStyle = _this._freeStyle;\n            for (var _a = 0, _b = fontFace; _a < _b.length; _a++) {\n                var face = _b[_a];\n                freeStyle.registerRule('@font-face', face);\n            }\n            _this._styleUpdated();\n            return;\n        };\n        /**\n         * Allows use to use the stylesheet in a node.js environment\n         */\n        this.getStyles = function () {\n            return (_this._raw || '') + _this._freeStyle.getStyles();\n        };\n        /**\n         * Takes keyframes and returns a generated animationName\n         */\n        this.keyframes = function (frames) {\n            var _a = explodeKeyframes(frames), keyframes = _a.keyframes, $debugName = _a.$debugName;\n            // TODO: replace $debugName with display name\n            var animationName = _this._freeStyle.registerKeyframes(keyframes, $debugName);\n            _this._styleUpdated();\n            return animationName;\n        };\n        /**\n         * Helps with testing. Reinitializes FreeStyle + raw\n         */\n        this.reinit = function () {\n            /** reinit freestyle */\n            var freeStyle = createFreeStyle();\n            _this._freeStyle = freeStyle;\n            _this._lastFreeStyleChangeId = freeStyle.changeId;\n            /** reinit raw */\n            _this._raw = '';\n            _this._pendingRawChange = false;\n            /** Clear any styles that were flushed */\n            var target = _this._getTag();\n            if (target) {\n                target.textContent = '';\n            }\n        };\n        /** Sets the target tag where we write the css on style updates */\n        this.setStylesTarget = function (tag) {\n            /** Clear any data in any previous tag */\n            if (_this._tag) {\n                _this._tag.textContent = '';\n            }\n            _this._tag = tag;\n            /** This special time buffer immediately */\n            _this.forceRenderStyles();\n        };\n        /**\n         * Takes an object where property names are ideal class names and property values are CSSProperties, and\n         * returns an object where property names are the same ideal class names and the property values are\n         * the actual generated class names using the ideal class name as the $debugName\n         */\n        this.stylesheet = function (classes) {\n            var classNames = Object.getOwnPropertyNames(classes);\n            var result = {};\n            for (var _i = 0, classNames_1 = classNames; _i < classNames_1.length; _i++) {\n                var className = classNames_1[_i];\n                var classDef = classes[className];\n                if (classDef) {\n                    classDef.$debugName = className;\n                    result[className] = _this.style(classDef);\n                }\n            }\n            return result;\n        };\n        var freeStyle = createFreeStyle();\n        this._autoGenerateTag = autoGenerateTag;\n        this._freeStyle = freeStyle;\n        this._lastFreeStyleChangeId = freeStyle.changeId;\n        this._pending = 0;\n        this._pendingRawChange = false;\n        this._raw = '';\n        this._tag = undefined;\n        // rebind prototype to TypeStyle.  It might be better to do a function() { return this.style.apply(this, arguments)}\n        this.style = this.style.bind(this);\n    }\n    /**\n     * Only calls cb all sync operations settle\n     */\n    TypeStyle.prototype._afterAllSync = function (cb) {\n        var _this = this;\n        this._pending++;\n        var pending = this._pending;\n        raf(function () {\n            if (pending !== _this._pending) {\n                return;\n            }\n            cb();\n        });\n    };\n    TypeStyle.prototype._getTag = function () {\n        if (this._tag) {\n            return this._tag;\n        }\n        if (this._autoGenerateTag) {\n            var tag = typeof window === 'undefined'\n                ? { textContent: '' }\n                : document.createElement('style');\n            if (typeof document !== 'undefined') {\n                document.head.appendChild(tag);\n            }\n            this._tag = tag;\n            return tag;\n        }\n        return undefined;\n    };\n    /** Checks if the style tag needs updating and if so queues up the change */\n    TypeStyle.prototype._styleUpdated = function () {\n        var _this = this;\n        var changeId = this._freeStyle.changeId;\n        var lastChangeId = this._lastFreeStyleChangeId;\n        if (!this._pendingRawChange && changeId === lastChangeId) {\n            return;\n        }\n        this._lastFreeStyleChangeId = changeId;\n        this._pendingRawChange = false;\n        this._afterAllSync(function () { return _this.forceRenderStyles(); });\n    };\n    TypeStyle.prototype.style = function () {\n        var freeStyle = this._freeStyle;\n        var _a = ensureStringObj(extend.apply(undefined, arguments)), result = _a.result, debugName = _a.debugName;\n        var className = debugName ? freeStyle.registerStyle(result, debugName) : freeStyle.registerStyle(result);\n        this._styleUpdated();\n        return className;\n    };\n    return TypeStyle;\n}());\nexport { TypeStyle };\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.preact = {})));\n}(this, (function (exports) { 'use strict';\n\n\tvar VNode = function VNode() {};\n\n\tvar options = {};\n\n\tvar stack = [];\n\n\tvar EMPTY_CHILDREN = [];\n\n\tfunction h(nodeName, attributes) {\n\t\tvar children = EMPTY_CHILDREN,\n\t\t    lastSimple = void 0,\n\t\t    child = void 0,\n\t\t    simple = void 0,\n\t\t    i = void 0;\n\t\tfor (i = arguments.length; i-- > 2;) {\n\t\t\tstack.push(arguments[i]);\n\t\t}\n\t\tif (attributes && attributes.children != null) {\n\t\t\tif (!stack.length) stack.push(attributes.children);\n\t\t\tdelete attributes.children;\n\t\t}\n\t\twhile (stack.length) {\n\t\t\tif ((child = stack.pop()) && child.pop !== undefined) {\n\t\t\t\tfor (i = child.length; i--;) {\n\t\t\t\t\tstack.push(child[i]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (typeof child === 'boolean') child = null;\n\n\t\t\t\tif (simple = typeof nodeName !== 'function') {\n\t\t\t\t\tif (child == null) child = '';else if (typeof child === 'number') child = String(child);else if (typeof child !== 'string') simple = false;\n\t\t\t\t}\n\n\t\t\t\tif (simple && lastSimple) {\n\t\t\t\t\tchildren[children.length - 1] += child;\n\t\t\t\t} else if (children === EMPTY_CHILDREN) {\n\t\t\t\t\tchildren = [child];\n\t\t\t\t} else {\n\t\t\t\t\tchildren.push(child);\n\t\t\t\t}\n\n\t\t\t\tlastSimple = simple;\n\t\t\t}\n\t\t}\n\n\t\tvar p = new VNode();\n\t\tp.nodeName = nodeName;\n\t\tp.children = children;\n\t\tp.attributes = attributes == null ? undefined : attributes;\n\t\tp.key = attributes == null ? undefined : attributes.key;\n\n\t\tif (options.vnode !== undefined) options.vnode(p);\n\n\t\treturn p;\n\t}\n\n\tfunction extend(obj, props) {\n\t  for (var i in props) {\n\t    obj[i] = props[i];\n\t  }return obj;\n\t}\n\n\tfunction applyRef(ref, value) {\n\t  if (ref) {\n\t    if (typeof ref == 'function') ref(value);else ref.current = value;\n\t  }\n\t}\n\n\tvar defer = typeof Promise == 'function' ? Promise.resolve().then.bind(Promise.resolve()) : setTimeout;\n\n\tfunction cloneElement(vnode, props) {\n\t  return h(vnode.nodeName, extend(extend({}, vnode.attributes), props), arguments.length > 2 ? [].slice.call(arguments, 2) : vnode.children);\n\t}\n\n\tvar NO_RENDER = 0;\n\n\tvar SYNC_RENDER = 1;\n\n\tvar FORCE_RENDER = 2;\n\n\tvar ASYNC_RENDER = 3;\n\n\tvar ATTR_KEY = '__preactattr_';\n\n\tvar IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;\n\n\tvar items = [];\n\n\tfunction enqueueRender(component) {\n\t\tif (!component._dirty && (component._dirty = true) && items.push(component) == 1) {\n\t\t\t(options.debounceRendering || defer)(rerender);\n\t\t}\n\t}\n\n\tfunction rerender() {\n\t\tvar p = void 0;\n\t\twhile (p = items.pop()) {\n\t\t\tif (p._dirty) renderComponent(p);\n\t\t}\n\t}\n\n\tfunction isSameNodeType(node, vnode, hydrating) {\n\t\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\t\t\treturn node.splitText !== undefined;\n\t\t}\n\t\tif (typeof vnode.nodeName === 'string') {\n\t\t\treturn !node._componentConstructor && isNamedNode(node, vnode.nodeName);\n\t\t}\n\t\treturn hydrating || node._componentConstructor === vnode.nodeName;\n\t}\n\n\tfunction isNamedNode(node, nodeName) {\n\t\treturn node.normalizedNodeName === nodeName || node.nodeName.toLowerCase() === nodeName.toLowerCase();\n\t}\n\n\tfunction getNodeProps(vnode) {\n\t\tvar props = extend({}, vnode.attributes);\n\t\tprops.children = vnode.children;\n\n\t\tvar defaultProps = vnode.nodeName.defaultProps;\n\t\tif (defaultProps !== undefined) {\n\t\t\tfor (var i in defaultProps) {\n\t\t\t\tif (props[i] === undefined) {\n\t\t\t\t\tprops[i] = defaultProps[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn props;\n\t}\n\n\tfunction createNode(nodeName, isSvg) {\n\t\tvar node = isSvg ? document.createElementNS('http://www.w3.org/2000/svg', nodeName) : document.createElement(nodeName);\n\t\tnode.normalizedNodeName = nodeName;\n\t\treturn node;\n\t}\n\n\tfunction removeNode(node) {\n\t\tvar parentNode = node.parentNode;\n\t\tif (parentNode) parentNode.removeChild(node);\n\t}\n\n\tfunction setAccessor(node, name, old, value, isSvg) {\n\t\tif (name === 'className') name = 'class';\n\n\t\tif (name === 'key') {} else if (name === 'ref') {\n\t\t\tapplyRef(old, null);\n\t\t\tapplyRef(value, node);\n\t\t} else if (name === 'class' && !isSvg) {\n\t\t\tnode.className = value || '';\n\t\t} else if (name === 'style') {\n\t\t\tif (!value || typeof value === 'string' || typeof old === 'string') {\n\t\t\t\tnode.style.cssText = value || '';\n\t\t\t}\n\t\t\tif (value && typeof value === 'object') {\n\t\t\t\tif (typeof old !== 'string') {\n\t\t\t\t\tfor (var i in old) {\n\t\t\t\t\t\tif (!(i in value)) node.style[i] = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var _i in value) {\n\t\t\t\t\tnode.style[_i] = typeof value[_i] === 'number' && IS_NON_DIMENSIONAL.test(_i) === false ? value[_i] + 'px' : value[_i];\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (name === 'dangerouslySetInnerHTML') {\n\t\t\tif (value) node.innerHTML = value.__html || '';\n\t\t} else if (name[0] == 'o' && name[1] == 'n') {\n\t\t\tvar useCapture = name !== (name = name.replace(/Capture$/, ''));\n\t\t\tname = name.toLowerCase().substring(2);\n\t\t\tif (value) {\n\t\t\t\tif (!old) node.addEventListener(name, eventProxy, useCapture);\n\t\t\t} else {\n\t\t\t\tnode.removeEventListener(name, eventProxy, useCapture);\n\t\t\t}\n\t\t\t(node._listeners || (node._listeners = {}))[name] = value;\n\t\t} else if (name !== 'list' && name !== 'type' && !isSvg && name in node) {\n\t\t\ttry {\n\t\t\t\tnode[name] = value == null ? '' : value;\n\t\t\t} catch (e) {}\n\t\t\tif ((value == null || value === false) && name != 'spellcheck') node.removeAttribute(name);\n\t\t} else {\n\t\t\tvar ns = isSvg && name !== (name = name.replace(/^xlink:?/, ''));\n\n\t\t\tif (value == null || value === false) {\n\t\t\t\tif (ns) node.removeAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase());else node.removeAttribute(name);\n\t\t\t} else if (typeof value !== 'function') {\n\t\t\t\tif (ns) node.setAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase(), value);else node.setAttribute(name, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction eventProxy(e) {\n\t\treturn this._listeners[e.type](options.event && options.event(e) || e);\n\t}\n\n\tvar mounts = [];\n\n\tvar diffLevel = 0;\n\n\tvar isSvgMode = false;\n\n\tvar hydrating = false;\n\n\tfunction flushMounts() {\n\t\tvar c = void 0;\n\t\twhile (c = mounts.shift()) {\n\t\t\tif (options.afterMount) options.afterMount(c);\n\t\t\tif (c.componentDidMount) c.componentDidMount();\n\t\t}\n\t}\n\n\tfunction diff(dom, vnode, context, mountAll, parent, componentRoot) {\n\t\tif (!diffLevel++) {\n\t\t\tisSvgMode = parent != null && parent.ownerSVGElement !== undefined;\n\n\t\t\thydrating = dom != null && !(ATTR_KEY in dom);\n\t\t}\n\n\t\tvar ret = idiff(dom, vnode, context, mountAll, componentRoot);\n\n\t\tif (parent && ret.parentNode !== parent) parent.appendChild(ret);\n\n\t\tif (! --diffLevel) {\n\t\t\thydrating = false;\n\n\t\t\tif (!componentRoot) flushMounts();\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tfunction idiff(dom, vnode, context, mountAll, componentRoot) {\n\t\tvar out = dom,\n\t\t    prevSvgMode = isSvgMode;\n\n\t\tif (vnode == null || typeof vnode === 'boolean') vnode = '';\n\n\t\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\t\t\tif (dom && dom.splitText !== undefined && dom.parentNode && (!dom._component || componentRoot)) {\n\t\t\t\tif (dom.nodeValue != vnode) {\n\t\t\t\t\tdom.nodeValue = vnode;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tout = document.createTextNode(vnode);\n\t\t\t\tif (dom) {\n\t\t\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\t\t\t\t\trecollectNodeTree(dom, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tout[ATTR_KEY] = true;\n\n\t\t\treturn out;\n\t\t}\n\n\t\tvar vnodeName = vnode.nodeName;\n\t\tif (typeof vnodeName === 'function') {\n\t\t\treturn buildComponentFromVNode(dom, vnode, context, mountAll);\n\t\t}\n\n\t\tisSvgMode = vnodeName === 'svg' ? true : vnodeName === 'foreignObject' ? false : isSvgMode;\n\n\t\tvnodeName = String(vnodeName);\n\t\tif (!dom || !isNamedNode(dom, vnodeName)) {\n\t\t\tout = createNode(vnodeName, isSvgMode);\n\n\t\t\tif (dom) {\n\t\t\t\twhile (dom.firstChild) {\n\t\t\t\t\tout.appendChild(dom.firstChild);\n\t\t\t\t}\n\t\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\n\t\t\t\trecollectNodeTree(dom, true);\n\t\t\t}\n\t\t}\n\n\t\tvar fc = out.firstChild,\n\t\t    props = out[ATTR_KEY],\n\t\t    vchildren = vnode.children;\n\n\t\tif (props == null) {\n\t\t\tprops = out[ATTR_KEY] = {};\n\t\t\tfor (var a = out.attributes, i = a.length; i--;) {\n\t\t\t\tprops[a[i].name] = a[i].value;\n\t\t\t}\n\t\t}\n\n\t\tif (!hydrating && vchildren && vchildren.length === 1 && typeof vchildren[0] === 'string' && fc != null && fc.splitText !== undefined && fc.nextSibling == null) {\n\t\t\tif (fc.nodeValue != vchildren[0]) {\n\t\t\t\tfc.nodeValue = vchildren[0];\n\t\t\t}\n\t\t} else if (vchildren && vchildren.length || fc != null) {\n\t\t\t\tinnerDiffNode(out, vchildren, context, mountAll, hydrating || props.dangerouslySetInnerHTML != null);\n\t\t\t}\n\n\t\tdiffAttributes(out, vnode.attributes, props);\n\n\t\tisSvgMode = prevSvgMode;\n\n\t\treturn out;\n\t}\n\n\tfunction innerDiffNode(dom, vchildren, context, mountAll, isHydrating) {\n\t\tvar originalChildren = dom.childNodes,\n\t\t    children = [],\n\t\t    keyed = {},\n\t\t    keyedLen = 0,\n\t\t    min = 0,\n\t\t    len = originalChildren.length,\n\t\t    childrenLen = 0,\n\t\t    vlen = vchildren ? vchildren.length : 0,\n\t\t    j = void 0,\n\t\t    c = void 0,\n\t\t    f = void 0,\n\t\t    vchild = void 0,\n\t\t    child = void 0;\n\n\t\tif (len !== 0) {\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar _child = originalChildren[i],\n\t\t\t\t    props = _child[ATTR_KEY],\n\t\t\t\t    key = vlen && props ? _child._component ? _child._component.__key : props.key : null;\n\t\t\t\tif (key != null) {\n\t\t\t\t\tkeyedLen++;\n\t\t\t\t\tkeyed[key] = _child;\n\t\t\t\t} else if (props || (_child.splitText !== undefined ? isHydrating ? _child.nodeValue.trim() : true : isHydrating)) {\n\t\t\t\t\tchildren[childrenLen++] = _child;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (vlen !== 0) {\n\t\t\tfor (var _i = 0; _i < vlen; _i++) {\n\t\t\t\tvchild = vchildren[_i];\n\t\t\t\tchild = null;\n\n\t\t\t\tvar _key = vchild.key;\n\t\t\t\tif (_key != null) {\n\t\t\t\t\tif (keyedLen && keyed[_key] !== undefined) {\n\t\t\t\t\t\tchild = keyed[_key];\n\t\t\t\t\t\tkeyed[_key] = undefined;\n\t\t\t\t\t\tkeyedLen--;\n\t\t\t\t\t}\n\t\t\t\t} else if (min < childrenLen) {\n\t\t\t\t\t\tfor (j = min; j < childrenLen; j++) {\n\t\t\t\t\t\t\tif (children[j] !== undefined && isSameNodeType(c = children[j], vchild, isHydrating)) {\n\t\t\t\t\t\t\t\tchild = c;\n\t\t\t\t\t\t\t\tchildren[j] = undefined;\n\t\t\t\t\t\t\t\tif (j === childrenLen - 1) childrenLen--;\n\t\t\t\t\t\t\t\tif (j === min) min++;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\tchild = idiff(child, vchild, context, mountAll);\n\n\t\t\t\tf = originalChildren[_i];\n\t\t\t\tif (child && child !== dom && child !== f) {\n\t\t\t\t\tif (f == null) {\n\t\t\t\t\t\tdom.appendChild(child);\n\t\t\t\t\t} else if (child === f.nextSibling) {\n\t\t\t\t\t\tremoveNode(f);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.insertBefore(child, f);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (keyedLen) {\n\t\t\tfor (var _i2 in keyed) {\n\t\t\t\tif (keyed[_i2] !== undefined) recollectNodeTree(keyed[_i2], false);\n\t\t\t}\n\t\t}\n\n\t\twhile (min <= childrenLen) {\n\t\t\tif ((child = children[childrenLen--]) !== undefined) recollectNodeTree(child, false);\n\t\t}\n\t}\n\n\tfunction recollectNodeTree(node, unmountOnly) {\n\t\tvar component = node._component;\n\t\tif (component) {\n\t\t\tunmountComponent(component);\n\t\t} else {\n\t\t\tif (node[ATTR_KEY] != null) applyRef(node[ATTR_KEY].ref, null);\n\n\t\t\tif (unmountOnly === false || node[ATTR_KEY] == null) {\n\t\t\t\tremoveNode(node);\n\t\t\t}\n\n\t\t\tremoveChildren(node);\n\t\t}\n\t}\n\n\tfunction removeChildren(node) {\n\t\tnode = node.lastChild;\n\t\twhile (node) {\n\t\t\tvar next = node.previousSibling;\n\t\t\trecollectNodeTree(node, true);\n\t\t\tnode = next;\n\t\t}\n\t}\n\n\tfunction diffAttributes(dom, attrs, old) {\n\t\tvar name = void 0;\n\n\t\tfor (name in old) {\n\t\t\tif (!(attrs && attrs[name] != null) && old[name] != null) {\n\t\t\t\tsetAccessor(dom, name, old[name], old[name] = undefined, isSvgMode);\n\t\t\t}\n\t\t}\n\n\t\tfor (name in attrs) {\n\t\t\tif (name !== 'children' && name !== 'innerHTML' && (!(name in old) || attrs[name] !== (name === 'value' || name === 'checked' ? dom[name] : old[name]))) {\n\t\t\t\tsetAccessor(dom, name, old[name], old[name] = attrs[name], isSvgMode);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar recyclerComponents = [];\n\n\tfunction createComponent(Ctor, props, context) {\n\t\tvar inst = void 0,\n\t\t    i = recyclerComponents.length;\n\n\t\tif (Ctor.prototype && Ctor.prototype.render) {\n\t\t\tinst = new Ctor(props, context);\n\t\t\tComponent.call(inst, props, context);\n\t\t} else {\n\t\t\tinst = new Component(props, context);\n\t\t\tinst.constructor = Ctor;\n\t\t\tinst.render = doRender;\n\t\t}\n\n\t\twhile (i--) {\n\t\t\tif (recyclerComponents[i].constructor === Ctor) {\n\t\t\t\tinst.nextBase = recyclerComponents[i].nextBase;\n\t\t\t\trecyclerComponents.splice(i, 1);\n\t\t\t\treturn inst;\n\t\t\t}\n\t\t}\n\n\t\treturn inst;\n\t}\n\n\tfunction doRender(props, state, context) {\n\t\treturn this.constructor(props, context);\n\t}\n\n\tfunction setComponentProps(component, props, renderMode, context, mountAll) {\n\t\tif (component._disable) return;\n\t\tcomponent._disable = true;\n\n\t\tcomponent.__ref = props.ref;\n\t\tcomponent.__key = props.key;\n\t\tdelete props.ref;\n\t\tdelete props.key;\n\n\t\tif (typeof component.constructor.getDerivedStateFromProps === 'undefined') {\n\t\t\tif (!component.base || mountAll) {\n\t\t\t\tif (component.componentWillMount) component.componentWillMount();\n\t\t\t} else if (component.componentWillReceiveProps) {\n\t\t\t\tcomponent.componentWillReceiveProps(props, context);\n\t\t\t}\n\t\t}\n\n\t\tif (context && context !== component.context) {\n\t\t\tif (!component.prevContext) component.prevContext = component.context;\n\t\t\tcomponent.context = context;\n\t\t}\n\n\t\tif (!component.prevProps) component.prevProps = component.props;\n\t\tcomponent.props = props;\n\n\t\tcomponent._disable = false;\n\n\t\tif (renderMode !== NO_RENDER) {\n\t\t\tif (renderMode === SYNC_RENDER || options.syncComponentUpdates !== false || !component.base) {\n\t\t\t\trenderComponent(component, SYNC_RENDER, mountAll);\n\t\t\t} else {\n\t\t\t\tenqueueRender(component);\n\t\t\t}\n\t\t}\n\n\t\tapplyRef(component.__ref, component);\n\t}\n\n\tfunction renderComponent(component, renderMode, mountAll, isChild) {\n\t\tif (component._disable) return;\n\n\t\tvar props = component.props,\n\t\t    state = component.state,\n\t\t    context = component.context,\n\t\t    previousProps = component.prevProps || props,\n\t\t    previousState = component.prevState || state,\n\t\t    previousContext = component.prevContext || context,\n\t\t    isUpdate = component.base,\n\t\t    nextBase = component.nextBase,\n\t\t    initialBase = isUpdate || nextBase,\n\t\t    initialChildComponent = component._component,\n\t\t    skip = false,\n\t\t    snapshot = previousContext,\n\t\t    rendered = void 0,\n\t\t    inst = void 0,\n\t\t    cbase = void 0;\n\n\t\tif (component.constructor.getDerivedStateFromProps) {\n\t\t\tstate = extend(extend({}, state), component.constructor.getDerivedStateFromProps(props, state));\n\t\t\tcomponent.state = state;\n\t\t}\n\n\t\tif (isUpdate) {\n\t\t\tcomponent.props = previousProps;\n\t\t\tcomponent.state = previousState;\n\t\t\tcomponent.context = previousContext;\n\t\t\tif (renderMode !== FORCE_RENDER && component.shouldComponentUpdate && component.shouldComponentUpdate(props, state, context) === false) {\n\t\t\t\tskip = true;\n\t\t\t} else if (component.componentWillUpdate) {\n\t\t\t\tcomponent.componentWillUpdate(props, state, context);\n\t\t\t}\n\t\t\tcomponent.props = props;\n\t\t\tcomponent.state = state;\n\t\t\tcomponent.context = context;\n\t\t}\n\n\t\tcomponent.prevProps = component.prevState = component.prevContext = component.nextBase = null;\n\t\tcomponent._dirty = false;\n\n\t\tif (!skip) {\n\t\t\trendered = component.render(props, state, context);\n\n\t\t\tif (component.getChildContext) {\n\t\t\t\tcontext = extend(extend({}, context), component.getChildContext());\n\t\t\t}\n\n\t\t\tif (isUpdate && component.getSnapshotBeforeUpdate) {\n\t\t\t\tsnapshot = component.getSnapshotBeforeUpdate(previousProps, previousState);\n\t\t\t}\n\n\t\t\tvar childComponent = rendered && rendered.nodeName,\n\t\t\t    toUnmount = void 0,\n\t\t\t    base = void 0;\n\n\t\t\tif (typeof childComponent === 'function') {\n\n\t\t\t\tvar childProps = getNodeProps(rendered);\n\t\t\t\tinst = initialChildComponent;\n\n\t\t\t\tif (inst && inst.constructor === childComponent && childProps.key == inst.__key) {\n\t\t\t\t\tsetComponentProps(inst, childProps, SYNC_RENDER, context, false);\n\t\t\t\t} else {\n\t\t\t\t\ttoUnmount = inst;\n\n\t\t\t\t\tcomponent._component = inst = createComponent(childComponent, childProps, context);\n\t\t\t\t\tinst.nextBase = inst.nextBase || nextBase;\n\t\t\t\t\tinst._parentComponent = component;\n\t\t\t\t\tsetComponentProps(inst, childProps, NO_RENDER, context, false);\n\t\t\t\t\trenderComponent(inst, SYNC_RENDER, mountAll, true);\n\t\t\t\t}\n\n\t\t\t\tbase = inst.base;\n\t\t\t} else {\n\t\t\t\tcbase = initialBase;\n\n\t\t\t\ttoUnmount = initialChildComponent;\n\t\t\t\tif (toUnmount) {\n\t\t\t\t\tcbase = component._component = null;\n\t\t\t\t}\n\n\t\t\t\tif (initialBase || renderMode === SYNC_RENDER) {\n\t\t\t\t\tif (cbase) cbase._component = null;\n\t\t\t\t\tbase = diff(cbase, rendered, context, mountAll || !isUpdate, initialBase && initialBase.parentNode, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (initialBase && base !== initialBase && inst !== initialChildComponent) {\n\t\t\t\tvar baseParent = initialBase.parentNode;\n\t\t\t\tif (baseParent && base !== baseParent) {\n\t\t\t\t\tbaseParent.replaceChild(base, initialBase);\n\n\t\t\t\t\tif (!toUnmount) {\n\t\t\t\t\t\tinitialBase._component = null;\n\t\t\t\t\t\trecollectNodeTree(initialBase, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (toUnmount) {\n\t\t\t\tunmountComponent(toUnmount);\n\t\t\t}\n\n\t\t\tcomponent.base = base;\n\t\t\tif (base && !isChild) {\n\t\t\t\tvar componentRef = component,\n\t\t\t\t    t = component;\n\t\t\t\twhile (t = t._parentComponent) {\n\t\t\t\t\t(componentRef = t).base = base;\n\t\t\t\t}\n\t\t\t\tbase._component = componentRef;\n\t\t\t\tbase._componentConstructor = componentRef.constructor;\n\t\t\t}\n\t\t}\n\n\t\tif (!isUpdate || mountAll) {\n\t\t\tmounts.push(component);\n\t\t} else if (!skip) {\n\n\t\t\tif (component.componentDidUpdate) {\n\t\t\t\tcomponent.componentDidUpdate(previousProps, previousState, snapshot);\n\t\t\t}\n\t\t\tif (options.afterUpdate) options.afterUpdate(component);\n\t\t}\n\n\t\twhile (component._renderCallbacks.length) {\n\t\t\tcomponent._renderCallbacks.pop().call(component);\n\t\t}if (!diffLevel && !isChild) flushMounts();\n\t}\n\n\tfunction buildComponentFromVNode(dom, vnode, context, mountAll) {\n\t\tvar c = dom && dom._component,\n\t\t    originalComponent = c,\n\t\t    oldDom = dom,\n\t\t    isDirectOwner = c && dom._componentConstructor === vnode.nodeName,\n\t\t    isOwner = isDirectOwner,\n\t\t    props = getNodeProps(vnode);\n\t\twhile (c && !isOwner && (c = c._parentComponent)) {\n\t\t\tisOwner = c.constructor === vnode.nodeName;\n\t\t}\n\n\t\tif (c && isOwner && (!mountAll || c._component)) {\n\t\t\tsetComponentProps(c, props, ASYNC_RENDER, context, mountAll);\n\t\t\tdom = c.base;\n\t\t} else {\n\t\t\tif (originalComponent && !isDirectOwner) {\n\t\t\t\tunmountComponent(originalComponent);\n\t\t\t\tdom = oldDom = null;\n\t\t\t}\n\n\t\t\tc = createComponent(vnode.nodeName, props, context);\n\t\t\tif (dom && !c.nextBase) {\n\t\t\t\tc.nextBase = dom;\n\n\t\t\t\toldDom = null;\n\t\t\t}\n\t\t\tsetComponentProps(c, props, SYNC_RENDER, context, mountAll);\n\t\t\tdom = c.base;\n\n\t\t\tif (oldDom && dom !== oldDom) {\n\t\t\t\toldDom._component = null;\n\t\t\t\trecollectNodeTree(oldDom, false);\n\t\t\t}\n\t\t}\n\n\t\treturn dom;\n\t}\n\n\tfunction unmountComponent(component) {\n\t\tif (options.beforeUnmount) options.beforeUnmount(component);\n\n\t\tvar base = component.base;\n\n\t\tcomponent._disable = true;\n\n\t\tif (component.componentWillUnmount) component.componentWillUnmount();\n\n\t\tcomponent.base = null;\n\n\t\tvar inner = component._component;\n\t\tif (inner) {\n\t\t\tunmountComponent(inner);\n\t\t} else if (base) {\n\t\t\tif (base[ATTR_KEY] != null) applyRef(base[ATTR_KEY].ref, null);\n\n\t\t\tcomponent.nextBase = base;\n\n\t\t\tremoveNode(base);\n\t\t\trecyclerComponents.push(component);\n\n\t\t\tremoveChildren(base);\n\t\t}\n\n\t\tapplyRef(component.__ref, null);\n\t}\n\n\tfunction Component(props, context) {\n\t\tthis._dirty = true;\n\n\t\tthis.context = context;\n\n\t\tthis.props = props;\n\n\t\tthis.state = this.state || {};\n\n\t\tthis._renderCallbacks = [];\n\t}\n\n\textend(Component.prototype, {\n\t\tsetState: function setState(state, callback) {\n\t\t\tif (!this.prevState) this.prevState = this.state;\n\t\t\tthis.state = extend(extend({}, this.state), typeof state === 'function' ? state(this.state, this.props) : state);\n\t\t\tif (callback) this._renderCallbacks.push(callback);\n\t\t\tenqueueRender(this);\n\t\t},\n\t\tforceUpdate: function forceUpdate(callback) {\n\t\t\tif (callback) this._renderCallbacks.push(callback);\n\t\t\trenderComponent(this, FORCE_RENDER);\n\t\t},\n\t\trender: function render() {}\n\t});\n\n\tfunction render(vnode, parent, merge) {\n\t  return diff(merge, vnode, {}, false, parent, false);\n\t}\n\n\tfunction createRef() {\n\t\treturn {};\n\t}\n\n\tvar preact = {\n\t\th: h,\n\t\tcreateElement: h,\n\t\tcloneElement: cloneElement,\n\t\tcreateRef: createRef,\n\t\tComponent: Component,\n\t\trender: render,\n\t\trerender: rerender,\n\t\toptions: options\n\t};\n\n\texports.default = preact;\n\texports.h = h;\n\texports.createElement = h;\n\texports.cloneElement = cloneElement;\n\texports.createRef = createRef;\n\texports.Component = Component;\n\texports.render = render;\n\texports.rerender = rerender;\n\texports.options = options;\n\n\tObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=preact.umd.js.map\n","import { stylesheet } from 'typestyle'\n\nconst controlsStyle = () => ({\n  zIndex: 30,\n  position: 'absolute' as 'absolute',\n  width: '100%',\n  bottom: 0,\n  padding: '0 16px',\n  boxSizing: 'border-box' as 'border-box',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  userSelect: 'none' as 'none',\n  opacity: 0,\n  transition: 'opacity 0.2s'\n})\n\nexport const ControlsStyle = stylesheet({\n  controls: {\n    ...controlsStyle()\n  },\n  controlsVisible: {\n    ...controlsStyle(),\n    opacity: 1\n  },\n  buttons: {\n    height: '100%',\n    display: 'flex',\n    justifyContent: 'space-between',\n    marginBottom: '6px',\n    alignItems: 'center'\n  },\n  button: {\n    width: '32px',\n    height: '32px',\n    padding: '7px',\n    boxSizing: 'border-box',\n    cursor: 'pointer'\n  },\n  left: {\n    display: 'flex',\n    alignItems: 'center',\n    $nest: {\n      '& .button': {\n        marginRight: '8px'\n      }\n    }\n  },\n  right: {\n    display: 'flex',\n    alignItems: 'center',\n    width: '70px',\n    height: '100%',\n    justifyContent: 'space-between'\n  }\n})\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The unique id is used for unique hashes.\n */\nvar uniqueId = 0;\n/**\n * Tag styles with this string to get unique hashes.\n */\nexports.IS_UNIQUE = '__DO_NOT_DEDUPE_STYLE__';\nvar upperCasePattern = /[A-Z]/g;\nvar msPattern = /^ms-/;\nvar interpolatePattern = /&/g;\nvar escapePattern = /[ !#$%&()*+,./;<=>?@[\\]^`{|}~\"'\\\\]/g;\nvar propLower = function (m) { return \"-\" + m.toLowerCase(); };\n/**\n * CSS properties that are valid unit-less numbers.\n *\n * Ref: https://github.com/facebook/react/blob/master/packages/react-dom/src/shared/CSSProperty.js\n */\nvar CSS_NUMBER = {\n    'animation-iteration-count': true,\n    'border-image-outset': true,\n    'border-image-slice': true,\n    'border-image-width': true,\n    'box-flex': true,\n    'box-flex-group': true,\n    'box-ordinal-group': true,\n    'column-count': true,\n    'columns': true,\n    'counter-increment': true,\n    'counter-reset': true,\n    'flex': true,\n    'flex-grow': true,\n    'flex-positive': true,\n    'flex-shrink': true,\n    'flex-negative': true,\n    'flex-order': true,\n    'font-weight': true,\n    'grid-area': true,\n    'grid-column': true,\n    'grid-column-end': true,\n    'grid-column-span': true,\n    'grid-column-start': true,\n    'grid-row': true,\n    'grid-row-end': true,\n    'grid-row-span': true,\n    'grid-row-start': true,\n    'line-clamp': true,\n    'line-height': true,\n    'opacity': true,\n    'order': true,\n    'orphans': true,\n    'tab-size': true,\n    'widows': true,\n    'z-index': true,\n    'zoom': true,\n    // SVG properties.\n    'fill-opacity': true,\n    'flood-opacity': true,\n    'stop-opacity': true,\n    'stroke-dasharray': true,\n    'stroke-dashoffset': true,\n    'stroke-miterlimit': true,\n    'stroke-opacity': true,\n    'stroke-width': true\n};\n// Add vendor prefixes to all unit-less properties.\nfor (var _i = 0, _a = Object.keys(CSS_NUMBER); _i < _a.length; _i++) {\n    var property = _a[_i];\n    for (var _b = 0, _c = ['-webkit-', '-ms-', '-moz-', '-o-', '']; _b < _c.length; _b++) {\n        var prefix = _c[_b];\n        CSS_NUMBER[prefix + property] = true;\n    }\n}\n/**\n * Escape a CSS class name.\n */\nexports.escape = function (str) { return str.replace(escapePattern, '\\\\$&'); };\n/**\n * Transform a JavaScript property into a CSS property.\n */\nfunction hyphenate(propertyName) {\n    return propertyName\n        .replace(upperCasePattern, propLower)\n        .replace(msPattern, '-ms-'); // Internet Explorer vendor prefix.\n}\nexports.hyphenate = hyphenate;\n/**\n * Generate a hash value from a string.\n */\nfunction stringHash(str) {\n    var value = 5381;\n    var len = str.length;\n    while (len--)\n        value = (value * 33) ^ str.charCodeAt(len);\n    return (value >>> 0).toString(36);\n}\nexports.stringHash = stringHash;\n/**\n * Transform a style string to a CSS string.\n */\nfunction styleToString(key, value) {\n    if (typeof value === 'number' && value !== 0 && !CSS_NUMBER.hasOwnProperty(key)) {\n        return key + \":\" + value + \"px\";\n    }\n    return key + \":\" + value;\n}\n/**\n * Sort an array of tuples by first value.\n */\nfunction sortTuples(value) {\n    return value.sort(function (a, b) { return a[0] > b[0] ? 1 : -1; });\n}\n/**\n * Categorize user styles.\n */\nfunction parseStyles(styles, hasNestedStyles) {\n    var properties = [];\n    var nestedStyles = [];\n    var isUnique = false;\n    // Sort keys before adding to styles.\n    for (var _i = 0, _a = Object.keys(styles); _i < _a.length; _i++) {\n        var key = _a[_i];\n        var value = styles[key];\n        if (value !== null && value !== undefined) {\n            if (key === exports.IS_UNIQUE) {\n                isUnique = true;\n            }\n            else if (typeof value === 'object' && !Array.isArray(value)) {\n                nestedStyles.push([key.trim(), value]);\n            }\n            else {\n                properties.push([hyphenate(key.trim()), value]);\n            }\n        }\n    }\n    return {\n        style: stringifyProperties(sortTuples(properties)),\n        nested: hasNestedStyles ? nestedStyles : sortTuples(nestedStyles),\n        isUnique: isUnique\n    };\n}\n/**\n * Stringify an array of property tuples.\n */\nfunction stringifyProperties(properties) {\n    return properties.map(function (_a) {\n        var name = _a[0], value = _a[1];\n        if (!Array.isArray(value))\n            return styleToString(name, value);\n        return value.map(function (x) { return styleToString(name, x); }).join(';');\n    }).join(';');\n}\n/**\n * Interpolate CSS selectors.\n */\nfunction interpolate(selector, parent) {\n    if (selector.indexOf('&') === -1)\n        return parent + \" \" + selector;\n    return selector.replace(interpolatePattern, parent);\n}\n/**\n * Recursive loop building styles with deferred selectors.\n */\nfunction stylize(selector, styles, rulesList, stylesList, parent) {\n    var _a = parseStyles(styles, selector !== ''), style = _a.style, nested = _a.nested, isUnique = _a.isUnique;\n    var pid = style;\n    if (selector.charCodeAt(0) === 64 /* @ */) {\n        var child = { selector: selector, styles: [], rules: [], style: parent ? '' : style };\n        rulesList.push(child);\n        // Nested styles support (e.g. `.foo > @media > .bar`).\n        if (style && parent)\n            child.styles.push({ selector: parent, style: style, isUnique: isUnique });\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var _b = nested_1[_i], name = _b[0], value = _b[1];\n            pid += name + stylize(name, value, child.rules, child.styles, parent);\n        }\n    }\n    else {\n        var key = parent ? interpolate(selector, parent) : selector;\n        if (style)\n            stylesList.push({ selector: key, style: style, isUnique: isUnique });\n        for (var _c = 0, nested_2 = nested; _c < nested_2.length; _c++) {\n            var _d = nested_2[_c], name = _d[0], value = _d[1];\n            pid += name + stylize(name, value, rulesList, stylesList, key);\n        }\n    }\n    return pid;\n}\n/**\n * Transform `stylize` tree into style objects.\n */\nfunction composeStylize(cache, pid, rulesList, stylesList, className, isStyle) {\n    for (var _i = 0, stylesList_1 = stylesList; _i < stylesList_1.length; _i++) {\n        var _a = stylesList_1[_i], selector = _a.selector, style = _a.style, isUnique = _a.isUnique;\n        var key = isStyle ? interpolate(selector, className) : selector;\n        var id = isUnique ? \"u\\0\" + (++uniqueId).toString(36) : \"s\\0\" + pid + \"\\0\" + style;\n        var item = new Style(style, id);\n        item.add(new Selector(key, \"k\\0\" + pid + \"\\0\" + key));\n        cache.add(item);\n    }\n    for (var _b = 0, rulesList_1 = rulesList; _b < rulesList_1.length; _b++) {\n        var _c = rulesList_1[_b], selector = _c.selector, style = _c.style, rules = _c.rules, styles = _c.styles;\n        var item = new Rule(selector, style, \"r\\0\" + pid + \"\\0\" + selector + \"\\0\" + style);\n        composeStylize(item, pid, rules, styles, className, isStyle);\n        cache.add(item);\n    }\n}\n/**\n * Cache to list to styles.\n */\nfunction join(arr) {\n    var res = '';\n    for (var i = 0; i < arr.length; i++)\n        res += arr[i];\n    return res;\n}\n/**\n * Noop changes.\n */\nvar noopChanges = {\n    add: function () { return undefined; },\n    change: function () { return undefined; },\n    remove: function () { return undefined; }\n};\n/**\n * Implement a cache/event emitter.\n */\nvar Cache = /** @class */ (function () {\n    function Cache(changes) {\n        if (changes === void 0) { changes = noopChanges; }\n        this.changes = changes;\n        this.sheet = [];\n        this.changeId = 0;\n        this._keys = [];\n        this._children = Object.create(null);\n        this._counters = Object.create(null);\n    }\n    Cache.prototype.add = function (style) {\n        var count = this._counters[style.id] || 0;\n        var item = this._children[style.id] || style.clone();\n        this._counters[style.id] = count + 1;\n        if (count === 0) {\n            this._children[item.id] = item;\n            this._keys.push(item.id);\n            this.sheet.push(item.getStyles());\n            this.changeId++;\n            this.changes.add(item, this._keys.length - 1);\n        }\n        else if (item instanceof Cache && style instanceof Cache) {\n            var curIndex = this._keys.indexOf(style.id);\n            var prevItemChangeId = item.changeId;\n            item.merge(style);\n            if (item.changeId !== prevItemChangeId) {\n                this.sheet.splice(curIndex, 1, item.getStyles());\n                this.changeId++;\n                this.changes.change(item, curIndex, curIndex);\n            }\n        }\n        return item;\n    };\n    Cache.prototype.remove = function (style) {\n        var count = this._counters[style.id];\n        if (count !== undefined && count > 0) {\n            this._counters[style.id] = count - 1;\n            var item = this._children[style.id];\n            var index = this._keys.indexOf(item.id);\n            if (count === 1) {\n                delete this._counters[style.id];\n                delete this._children[style.id];\n                this._keys.splice(index, 1);\n                this.sheet.splice(index, 1);\n                this.changeId++;\n                this.changes.remove(item, index);\n            }\n            else if (item instanceof Cache && style instanceof Cache) {\n                var prevChangeId = item.changeId;\n                item.unmerge(style);\n                if (item.changeId !== prevChangeId) {\n                    this.sheet.splice(index, 1, item.getStyles());\n                    this.changeId++;\n                    this.changes.change(item, index, index);\n                }\n            }\n        }\n    };\n    Cache.prototype.values = function () {\n        var _this = this;\n        return this._keys.map(function (key) { return _this._children[key]; });\n    };\n    Cache.prototype.merge = function (cache) {\n        for (var _i = 0, _a = cache.values(); _i < _a.length; _i++) {\n            var item = _a[_i];\n            this.add(item);\n        }\n        return this;\n    };\n    Cache.prototype.unmerge = function (cache) {\n        for (var _i = 0, _a = cache.values(); _i < _a.length; _i++) {\n            var item = _a[_i];\n            this.remove(item);\n        }\n        return this;\n    };\n    Cache.prototype.clone = function () {\n        return new Cache().merge(this);\n    };\n    return Cache;\n}());\nexports.Cache = Cache;\n/**\n * Selector is a dumb class made to represent nested CSS selectors.\n */\nvar Selector = /** @class */ (function () {\n    function Selector(selector, id) {\n        this.selector = selector;\n        this.id = id;\n    }\n    Selector.prototype.getStyles = function () {\n        return this.selector;\n    };\n    Selector.prototype.clone = function () {\n        return new Selector(this.selector, this.id);\n    };\n    return Selector;\n}());\nexports.Selector = Selector;\n/**\n * The style container registers a style string with selectors.\n */\nvar Style = /** @class */ (function (_super) {\n    __extends(Style, _super);\n    function Style(style, id) {\n        var _this = _super.call(this) || this;\n        _this.style = style;\n        _this.id = id;\n        return _this;\n    }\n    Style.prototype.getStyles = function () {\n        return this.sheet.join(',') + \"{\" + this.style + \"}\";\n    };\n    Style.prototype.clone = function () {\n        return new Style(this.style, this.id).merge(this);\n    };\n    return Style;\n}(Cache));\nexports.Style = Style;\n/**\n * Implement rule logic for style output.\n */\nvar Rule = /** @class */ (function (_super) {\n    __extends(Rule, _super);\n    function Rule(rule, style, id) {\n        var _this = _super.call(this) || this;\n        _this.rule = rule;\n        _this.style = style;\n        _this.id = id;\n        return _this;\n    }\n    Rule.prototype.getStyles = function () {\n        return this.rule + \"{\" + this.style + join(this.sheet) + \"}\";\n    };\n    Rule.prototype.clone = function () {\n        return new Rule(this.rule, this.style, this.id).merge(this);\n    };\n    return Rule;\n}(Cache));\nexports.Rule = Rule;\n/**\n * The FreeStyle class implements the API for everything else.\n */\nvar FreeStyle = /** @class */ (function (_super) {\n    __extends(FreeStyle, _super);\n    function FreeStyle(hash, debug, id, changes) {\n        var _this = _super.call(this, changes) || this;\n        _this.hash = hash;\n        _this.debug = debug;\n        _this.id = id;\n        return _this;\n    }\n    FreeStyle.prototype.registerStyle = function (styles, displayName) {\n        var rulesList = [];\n        var stylesList = [];\n        var pid = stylize('&', styles, rulesList, stylesList);\n        var hash = \"f\" + this.hash(pid);\n        var id = this.debug && displayName ? displayName + \"_\" + hash : hash;\n        composeStylize(this, pid, rulesList, stylesList, \".\" + exports.escape(id), true);\n        return id;\n    };\n    FreeStyle.prototype.registerKeyframes = function (keyframes, displayName) {\n        return this.registerHashRule('@keyframes', keyframes, displayName);\n    };\n    FreeStyle.prototype.registerHashRule = function (prefix, styles, displayName) {\n        var rulesList = [];\n        var stylesList = [];\n        var pid = stylize('', styles, rulesList, stylesList);\n        var hash = \"f\" + this.hash(pid);\n        var id = this.debug && displayName ? displayName + \"_\" + hash : hash;\n        var rule = new Rule(prefix + \" \" + exports.escape(id), '', \"h\\0\" + pid + \"\\0\" + prefix);\n        composeStylize(rule, pid, rulesList, stylesList, '', false);\n        this.add(rule);\n        return id;\n    };\n    FreeStyle.prototype.registerRule = function (rule, styles) {\n        var rulesList = [];\n        var stylesList = [];\n        var pid = stylize(rule, styles, rulesList, stylesList);\n        composeStylize(this, pid, rulesList, stylesList, '', false);\n    };\n    FreeStyle.prototype.registerCss = function (styles) {\n        return this.registerRule('', styles);\n    };\n    FreeStyle.prototype.getStyles = function () {\n        return join(this.sheet);\n    };\n    FreeStyle.prototype.clone = function () {\n        return new FreeStyle(this.hash, this.debug, this.id, this.changes).merge(this);\n    };\n    return FreeStyle;\n}(Cache));\nexports.FreeStyle = FreeStyle;\n/**\n * Exports a simple function to create a new instance.\n */\nfunction create(hash, debug, changes) {\n    if (hash === void 0) { hash = stringHash; }\n    if (debug === void 0) { debug = typeof process !== 'undefined' && process.env.NODE_ENV !== 'production'; }\n    if (changes === void 0) { changes = noopChanges; }\n    return new FreeStyle(hash, debug, \"f\" + (++uniqueId).toString(36), changes);\n}\nexports.create = create;\n//# sourceMappingURL=free-style.js.map","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","export function paletteToRGBA(\n  pixels: Uint8Array,\n  palette: Uint8Array\n): Uint8Array {\n  const rgba = new Uint8Array(pixels.length * 4)\n\n  const len = pixels.length\n  for (let i = 0; i < len; ++i) {\n    rgba[i * 4] = palette[pixels[i] * 3]\n    rgba[i * 4 + 1] = palette[pixels[i] * 3 + 1]\n    rgba[i * 4 + 2] = palette[pixels[i] * 3 + 2]\n    rgba[i * 4 + 3] = 255\n  }\n\n  return rgba\n}\n\nexport function paletteWithLastTransToRGBA(\n  pixels: Uint8Array,\n  palette: Uint8Array\n): Uint8Array {\n  const rgba = new Uint8Array(pixels.length * 4)\n\n  const len = pixels.length\n  for (let i = 0; i < len; ++i) {\n    if (pixels[i] === 255) {\n      rgba[i * 4 + 3] = 0\n    } else {\n      rgba[i * 4] = palette[pixels[i] * 3]\n      rgba[i * 4 + 1] = palette[pixels[i] * 3 + 1]\n      rgba[i * 4 + 2] = palette[pixels[i] * 3 + 2]\n      rgba[i * 4 + 3] = 255\n    }\n  }\n\n  return rgba\n}\n","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 2x3 Matrix\r\n * @module mat2d\r\n *\r\n * @description\r\n * A mat2d contains six elements defined as:\r\n * <pre>\r\n * [a, c, tx,\r\n *  b, d, ty]\r\n * </pre>\r\n * This is a short form for the 3x3 matrix:\r\n * <pre>\r\n * [a, c, tx,\r\n *  b, d, ty,\r\n *  0, 0, 1]\r\n * </pre>\r\n * The last row is ignored so the array is shorter and operations are faster.\r\n */\r\n\r\n/**\r\n * Creates a new identity mat2d\r\n *\r\n * @returns {mat2d} a new 2x3 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(6);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[4] = 0;\r\n    out[5] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat2d initialized with values from an existing matrix\r\n *\r\n * @param {mat2d} a matrix to clone\r\n * @returns {mat2d} a new 2x3 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(6);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat2d to another\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the source matrix\r\n * @returns {mat2d} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat2d to the identity matrix\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @returns {mat2d} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat2d with the given values\r\n *\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat2d} A new mat2d\r\n */\r\nexport function fromValues(a, b, c, d, tx, ty) {\r\n  var out = new glMatrix.ARRAY_TYPE(6);\r\n  out[0] = a;\r\n  out[1] = b;\r\n  out[2] = c;\r\n  out[3] = d;\r\n  out[4] = tx;\r\n  out[5] = ty;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat2d to the given values\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat2d} out\r\n */\r\nexport function set(out, a, b, c, d, tx, ty) {\r\n  out[0] = a;\r\n  out[1] = b;\r\n  out[2] = c;\r\n  out[3] = d;\r\n  out[4] = tx;\r\n  out[5] = ty;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat2d\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the source matrix\r\n * @returns {mat2d} out\r\n */\r\nexport function invert(out, a) {\r\n  var aa = a[0],\r\n      ab = a[1],\r\n      ac = a[2],\r\n      ad = a[3];\r\n  var atx = a[4],\r\n      aty = a[5];\r\n\r\n  var det = aa * ad - ab * ac;\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = ad * det;\r\n  out[1] = -ab * det;\r\n  out[2] = -ac * det;\r\n  out[3] = aa * det;\r\n  out[4] = (ac * aty - ad * atx) * det;\r\n  out[5] = (ab * atx - aa * aty) * det;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat2d\r\n *\r\n * @param {mat2d} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  return a[0] * a[3] - a[1] * a[2];\r\n}\r\n\r\n/**\r\n * Multiplies two mat2d's\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5];\r\n  out[0] = a0 * b0 + a2 * b1;\r\n  out[1] = a1 * b0 + a3 * b1;\r\n  out[2] = a0 * b2 + a2 * b3;\r\n  out[3] = a1 * b2 + a3 * b3;\r\n  out[4] = a0 * b4 + a2 * b5 + a4;\r\n  out[5] = a1 * b4 + a3 * b5 + a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat2d by the given angle\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2d} out\r\n */\r\nexport function rotate(out, a, rad) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  out[0] = a0 * c + a2 * s;\r\n  out[1] = a1 * c + a3 * s;\r\n  out[2] = a0 * -s + a2 * c;\r\n  out[3] = a1 * -s + a3 * c;\r\n  out[4] = a4;\r\n  out[5] = a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales the mat2d by the dimensions in the given vec2\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to translate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat2d} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var v0 = v[0],\r\n      v1 = v[1];\r\n  out[0] = a0 * v0;\r\n  out[1] = a1 * v0;\r\n  out[2] = a2 * v1;\r\n  out[3] = a3 * v1;\r\n  out[4] = a4;\r\n  out[5] = a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translates the mat2d by the dimensions in the given vec2\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to translate\r\n * @param {vec2} v the vec2 to translate the matrix by\r\n * @returns {mat2d} out\r\n **/\r\nexport function translate(out, a, v) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var v0 = v[0],\r\n      v1 = v[1];\r\n  out[0] = a0;\r\n  out[1] = a1;\r\n  out[2] = a2;\r\n  out[3] = a3;\r\n  out[4] = a0 * v0 + a2 * v1 + a4;\r\n  out[5] = a1 * v0 + a3 * v1 + a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.rotate(dest, dest, rad);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2d} out\r\n */\r\nexport function fromRotation(out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = -s;\r\n  out[3] = c;\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.scale(dest, dest, vec);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat2d} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = v[1];\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.translate(dest, dest, vec);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {vec2} v Translation vector\r\n * @returns {mat2d} out\r\n */\r\nexport function fromTranslation(out, v) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = v[0];\r\n  out[5] = v[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a mat2d\r\n *\r\n * @param {mat2d} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat2d(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat2d\r\n *\r\n * @param {mat2d} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + 1);\r\n}\r\n\r\n/**\r\n * Adds two mat2d's\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  out[4] = a[4] - b[4];\r\n  out[5] = a[5] - b[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat2d} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat2d's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat2d} out the receiving vector\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat2d} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  out[4] = a[4] + b[4] * scale;\r\n  out[5] = a[5] + b[5] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat2d} a The first matrix.\r\n * @param {mat2d} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat2d} a The first matrix.\r\n * @param {mat2d} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5));\r\n}\r\n\r\n/**\r\n * Alias for {@link mat2d.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat2d.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 3x3 Matrix\r\n * @module mat3\r\n */\r\n\r\n/**\r\n * Creates a new identity mat3\r\n *\r\n * @returns {mat3} a new 3x3 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(9);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n    out[5] = 0;\r\n    out[6] = 0;\r\n    out[7] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[4] = 1;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copies the upper-left 3x3 values into the given mat3.\r\n *\r\n * @param {mat3} out the receiving 3x3 matrix\r\n * @param {mat4} a   the source 4x4 matrix\r\n * @returns {mat3} out\r\n */\r\nexport function fromMat4(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[4];\r\n  out[4] = a[5];\r\n  out[5] = a[6];\r\n  out[6] = a[8];\r\n  out[7] = a[9];\r\n  out[8] = a[10];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat3 initialized with values from an existing matrix\r\n *\r\n * @param {mat3} a matrix to clone\r\n * @returns {mat3} a new 3x3 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(9);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat3 to another\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat3 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\r\n * @returns {mat3} A new mat3\r\n */\r\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\r\n  var out = new glMatrix.ARRAY_TYPE(9);\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m10;\r\n  out[4] = m11;\r\n  out[5] = m12;\r\n  out[6] = m20;\r\n  out[7] = m21;\r\n  out[8] = m22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat3 to the given values\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\r\n * @returns {mat3} out\r\n */\r\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m10;\r\n  out[4] = m11;\r\n  out[5] = m12;\r\n  out[6] = m20;\r\n  out[7] = m21;\r\n  out[8] = m22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat3 to the identity matrix\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @returns {mat3} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 1;\r\n  out[5] = 0;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transpose the values of a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function transpose(out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a01 = a[1],\r\n        a02 = a[2],\r\n        a12 = a[5];\r\n    out[1] = a[3];\r\n    out[2] = a[6];\r\n    out[3] = a01;\r\n    out[5] = a[7];\r\n    out[6] = a02;\r\n    out[7] = a12;\r\n  } else {\r\n    out[0] = a[0];\r\n    out[1] = a[3];\r\n    out[2] = a[6];\r\n    out[3] = a[1];\r\n    out[4] = a[4];\r\n    out[5] = a[7];\r\n    out[6] = a[2];\r\n    out[7] = a[5];\r\n    out[8] = a[8];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function invert(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  var b01 = a22 * a11 - a12 * a21;\r\n  var b11 = -a22 * a10 + a12 * a20;\r\n  var b21 = a21 * a10 - a11 * a20;\r\n\r\n  // Calculate the determinant\r\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = b01 * det;\r\n  out[1] = (-a22 * a01 + a02 * a21) * det;\r\n  out[2] = (a12 * a01 - a02 * a11) * det;\r\n  out[3] = b11 * det;\r\n  out[4] = (a22 * a00 - a02 * a20) * det;\r\n  out[5] = (-a12 * a00 + a02 * a10) * det;\r\n  out[6] = b21 * det;\r\n  out[7] = (-a21 * a00 + a01 * a20) * det;\r\n  out[8] = (a11 * a00 - a01 * a10) * det;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the adjugate of a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function adjoint(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  out[0] = a11 * a22 - a12 * a21;\r\n  out[1] = a02 * a21 - a01 * a22;\r\n  out[2] = a01 * a12 - a02 * a11;\r\n  out[3] = a12 * a20 - a10 * a22;\r\n  out[4] = a00 * a22 - a02 * a20;\r\n  out[5] = a02 * a10 - a00 * a12;\r\n  out[6] = a10 * a21 - a11 * a20;\r\n  out[7] = a01 * a20 - a00 * a21;\r\n  out[8] = a00 * a11 - a01 * a10;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat3\r\n *\r\n * @param {mat3} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\r\n}\r\n\r\n/**\r\n * Multiplies two mat3's\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  var b00 = b[0],\r\n      b01 = b[1],\r\n      b02 = b[2];\r\n  var b10 = b[3],\r\n      b11 = b[4],\r\n      b12 = b[5];\r\n  var b20 = b[6],\r\n      b21 = b[7],\r\n      b22 = b[8];\r\n\r\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\r\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\r\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\r\n\r\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\r\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\r\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\r\n\r\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\r\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\r\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translate a mat3 by the given vector\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to translate\r\n * @param {vec2} v vector to translate by\r\n * @returns {mat3} out\r\n */\r\nexport function translate(out, a, v) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5],\r\n      a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8],\r\n      x = v[0],\r\n      y = v[1];\r\n\r\n  out[0] = a00;\r\n  out[1] = a01;\r\n  out[2] = a02;\r\n\r\n  out[3] = a10;\r\n  out[4] = a11;\r\n  out[5] = a12;\r\n\r\n  out[6] = x * a00 + y * a10 + a20;\r\n  out[7] = x * a01 + y * a11 + a21;\r\n  out[8] = x * a02 + y * a12 + a22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat3 by the given angle\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat3} out\r\n */\r\nexport function rotate(out, a, rad) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5],\r\n      a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8],\r\n      s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  out[0] = c * a00 + s * a10;\r\n  out[1] = c * a01 + s * a11;\r\n  out[2] = c * a02 + s * a12;\r\n\r\n  out[3] = c * a10 - s * a00;\r\n  out[4] = c * a11 - s * a01;\r\n  out[5] = c * a12 - s * a02;\r\n\r\n  out[6] = a20;\r\n  out[7] = a21;\r\n  out[8] = a22;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales the mat3 by the dimensions in the given vec2\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to rotate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat3} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var x = v[0],\r\n      y = v[1];\r\n\r\n  out[0] = x * a[0];\r\n  out[1] = x * a[1];\r\n  out[2] = x * a[2];\r\n\r\n  out[3] = y * a[3];\r\n  out[4] = y * a[4];\r\n  out[5] = y * a[5];\r\n\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.translate(dest, dest, vec);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {vec2} v Translation vector\r\n * @returns {mat3} out\r\n */\r\nexport function fromTranslation(out, v) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 1;\r\n  out[5] = 0;\r\n  out[6] = v[0];\r\n  out[7] = v[1];\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.rotate(dest, dest, rad);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat3} out\r\n */\r\nexport function fromRotation(out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = 0;\r\n\r\n  out[3] = -s;\r\n  out[4] = c;\r\n  out[5] = 0;\r\n\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.scale(dest, dest, vec);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat3} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n\r\n  out[3] = 0;\r\n  out[4] = v[1];\r\n  out[5] = 0;\r\n\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copies the values from a mat2d into a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat2d} a the matrix to copy\r\n * @returns {mat3} out\r\n **/\r\nexport function fromMat2d(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = 0;\r\n\r\n  out[3] = a[2];\r\n  out[4] = a[3];\r\n  out[5] = 0;\r\n\r\n  out[6] = a[4];\r\n  out[7] = a[5];\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n* Calculates a 3x3 matrix from the given quaternion\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {quat} q Quaternion to create matrix from\r\n*\r\n* @returns {mat3} out\r\n*/\r\nexport function fromQuat(out, q) {\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var yx = y * x2;\r\n  var yy = y * y2;\r\n  var zx = z * x2;\r\n  var zy = z * y2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out[0] = 1 - yy - zz;\r\n  out[3] = yx - wz;\r\n  out[6] = zx + wy;\r\n\r\n  out[1] = yx + wz;\r\n  out[4] = 1 - xx - zz;\r\n  out[7] = zy - wx;\r\n\r\n  out[2] = zx - wy;\r\n  out[5] = zy + wx;\r\n  out[8] = 1 - xx - yy;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n* Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {mat4} a Mat4 to derive the normal matrix from\r\n*\r\n* @returns {mat3} out\r\n*/\r\nexport function normalFromMat4(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n\r\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n\r\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a 2D projection matrix with the given bounds\r\n *\r\n * @param {mat3} out mat3 frustum matrix will be written into\r\n * @param {number} width Width of your gl context\r\n * @param {number} height Height of gl context\r\n * @returns {mat3} out\r\n */\r\nexport function projection(out, width, height) {\r\n  out[0] = 2 / width;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = -2 / height;\r\n  out[5] = 0;\r\n  out[6] = -1;\r\n  out[7] = 1;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a mat3\r\n *\r\n * @param {mat3} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' + a[8] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat3\r\n *\r\n * @param {mat3} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2));\r\n}\r\n\r\n/**\r\n * Adds two mat3's\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  out[6] = a[6] + b[6];\r\n  out[7] = a[7] + b[7];\r\n  out[8] = a[8] + b[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  out[4] = a[4] - b[4];\r\n  out[5] = a[5] - b[5];\r\n  out[6] = a[6] - b[6];\r\n  out[7] = a[7] - b[7];\r\n  out[8] = a[8] - b[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat3} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  out[6] = a[6] * b;\r\n  out[7] = a[7] * b;\r\n  out[8] = a[8] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat3} out the receiving vector\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat3} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  out[4] = a[4] + b[4] * scale;\r\n  out[5] = a[5] + b[5] * scale;\r\n  out[6] = a[6] + b[6] * scale;\r\n  out[7] = a[7] + b[7] * scale;\r\n  out[8] = a[8] + b[8] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat3} a The first matrix.\r\n * @param {mat3} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat3} a The first matrix.\r\n * @param {mat3} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5],\r\n      a6 = a[6],\r\n      a7 = a[7],\r\n      a8 = a[8];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5],\r\n      b6 = b[6],\r\n      b7 = b[7],\r\n      b8 = b[8];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\r\n}\r\n\r\n/**\r\n * Alias for {@link mat3.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat3.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\r\n * @module mat4\r\n */\r\n\r\n/**\r\n * Creates a new identity mat4\r\n *\r\n * @returns {mat4} a new 4x4 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(16);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n    out[4] = 0;\r\n    out[6] = 0;\r\n    out[7] = 0;\r\n    out[8] = 0;\r\n    out[9] = 0;\r\n    out[11] = 0;\r\n    out[12] = 0;\r\n    out[13] = 0;\r\n    out[14] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[5] = 1;\r\n  out[10] = 1;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat4 initialized with values from an existing matrix\r\n *\r\n * @param {mat4} a matrix to clone\r\n * @returns {mat4} a new 4x4 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(16);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  out[9] = a[9];\r\n  out[10] = a[10];\r\n  out[11] = a[11];\r\n  out[12] = a[12];\r\n  out[13] = a[13];\r\n  out[14] = a[14];\r\n  out[15] = a[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat4 to another\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  out[9] = a[9];\r\n  out[10] = a[10];\r\n  out[11] = a[11];\r\n  out[12] = a[12];\r\n  out[13] = a[13];\r\n  out[14] = a[14];\r\n  out[15] = a[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat4 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} A new mat4\r\n */\r\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n  var out = new glMatrix.ARRAY_TYPE(16);\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m03;\r\n  out[4] = m10;\r\n  out[5] = m11;\r\n  out[6] = m12;\r\n  out[7] = m13;\r\n  out[8] = m20;\r\n  out[9] = m21;\r\n  out[10] = m22;\r\n  out[11] = m23;\r\n  out[12] = m30;\r\n  out[13] = m31;\r\n  out[14] = m32;\r\n  out[15] = m33;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat4 to the given values\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} out\r\n */\r\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m03;\r\n  out[4] = m10;\r\n  out[5] = m11;\r\n  out[6] = m12;\r\n  out[7] = m13;\r\n  out[8] = m20;\r\n  out[9] = m21;\r\n  out[10] = m22;\r\n  out[11] = m23;\r\n  out[12] = m30;\r\n  out[13] = m31;\r\n  out[14] = m32;\r\n  out[15] = m33;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat4 to the identity matrix\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @returns {mat4} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = 1;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transpose the values of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function transpose(out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a01 = a[1],\r\n        a02 = a[2],\r\n        a03 = a[3];\r\n    var a12 = a[6],\r\n        a13 = a[7];\r\n    var a23 = a[11];\r\n\r\n    out[1] = a[4];\r\n    out[2] = a[8];\r\n    out[3] = a[12];\r\n    out[4] = a01;\r\n    out[6] = a[9];\r\n    out[7] = a[13];\r\n    out[8] = a02;\r\n    out[9] = a12;\r\n    out[11] = a[14];\r\n    out[12] = a03;\r\n    out[13] = a13;\r\n    out[14] = a23;\r\n  } else {\r\n    out[0] = a[0];\r\n    out[1] = a[4];\r\n    out[2] = a[8];\r\n    out[3] = a[12];\r\n    out[4] = a[1];\r\n    out[5] = a[5];\r\n    out[6] = a[9];\r\n    out[7] = a[13];\r\n    out[8] = a[2];\r\n    out[9] = a[6];\r\n    out[10] = a[10];\r\n    out[11] = a[14];\r\n    out[12] = a[3];\r\n    out[13] = a[7];\r\n    out[14] = a[11];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function invert(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\r\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\r\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\r\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\r\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\r\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\r\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the adjugate of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function adjoint(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\r\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\r\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\r\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\r\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\r\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\r\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\r\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\r\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\r\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\r\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\r\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\r\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\r\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\r\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\r\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat4\r\n *\r\n * @param {mat4} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n}\r\n\r\n/**\r\n * Multiplies two mat4s\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  // Cache only the current line of the second matrix\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b[4];b1 = b[5];b2 = b[6];b3 = b[7];\r\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b[8];b1 = b[9];b2 = b[10];b3 = b[11];\r\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b[12];b1 = b[13];b2 = b[14];b3 = b[15];\r\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translate a mat4 by the given vector\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {mat4} out\r\n */\r\nexport function translate(out, a, v) {\r\n  var x = v[0],\r\n      y = v[1],\r\n      z = v[2];\r\n  var a00 = void 0,\r\n      a01 = void 0,\r\n      a02 = void 0,\r\n      a03 = void 0;\r\n  var a10 = void 0,\r\n      a11 = void 0,\r\n      a12 = void 0,\r\n      a13 = void 0;\r\n  var a20 = void 0,\r\n      a21 = void 0,\r\n      a22 = void 0,\r\n      a23 = void 0;\r\n\r\n  if (a === out) {\r\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\r\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\r\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\r\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\r\n  } else {\r\n    a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];\r\n    a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];\r\n    a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];\r\n\r\n    out[0] = a00;out[1] = a01;out[2] = a02;out[3] = a03;\r\n    out[4] = a10;out[5] = a11;out[6] = a12;out[7] = a13;\r\n    out[8] = a20;out[9] = a21;out[10] = a22;out[11] = a23;\r\n\r\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\r\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\r\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\r\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {vec3} v the vec3 to scale the matrix by\r\n * @returns {mat4} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var x = v[0],\r\n      y = v[1],\r\n      z = v[2];\r\n\r\n  out[0] = a[0] * x;\r\n  out[1] = a[1] * x;\r\n  out[2] = a[2] * x;\r\n  out[3] = a[3] * x;\r\n  out[4] = a[4] * y;\r\n  out[5] = a[5] * y;\r\n  out[6] = a[6] * y;\r\n  out[7] = a[7] * y;\r\n  out[8] = a[8] * z;\r\n  out[9] = a[9] * z;\r\n  out[10] = a[10] * z;\r\n  out[11] = a[11] * z;\r\n  out[12] = a[12];\r\n  out[13] = a[13];\r\n  out[14] = a[14];\r\n  out[15] = a[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat4 by the given angle around the given axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\r\nexport function rotate(out, a, rad, axis) {\r\n  var x = axis[0],\r\n      y = axis[1],\r\n      z = axis[2];\r\n  var len = Math.sqrt(x * x + y * y + z * z);\r\n  var s = void 0,\r\n      c = void 0,\r\n      t = void 0;\r\n  var a00 = void 0,\r\n      a01 = void 0,\r\n      a02 = void 0,\r\n      a03 = void 0;\r\n  var a10 = void 0,\r\n      a11 = void 0,\r\n      a12 = void 0,\r\n      a13 = void 0;\r\n  var a20 = void 0,\r\n      a21 = void 0,\r\n      a22 = void 0,\r\n      a23 = void 0;\r\n  var b00 = void 0,\r\n      b01 = void 0,\r\n      b02 = void 0;\r\n  var b10 = void 0,\r\n      b11 = void 0,\r\n      b12 = void 0;\r\n  var b20 = void 0,\r\n      b21 = void 0,\r\n      b22 = void 0;\r\n\r\n  if (len < glMatrix.EPSILON) {\r\n    return null;\r\n  }\r\n\r\n  len = 1 / len;\r\n  x *= len;\r\n  y *= len;\r\n  z *= len;\r\n\r\n  s = Math.sin(rad);\r\n  c = Math.cos(rad);\r\n  t = 1 - c;\r\n\r\n  a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];\r\n  a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];\r\n  a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];\r\n\r\n  // Construct the elements of the rotation matrix\r\n  b00 = x * x * t + c;b01 = y * x * t + z * s;b02 = z * x * t - y * s;\r\n  b10 = x * y * t - z * s;b11 = y * y * t + c;b12 = z * y * t + x * s;\r\n  b20 = x * z * t + y * s;b21 = y * z * t - x * s;b22 = z * z * t + c;\r\n\r\n  // Perform rotation-specific matrix multiplication\r\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\r\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\r\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\r\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\r\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\r\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\r\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\r\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\r\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\r\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\r\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\r\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged last row\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the X axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function rotateX(out, a, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  var a10 = a[4];\r\n  var a11 = a[5];\r\n  var a12 = a[6];\r\n  var a13 = a[7];\r\n  var a20 = a[8];\r\n  var a21 = a[9];\r\n  var a22 = a[10];\r\n  var a23 = a[11];\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged rows\r\n    out[0] = a[0];\r\n    out[1] = a[1];\r\n    out[2] = a[2];\r\n    out[3] = a[3];\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[4] = a10 * c + a20 * s;\r\n  out[5] = a11 * c + a21 * s;\r\n  out[6] = a12 * c + a22 * s;\r\n  out[7] = a13 * c + a23 * s;\r\n  out[8] = a20 * c - a10 * s;\r\n  out[9] = a21 * c - a11 * s;\r\n  out[10] = a22 * c - a12 * s;\r\n  out[11] = a23 * c - a13 * s;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the Y axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function rotateY(out, a, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  var a00 = a[0];\r\n  var a01 = a[1];\r\n  var a02 = a[2];\r\n  var a03 = a[3];\r\n  var a20 = a[8];\r\n  var a21 = a[9];\r\n  var a22 = a[10];\r\n  var a23 = a[11];\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged rows\r\n    out[4] = a[4];\r\n    out[5] = a[5];\r\n    out[6] = a[6];\r\n    out[7] = a[7];\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = a00 * c - a20 * s;\r\n  out[1] = a01 * c - a21 * s;\r\n  out[2] = a02 * c - a22 * s;\r\n  out[3] = a03 * c - a23 * s;\r\n  out[8] = a00 * s + a20 * c;\r\n  out[9] = a01 * s + a21 * c;\r\n  out[10] = a02 * s + a22 * c;\r\n  out[11] = a03 * s + a23 * c;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the Z axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function rotateZ(out, a, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  var a00 = a[0];\r\n  var a01 = a[1];\r\n  var a02 = a[2];\r\n  var a03 = a[3];\r\n  var a10 = a[4];\r\n  var a11 = a[5];\r\n  var a12 = a[6];\r\n  var a13 = a[7];\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged last row\r\n    out[8] = a[8];\r\n    out[9] = a[9];\r\n    out[10] = a[10];\r\n    out[11] = a[11];\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = a00 * c + a10 * s;\r\n  out[1] = a01 * c + a11 * s;\r\n  out[2] = a02 * c + a12 * s;\r\n  out[3] = a03 * c + a13 * s;\r\n  out[4] = a10 * c - a00 * s;\r\n  out[5] = a11 * c - a01 * s;\r\n  out[6] = a12 * c - a02 * s;\r\n  out[7] = a13 * c - a03 * s;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromTranslation(out, v) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = 1;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.scale(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Scaling vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = v[1];\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = v[2];\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle around a given axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotate(dest, dest, rad, axis);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotation(out, rad, axis) {\r\n  var x = axis[0],\r\n      y = axis[1],\r\n      z = axis[2];\r\n  var len = Math.sqrt(x * x + y * y + z * z);\r\n  var s = void 0,\r\n      c = void 0,\r\n      t = void 0;\r\n\r\n  if (len < glMatrix.EPSILON) {\r\n    return null;\r\n  }\r\n\r\n  len = 1 / len;\r\n  x *= len;\r\n  y *= len;\r\n  z *= len;\r\n\r\n  s = Math.sin(rad);\r\n  c = Math.cos(rad);\r\n  t = 1 - c;\r\n\r\n  // Perform rotation-specific matrix multiplication\r\n  out[0] = x * x * t + c;\r\n  out[1] = y * x * t + z * s;\r\n  out[2] = z * x * t - y * s;\r\n  out[3] = 0;\r\n  out[4] = x * y * t - z * s;\r\n  out[5] = y * y * t + c;\r\n  out[6] = z * y * t + x * s;\r\n  out[7] = 0;\r\n  out[8] = x * z * t + y * s;\r\n  out[9] = y * z * t - x * s;\r\n  out[10] = z * z * t + c;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from the given angle around the X axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateX(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function fromXRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = c;\r\n  out[6] = s;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = -s;\r\n  out[10] = c;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from the given angle around the Y axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateY(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function fromYRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = c;\r\n  out[1] = 0;\r\n  out[2] = -s;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = 1;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = s;\r\n  out[9] = 0;\r\n  out[10] = c;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from the given angle around the Z axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateZ(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function fromZRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = -s;\r\n  out[5] = c;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation and vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotationTranslation(out, q, v) {\r\n  // Quaternion math\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out[0] = 1 - (yy + zz);\r\n  out[1] = xy + wz;\r\n  out[2] = xz - wy;\r\n  out[3] = 0;\r\n  out[4] = xy - wz;\r\n  out[5] = 1 - (xx + zz);\r\n  out[6] = yz + wx;\r\n  out[7] = 0;\r\n  out[8] = xz + wy;\r\n  out[9] = yz - wx;\r\n  out[10] = 1 - (xx + yy);\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat4 from a dual quat.\r\n *\r\n * @param {mat4} out Matrix\r\n * @param {quat2} a Dual Quaternion\r\n * @returns {mat4} mat4 receiving operation result\r\n */\r\nexport function fromQuat2(out, a) {\r\n  var translation = new glMatrix.ARRAY_TYPE(3);\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7];\r\n\r\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw;\r\n  //Only scale if it makes sense\r\n  if (magnitude > 0) {\r\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\r\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\r\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\r\n  } else {\r\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\r\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\r\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\r\n  }\r\n  fromRotationTranslation(out, a, translation);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the translation vector component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslation,\r\n *  the returned vector will be the same as the translation vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive translation component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\r\nexport function getTranslation(out, mat) {\r\n  out[0] = mat[12];\r\n  out[1] = mat[13];\r\n  out[2] = mat[14];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the scaling factor component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslationScale\r\n *  with a normalized Quaternion paramter, the returned vector will be\r\n *  the same as the scaling vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive scaling factor component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\r\nexport function getScaling(out, mat) {\r\n  var m11 = mat[0];\r\n  var m12 = mat[1];\r\n  var m13 = mat[2];\r\n  var m21 = mat[4];\r\n  var m22 = mat[5];\r\n  var m23 = mat[6];\r\n  var m31 = mat[8];\r\n  var m32 = mat[9];\r\n  var m33 = mat[10];\r\n\r\n  out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\r\n  out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\r\n  out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a quaternion representing the rotational component\r\n *  of a transformation matrix. If a matrix is built with\r\n *  fromRotationTranslation, the returned quaternion will be the\r\n *  same as the quaternion originally supplied.\r\n * @param {quat} out Quaternion to receive the rotation component\r\n * @param {mat4} mat Matrix to be decomposed (input)\r\n * @return {quat} out\r\n */\r\nexport function getRotation(out, mat) {\r\n  // Algorithm taken from http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n  var trace = mat[0] + mat[5] + mat[10];\r\n  var S = 0;\r\n\r\n  if (trace > 0) {\r\n    S = Math.sqrt(trace + 1.0) * 2;\r\n    out[3] = 0.25 * S;\r\n    out[0] = (mat[6] - mat[9]) / S;\r\n    out[1] = (mat[8] - mat[2]) / S;\r\n    out[2] = (mat[1] - mat[4]) / S;\r\n  } else if (mat[0] > mat[5] && mat[0] > mat[10]) {\r\n    S = Math.sqrt(1.0 + mat[0] - mat[5] - mat[10]) * 2;\r\n    out[3] = (mat[6] - mat[9]) / S;\r\n    out[0] = 0.25 * S;\r\n    out[1] = (mat[1] + mat[4]) / S;\r\n    out[2] = (mat[8] + mat[2]) / S;\r\n  } else if (mat[5] > mat[10]) {\r\n    S = Math.sqrt(1.0 + mat[5] - mat[0] - mat[10]) * 2;\r\n    out[3] = (mat[8] - mat[2]) / S;\r\n    out[0] = (mat[1] + mat[4]) / S;\r\n    out[1] = 0.25 * S;\r\n    out[2] = (mat[6] + mat[9]) / S;\r\n  } else {\r\n    S = Math.sqrt(1.0 + mat[10] - mat[0] - mat[5]) * 2;\r\n    out[3] = (mat[1] - mat[4]) / S;\r\n    out[0] = (mat[8] + mat[2]) / S;\r\n    out[1] = (mat[6] + mat[9]) / S;\r\n    out[2] = 0.25 * S;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotationTranslationScale(out, q, v, s) {\r\n  // Quaternion math\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n  var sx = s[0];\r\n  var sy = s[1];\r\n  var sz = s[2];\r\n\r\n  out[0] = (1 - (yy + zz)) * sx;\r\n  out[1] = (xy + wz) * sx;\r\n  out[2] = (xz - wy) * sx;\r\n  out[3] = 0;\r\n  out[4] = (xy - wz) * sy;\r\n  out[5] = (1 - (xx + zz)) * sy;\r\n  out[6] = (yz + wx) * sy;\r\n  out[7] = 0;\r\n  out[8] = (xz + wy) * sz;\r\n  out[9] = (yz - wx) * sz;\r\n  out[10] = (1 - (xx + yy)) * sz;\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     mat4.translate(dest, origin);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *     mat4.translate(dest, negativeOrigin);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @param {vec3} o The origin vector around which to scale and rotate\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\r\n  // Quaternion math\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  var sx = s[0];\r\n  var sy = s[1];\r\n  var sz = s[2];\r\n\r\n  var ox = o[0];\r\n  var oy = o[1];\r\n  var oz = o[2];\r\n\r\n  var out0 = (1 - (yy + zz)) * sx;\r\n  var out1 = (xy + wz) * sx;\r\n  var out2 = (xz - wy) * sx;\r\n  var out4 = (xy - wz) * sy;\r\n  var out5 = (1 - (xx + zz)) * sy;\r\n  var out6 = (yz + wx) * sy;\r\n  var out8 = (xz + wy) * sz;\r\n  var out9 = (yz - wx) * sz;\r\n  var out10 = (1 - (xx + yy)) * sz;\r\n\r\n  out[0] = out0;\r\n  out[1] = out1;\r\n  out[2] = out2;\r\n  out[3] = 0;\r\n  out[4] = out4;\r\n  out[5] = out5;\r\n  out[6] = out6;\r\n  out[7] = 0;\r\n  out[8] = out8;\r\n  out[9] = out9;\r\n  out[10] = out10;\r\n  out[11] = 0;\r\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\r\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\r\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates a 4x4 matrix from the given quaternion\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Quaternion to create matrix from\r\n *\r\n * @returns {mat4} out\r\n */\r\nexport function fromQuat(out, q) {\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var yx = y * x2;\r\n  var yy = y * y2;\r\n  var zx = z * x2;\r\n  var zy = z * y2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out[0] = 1 - yy - zz;\r\n  out[1] = yx + wz;\r\n  out[2] = zx - wy;\r\n  out[3] = 0;\r\n\r\n  out[4] = yx - wz;\r\n  out[5] = 1 - xx - zz;\r\n  out[6] = zy + wx;\r\n  out[7] = 0;\r\n\r\n  out[8] = zx + wy;\r\n  out[9] = zy - wx;\r\n  out[10] = 1 - xx - yy;\r\n  out[11] = 0;\r\n\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a frustum matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Number} left Left bound of the frustum\r\n * @param {Number} right Right bound of the frustum\r\n * @param {Number} bottom Bottom bound of the frustum\r\n * @param {Number} top Top bound of the frustum\r\n * @param {Number} near Near bound of the frustum\r\n * @param {Number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nexport function frustum(out, left, right, bottom, top, near, far) {\r\n  var rl = 1 / (right - left);\r\n  var tb = 1 / (top - bottom);\r\n  var nf = 1 / (near - far);\r\n  out[0] = near * 2 * rl;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = near * 2 * tb;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = (right + left) * rl;\r\n  out[9] = (top + bottom) * tb;\r\n  out[10] = (far + near) * nf;\r\n  out[11] = -1;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = far * near * 2 * nf;\r\n  out[15] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a perspective projection matrix with the given bounds.\r\n * Passing null/undefined/no value for far will generate infinite projection matrix.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} fovy Vertical field of view in radians\r\n * @param {number} aspect Aspect ratio. typically viewport width/height\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum, can be null or Infinity\r\n * @returns {mat4} out\r\n */\r\nexport function perspective(out, fovy, aspect, near, far) {\r\n  var f = 1.0 / Math.tan(fovy / 2),\r\n      nf = void 0;\r\n  out[0] = f / aspect;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = f;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[11] = -1;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[15] = 0;\r\n  if (far != null && far !== Infinity) {\r\n    nf = 1 / (near - far);\r\n    out[10] = (far + near) * nf;\r\n    out[14] = 2 * far * near * nf;\r\n  } else {\r\n    out[10] = -1;\r\n    out[14] = -2 * near;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a perspective projection matrix with the given field of view.\r\n * This is primarily useful for generating projection matrices to be used\r\n * with the still experiemental WebVR API.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\r\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\r\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\r\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\r\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\r\n  var xScale = 2.0 / (leftTan + rightTan);\r\n  var yScale = 2.0 / (upTan + downTan);\r\n\r\n  out[0] = xScale;\r\n  out[1] = 0.0;\r\n  out[2] = 0.0;\r\n  out[3] = 0.0;\r\n  out[4] = 0.0;\r\n  out[5] = yScale;\r\n  out[6] = 0.0;\r\n  out[7] = 0.0;\r\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\r\n  out[9] = (upTan - downTan) * yScale * 0.5;\r\n  out[10] = far / (near - far);\r\n  out[11] = -1.0;\r\n  out[12] = 0.0;\r\n  out[13] = 0.0;\r\n  out[14] = far * near / (near - far);\r\n  out[15] = 0.0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a orthogonal projection matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} left Left bound of the frustum\r\n * @param {number} right Right bound of the frustum\r\n * @param {number} bottom Bottom bound of the frustum\r\n * @param {number} top Top bound of the frustum\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nexport function ortho(out, left, right, bottom, top, near, far) {\r\n  var lr = 1 / (left - right);\r\n  var bt = 1 / (bottom - top);\r\n  var nf = 1 / (near - far);\r\n  out[0] = -2 * lr;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = -2 * bt;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 2 * nf;\r\n  out[11] = 0;\r\n  out[12] = (left + right) * lr;\r\n  out[13] = (top + bottom) * bt;\r\n  out[14] = (far + near) * nf;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\r\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\r\nexport function lookAt(out, eye, center, up) {\r\n  var x0 = void 0,\r\n      x1 = void 0,\r\n      x2 = void 0,\r\n      y0 = void 0,\r\n      y1 = void 0,\r\n      y2 = void 0,\r\n      z0 = void 0,\r\n      z1 = void 0,\r\n      z2 = void 0,\r\n      len = void 0;\r\n  var eyex = eye[0];\r\n  var eyey = eye[1];\r\n  var eyez = eye[2];\r\n  var upx = up[0];\r\n  var upy = up[1];\r\n  var upz = up[2];\r\n  var centerx = center[0];\r\n  var centery = center[1];\r\n  var centerz = center[2];\r\n\r\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\r\n    return identity(out);\r\n  }\r\n\r\n  z0 = eyex - centerx;\r\n  z1 = eyey - centery;\r\n  z2 = eyez - centerz;\r\n\r\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\r\n  z0 *= len;\r\n  z1 *= len;\r\n  z2 *= len;\r\n\r\n  x0 = upy * z2 - upz * z1;\r\n  x1 = upz * z0 - upx * z2;\r\n  x2 = upx * z1 - upy * z0;\r\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\r\n  if (!len) {\r\n    x0 = 0;\r\n    x1 = 0;\r\n    x2 = 0;\r\n  } else {\r\n    len = 1 / len;\r\n    x0 *= len;\r\n    x1 *= len;\r\n    x2 *= len;\r\n  }\r\n\r\n  y0 = z1 * x2 - z2 * x1;\r\n  y1 = z2 * x0 - z0 * x2;\r\n  y2 = z0 * x1 - z1 * x0;\r\n\r\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\r\n  if (!len) {\r\n    y0 = 0;\r\n    y1 = 0;\r\n    y2 = 0;\r\n  } else {\r\n    len = 1 / len;\r\n    y0 *= len;\r\n    y1 *= len;\r\n    y2 *= len;\r\n  }\r\n\r\n  out[0] = x0;\r\n  out[1] = y0;\r\n  out[2] = z0;\r\n  out[3] = 0;\r\n  out[4] = x1;\r\n  out[5] = y1;\r\n  out[6] = z1;\r\n  out[7] = 0;\r\n  out[8] = x2;\r\n  out[9] = y2;\r\n  out[10] = z2;\r\n  out[11] = 0;\r\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\r\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\r\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a matrix that makes something look at something else.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\r\nexport function targetTo(out, eye, target, up) {\r\n  var eyex = eye[0],\r\n      eyey = eye[1],\r\n      eyez = eye[2],\r\n      upx = up[0],\r\n      upy = up[1],\r\n      upz = up[2];\r\n\r\n  var z0 = eyex - target[0],\r\n      z1 = eyey - target[1],\r\n      z2 = eyez - target[2];\r\n\r\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    z0 *= len;\r\n    z1 *= len;\r\n    z2 *= len;\r\n  }\r\n\r\n  var x0 = upy * z2 - upz * z1,\r\n      x1 = upz * z0 - upx * z2,\r\n      x2 = upx * z1 - upy * z0;\r\n\r\n  len = x0 * x0 + x1 * x1 + x2 * x2;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    x0 *= len;\r\n    x1 *= len;\r\n    x2 *= len;\r\n  }\r\n\r\n  out[0] = x0;\r\n  out[1] = x1;\r\n  out[2] = x2;\r\n  out[3] = 0;\r\n  out[4] = z1 * x2 - z2 * x1;\r\n  out[5] = z2 * x0 - z0 * x2;\r\n  out[6] = z0 * x1 - z1 * x0;\r\n  out[7] = 0;\r\n  out[8] = z0;\r\n  out[9] = z1;\r\n  out[10] = z2;\r\n  out[11] = 0;\r\n  out[12] = eyex;\r\n  out[13] = eyey;\r\n  out[14] = eyez;\r\n  out[15] = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a mat4\r\n *\r\n * @param {mat4} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' + a[8] + ', ' + a[9] + ', ' + a[10] + ', ' + a[11] + ', ' + a[12] + ', ' + a[13] + ', ' + a[14] + ', ' + a[15] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat4\r\n *\r\n * @param {mat4} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2) + Math.pow(a[9], 2) + Math.pow(a[10], 2) + Math.pow(a[11], 2) + Math.pow(a[12], 2) + Math.pow(a[13], 2) + Math.pow(a[14], 2) + Math.pow(a[15], 2));\r\n}\r\n\r\n/**\r\n * Adds two mat4's\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  out[6] = a[6] + b[6];\r\n  out[7] = a[7] + b[7];\r\n  out[8] = a[8] + b[8];\r\n  out[9] = a[9] + b[9];\r\n  out[10] = a[10] + b[10];\r\n  out[11] = a[11] + b[11];\r\n  out[12] = a[12] + b[12];\r\n  out[13] = a[13] + b[13];\r\n  out[14] = a[14] + b[14];\r\n  out[15] = a[15] + b[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  out[4] = a[4] - b[4];\r\n  out[5] = a[5] - b[5];\r\n  out[6] = a[6] - b[6];\r\n  out[7] = a[7] - b[7];\r\n  out[8] = a[8] - b[8];\r\n  out[9] = a[9] - b[9];\r\n  out[10] = a[10] - b[10];\r\n  out[11] = a[11] - b[11];\r\n  out[12] = a[12] - b[12];\r\n  out[13] = a[13] - b[13];\r\n  out[14] = a[14] - b[14];\r\n  out[15] = a[15] - b[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat4} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  out[6] = a[6] * b;\r\n  out[7] = a[7] * b;\r\n  out[8] = a[8] * b;\r\n  out[9] = a[9] * b;\r\n  out[10] = a[10] * b;\r\n  out[11] = a[11] * b;\r\n  out[12] = a[12] * b;\r\n  out[13] = a[13] * b;\r\n  out[14] = a[14] * b;\r\n  out[15] = a[15] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat4} out the receiving vector\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat4} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  out[4] = a[4] + b[4] * scale;\r\n  out[5] = a[5] + b[5] * scale;\r\n  out[6] = a[6] + b[6] * scale;\r\n  out[7] = a[7] + b[7] * scale;\r\n  out[8] = a[8] + b[8] * scale;\r\n  out[9] = a[9] + b[9] * scale;\r\n  out[10] = a[10] + b[10] * scale;\r\n  out[11] = a[11] + b[11] * scale;\r\n  out[12] = a[12] + b[12] * scale;\r\n  out[13] = a[13] + b[13] * scale;\r\n  out[14] = a[14] + b[14] * scale;\r\n  out[15] = a[15] + b[15] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var a4 = a[4],\r\n      a5 = a[5],\r\n      a6 = a[6],\r\n      a7 = a[7];\r\n  var a8 = a[8],\r\n      a9 = a[9],\r\n      a10 = a[10],\r\n      a11 = a[11];\r\n  var a12 = a[12],\r\n      a13 = a[13],\r\n      a14 = a[14],\r\n      a15 = a[15];\r\n\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  var b4 = b[4],\r\n      b5 = b[5],\r\n      b6 = b[6],\r\n      b7 = b[7];\r\n  var b8 = b[8],\r\n      b9 = b[9],\r\n      b10 = b[10],\r\n      b11 = b[11];\r\n  var b12 = b[12],\r\n      b13 = b[13],\r\n      b14 = b[14],\r\n      b15 = b[15];\r\n\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\r\n}\r\n\r\n/**\r\n * Alias for {@link mat4.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat4.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 4 Dimensional Vector\r\n * @module vec4\r\n */\r\n\r\n/**\r\n * Creates a new, empty vec4\r\n *\r\n * @returns {vec4} a new 4D vector\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec4 initialized with values from an existing vector\r\n *\r\n * @param {vec4} a vector to clone\r\n * @returns {vec4} a new 4D vector\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec4 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} a new 4D vector\r\n */\r\nexport function fromValues(x, y, z, w) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  out[3] = w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one vec4 to another\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the source vector\r\n * @returns {vec4} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec4 to the given values\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} out\r\n */\r\nexport function set(out, x, y, z, w) {\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  out[3] = w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  out[0] = a[0] * b[0];\r\n  out[1] = a[1] * b[1];\r\n  out[2] = a[2] * b[2];\r\n  out[3] = a[3] * b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Divides two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function divide(out, a, b) {\r\n  out[0] = a[0] / b[0];\r\n  out[1] = a[1] / b[1];\r\n  out[2] = a[2] / b[2];\r\n  out[3] = a[3] / b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.ceil the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to ceil\r\n * @returns {vec4} out\r\n */\r\nexport function ceil(out, a) {\r\n  out[0] = Math.ceil(a[0]);\r\n  out[1] = Math.ceil(a[1]);\r\n  out[2] = Math.ceil(a[2]);\r\n  out[3] = Math.ceil(a[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.floor the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to floor\r\n * @returns {vec4} out\r\n */\r\nexport function floor(out, a) {\r\n  out[0] = Math.floor(a[0]);\r\n  out[1] = Math.floor(a[1]);\r\n  out[2] = Math.floor(a[2]);\r\n  out[3] = Math.floor(a[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the minimum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function min(out, a, b) {\r\n  out[0] = Math.min(a[0], b[0]);\r\n  out[1] = Math.min(a[1], b[1]);\r\n  out[2] = Math.min(a[2], b[2]);\r\n  out[3] = Math.min(a[3], b[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the maximum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function max(out, a, b) {\r\n  out[0] = Math.max(a[0], b[0]);\r\n  out[1] = Math.max(a[1], b[1]);\r\n  out[2] = Math.max(a[2], b[2]);\r\n  out[3] = Math.max(a[3], b[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.round the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to round\r\n * @returns {vec4} out\r\n */\r\nexport function round(out, a) {\r\n  out[0] = Math.round(a[0]);\r\n  out[1] = Math.round(a[1]);\r\n  out[2] = Math.round(a[2]);\r\n  out[3] = Math.round(a[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales a vec4 by a scalar number\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec4} out\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec4's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec4} out\r\n */\r\nexport function scaleAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nexport function distance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  var w = b[3] - a[3];\r\n  return Math.sqrt(x * x + y * y + z * z + w * w);\r\n}\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nexport function squaredDistance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  var w = b[3] - a[3];\r\n  return x * x + y * y + z * z + w * w;\r\n}\r\n\r\n/**\r\n * Calculates the length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport function length(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var w = a[3];\r\n  return Math.sqrt(x * x + y * y + z * z + w * w);\r\n}\r\n\r\n/**\r\n * Calculates the squared length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nexport function squaredLength(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var w = a[3];\r\n  return x * x + y * y + z * z + w * w;\r\n}\r\n\r\n/**\r\n * Negates the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to negate\r\n * @returns {vec4} out\r\n */\r\nexport function negate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = -a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the inverse of the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to invert\r\n * @returns {vec4} out\r\n */\r\nexport function inverse(out, a) {\r\n  out[0] = 1.0 / a[0];\r\n  out[1] = 1.0 / a[1];\r\n  out[2] = 1.0 / a[2];\r\n  out[3] = 1.0 / a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Normalize a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to normalize\r\n * @returns {vec4} out\r\n */\r\nexport function normalize(out, a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var w = a[3];\r\n  var len = x * x + y * y + z * z + w * w;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    out[0] = x * len;\r\n    out[1] = y * len;\r\n    out[2] = z * len;\r\n    out[3] = w * len;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nexport function dot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation between two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec4} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var ax = a[0];\r\n  var ay = a[1];\r\n  var az = a[2];\r\n  var aw = a[3];\r\n  out[0] = ax + t * (b[0] - ax);\r\n  out[1] = ay + t * (b[1] - ay);\r\n  out[2] = az + t * (b[2] - az);\r\n  out[3] = aw + t * (b[3] - aw);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec4} out\r\n */\r\nexport function random(out, scale) {\r\n  scale = scale || 1.0;\r\n\r\n  // Marsaglia, George. Choosing a Point from the Surface of a\r\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\r\n  // http://projecteuclid.org/euclid.aoms/1177692644;\r\n  var v1, v2, v3, v4;\r\n  var s1, s2;\r\n  do {\r\n    v1 = glMatrix.RANDOM() * 2 - 1;\r\n    v2 = glMatrix.RANDOM() * 2 - 1;\r\n    s1 = v1 * v1 + v2 * v2;\r\n  } while (s1 >= 1);\r\n  do {\r\n    v3 = glMatrix.RANDOM() * 2 - 1;\r\n    v4 = glMatrix.RANDOM() * 2 - 1;\r\n    s2 = v3 * v3 + v4 * v4;\r\n  } while (s2 >= 1);\r\n\r\n  var d = Math.sqrt((1 - s1) / s2);\r\n  out[0] = scale * v1;\r\n  out[1] = scale * v2;\r\n  out[2] = scale * v3 * d;\r\n  out[3] = scale * v4 * d;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec4 with a mat4.\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec4} out\r\n */\r\nexport function transformMat4(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2],\r\n      w = a[3];\r\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\r\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\r\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\r\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec4 with a quat\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec4} out\r\n */\r\nexport function transformQuat(out, a, q) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3];\r\n\r\n  // calculate quat * vec\r\n  var ix = qw * x + qy * z - qz * y;\r\n  var iy = qw * y + qz * x - qx * z;\r\n  var iz = qw * z + qx * y - qy * x;\r\n  var iw = -qx * x - qy * y - qz * z;\r\n\r\n  // calculate result * inverse quat\r\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec4} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'vec4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\r\n}\r\n\r\n/**\r\n * Alias for {@link vec4.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;\r\n\r\n/**\r\n * Alias for {@link vec4.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link vec4.divide}\r\n * @function\r\n */\r\nexport var div = divide;\r\n\r\n/**\r\n * Alias for {@link vec4.distance}\r\n * @function\r\n */\r\nexport var dist = distance;\r\n\r\n/**\r\n * Alias for {@link vec4.squaredDistance}\r\n * @function\r\n */\r\nexport var sqrDist = squaredDistance;\r\n\r\n/**\r\n * Alias for {@link vec4.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Alias for {@link vec4.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Perform some operation over an array of vec4s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nexport var forEach = function () {\r\n  var vec = create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i = void 0,\r\n        l = void 0;\r\n    if (!stride) {\r\n      stride = 4;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min(count * stride + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec[0] = a[i];vec[1] = a[i + 1];vec[2] = a[i + 2];vec[3] = a[i + 3];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec[0];a[i + 1] = vec[1];a[i + 2] = vec[2];a[i + 3] = vec[3];\r\n    }\r\n\r\n    return a;\r\n  };\r\n}();","import * as glMatrix from \"./common.js\";\r\nimport * as mat3 from \"./mat3.js\";\r\nimport * as vec3 from \"./vec3.js\";\r\nimport * as vec4 from \"./vec4.js\";\r\n\r\n/**\r\n * Quaternion\r\n * @module quat\r\n */\r\n\r\n/**\r\n * Creates a new identity quat\r\n *\r\n * @returns {quat} a new quaternion\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n  }\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a quat to the identity quaternion\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @returns {quat} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 0;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Sets a quat from the given angle and rotation axis,\r\n * then returns it.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {vec3} axis the axis around which to rotate\r\n * @param {Number} rad the angle in radians\r\n * @returns {quat} out\r\n **/\r\nexport function setAxisAngle(out, axis, rad) {\r\n  rad = rad * 0.5;\r\n  var s = Math.sin(rad);\r\n  out[0] = s * axis[0];\r\n  out[1] = s * axis[1];\r\n  out[2] = s * axis[2];\r\n  out[3] = Math.cos(rad);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Gets the rotation axis and angle for a given\r\n *  quaternion. If a quaternion is created with\r\n *  setAxisAngle, this method will return the same\r\n *  values as providied in the original parameter list\r\n *  OR functionally equivalent values.\r\n * Example: The quaternion formed by axis [0, 0, 1] and\r\n *  angle -90 is the same as the quaternion formed by\r\n *  [0, 0, 1] and 270. This method favors the latter.\r\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\r\n * @param  {quat} q     Quaternion to be decomposed\r\n * @return {Number}     Angle, in radians, of the rotation\r\n */\r\nexport function getAxisAngle(out_axis, q) {\r\n  var rad = Math.acos(q[3]) * 2.0;\r\n  var s = Math.sin(rad / 2.0);\r\n  if (s > glMatrix.EPSILON) {\r\n    out_axis[0] = q[0] / s;\r\n    out_axis[1] = q[1] / s;\r\n    out_axis[2] = q[2] / s;\r\n  } else {\r\n    // If s is zero, return any axis (no rotation - axis does not matter)\r\n    out_axis[0] = 1;\r\n    out_axis[1] = 0;\r\n    out_axis[2] = 0;\r\n  }\r\n  return rad;\r\n}\r\n\r\n/**\r\n * Multiplies two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {quat} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bx = b[0],\r\n      by = b[1],\r\n      bz = b[2],\r\n      bw = b[3];\r\n\r\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\r\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\r\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\r\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the X axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nexport function rotateX(out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bx = Math.sin(rad),\r\n      bw = Math.cos(rad);\r\n\r\n  out[0] = ax * bw + aw * bx;\r\n  out[1] = ay * bw + az * bx;\r\n  out[2] = az * bw - ay * bx;\r\n  out[3] = aw * bw - ax * bx;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the Y axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nexport function rotateY(out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var by = Math.sin(rad),\r\n      bw = Math.cos(rad);\r\n\r\n  out[0] = ax * bw - az * by;\r\n  out[1] = ay * bw + aw * by;\r\n  out[2] = az * bw + ax * by;\r\n  out[3] = aw * bw - ay * by;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the Z axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nexport function rotateZ(out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bz = Math.sin(rad),\r\n      bw = Math.cos(rad);\r\n\r\n  out[0] = ax * bw + ay * bz;\r\n  out[1] = ay * bw - ax * bz;\r\n  out[2] = az * bw + aw * bz;\r\n  out[3] = aw * bw - az * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the W component of a quat from the X, Y, and Z components.\r\n * Assumes that quaternion is 1 unit in length.\r\n * Any existing W component will be ignored.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate W component of\r\n * @returns {quat} out\r\n */\r\nexport function calculateW(out, a) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a spherical linear interpolation between two quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat} out\r\n */\r\nexport function slerp(out, a, b, t) {\r\n  // benchmarks:\r\n  //    http://jsperf.com/quaternion-slerp-implementations\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bx = b[0],\r\n      by = b[1],\r\n      bz = b[2],\r\n      bw = b[3];\r\n\r\n  var omega = void 0,\r\n      cosom = void 0,\r\n      sinom = void 0,\r\n      scale0 = void 0,\r\n      scale1 = void 0;\r\n\r\n  // calc cosine\r\n  cosom = ax * bx + ay * by + az * bz + aw * bw;\r\n  // adjust signs (if necessary)\r\n  if (cosom < 0.0) {\r\n    cosom = -cosom;\r\n    bx = -bx;\r\n    by = -by;\r\n    bz = -bz;\r\n    bw = -bw;\r\n  }\r\n  // calculate coefficients\r\n  if (1.0 - cosom > glMatrix.EPSILON) {\r\n    // standard case (slerp)\r\n    omega = Math.acos(cosom);\r\n    sinom = Math.sin(omega);\r\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\r\n    scale1 = Math.sin(t * omega) / sinom;\r\n  } else {\r\n    // \"from\" and \"to\" quaternions are very close\r\n    //  ... so we can do a linear interpolation\r\n    scale0 = 1.0 - t;\r\n    scale1 = t;\r\n  }\r\n  // calculate final values\r\n  out[0] = scale0 * ax + scale1 * bx;\r\n  out[1] = scale0 * ay + scale1 * by;\r\n  out[2] = scale0 * az + scale1 * bz;\r\n  out[3] = scale0 * aw + scale1 * bw;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random quaternion\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @returns {quat} out\r\n */\r\nexport function random(out) {\r\n  // Implementation of http://planning.cs.uiuc.edu/node198.html\r\n  // TODO: Calling random 3 times is probably not the fastest solution\r\n  var u1 = glMatrix.RANDOM();\r\n  var u2 = glMatrix.RANDOM();\r\n  var u3 = glMatrix.RANDOM();\r\n\r\n  var sqrt1MinusU1 = Math.sqrt(1 - u1);\r\n  var sqrtU1 = Math.sqrt(u1);\r\n\r\n  out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\r\n  out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\r\n  out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\r\n  out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the inverse of a quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate inverse of\r\n * @returns {quat} out\r\n */\r\nexport function invert(out, a) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\r\n  var invDot = dot ? 1.0 / dot : 0;\r\n\r\n  // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\r\n\r\n  out[0] = -a0 * invDot;\r\n  out[1] = -a1 * invDot;\r\n  out[2] = -a2 * invDot;\r\n  out[3] = a3 * invDot;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the conjugate of a quat\r\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate conjugate of\r\n * @returns {quat} out\r\n */\r\nexport function conjugate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a quaternion from the given 3x3 rotation matrix.\r\n *\r\n * NOTE: The resultant quaternion is not normalized, so you should be sure\r\n * to renormalize the quaternion yourself where necessary.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {mat3} m rotation matrix\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport function fromMat3(out, m) {\r\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\r\n  // article \"Quaternion Calculus and Fast Animation\".\r\n  var fTrace = m[0] + m[4] + m[8];\r\n  var fRoot = void 0;\r\n\r\n  if (fTrace > 0.0) {\r\n    // |w| > 1/2, may as well choose w > 1/2\r\n    fRoot = Math.sqrt(fTrace + 1.0); // 2w\r\n    out[3] = 0.5 * fRoot;\r\n    fRoot = 0.5 / fRoot; // 1/(4w)\r\n    out[0] = (m[5] - m[7]) * fRoot;\r\n    out[1] = (m[6] - m[2]) * fRoot;\r\n    out[2] = (m[1] - m[3]) * fRoot;\r\n  } else {\r\n    // |w| <= 1/2\r\n    var i = 0;\r\n    if (m[4] > m[0]) i = 1;\r\n    if (m[8] > m[i * 3 + i]) i = 2;\r\n    var j = (i + 1) % 3;\r\n    var k = (i + 2) % 3;\r\n\r\n    fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);\r\n    out[i] = 0.5 * fRoot;\r\n    fRoot = 0.5 / fRoot;\r\n    out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\r\n    out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\r\n    out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a quaternion from the given euler angle x, y, z.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {x} Angle to rotate around X axis in degrees.\r\n * @param {y} Angle to rotate around Y axis in degrees.\r\n * @param {z} Angle to rotate around Z axis in degrees.\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport function fromEuler(out, x, y, z) {\r\n  var halfToRad = 0.5 * Math.PI / 180.0;\r\n  x *= halfToRad;\r\n  y *= halfToRad;\r\n  z *= halfToRad;\r\n\r\n  var sx = Math.sin(x);\r\n  var cx = Math.cos(x);\r\n  var sy = Math.sin(y);\r\n  var cy = Math.cos(y);\r\n  var sz = Math.sin(z);\r\n  var cz = Math.cos(z);\r\n\r\n  out[0] = sx * cy * cz - cx * sy * sz;\r\n  out[1] = cx * sy * cz + sx * cy * sz;\r\n  out[2] = cx * cy * sz - sx * sy * cz;\r\n  out[3] = cx * cy * cz + sx * sy * sz;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a quatenion\r\n *\r\n * @param {quat} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'quat(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\r\n}\r\n\r\n/**\r\n * Creates a new quat initialized with values from an existing quaternion\r\n *\r\n * @param {quat} a quaternion to clone\r\n * @returns {quat} a new quaternion\r\n * @function\r\n */\r\nexport var clone = vec4.clone;\r\n\r\n/**\r\n * Creates a new quat initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {quat} a new quaternion\r\n * @function\r\n */\r\nexport var fromValues = vec4.fromValues;\r\n\r\n/**\r\n * Copy the values from one quat to another\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the source quaternion\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var copy = vec4.copy;\r\n\r\n/**\r\n * Set the components of a quat to the given values\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var set = vec4.set;\r\n\r\n/**\r\n * Adds two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var add = vec4.add;\r\n\r\n/**\r\n * Alias for {@link quat.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Scales a quat by a scalar number\r\n *\r\n * @param {quat} out the receiving vector\r\n * @param {quat} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var scale = vec4.scale;\r\n\r\n/**\r\n * Calculates the dot product of two quat's\r\n *\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {Number} dot product of a and b\r\n * @function\r\n */\r\nexport var dot = vec4.dot;\r\n\r\n/**\r\n * Performs a linear interpolation between two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var lerp = vec4.lerp;\r\n\r\n/**\r\n * Calculates the length of a quat\r\n *\r\n * @param {quat} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport var length = vec4.length;\r\n\r\n/**\r\n * Alias for {@link quat.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Calculates the squared length of a quat\r\n *\r\n * @param {quat} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n * @function\r\n */\r\nexport var squaredLength = vec4.squaredLength;\r\n\r\n/**\r\n * Alias for {@link quat.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Normalize a quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quaternion to normalize\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var normalize = vec4.normalize;\r\n\r\n/**\r\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {quat} a The first quaternion.\r\n * @param {quat} b The second quaternion.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport var exactEquals = vec4.exactEquals;\r\n\r\n/**\r\n * Returns whether or not the quaternions have approximately the same elements in the same position.\r\n *\r\n * @param {quat} a The first vector.\r\n * @param {quat} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport var equals = vec4.equals;\r\n\r\n/**\r\n * Sets a quaternion to represent the shortest rotation from one\r\n * vector to another.\r\n *\r\n * Both vectors are assumed to be unit length.\r\n *\r\n * @param {quat} out the receiving quaternion.\r\n * @param {vec3} a the initial vector\r\n * @param {vec3} b the destination vector\r\n * @returns {quat} out\r\n */\r\nexport var rotationTo = function () {\r\n  var tmpvec3 = vec3.create();\r\n  var xUnitVec3 = vec3.fromValues(1, 0, 0);\r\n  var yUnitVec3 = vec3.fromValues(0, 1, 0);\r\n\r\n  return function (out, a, b) {\r\n    var dot = vec3.dot(a, b);\r\n    if (dot < -0.999999) {\r\n      vec3.cross(tmpvec3, xUnitVec3, a);\r\n      if (vec3.len(tmpvec3) < 0.000001) vec3.cross(tmpvec3, yUnitVec3, a);\r\n      vec3.normalize(tmpvec3, tmpvec3);\r\n      setAxisAngle(out, tmpvec3, Math.PI);\r\n      return out;\r\n    } else if (dot > 0.999999) {\r\n      out[0] = 0;\r\n      out[1] = 0;\r\n      out[2] = 0;\r\n      out[3] = 1;\r\n      return out;\r\n    } else {\r\n      vec3.cross(tmpvec3, a, b);\r\n      out[0] = tmpvec3[0];\r\n      out[1] = tmpvec3[1];\r\n      out[2] = tmpvec3[2];\r\n      out[3] = 1 + dot;\r\n      return normalize(out, out);\r\n    }\r\n  };\r\n}();\r\n\r\n/**\r\n * Performs a spherical linear interpolation with two control points\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {quat} c the third operand\r\n * @param {quat} d the fourth operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat} out\r\n */\r\nexport var sqlerp = function () {\r\n  var temp1 = create();\r\n  var temp2 = create();\r\n\r\n  return function (out, a, b, c, d, t) {\r\n    slerp(temp1, a, d, t);\r\n    slerp(temp2, b, c, t);\r\n    slerp(out, temp1, temp2, 2 * t * (1 - t));\r\n\r\n    return out;\r\n  };\r\n}();\r\n\r\n/**\r\n * Sets the specified quaternion with values corresponding to the given\r\n * axes. Each axis is a vec3 and is expected to be unit length and\r\n * perpendicular to all other specified axes.\r\n *\r\n * @param {vec3} view  the vector representing the viewing direction\r\n * @param {vec3} right the vector representing the local \"right\" direction\r\n * @param {vec3} up    the vector representing the local \"up\" direction\r\n * @returns {quat} out\r\n */\r\nexport var setAxes = function () {\r\n  var matr = mat3.create();\r\n\r\n  return function (out, view, right, up) {\r\n    matr[0] = right[0];\r\n    matr[3] = right[1];\r\n    matr[6] = right[2];\r\n\r\n    matr[1] = up[0];\r\n    matr[4] = up[1];\r\n    matr[7] = up[2];\r\n\r\n    matr[2] = -view[0];\r\n    matr[5] = -view[1];\r\n    matr[8] = -view[2];\r\n\r\n    return normalize(out, fromMat3(out, matr));\r\n  };\r\n}();","import * as glMatrix from \"./common.js\";\r\nimport * as quat from \"./quat.js\";\r\nimport * as mat4 from \"./mat4.js\";\r\n\r\n/**\r\n * Dual Quaternion<br>\r\n * Format: [real, dual]<br>\r\n * Quaternion format: XYZW<br>\r\n * Make sure to have normalized dual quaternions, otherwise the functions may not work as intended.<br>\r\n * @module quat2\r\n */\r\n\r\n/**\r\n * Creates a new identity dual quat\r\n *\r\n * @returns {quat2} a new dual quaternion [real -> rotation, dual -> translation]\r\n */\r\nexport function create() {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    dq[0] = 0;\r\n    dq[1] = 0;\r\n    dq[2] = 0;\r\n    dq[4] = 0;\r\n    dq[5] = 0;\r\n    dq[6] = 0;\r\n    dq[7] = 0;\r\n  }\r\n  dq[3] = 1;\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a new quat initialized with values from an existing quaternion\r\n *\r\n * @param {quat2} a dual quaternion to clone\r\n * @returns {quat2} new dual quaternion\r\n * @function\r\n */\r\nexport function clone(a) {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  dq[0] = a[0];\r\n  dq[1] = a[1];\r\n  dq[2] = a[2];\r\n  dq[3] = a[3];\r\n  dq[4] = a[4];\r\n  dq[5] = a[5];\r\n  dq[6] = a[6];\r\n  dq[7] = a[7];\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a new dual quat initialized with the given values\r\n *\r\n * @param {Number} x1 X component\r\n * @param {Number} y1 Y component\r\n * @param {Number} z1 Z component\r\n * @param {Number} w1 W component\r\n * @param {Number} x2 X component\r\n * @param {Number} y2 Y component\r\n * @param {Number} z2 Z component\r\n * @param {Number} w2 W component\r\n * @returns {quat2} new dual quaternion\r\n * @function\r\n */\r\nexport function fromValues(x1, y1, z1, w1, x2, y2, z2, w2) {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  dq[0] = x1;\r\n  dq[1] = y1;\r\n  dq[2] = z1;\r\n  dq[3] = w1;\r\n  dq[4] = x2;\r\n  dq[5] = y2;\r\n  dq[6] = z2;\r\n  dq[7] = w2;\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a new dual quat from the given values (quat and translation)\r\n *\r\n * @param {Number} x1 X component\r\n * @param {Number} y1 Y component\r\n * @param {Number} z1 Z component\r\n * @param {Number} w1 W component\r\n * @param {Number} x2 X component (translation)\r\n * @param {Number} y2 Y component (translation)\r\n * @param {Number} z2 Z component (translation)\r\n * @returns {quat2} new dual quaternion\r\n * @function\r\n */\r\nexport function fromRotationTranslationValues(x1, y1, z1, w1, x2, y2, z2) {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  dq[0] = x1;\r\n  dq[1] = y1;\r\n  dq[2] = z1;\r\n  dq[3] = w1;\r\n  var ax = x2 * 0.5,\r\n      ay = y2 * 0.5,\r\n      az = z2 * 0.5;\r\n  dq[4] = ax * w1 + ay * z1 - az * y1;\r\n  dq[5] = ay * w1 + az * x1 - ax * z1;\r\n  dq[6] = az * w1 + ax * y1 - ay * x1;\r\n  dq[7] = -ax * x1 - ay * y1 - az * z1;\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a dual quat from a quaternion and a translation\r\n *\r\n * @param {quat2} dual quaternion receiving operation result\r\n * @param {quat} q quaternion\r\n * @param {vec3} t tranlation vector\r\n * @returns {quat2} dual quaternion receiving operation result\r\n * @function\r\n */\r\nexport function fromRotationTranslation(out, q, t) {\r\n  var ax = t[0] * 0.5,\r\n      ay = t[1] * 0.5,\r\n      az = t[2] * 0.5,\r\n      bx = q[0],\r\n      by = q[1],\r\n      bz = q[2],\r\n      bw = q[3];\r\n  out[0] = bx;\r\n  out[1] = by;\r\n  out[2] = bz;\r\n  out[3] = bw;\r\n  out[4] = ax * bw + ay * bz - az * by;\r\n  out[5] = ay * bw + az * bx - ax * bz;\r\n  out[6] = az * bw + ax * by - ay * bx;\r\n  out[7] = -ax * bx - ay * by - az * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a dual quat from a translation\r\n *\r\n * @param {quat2} dual quaternion receiving operation result\r\n * @param {vec3} t translation vector\r\n * @returns {quat2} dual quaternion receiving operation result\r\n * @function\r\n */\r\nexport function fromTranslation(out, t) {\r\n  out[0] = 0;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = t[0] * 0.5;\r\n  out[5] = t[1] * 0.5;\r\n  out[6] = t[2] * 0.5;\r\n  out[7] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a dual quat from a quaternion\r\n *\r\n * @param {quat2} dual quaternion receiving operation result\r\n * @param {quat} q the quaternion\r\n * @returns {quat2} dual quaternion receiving operation result\r\n * @function\r\n */\r\nexport function fromRotation(out, q) {\r\n  out[0] = q[0];\r\n  out[1] = q[1];\r\n  out[2] = q[2];\r\n  out[3] = q[3];\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new dual quat from a matrix (4x4)\r\n *\r\n * @param {quat2} out the dual quaternion\r\n * @param {mat4} a the matrix\r\n * @returns {quat2} dual quat receiving operation result\r\n * @function\r\n */\r\nexport function fromMat4(out, a) {\r\n  //TODO Optimize this\r\n  var outer = quat.create();\r\n  mat4.getRotation(outer, a);\r\n  var t = new glMatrix.ARRAY_TYPE(3);\r\n  mat4.getTranslation(t, a);\r\n  fromRotationTranslation(out, outer, t);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one dual quat to another\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the source dual quaternion\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a dual quat to the identity dual quaternion\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @returns {quat2} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 0;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a dual quat to the given values\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {Number} x1 X component\r\n * @param {Number} y1 Y component\r\n * @param {Number} z1 Z component\r\n * @param {Number} w1 W component\r\n * @param {Number} x2 X component\r\n * @param {Number} y2 Y component\r\n * @param {Number} z2 Z component\r\n * @param {Number} w2 W component\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function set(out, x1, y1, z1, w1, x2, y2, z2, w2) {\r\n  out[0] = x1;\r\n  out[1] = y1;\r\n  out[2] = z1;\r\n  out[3] = w1;\r\n\r\n  out[4] = x2;\r\n  out[5] = y2;\r\n  out[6] = z2;\r\n  out[7] = w2;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Gets the real part of a dual quat\r\n * @param  {quat} out real part\r\n * @param  {quat2} a Dual Quaternion\r\n * @return {quat} real part\r\n */\r\nexport var getReal = quat.copy;\r\n\r\n/**\r\n * Gets the dual part of a dual quat\r\n * @param  {quat} out dual part\r\n * @param  {quat2} a Dual Quaternion\r\n * @return {quat} dual part\r\n */\r\nexport function getDual(out, a) {\r\n  out[0] = a[4];\r\n  out[1] = a[5];\r\n  out[2] = a[6];\r\n  out[3] = a[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the real component of a dual quat to the given quaternion\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {quat} q a quaternion representing the real part\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport var setReal = quat.copy;\r\n\r\n/**\r\n * Set the dual component of a dual quat to the given quaternion\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {quat} q a quaternion representing the dual part\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function setDual(out, q) {\r\n  out[4] = q[0];\r\n  out[5] = q[1];\r\n  out[6] = q[2];\r\n  out[7] = q[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Gets the translation of a normalized dual quat\r\n * @param  {vec3} out translation\r\n * @param  {quat2} a Dual Quaternion to be decomposed\r\n * @return {vec3} translation\r\n */\r\nexport function getTranslation(out, a) {\r\n  var ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3];\r\n  out[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\r\n  out[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\r\n  out[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translates a dual quat by the given vector\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {quat2} out\r\n */\r\nexport function translate(out, a, v) {\r\n  var ax1 = a[0],\r\n      ay1 = a[1],\r\n      az1 = a[2],\r\n      aw1 = a[3],\r\n      bx1 = v[0] * 0.5,\r\n      by1 = v[1] * 0.5,\r\n      bz1 = v[2] * 0.5,\r\n      ax2 = a[4],\r\n      ay2 = a[5],\r\n      az2 = a[6],\r\n      aw2 = a[7];\r\n  out[0] = ax1;\r\n  out[1] = ay1;\r\n  out[2] = az1;\r\n  out[3] = aw1;\r\n  out[4] = aw1 * bx1 + ay1 * bz1 - az1 * by1 + ax2;\r\n  out[5] = aw1 * by1 + az1 * bx1 - ax1 * bz1 + ay2;\r\n  out[6] = aw1 * bz1 + ax1 * by1 - ay1 * bx1 + az2;\r\n  out[7] = -ax1 * bx1 - ay1 * by1 - az1 * bz1 + aw2;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around the X axis\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {number} rad how far should the rotation be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateX(out, a, rad) {\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      ax1 = ax * bw + aw * bx + ay * bz - az * by,\r\n      ay1 = ay * bw + aw * by + az * bx - ax * bz,\r\n      az1 = az * bw + aw * bz + ax * by - ay * bx,\r\n      aw1 = aw * bw - ax * bx - ay * by - az * bz;\r\n  quat.rotateX(out, a, rad);\r\n  bx = out[0];\r\n  by = out[1];\r\n  bz = out[2];\r\n  bw = out[3];\r\n  out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around the Y axis\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {number} rad how far should the rotation be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateY(out, a, rad) {\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      ax1 = ax * bw + aw * bx + ay * bz - az * by,\r\n      ay1 = ay * bw + aw * by + az * bx - ax * bz,\r\n      az1 = az * bw + aw * bz + ax * by - ay * bx,\r\n      aw1 = aw * bw - ax * bx - ay * by - az * bz;\r\n  quat.rotateY(out, a, rad);\r\n  bx = out[0];\r\n  by = out[1];\r\n  bz = out[2];\r\n  bw = out[3];\r\n  out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around the Z axis\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {number} rad how far should the rotation be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateZ(out, a, rad) {\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      ax1 = ax * bw + aw * bx + ay * bz - az * by,\r\n      ay1 = ay * bw + aw * by + az * bx - ax * bz,\r\n      az1 = az * bw + aw * bz + ax * by - ay * bx,\r\n      aw1 = aw * bw - ax * bx - ay * by - az * bz;\r\n  quat.rotateZ(out, a, rad);\r\n  bx = out[0];\r\n  by = out[1];\r\n  bz = out[2];\r\n  bw = out[3];\r\n  out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat by a given quaternion (a * q)\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {quat} q quaternion to rotate by\r\n * @returns {quat2} out\r\n */\r\nexport function rotateByQuatAppend(out, a, q) {\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3],\r\n      ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n\r\n  out[0] = ax * qw + aw * qx + ay * qz - az * qy;\r\n  out[1] = ay * qw + aw * qy + az * qx - ax * qz;\r\n  out[2] = az * qw + aw * qz + ax * qy - ay * qx;\r\n  out[3] = aw * qw - ax * qx - ay * qy - az * qz;\r\n  ax = a[4];\r\n  ay = a[5];\r\n  az = a[6];\r\n  aw = a[7];\r\n  out[4] = ax * qw + aw * qx + ay * qz - az * qy;\r\n  out[5] = ay * qw + aw * qy + az * qx - ax * qz;\r\n  out[6] = az * qw + aw * qz + ax * qy - ay * qx;\r\n  out[7] = aw * qw - ax * qx - ay * qy - az * qz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat by a given quaternion (q * a)\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat} q quaternion to rotate by\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @returns {quat2} out\r\n */\r\nexport function rotateByQuatPrepend(out, q, a) {\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3],\r\n      bx = a[0],\r\n      by = a[1],\r\n      bz = a[2],\r\n      bw = a[3];\r\n\r\n  out[0] = qx * bw + qw * bx + qy * bz - qz * by;\r\n  out[1] = qy * bw + qw * by + qz * bx - qx * bz;\r\n  out[2] = qz * bw + qw * bz + qx * by - qy * bx;\r\n  out[3] = qw * bw - qx * bx - qy * by - qz * bz;\r\n  bx = a[4];\r\n  by = a[5];\r\n  bz = a[6];\r\n  bw = a[7];\r\n  out[4] = qx * bw + qw * bx + qy * bz - qz * by;\r\n  out[5] = qy * bw + qw * by + qz * bx - qx * bz;\r\n  out[6] = qz * bw + qw * bz + qx * by - qy * bx;\r\n  out[7] = qw * bw - qx * bx - qy * by - qz * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around a given axis. Does the normalisation automatically\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {vec3} axis the axis to rotate around\r\n * @param {Number} rad how far the rotation should be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateAroundAxis(out, a, axis, rad) {\r\n  //Special case for rad = 0\r\n  if (Math.abs(rad) < glMatrix.EPSILON) {\r\n    return copy(out, a);\r\n  }\r\n  var axisLength = Math.sqrt(axis[0] * axis[0] + axis[1] * axis[1] + axis[2] * axis[2]);\r\n\r\n  rad = rad * 0.5;\r\n  var s = Math.sin(rad);\r\n  var bx = s * axis[0] / axisLength;\r\n  var by = s * axis[1] / axisLength;\r\n  var bz = s * axis[2] / axisLength;\r\n  var bw = Math.cos(rad);\r\n\r\n  var ax1 = a[0],\r\n      ay1 = a[1],\r\n      az1 = a[2],\r\n      aw1 = a[3];\r\n  out[0] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[1] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[2] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[3] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n\r\n  var ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7];\r\n  out[4] = ax * bw + aw * bx + ay * bz - az * by;\r\n  out[5] = ay * bw + aw * by + az * bx - ax * bz;\r\n  out[6] = az * bw + aw * bz + ax * by - ay * bx;\r\n  out[7] = aw * bw - ax * bx - ay * by - az * bz;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two dual quat's\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  out[6] = a[6] + b[6];\r\n  out[7] = a[7] + b[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two dual quat's\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @returns {quat2} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var ax0 = a[0],\r\n      ay0 = a[1],\r\n      az0 = a[2],\r\n      aw0 = a[3],\r\n      bx1 = b[4],\r\n      by1 = b[5],\r\n      bz1 = b[6],\r\n      bw1 = b[7],\r\n      ax1 = a[4],\r\n      ay1 = a[5],\r\n      az1 = a[6],\r\n      aw1 = a[7],\r\n      bx0 = b[0],\r\n      by0 = b[1],\r\n      bz0 = b[2],\r\n      bw0 = b[3];\r\n  out[0] = ax0 * bw0 + aw0 * bx0 + ay0 * bz0 - az0 * by0;\r\n  out[1] = ay0 * bw0 + aw0 * by0 + az0 * bx0 - ax0 * bz0;\r\n  out[2] = az0 * bw0 + aw0 * bz0 + ax0 * by0 - ay0 * bx0;\r\n  out[3] = aw0 * bw0 - ax0 * bx0 - ay0 * by0 - az0 * bz0;\r\n  out[4] = ax0 * bw1 + aw0 * bx1 + ay0 * bz1 - az0 * by1 + ax1 * bw0 + aw1 * bx0 + ay1 * bz0 - az1 * by0;\r\n  out[5] = ay0 * bw1 + aw0 * by1 + az0 * bx1 - ax0 * bz1 + ay1 * bw0 + aw1 * by0 + az1 * bx0 - ax1 * bz0;\r\n  out[6] = az0 * bw1 + aw0 * bz1 + ax0 * by1 - ay0 * bx1 + az1 * bw0 + aw1 * bz0 + ax1 * by0 - ay1 * bx0;\r\n  out[7] = aw0 * bw1 - ax0 * bx1 - ay0 * by1 - az0 * bz1 + aw1 * bw0 - ax1 * bx0 - ay1 * by0 - az1 * bz0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Alias for {@link quat2.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Scales a dual quat by a scalar number\r\n *\r\n * @param {quat2} out the receiving dual quat\r\n * @param {quat2} a the dual quat to scale\r\n * @param {Number} b amount to scale the dual quat by\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  out[6] = a[6] * b;\r\n  out[7] = a[7] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two dual quat's (The dot product of the real parts)\r\n *\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @returns {Number} dot product of a and b\r\n * @function\r\n */\r\nexport var dot = quat.dot;\r\n\r\n/**\r\n * Performs a linear interpolation between two dual quats's\r\n * NOTE: The resulting dual quaternions won't always be normalized (The error is most noticeable when t = 0.5)\r\n *\r\n * @param {quat2} out the receiving dual quat\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat2} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var mt = 1 - t;\r\n  if (dot(a, b) < 0) t = -t;\r\n\r\n  out[0] = a[0] * mt + b[0] * t;\r\n  out[1] = a[1] * mt + b[1] * t;\r\n  out[2] = a[2] * mt + b[2] * t;\r\n  out[3] = a[3] * mt + b[3] * t;\r\n  out[4] = a[4] * mt + b[4] * t;\r\n  out[5] = a[5] * mt + b[5] * t;\r\n  out[6] = a[6] * mt + b[6] * t;\r\n  out[7] = a[7] * mt + b[7] * t;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the inverse of a dual quat. If they are normalized, conjugate is cheaper\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a dual quat to calculate inverse of\r\n * @returns {quat2} out\r\n */\r\nexport function invert(out, a) {\r\n  var sqlen = squaredLength(a);\r\n  out[0] = -a[0] / sqlen;\r\n  out[1] = -a[1] / sqlen;\r\n  out[2] = -a[2] / sqlen;\r\n  out[3] = a[3] / sqlen;\r\n  out[4] = -a[4] / sqlen;\r\n  out[5] = -a[5] / sqlen;\r\n  out[6] = -a[6] / sqlen;\r\n  out[7] = a[7] / sqlen;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the conjugate of a dual quat\r\n * If the dual quaternion is normalized, this function is faster than quat2.inverse and produces the same result.\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {quat2} a quat to calculate conjugate of\r\n * @returns {quat2} out\r\n */\r\nexport function conjugate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = a[3];\r\n  out[4] = -a[4];\r\n  out[5] = -a[5];\r\n  out[6] = -a[6];\r\n  out[7] = a[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the length of a dual quat\r\n *\r\n * @param {quat2} a dual quat to calculate length of\r\n * @returns {Number} length of a\r\n * @function\r\n */\r\nexport var length = quat.length;\r\n\r\n/**\r\n * Alias for {@link quat2.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Calculates the squared length of a dual quat\r\n *\r\n * @param {quat2} a dual quat to calculate squared length of\r\n * @returns {Number} squared length of a\r\n * @function\r\n */\r\nexport var squaredLength = quat.squaredLength;\r\n\r\n/**\r\n * Alias for {@link quat2.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Normalize a dual quat\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a dual quaternion to normalize\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function normalize(out, a) {\r\n  var magnitude = squaredLength(a);\r\n  if (magnitude > 0) {\r\n    magnitude = Math.sqrt(magnitude);\r\n\r\n    var a0 = a[0] / magnitude;\r\n    var a1 = a[1] / magnitude;\r\n    var a2 = a[2] / magnitude;\r\n    var a3 = a[3] / magnitude;\r\n\r\n    var b0 = a[4];\r\n    var b1 = a[5];\r\n    var b2 = a[6];\r\n    var b3 = a[7];\r\n\r\n    var a_dot_b = a0 * b0 + a1 * b1 + a2 * b2 + a3 * b3;\r\n\r\n    out[0] = a0;\r\n    out[1] = a1;\r\n    out[2] = a2;\r\n    out[3] = a3;\r\n\r\n    out[4] = (b0 - a0 * a_dot_b) / magnitude;\r\n    out[5] = (b1 - a1 * a_dot_b) / magnitude;\r\n    out[6] = (b2 - a2 * a_dot_b) / magnitude;\r\n    out[7] = (b3 - a3 * a_dot_b) / magnitude;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a dual quatenion\r\n *\r\n * @param {quat2} a dual quaternion to represent as a string\r\n * @returns {String} string representation of the dual quat\r\n */\r\nexport function str(a) {\r\n  return 'quat2(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the dual quaternions have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {quat2} a the first dual quaternion.\r\n * @param {quat2} b the second dual quaternion.\r\n * @returns {Boolean} true if the dual quaternions are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7];\r\n}\r\n\r\n/**\r\n * Returns whether or not the dual quaternions have approximately the same elements in the same position.\r\n *\r\n * @param {quat2} a the first dual quat.\r\n * @param {quat2} b the second dual quat.\r\n * @returns {Boolean} true if the dual quats are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5],\r\n      a6 = a[6],\r\n      a7 = a[7];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5],\r\n      b6 = b[6],\r\n      b7 = b[7];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7));\r\n}","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 2 Dimensional Vector\r\n * @module vec2\r\n */\r\n\r\n/**\r\n * Creates a new, empty vec2\r\n *\r\n * @returns {vec2} a new 2D vector\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(2);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec2 initialized with values from an existing vector\r\n *\r\n * @param {vec2} a vector to clone\r\n * @returns {vec2} a new 2D vector\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(2);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec2 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} a new 2D vector\r\n */\r\nexport function fromValues(x, y) {\r\n  var out = new glMatrix.ARRAY_TYPE(2);\r\n  out[0] = x;\r\n  out[1] = y;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one vec2 to another\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the source vector\r\n * @returns {vec2} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec2 to the given values\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} out\r\n */\r\nexport function set(out, x, y) {\r\n  out[0] = x;\r\n  out[1] = y;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  out[0] = a[0] * b[0];\r\n  out[1] = a[1] * b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Divides two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function divide(out, a, b) {\r\n  out[0] = a[0] / b[0];\r\n  out[1] = a[1] / b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.ceil the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to ceil\r\n * @returns {vec2} out\r\n */\r\nexport function ceil(out, a) {\r\n  out[0] = Math.ceil(a[0]);\r\n  out[1] = Math.ceil(a[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.floor the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to floor\r\n * @returns {vec2} out\r\n */\r\nexport function floor(out, a) {\r\n  out[0] = Math.floor(a[0]);\r\n  out[1] = Math.floor(a[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the minimum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function min(out, a, b) {\r\n  out[0] = Math.min(a[0], b[0]);\r\n  out[1] = Math.min(a[1], b[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the maximum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function max(out, a, b) {\r\n  out[0] = Math.max(a[0], b[0]);\r\n  out[1] = Math.max(a[1], b[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.round the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to round\r\n * @returns {vec2} out\r\n */\r\nexport function round(out, a) {\r\n  out[0] = Math.round(a[0]);\r\n  out[1] = Math.round(a[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales a vec2 by a scalar number\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec2} out\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec2's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec2} out\r\n */\r\nexport function scaleAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nexport function distance(a, b) {\r\n  var x = b[0] - a[0],\r\n      y = b[1] - a[1];\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nexport function squaredDistance(a, b) {\r\n  var x = b[0] - a[0],\r\n      y = b[1] - a[1];\r\n  return x * x + y * y;\r\n}\r\n\r\n/**\r\n * Calculates the length of a vec2\r\n *\r\n * @param {vec2} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport function length(a) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n\r\n/**\r\n * Calculates the squared length of a vec2\r\n *\r\n * @param {vec2} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nexport function squaredLength(a) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  return x * x + y * y;\r\n}\r\n\r\n/**\r\n * Negates the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to negate\r\n * @returns {vec2} out\r\n */\r\nexport function negate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the inverse of the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to invert\r\n * @returns {vec2} out\r\n */\r\nexport function inverse(out, a) {\r\n  out[0] = 1.0 / a[0];\r\n  out[1] = 1.0 / a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Normalize a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to normalize\r\n * @returns {vec2} out\r\n */\r\nexport function normalize(out, a) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  var len = x * x + y * y;\r\n  if (len > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len = 1 / Math.sqrt(len);\r\n    out[0] = a[0] * len;\r\n    out[1] = a[1] * len;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nexport function dot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1];\r\n}\r\n\r\n/**\r\n * Computes the cross product of two vec2's\r\n * Note that the cross product must by definition produce a 3D vector\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function cross(out, a, b) {\r\n  var z = a[0] * b[1] - a[1] * b[0];\r\n  out[0] = out[1] = 0;\r\n  out[2] = z;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation between two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec2} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var ax = a[0],\r\n      ay = a[1];\r\n  out[0] = ax + t * (b[0] - ax);\r\n  out[1] = ay + t * (b[1] - ay);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec2} out\r\n */\r\nexport function random(out, scale) {\r\n  scale = scale || 1.0;\r\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\r\n  out[0] = Math.cos(r) * scale;\r\n  out[1] = Math.sin(r) * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat2} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat2(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  out[0] = m[0] * x + m[2] * y;\r\n  out[1] = m[1] * x + m[3] * y;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat2d\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat2d} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat2d(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  out[0] = m[0] * x + m[2] * y + m[4];\r\n  out[1] = m[1] * x + m[3] * y + m[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat3\r\n * 3rd vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat3} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat3(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  out[0] = m[0] * x + m[3] * y + m[6];\r\n  out[1] = m[1] * x + m[4] * y + m[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat4\r\n * 3rd vector component is implicitly '0'\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat4(out, a, m) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  out[0] = m[0] * x + m[4] * y + m[12];\r\n  out[1] = m[1] * x + m[5] * y + m[13];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 2D vector\r\n * @param {vec2} out The receiving vec2\r\n * @param {vec2} a The vec2 point to rotate\r\n * @param {vec2} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec2} out\r\n */\r\nexport function rotate(out, a, b, c) {\r\n  //Translate point to the origin\r\n  var p0 = a[0] - b[0],\r\n      p1 = a[1] - b[1],\r\n      sinC = Math.sin(c),\r\n      cosC = Math.cos(c);\r\n\r\n  //perform rotation and translate to correct position\r\n  out[0] = p0 * cosC - p1 * sinC + b[0];\r\n  out[1] = p0 * sinC + p1 * cosC + b[1];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Get the angle between two 2D vectors\r\n * @param {vec2} a The first operand\r\n * @param {vec2} b The second operand\r\n * @returns {Number} The angle in radians\r\n */\r\nexport function angle(a, b) {\r\n  var x1 = a[0],\r\n      y1 = a[1],\r\n      x2 = b[0],\r\n      y2 = b[1];\r\n\r\n  var len1 = x1 * x1 + y1 * y1;\r\n  if (len1 > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len1 = 1 / Math.sqrt(len1);\r\n  }\r\n\r\n  var len2 = x2 * x2 + y2 * y2;\r\n  if (len2 > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len2 = 1 / Math.sqrt(len2);\r\n  }\r\n\r\n  var cosine = (x1 * x2 + y1 * y2) * len1 * len2;\r\n\r\n  if (cosine > 1.0) {\r\n    return 0;\r\n  } else if (cosine < -1.0) {\r\n    return Math.PI;\r\n  } else {\r\n    return Math.acos(cosine);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec2} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'vec2(' + a[0] + ', ' + a[1] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec2} a The first vector.\r\n * @param {vec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1];\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec2} a The first vector.\r\n * @param {vec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1];\r\n  var b0 = b[0],\r\n      b1 = b[1];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\r\n}\r\n\r\n/**\r\n * Alias for {@link vec2.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Alias for {@link vec2.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;\r\n\r\n/**\r\n * Alias for {@link vec2.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link vec2.divide}\r\n * @function\r\n */\r\nexport var div = divide;\r\n\r\n/**\r\n * Alias for {@link vec2.distance}\r\n * @function\r\n */\r\nexport var dist = distance;\r\n\r\n/**\r\n * Alias for {@link vec2.squaredDistance}\r\n * @function\r\n */\r\nexport var sqrDist = squaredDistance;\r\n\r\n/**\r\n * Alias for {@link vec2.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Perform some operation over an array of vec2s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nexport var forEach = function () {\r\n  var vec = create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i = void 0,\r\n        l = void 0;\r\n    if (!stride) {\r\n      stride = 2;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min(count * stride + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec[0] = a[i];vec[1] = a[i + 1];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec[0];a[i + 1] = vec[1];\r\n    }\r\n\r\n    return a;\r\n  };\r\n}();","import * as glMatrix from \"./gl-matrix/common.js\";\r\nimport * as mat2 from \"./gl-matrix/mat2.js\";\r\nimport * as mat2d from \"./gl-matrix/mat2d.js\";\r\nimport * as mat3 from \"./gl-matrix/mat3.js\";\r\nimport * as mat4 from \"./gl-matrix/mat4.js\";\r\nimport * as quat from \"./gl-matrix/quat.js\";\r\nimport * as quat2 from \"./gl-matrix/quat2.js\";\r\nimport * as vec2 from \"./gl-matrix/vec2.js\";\r\nimport * as vec3 from \"./gl-matrix/vec3.js\";\r\nimport * as vec4 from \"./gl-matrix/vec4.js\";\r\n\r\nexport { glMatrix, mat2, mat2d, mat3, mat4, quat, quat2, vec2, vec3, vec4 };","const wnd: any = window\r\n\r\nlet _now\r\nif (typeof performance !== 'undefined') {\r\n  if (performance.now) {\r\n    _now = () => wnd.performance.now()\r\n  } else if (wnd.performance.mozNow) {\r\n    _now = () => wnd.performance.mozNow()\r\n  } else if (wnd.performance.msNow) {\r\n    _now = () => wnd.performance.msNow()\r\n  } else if (wnd.performance.oNow) {\r\n    _now = () => wnd.performance.oNow()\r\n  } else if (wnd.performance.webkitNow) {\r\n    _now = () => wnd.performance.webkitNow()\r\n  } else if (Date.now) {\r\n    _now = () => Date.now()\r\n  }\r\n}\r\n\r\nexport const now = _now || (() => new Date().getTime())\r\n\r\nexport const formatTime = (seconds: number) => {\r\n  const m = Math.floor(seconds / 60)\r\n  const s = Math.floor(seconds - m * 60)\r\n  const mm = m < 10 ? '0' + m : m.toString()\r\n  const ss = s < 10 ? '0' + s : s.toString()\r\n  return mm + ':' + ss\r\n}\r\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import * as Path from 'path'\r\nimport { BitStream } from './BitReader'\r\nimport { Reader, ReaderDataType } from './Reader'\r\n\r\nconst DT_BYTE = 1\r\nconst DT_SHORT = 1 << 1\r\nconst DT_FLOAT = 1 << 2\r\nconst DT_INTEGER = 1 << 3\r\nconst DT_ANGLE = 1 << 4\r\nconst DT_TIMEWINDOW_8 = 1 << 5\r\nconst DT_TIMEWINDOW_BIG = 1 << 6\r\nconst DT_STRING = 1 << 7\r\nconst DT_SIGNED = 1 << 31\r\n\r\nfunction readDelta(bs: BitStream, dd: any) {\r\n  let data: any = {}\r\n\r\n  let maskBitCount = bs.readBits(3)\r\n  let maskBits = []\r\n  for (let i = 0; i < maskBitCount; ++i) {\r\n    maskBits.push(bs.readBits(8))\r\n  }\r\n\r\n  let brk = false\r\n  for (let i = 0; i < maskBitCount; ++i) {\r\n    for (let j = 0; j < 8; ++j) {\r\n      let index = j + i * 8\r\n      if (index === dd.length) {\r\n        brk = true\r\n        break\r\n      }\r\n\r\n      if (maskBits[i] & (1 << j)) {\r\n        if (dd[index].flags & DT_BYTE) {\r\n          if (dd[index].flags & DT_SIGNED) {\r\n            let sign = bs.readBits(1) ? -1 : 1\r\n            let value = bs.readBits(dd[index].bits - 1)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            let value = bs.readBits(dd[index].bits)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (dd[index].flags & DT_SHORT) {\r\n          if (dd[index].flags & DT_SIGNED) {\r\n            let sign = bs.readBits(1) ? -1 : 1\r\n            let value = bs.readBits(dd[index].bits - 1)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            let value = bs.readBits(dd[index].bits)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (dd[index].flags & DT_INTEGER) {\r\n          if (dd[index].flags & DT_SIGNED) {\r\n            let sign = bs.readBits(1) ? -1 : 1\r\n            let value = bs.readBits(dd[index].bits - 1)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            let value = bs.readBits(dd[index].bits)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (\r\n          dd[index].flags & DT_FLOAT ||\r\n          dd[index].flags & DT_TIMEWINDOW_8 ||\r\n          dd[index].flags & DT_TIMEWINDOW_BIG\r\n        ) {\r\n          if (dd[index].flags & DT_SIGNED) {\r\n            let sign = bs.readBits(1) ? -1 : 1\r\n            let value = bs.readBits(dd[index].bits - 1)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            let value = bs.readBits(dd[index].bits)\r\n            let divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (dd[index].flags & DT_ANGLE) {\r\n          let value = bs.readBits(dd[index].bits)\r\n          let multiplier = 360 / (1 << dd[index].bits)\r\n          data[dd[index].name] = value * multiplier\r\n        } else if (dd[index].flags & DT_STRING) {\r\n          data[dd[index].name] = bs.readString()\r\n        }\r\n      }\r\n    }\r\n\r\n    if (brk) {\r\n      break\r\n    }\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nfunction readCoord(bs: BitStream) {\r\n  let intFlag = bs.readBits(1)\r\n  let fractionFlag = bs.readBits(1)\r\n\r\n  if (!intFlag && !fractionFlag) {\r\n    return 0\r\n  }\r\n\r\n  let sign = bs.readBits(1)\r\n  let intValue = 0\r\n  let fractionValue = 0\r\n  if (intFlag) {\r\n    intValue = bs.readBits(12)\r\n  }\r\n  if (fractionFlag) {\r\n    fractionValue = bs.readBits(3)\r\n  }\r\n\r\n  let value = intValue + fractionValue / 32\r\n  if (sign) {\r\n    value = -value\r\n  }\r\n\r\n  return value\r\n}\r\n\r\nclass FrameDataReader {\r\n  static bad() {\r\n    throw new Error('Invalid message type')\r\n  }\r\n\r\n  static nop(): null {\r\n    return null\r\n  }\r\n\r\n  static disconnect(r: Reader) {\r\n    return {\r\n      reason: r.str()\r\n    }\r\n  }\r\n\r\n  static event(r: Reader, deltaDecoders: any) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let events = []\r\n    let eventCount = bs.readBits(5)\r\n    for (let i = 0; i < eventCount; ++i) {\r\n      let event: any = {}\r\n      event.index = bs.readBits(10)\r\n      let packetIndexBit = bs.readBits(1)\r\n      if (packetIndexBit) {\r\n        event.packetIndex = bs.readBits(11)\r\n        let deltaBit = bs.readBits(1)\r\n        if (deltaBit) {\r\n          event.delta = readDelta(bs, deltaDecoders['event_t'])\r\n        }\r\n      }\r\n      let fireTimeBit = bs.readBits(1)\r\n      if (fireTimeBit) {\r\n        event.fireTime = bs.readBits(16)\r\n      }\r\n\r\n      events.push(event)\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return { events }\r\n  }\r\n\r\n  static version(r: Reader) {\r\n    return {\r\n      version: r.ui()\r\n    }\r\n  }\r\n\r\n  static setView(r: Reader) {\r\n    return {\r\n      entityIndex: r.s()\r\n    }\r\n  }\r\n\r\n  static sound(r: Reader) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let flags = bs.readBits(9)\r\n\r\n    let volume = 1\r\n    if ((flags & 1) !== 0) {\r\n      volume = bs.readBits(8) / 255\r\n    }\r\n\r\n    let attenuation = 1\r\n    if ((flags & 2) !== 0) {\r\n      attenuation = bs.readBits(8) / 64\r\n    }\r\n\r\n    let channel = bs.readBits(3)\r\n    let entityIndex = bs.readBits(11)\r\n\r\n    let soundIndex\r\n    if ((flags & 4) !== 0) {\r\n      soundIndex = bs.readBits(16)\r\n    } else {\r\n      soundIndex = bs.readBits(8)\r\n    }\r\n\r\n    let xFlag = bs.readBits(1)\r\n    let yFlag = bs.readBits(1)\r\n    let zFlag = bs.readBits(1)\r\n    let xPosition\r\n    let yPosition\r\n    let zPosition\r\n    if (xFlag) {\r\n      xPosition = readCoord(bs)\r\n    }\r\n    if (yFlag) {\r\n      yPosition = readCoord(bs)\r\n    }\r\n    if (zFlag) {\r\n      zPosition = readCoord(bs)\r\n    }\r\n\r\n    let pitch = 1\r\n    if ((flags & 8) !== 0) {\r\n      pitch = bs.readBits(8)\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      flags,\r\n      volume,\r\n      attenuation,\r\n      channel,\r\n      entityIndex,\r\n      soundIndex,\r\n      xPosition,\r\n      yPosition,\r\n      zPosition,\r\n      pitch\r\n    }\r\n  }\r\n\r\n  static time(r: Reader) {\r\n    return {\r\n      time: r.f()\r\n    }\r\n  }\r\n\r\n  static print(r: Reader) {\r\n    return {\r\n      message: r.str()\r\n    }\r\n  }\r\n\r\n  static stuffText(r: Reader) {\r\n    let message = r.str()\r\n    let commands = message.split(';').map(command => {\r\n      let args = command\r\n        .split(/\\s*(\"[^\"]+\"|[^\\s\"]+)/)\r\n        .map(arg => arg.replace(/^\"(.*)\"$/, '$1').trim())\r\n        .filter(arg => arg)\r\n\r\n      let func = args[0]\r\n      let params = args.slice(1)\r\n\r\n      return { func, params }\r\n    })\r\n\r\n    return { commands }\r\n  }\r\n\r\n  static setAngle(r: Reader) {\r\n    return {\r\n      pitch: r.s(),\r\n      yaw: r.s(),\r\n      roll: r.s()\r\n    }\r\n  }\r\n\r\n  static serverInfo(r: Reader) {\r\n    let info = {\r\n      protocol: r.i(),\r\n      spawnCount: r.i(), // map change count\r\n      mapCrc: r.i(),\r\n      clientDllHash: r.arrx(16, ReaderDataType.UByte),\r\n      maxPlayers: r.ub(),\r\n      playerIndex: r.ub(),\r\n      isDeathmatch: r.ub(),\r\n      gameDir: r.str(),\r\n      hostName: r.str(),\r\n      mapFileName: r.str(), // path to map relative in mod directory\r\n      mapCycle: r.str()\r\n    }\r\n    r.skip(1) // skip padding\r\n\r\n    return info\r\n  }\r\n\r\n  static lightStyle(r: Reader) {\r\n    return {\r\n      index: r.ub(),\r\n      lightInfo: r.str()\r\n    }\r\n  }\r\n\r\n  static updateUserInfo(r: Reader) {\r\n    return {\r\n      clientIndex: r.ub(),\r\n      clientUserId: r.ui(),\r\n      clientUserInfo: r.str(),\r\n      clientCdKeyHash: r.arrx(16, ReaderDataType.UByte)\r\n    }\r\n  }\r\n\r\n  static deltaDescription(r: Reader, deltaDecoders: any) {\r\n    let data: any = {\r\n      name: r.str(),\r\n      fields: []\r\n    }\r\n\r\n    let bs = new BitStream(r.data.buffer)\r\n    let fieldCount = r.us()\r\n    bs.index = r.tell() * 8\r\n    for (let i = 0; i < fieldCount; ++i) {\r\n      data.fields.push(readDelta(bs, deltaDecoders.delta_description_t))\r\n    }\r\n    deltaDecoders[data.name] = data.fields\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  static clientData(r: Reader, deltaDecoders: any) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let deltaSequence = bs.readBits(1)\r\n    if (deltaSequence) {\r\n      // delta update mask\r\n      bs.index += 8\r\n    }\r\n\r\n    let clientDataDecoder = deltaDecoders['clientdata_t']\r\n    let clientData = readDelta(bs, clientDataDecoder)\r\n\r\n    // TODO: weapon data\r\n    let weaponDataDecoder = deltaDecoders['weapon_data_t']\r\n    while (bs.readBits(1)) {\r\n      bs.index += 6 // weapon index\r\n      readDelta(bs, weaponDataDecoder) // weapon data\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      clientData\r\n    }\r\n  }\r\n\r\n  static stopSound(r: Reader) {\r\n    return {\r\n      entityIndex: r.s()\r\n    }\r\n  }\r\n\r\n  static pings(r: Reader) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let pings = []\r\n    while (bs.readBits(1)) {\r\n      pings.push({\r\n        slot: bs.readBits(8),\r\n        ping: bs.readBits(8),\r\n        loss: bs.readBits(8)\r\n      })\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return pings\r\n  }\r\n\r\n  static particle(r: Reader) {\r\n    return {\r\n      position: [r.s() / 8, r.s() / 8, r.s() / 8],\r\n      direction: [r.b(), r.b(), r.b()],\r\n      count: r.ub(),\r\n      color: r.ub()\r\n    }\r\n  }\r\n\r\n  static damage(): null {\r\n    // unused\r\n    return null\r\n  }\r\n\r\n  static spawnStatic(r: Reader) {\r\n    let data: any = {\r\n      modelIndex: r.s(),\r\n      sequence: r.b(),\r\n      frame: r.b(),\r\n      colorMap: r.s(),\r\n      skin: r.b(),\r\n      position: [],\r\n      rotation: []\r\n    }\r\n    data.position[0] = r.s() / 8\r\n    data.rotation[0] = r.b() * (360 / 256)\r\n    data.position[1] = r.s() / 8\r\n    data.rotation[1] = r.b() * (360 / 256)\r\n    data.position[2] = r.s() / 8\r\n    data.rotation[2] = r.b() * (360 / 256)\r\n    data.renderMode = r.b()\r\n    if (data.renderMode) {\r\n      data.renderAmt = r.b()\r\n      data.renderColor = [r.ub(), r.ub(), r.ub()]\r\n      data.renderFx = r.b()\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  static eventReliable(r: Reader, deltaDecoders: any) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let eventIndex = bs.readBits(10)\r\n    let eventData = readDelta(bs, deltaDecoders['event_t'])\r\n    let delayBit = bs.readBits(1)\r\n    let delay\r\n    if (delayBit) {\r\n      delay = bs.readBits(16)\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      eventIndex,\r\n      eventData,\r\n      delayBit,\r\n      delay\r\n    }\r\n  }\r\n\r\n  static spawnBaseLine(r: Reader, deltaDecoders: any) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let entities = []\r\n    while (true) {\r\n      let entityIdx = bs.readBits(11)\r\n      if (entityIdx === (1 << 11) - 1) {\r\n        break\r\n      }\r\n\r\n      let entityType = bs.readBits(2)\r\n      let entityTypeString\r\n      if (entityType & 1) {\r\n        if (entityIdx > 0 && entityIdx <= 32) {\r\n          entityTypeString = 'entity_state_player_t'\r\n        } else {\r\n          entityTypeString = 'entity_state_t'\r\n        }\r\n      } else {\r\n        entityTypeString = 'custom_entity_state_t'\r\n      }\r\n\r\n      entities[entityIdx] = readDelta(bs, deltaDecoders[entityTypeString])\r\n    }\r\n\r\n    let footer = bs.readBits(5)\r\n    if (footer !== (1 << 5) - 1) {\r\n      throw new Error('Bad spawnbaseline')\r\n    }\r\n\r\n    let nExtraData = bs.readBits(6)\r\n    let extraData = []\r\n    for (let i = 0; i < nExtraData; ++i) {\r\n      extraData.push(readDelta(bs, deltaDecoders['entity_state_t']))\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      entities,\r\n      extraData\r\n    }\r\n  }\r\n\r\n  static tempEntity(r: Reader) {\r\n    const TE_BEAMPOINTS = 0 // Beam effect between two points\r\n    const TE_BEAMENTPOINT = 1 // Beam effect between point and entity\r\n    const TE_GUNSHOT = 2 // Particle effect plus ricochet sound\r\n    const TE_EXPLOSION = 3 // Additive sprite, 2 dynamic lights, flickering particles, explosion sound, move vertically 8 pps\r\n    const TE_TAREXPLOSION = 4 // Quake1 \"tarbaby\" explosion with sound\r\n    const TE_SMOKE = 5 // Alphablend sprite, move vertically 30 pps\r\n    const TE_TRACER = 6 // Tracer effect from point to point\r\n    const TE_LIGHTNING = 7 // TE_BEAMPOINTS with simplified parameters\r\n    const TE_BEAMENTS = 8\r\n    const TE_SPARKS = 9 // 8 random tracers with gravity, ricochet sprite\r\n    const TE_LAVASPLASH = 10 // Quake1 lava splash\r\n    const TE_TELEPORT = 11 // Quake1 teleport splash\r\n    const TE_EXPLOSION2 = 12 // Quake1 colormaped (base palette) particle explosion with sound\r\n    const TE_BSPDECAL = 13 // Decal from the .BSP file\r\n    const TE_IMPLOSION = 14 // Tracers moving toward a point\r\n    const TE_SPRITETRAIL = 15 // Line of moving glow sprites with gravity, fadeout, and collisions\r\n    const TE_SPRITE = 17 // Additive sprite, plays 1 cycle\r\n    const TE_BEAMSPRITE = 18 // A beam with a sprite at the end\r\n    const TE_BEAMTORUS = 19 // Screen aligned beam ring, expands to max radius over lifetime\r\n    const TE_BEAMDISK = 20 // Disk that expands to max radius over lifetime\r\n    const TE_BEAMCYLINDER = 21 // Cylinder that expands to max radius over lifetime\r\n    const TE_BEAMFOLLOW = 22 // Create a line of decaying beam segments until entity stops moving\r\n    const TE_GLOWSPRITE = 23\r\n    const TE_BEAMRING = 24 // Connect a beam ring to two entities\r\n    const TE_STREAK_SPLASH = 25 // Oriented shower of tracers\r\n    const TE_DLIGHT = 27 // Dynamic light, effect world, minor entity effect\r\n    const TE_ELIGHT = 28 // Point entity light, no world effect\r\n    const TE_TEXTMESSAGE = 29\r\n    const TE_LINE = 30\r\n    const TE_BOX = 31\r\n    const TE_KILLBEAM = 99 // Kill all beams attached to entity\r\n    const TE_LARGEFUNNEL = 100\r\n    const TE_BLOODSTREAM = 101 // Particle spray\r\n    const TE_SHOWLINE = 102 // Line of particles every 5 units, dies in 30 seconds\r\n    const TE_BLOOD = 103 // Particle spray\r\n    const TE_DECAL = 104 // Decal applied to a brush entity (not the world)\r\n    const TE_FIZZ = 105 // Create alpha sprites inside of entity, float upwards\r\n    const TE_MODEL = 106 // Create a moving model that bounces and makes a sound when it hits\r\n    const TE_EXPLODEMODEL = 107 // Spherical shower of models, picks from set\r\n    const TE_BREAKMODEL = 108 // Box of models or sprites\r\n    const TE_GUNSHOTDECAL = 109 // Decal and ricochet sound\r\n    const TE_SPRITE_SPRAY = 110 // Spray of alpha sprites\r\n    const TE_ARMOR_RICOCHET = 111 // Quick spark sprite, client ricochet sound.\r\n    const TE_PLAYERDECAL = 112\r\n    const TE_BUBBLES = 113 // Create alpha sprites inside of box, float upwards\r\n    const TE_BUBBLETRAIL = 114 // Create alpha sprites along a line, float upwards\r\n    const TE_BLOODSPRITE = 115 // Spray of opaque sprite1's that fall, single sprite2 for 1..2 secs (this is a high-priority tent)\r\n    const TE_WORLDDECAL = 116 // Decal applied to the world brush\r\n    const TE_WORLDDECALHIGH = 117 // Decal (with texture index > 256) applied to world brush\r\n    const TE_DECALHIGH = 118 // Same as TE_DECAL, but the texture index was greater than 256\r\n    const TE_PROJECTILE = 119 // Makes a projectile (like a nail) (this is a high-priority tent)\r\n    const TE_SPRAY = 120 // Throws a shower of sprites or models\r\n    const TE_PLAYERSPRITES = 121 // Sprites emit from a player's bounding box (ONLY use for players!)\r\n    const TE_PARTICLEBURST = 122 // Very similar to lavasplash\r\n    const TE_FIREFIELD = 123 // Makes a field of fire\r\n    const TE_PLAYERATTACHMENT = 124 // Attaches a TENT to a player (this is a high-priority tent)\r\n    const TE_KILLPLAYERATTACHMENTS = 125 // Will expire all TENTS attached to a player.\r\n    const TE_MULTIGUNSHOT = 126 // Much more compact shotgun message\r\n    const TE_USERTRACER = 127 // Larger message than the standard tracer, but allows some customization.\r\n\r\n    let type = r.ub()\r\n    let data: any = {}\r\n    switch (type) {\r\n      case TE_BEAMPOINTS: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMENTPOINT: {\r\n        r.skip(20)\r\n        break\r\n      }\r\n\r\n      case TE_GUNSHOT: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_EXPLOSION: {\r\n        r.skip(11)\r\n        break\r\n      }\r\n\r\n      case TE_TAREXPLOSION: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_SMOKE: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_TRACER: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_LIGHTNING: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMENTS: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_SPARKS: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_LAVASPLASH: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_TELEPORT: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_EXPLOSION2: {\r\n        r.skip(8)\r\n        break\r\n      }\r\n\r\n      case TE_BSPDECAL: {\r\n        r.skip(8)\r\n        let entityIndex = r.s()\r\n        if (entityIndex) {\r\n          r.skip(2)\r\n        }\r\n        break\r\n      }\r\n\r\n      case TE_IMPLOSION: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_SPRITETRAIL: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_SPRITE: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMSPRITE: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMTORUS: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMDISK: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMCYLINDER: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMFOLLOW: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_GLOWSPRITE: {\r\n        r.skip(11)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMRING: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_STREAK_SPLASH: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_DLIGHT: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_ELIGHT: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_TEXTMESSAGE: {\r\n        data.channel = r.b()\r\n        data.x = r.s()\r\n        data.y = r.s()\r\n        data.effect = r.b()\r\n        data.textColor = [r.ub(), r.ub(), r.ub(), r.ub()]\r\n        data.effectColor = [r.ub(), r.ub(), r.ub(), r.ub()]\r\n        data.fadeInTime = r.s()\r\n        data.fadeOutTime = r.s()\r\n        data.holdTime = r.s()\r\n        if (data.effect) {\r\n          data.effectTime = r.s()\r\n        }\r\n        data.message = r.str()\r\n        break\r\n      }\r\n\r\n      case TE_LINE: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_BOX: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_KILLBEAM: {\r\n        r.skip(2)\r\n        break\r\n      }\r\n\r\n      case TE_LARGEFUNNEL: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_BLOODSTREAM: {\r\n        r.skip(14)\r\n        break\r\n      }\r\n\r\n      case TE_SHOWLINE: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_BLOOD: {\r\n        r.skip(14)\r\n        break\r\n      }\r\n\r\n      case TE_DECAL: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_FIZZ: {\r\n        r.skip(5)\r\n        break\r\n      }\r\n\r\n      case TE_MODEL: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_EXPLODEMODEL: {\r\n        r.skip(13)\r\n        break\r\n      }\r\n\r\n      case TE_BREAKMODEL: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_GUNSHOTDECAL: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_SPRITE_SPRAY: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_ARMOR_RICOCHET: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_PLAYERDECAL: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_BUBBLES: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_BUBBLETRAIL: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_BLOODSPRITE: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_WORLDDECAL: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_WORLDDECALHIGH: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_DECALHIGH: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_PROJECTILE: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_SPRAY: {\r\n        r.skip(18)\r\n        break\r\n      }\r\n\r\n      case TE_PLAYERSPRITES: {\r\n        r.skip(5)\r\n        break\r\n      }\r\n\r\n      case TE_PARTICLEBURST: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_FIREFIELD: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_PLAYERATTACHMENT: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_KILLPLAYERATTACHMENTS: {\r\n        r.skip(1)\r\n        break\r\n      }\r\n\r\n      case TE_MULTIGUNSHOT: {\r\n        r.skip(18)\r\n        break\r\n      }\r\n\r\n      case TE_USERTRACER: {\r\n        r.skip(15)\r\n        break\r\n      }\r\n\r\n      default: {\r\n        throw new Error('Unknown temp entity type')\r\n      }\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  static setPause(r: Reader) {\r\n    return {\r\n      isPaused: r.b()\r\n    }\r\n  }\r\n\r\n  static signOnNum(r: Reader) {\r\n    return {\r\n      sign: r.b()\r\n    }\r\n  }\r\n\r\n  static centerPrint(r: Reader) {\r\n    return {\r\n      message: r.str()\r\n    }\r\n  }\r\n\r\n  static killedMonster(): null {\r\n    // unused\r\n    return null\r\n  }\r\n\r\n  static foundSecret(): null {\r\n    // unused\r\n    return null\r\n  }\r\n\r\n  static spawnStaticSound(r: Reader) {\r\n    return {\r\n      position: [r.s() / 8, r.s() / 8, r.s() / 8],\r\n      soundIndex: r.us(),\r\n      volume: r.ub() / 255,\r\n      attenuation: r.ub() / 64,\r\n      entityIndex: r.us(),\r\n      pitch: r.ub(),\r\n      flags: r.ub()\r\n    }\r\n  }\r\n\r\n  static intermission(): null {\r\n    // has no arguments\r\n    return null\r\n  }\r\n\r\n  static finale(r: Reader) {\r\n    return {\r\n      text: r.str()\r\n    }\r\n  }\r\n\r\n  static cdTrack(r: Reader) {\r\n    return {\r\n      track: r.b(),\r\n      loopTrack: r.b()\r\n    }\r\n  }\r\n\r\n  static restore(r: Reader) {\r\n    let saveName = r.str()\r\n    let mapCount = r.ub()\r\n    let maps = []\r\n    for (let i = 0; i < mapCount; ++i) {\r\n      maps.push(r.str())\r\n    }\r\n\r\n    return { saveName, maps }\r\n  }\r\n\r\n  static cutscene(r: Reader) {\r\n    return {\r\n      text: r.str()\r\n    }\r\n  }\r\n\r\n  static weaponAnim(r: Reader) {\r\n    return {\r\n      sequenceNumber: r.b(),\r\n      weaponModelBodyGroup: r.b()\r\n    }\r\n  }\r\n\r\n  static decalName(r: Reader) {\r\n    return {\r\n      positionIndex: r.ub(),\r\n      decalName: r.str()\r\n    }\r\n  }\r\n\r\n  static roomType(r: Reader) {\r\n    return {\r\n      type: r.us()\r\n    }\r\n  }\r\n\r\n  static addAngle(r: Reader) {\r\n    // NOTE: not sure if (360/65536) or (65536/360)\r\n    return {\r\n      angleToAdd: r.s() / (360 / 65536)\r\n    }\r\n  }\r\n\r\n  static newUserMsg(r: Reader) {\r\n    return {\r\n      index: r.ub(),\r\n      size: r.b(),\r\n      name: r.nstr(16)\r\n    }\r\n  }\r\n\r\n  static packetEntities(r: Reader, deltaDecoders: any) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    let entityStates = []\r\n    bs.readBits(16) // skip entity count (unreliable)\r\n    let entityNumber = 0\r\n    while (true) {\r\n      let footer = bs.readBits(16)\r\n      if (footer === 0) {\r\n        break\r\n      }\r\n\r\n      bs.index -= 16\r\n\r\n      let entityNumberIncrement = bs.readBits(1)\r\n      if (!entityNumberIncrement) {\r\n        let absoluteEntityNumber = bs.readBits(1)\r\n        if (absoluteEntityNumber) {\r\n          entityNumber = bs.readBits(11)\r\n        } else {\r\n          entityNumber += bs.readBits(6)\r\n        }\r\n      } else {\r\n        entityNumber++\r\n      }\r\n\r\n      let custom = bs.readBits(1)\r\n      let useBaseline = bs.readBits(1)\r\n      if (useBaseline) {\r\n        bs.index += 6 // baseline index\r\n      }\r\n\r\n      let entityType = 'entity_state_t'\r\n      if (entityNumber > 0 && entityNumber <= 32) {\r\n        entityType = 'entity_state_player_t'\r\n      } else if (custom) {\r\n        entityType = 'custom_entity_state_t'\r\n      }\r\n\r\n      entityStates.push(readDelta(bs, deltaDecoders[entityType]))\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return { entityStates }\r\n  }\r\n\r\n  static deltaPacketEntities(r: Reader, deltaDecoders: any) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    bs.readBits(16) // skip entity count (unreliable)\r\n    bs.index += 8 // either updatemask or delta sequence number\r\n\r\n    let entityStates = []\r\n    let entityIdx = 0\r\n    while (true) {\r\n      let footer = bs.readBits(16)\r\n      if (footer === 0) {\r\n        break\r\n      }\r\n\r\n      bs.index -= 16\r\n\r\n      let removeEntity = bs.readBits(1)\r\n      let absoluteEntityNumber = bs.readBits(1)\r\n      if (absoluteEntityNumber) {\r\n        entityIdx = bs.readBits(11)\r\n      } else {\r\n        entityIdx += bs.readBits(6)\r\n      }\r\n\r\n      if (removeEntity) {\r\n        continue\r\n      }\r\n\r\n      let custom = bs.readBits(1)\r\n      let entityType = 'entity_state_t'\r\n      if (entityIdx > 0 && entityIdx < 32) {\r\n        entityType = 'entity_state_player_t'\r\n      } else if (custom) {\r\n        entityType = 'custom_entity_state_t'\r\n      }\r\n\r\n      entityStates[entityIdx] = readDelta(bs, deltaDecoders[entityType])\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return { entityStates }\r\n  }\r\n\r\n  static choke(): null {\r\n    // no arguments\r\n    return null\r\n  }\r\n\r\n  static resourceList(r: Reader) {\r\n    let bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    // TODO: extract more data???\r\n\r\n    let entries = []\r\n    let entryCount = bs.readBits(12)\r\n    for (let i = 0; i < entryCount; ++i) {\r\n      let entry: any = {}\r\n      entry.type = bs.readBits(4)\r\n      entry.name = bs.readString()\r\n      entry.index = bs.readBits(12)\r\n      entry.size = bs.readBits(24)\r\n\r\n      let flags = bs.readBits(3)\r\n      if (flags & 4) {\r\n        // TODO: entry.md5hash = read 128 bits\r\n        bs.index += 128\r\n      }\r\n\r\n      // 1 bit = boolean hasExtraInfo\r\n      if (bs.readBits(1)) {\r\n        // 32 bytes extraInfo\r\n        bs.index += 256\r\n      }\r\n\r\n      entries.push(entry)\r\n    }\r\n\r\n    if (bs.readBits(1)) {\r\n      while (bs.readBits(1)) {\r\n        let nBits = bs.readBits(1) ? 5 : 10\r\n        bs.index += nBits\r\n      }\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return entries\r\n  }\r\n\r\n  static newMoveVars(r: Reader) {\r\n    return {\r\n      gravity: r.f(),\r\n      stopSpeed: r.f(),\r\n      maxSpeed: r.f(),\r\n      spectatorMaxSpeed: r.f(),\r\n      acceleration: r.f(),\r\n      airAcceleration: r.f(),\r\n      waterAcceleration: r.f(),\r\n      friction: r.f(),\r\n      edgeFriction: r.f(),\r\n      waterFriction: r.f(),\r\n      entityGravity: r.f(),\r\n      bounce: r.f(),\r\n      stepSize: r.f(),\r\n      maxVelocity: r.f(),\r\n      zMax: r.f(),\r\n      waveHeight: r.f(),\r\n      footsteps: r.b(),\r\n      rollAngle: r.f(),\r\n      rollSpeed: r.f(),\r\n      skyColor: [r.f(), r.f(), r.f()],\r\n      skyVec: [r.f(), r.f(), r.f()],\r\n      skyName: r.str()\r\n    }\r\n  }\r\n\r\n  static resourceRequest(r: Reader) {\r\n    let data = {\r\n      spawnCount: r.i()\r\n    }\r\n    r.skip(4) // unknown (always 0)\r\n\r\n    return data\r\n  }\r\n\r\n  static customization(r: Reader) {\r\n    let playerIndex = r.ub()\r\n    let type = r.ub()\r\n    let name = r.str()\r\n    let index = r.us()\r\n    let downloadSize = r.ui()\r\n    let flags = r.ub()\r\n    let md5hash\r\n    if (flags & 4) {\r\n      md5hash = [r.i(), r.i(), r.i(), r.i()]\r\n    }\r\n\r\n    return {\r\n      playerIndex,\r\n      type,\r\n      name,\r\n      index,\r\n      downloadSize,\r\n      flags,\r\n      md5hash\r\n    }\r\n  }\r\n\r\n  static crosshairAngle(r: Reader) {\r\n    return {\r\n      pitch: r.b(),\r\n      yaw: r.b()\r\n    }\r\n  }\r\n\r\n  static soundFade(r: Reader) {\r\n    return {\r\n      initialPercent: r.ub(),\r\n      holdTime: r.ub(),\r\n      fadeOutTime: r.ub(),\r\n      fadeInTime: r.ub()\r\n    }\r\n  }\r\n\r\n  static fileTxferFailed(r: Reader) {\r\n    return {\r\n      filename: r.str()\r\n    }\r\n  }\r\n\r\n  static hltv(r: Reader) {\r\n    return {\r\n      mode: r.ub()\r\n    }\r\n  }\r\n\r\n  static director(r: Reader) {\r\n    let length = r.ub()\r\n    return {\r\n      flag: r.ub(),\r\n      message: r.nstr(length - 1)\r\n    }\r\n  }\r\n\r\n  static voiceInit(r: Reader) {\r\n    return {\r\n      codecName: r.str(),\r\n      quality: r.b()\r\n    }\r\n  }\r\n\r\n  static voiceData(r: Reader) {\r\n    let playerIndex = r.ub()\r\n    let size = r.us()\r\n    let data = r.arrx(size, ReaderDataType.UByte)\r\n    return { playerIndex, data }\r\n  }\r\n\r\n  static sendExtraInfo(r: Reader) {\r\n    return {\r\n      fallbackDir: r.str(),\r\n      canCheat: r.ub()\r\n    }\r\n  }\r\n\r\n  static timeScale(r: Reader) {\r\n    return {\r\n      timeScale: r.f()\r\n    }\r\n  }\r\n\r\n  static resourceLocation(r: Reader) {\r\n    return {\r\n      url: r.str()\r\n    }\r\n  }\r\n\r\n  static sendCvarValue(r: Reader) {\r\n    // deprecated\r\n    return {\r\n      name: r.str()\r\n    }\r\n  }\r\n\r\n  static sendCvarValue2(r: Reader) {\r\n    return {\r\n      requestId: r.ui(),\r\n      name: r.str()\r\n    }\r\n  }\r\n\r\n  static read(r: Reader, type: number, deltaDecoders: any) {\r\n    if (FrameDataReader.handlers[type]) {\r\n      try {\r\n        return FrameDataReader.handlers[type](r, deltaDecoders)\r\n      } catch (e) {\r\n        return null\r\n      }\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n\r\n  static readonly handlers = [\r\n    FrameDataReader.bad, // SVC_BAD                      0\r\n    FrameDataReader.nop, // SVC_NOP                      1\r\n    FrameDataReader.disconnect, // SVC_DISCONNECT               2\r\n    FrameDataReader.event, // SVC_EVENT                    3\r\n    FrameDataReader.version, // SVC_VERSION                  4\r\n    FrameDataReader.setView, // SVC_SETVIEW                  5\r\n    FrameDataReader.sound, // SVC_SOUND                    6\r\n    FrameDataReader.time, // SVC_TIME                     7\r\n    FrameDataReader.print, // SVC_PRINT                    8\r\n    FrameDataReader.stuffText, // SVC_STUFFTEXT                9\r\n    FrameDataReader.setAngle, // SVC_SETANGLE                10\r\n    FrameDataReader.serverInfo, // SVC_SERVERINFO              11\r\n    FrameDataReader.lightStyle, // SVC_LIGHTSTYLE              12\r\n    FrameDataReader.updateUserInfo, // SVC_UPDATEUSERINFO          13\r\n    FrameDataReader.deltaDescription, // SVC_DELTADESCRIPTION        14\r\n    FrameDataReader.clientData, // SVC_CLIENTDATA              15\r\n    FrameDataReader.stopSound, // SVC_STOPSOUND               16\r\n    FrameDataReader.pings, // SVC_PINGS                   17\r\n    FrameDataReader.particle, // SVC_PARTICLE                18\r\n    FrameDataReader.damage, // SVC_DAMAGE                  19\r\n    FrameDataReader.spawnStatic, // SVC_SPAWNSTATIC             20\r\n    FrameDataReader.eventReliable, // SVC_EVENT_RELIABLE          21\r\n    FrameDataReader.spawnBaseLine, // SVC_SPAWNBASELINE           22\r\n    FrameDataReader.tempEntity, // SVC_TEMPENTITY              23\r\n    FrameDataReader.setPause, // SVC_SETPAUSE                24\r\n    FrameDataReader.signOnNum, // SVC_SIGNONNUM               25\r\n    FrameDataReader.centerPrint, // SVC_CENTERPRINT             26\r\n    FrameDataReader.killedMonster, // SVC_KILLEDMONSTER           27\r\n    FrameDataReader.foundSecret, // SVC_FOUNDSECRET             28\r\n    FrameDataReader.spawnStaticSound, // SVC_SPAWNSTATICSOUND        29\r\n    FrameDataReader.intermission, // SVC_INTERMISSION            30\r\n    FrameDataReader.finale, // SVC_FINALE                  31\r\n    FrameDataReader.cdTrack, // SVC_CDTRACK                 32\r\n    FrameDataReader.restore, // SVC_RESTORE                 33\r\n    FrameDataReader.cutscene, // SVC_CUTSCENE                34\r\n    FrameDataReader.weaponAnim, // SVC_WEAPONANIM              35\r\n    FrameDataReader.decalName, // SVC_DECALNAME               36\r\n    FrameDataReader.roomType, // SVC_ROOMTYPE                37\r\n    FrameDataReader.addAngle, // SVC_ADDANGLE                38\r\n    FrameDataReader.newUserMsg, // SVC_NEWUSERMSG              39\r\n    FrameDataReader.packetEntities, // SVC_PACKETENTITIES          40\r\n    FrameDataReader.deltaPacketEntities, // SVC_DELTAPACKETENTITIES     41\r\n    FrameDataReader.choke, // SVC_CHOKE                   42\r\n    FrameDataReader.resourceList, // SVC_RESOURCELIST            43\r\n    FrameDataReader.newMoveVars, // SVC_NEWMOVEVARS             44\r\n    FrameDataReader.resourceRequest, // SVC_RESOURCEREQUEST         45\r\n    FrameDataReader.customization, // SVC_CUSTOMIZATION           46\r\n    FrameDataReader.crosshairAngle, // SVC_CROSSHAIRANGLE          47\r\n    FrameDataReader.soundFade, // SVC_SOUNDFADE               48\r\n    FrameDataReader.fileTxferFailed, // SVC_FILETXFERFAILED         49\r\n    FrameDataReader.hltv, // SVC_HLTV                    50\r\n    FrameDataReader.director, // SVC_DIRECTOR                51\r\n    FrameDataReader.voiceInit, // SVC_VOICEINIT               52\r\n    FrameDataReader.voiceData, // SVC_VOICEDATA               53\r\n    FrameDataReader.sendExtraInfo, // SVC_SENDEXTRAINFO           54\r\n    FrameDataReader.timeScale, // SVC_TIMESCALE               55\r\n    FrameDataReader.resourceLocation, // SVC_RESOURCELOCATION        56\r\n    FrameDataReader.sendCvarValue, // SVC_SENDCVARVALUE           57\r\n    FrameDataReader.sendCvarValue2 // SVC_SENDCVARVALUE2          58\r\n  ]\r\n}\r\n\r\nnamespace FrameDataReader {\r\n  export enum SVC {\r\n    BAD = 0,\r\n    NOP = 1,\r\n    DISCONNECT = 2,\r\n    EVENT = 3,\r\n    VERSION = 4,\r\n    SETVIEW = 5,\r\n    SOUND = 6,\r\n    TIME = 7,\r\n    PRINT = 8,\r\n    STUFFTEXT = 9,\r\n    SETANGLE = 10,\r\n    SERVERINFO = 11,\r\n    LIGHTSTYLE = 12,\r\n    UPDATEUSERINFO = 13,\r\n    DELTADESCRIPTION = 14,\r\n    CLIENTDATA = 15,\r\n    STOPSOUND = 16,\r\n    PINGS = 17,\r\n    PARTICLE = 18,\r\n    DAMAGE = 19,\r\n    SPAWNSTATIC = 20,\r\n    EVENT_RELIABLE = 21,\r\n    SPAWNBASELINE = 22,\r\n    TEMPENTITY = 23,\r\n    SETPAUSE = 24,\r\n    SIGNONNUM = 25,\r\n    CENTERPRINT = 26,\r\n    KILLEDMONSTER = 27,\r\n    FOUNDSECRET = 28,\r\n    SPAWNSTATICSOUND = 29,\r\n    INTERMISSION = 30,\r\n    FINALE = 31,\r\n    CDTRACK = 32,\r\n    RESTORE = 33,\r\n    CUTSCENE = 34,\r\n    WEAPONANIM = 35,\r\n    DECALNAME = 36,\r\n    ROOMTYPE = 37,\r\n    ADDANGLE = 38,\r\n    NEWUSERMSG = 39,\r\n    PACKETENTITIES = 40,\r\n    DELTAPACKETENTITIES = 41,\r\n    CHOKE = 42,\r\n    RESOURCELIST = 43,\r\n    NEWMOVEVARS = 44,\r\n    RESOURCEREQUEST = 45,\r\n    CUSTOMIZATION = 46,\r\n    CROSSHAIRANGLE = 47,\r\n    SOUNDFADE = 48,\r\n    FILETXFERFAILED = 49,\r\n    HLTV = 50,\r\n    DIRECTOR = 51,\r\n    VOICEINIT = 52,\r\n    VOICEDATA = 53,\r\n    SENDEXTRAINFO = 54,\r\n    TIMESCALE = 55,\r\n    RESOURCELOCATION = 56,\r\n    SENDCVARVALUE = 57,\r\n    SENDCVARVALUE2 = 58\r\n  }\r\n}\r\n\r\nconst checkType = (r: Reader) => {\r\n  let magic = r.nstr(8)\r\n  return magic === 'HLDEMO'\r\n}\r\n\r\nconst readHeader = (r: Reader) => {\r\n  return {\r\n    demoProtocol: r.ui(),\r\n    netProtocol: r.ui(),\r\n    mapName: r.nstr(260),\r\n    modName: r.nstr(260),\r\n    mapCrc: r.i(),\r\n    dirOffset: r.ui()\r\n  }\r\n}\r\n\r\nconst readDirectories = (r: Reader, offset: number) => {\r\n  r.seek(offset)\r\n\r\n  let count = r.ui()\r\n  let directories = []\r\n  for (let i = 0; i < count; ++i) {\r\n    directories.push({\r\n      id: r.ui(),\r\n      name: r.nstr(64),\r\n      flags: r.ui(),\r\n      cdTrack: r.i(),\r\n      time: r.f(),\r\n      frames: r.ui(),\r\n      offset: r.ui(),\r\n      length: r.ui()\r\n    })\r\n  }\r\n\r\n  return directories\r\n}\r\n\r\nconst readFrameData = (r: Reader, deltaDecoders: any, customMessages: any) => {\r\n  let length = r.ui()\r\n  let limit = r.tell() + length\r\n  let data = []\r\n  while (r.tell() < limit) {\r\n    let type = r.ub()\r\n    if (type === 1) {\r\n      continue\r\n    } else if (type >= 64) {\r\n      if (customMessages[type] && customMessages[type].size > -1) {\r\n        r.skip(customMessages[type].size)\r\n      } else {\r\n        r.skip(r.ub())\r\n      }\r\n\r\n      continue\r\n    }\r\n\r\n    let message = FrameDataReader.read(r, type, deltaDecoders)\r\n    if (message) {\r\n      if (type === 39) {\r\n        customMessages[message.index] = message\r\n      }\r\n      data.push({\r\n        type,\r\n        data: message\r\n      })\r\n    } else {\r\n      r.seek(limit)\r\n    }\r\n  }\r\n\r\n  // just in case\r\n  r.seek(limit)\r\n\r\n  return data\r\n}\r\n\r\nconst readFrame = (r: Reader, deltaDecoders: any, customMessages: any) => {\r\n  let frame: any = {\r\n    type: r.ub(),\r\n    time: r.f(),\r\n    tick: r.ui()\r\n  }\r\n\r\n  switch (frame.type) {\r\n    case 0:\r\n    case 1: {\r\n      r.skip(4)\r\n      frame.camera = {\r\n        position: [r.f(), r.f(), r.f()],\r\n        orientation: [r.f(), r.f(), r.f()]\r\n      }\r\n      r.skip(436)\r\n      frame.data = readFrameData(r, deltaDecoders, customMessages)\r\n      break\r\n    }\r\n    case 2: {\r\n      break\r\n    }\r\n    case 3: {\r\n      frame.command = r.nstr(64)\r\n      break\r\n    }\r\n    case 4: {\r\n      r.skip(32)\r\n      break\r\n    }\r\n    case 5: {\r\n      break\r\n    }\r\n    case 6: {\r\n      r.skip(84)\r\n      break\r\n    }\r\n    case 7: {\r\n      r.skip(8)\r\n      break\r\n    }\r\n    case 8: {\r\n      frame.sound = {\r\n        channel: r.i(),\r\n        sample: r.nstr(r.ui()),\r\n        attenuation: r.f(),\r\n        volume: r.f(),\r\n        flags: r.ui(),\r\n        pitch: r.i()\r\n      }\r\n      break\r\n    }\r\n    case 9: {\r\n      r.skip(r.ui())\r\n      break\r\n    }\r\n    default: {\r\n      frame.error = true\r\n      break\r\n    }\r\n  }\r\n\r\n  return frame\r\n}\r\n\r\nconst getInitialDeltaDecoders = () => {\r\n  return Object.assign(\r\n    {},\r\n    {\r\n      delta_description_t: [\r\n        {\r\n          name: 'flags',\r\n          bits: 32,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'name',\r\n          bits: 8,\r\n          divisor: 1,\r\n          flags: DT_STRING\r\n        },\r\n        {\r\n          name: 'offset',\r\n          bits: 16,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'size',\r\n          bits: 8,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'bits',\r\n          bits: 8,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'divisor',\r\n          bits: 32,\r\n          divisor: 4000,\r\n          flags: DT_FLOAT\r\n        },\r\n        {\r\n          name: 'preMultiplier',\r\n          bits: 32,\r\n          divisor: 4000,\r\n          flags: DT_FLOAT\r\n        }\r\n      ]\r\n    }\r\n  )\r\n}\r\n\r\nclass ReplayState {\r\n  cameraPos: any[]\r\n  cameraRot: any[]\r\n  entities: any[]\r\n\r\n  constructor(obj: any | null = null) {\r\n    if (obj) {\r\n      this.cameraPos = JSON.parse(JSON.stringify(obj.cameraPos))\r\n      this.cameraRot = JSON.parse(JSON.stringify(obj.cameraRot))\r\n      this.entities = JSON.parse(JSON.stringify(obj.entities))\r\n    } else {\r\n      this.cameraPos = [0, 0, 0]\r\n      this.cameraRot = [0, 0, 0]\r\n      this.entities = []\r\n    }\r\n  }\r\n\r\n  feedFrame(frame: any) {\r\n    switch (frame.type) {\r\n      case 0:\r\n      case 1: {\r\n        this.cameraPos[0] = frame.camera.position[0]\r\n        this.cameraPos[1] = frame.camera.position[1]\r\n        this.cameraPos[2] = frame.camera.position[2]\r\n\r\n        this.cameraRot[0] = frame.camera.orientation[0]\r\n        this.cameraRot[1] = frame.camera.orientation[1]\r\n        this.cameraRot[2] = frame.camera.orientation[2]\r\n\r\n        // TODO: handle spawnbaseline, clientdata, and similar messages\r\n\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  // TODO\r\n  // serialize() {\r\n  //     return JSON.stringify(this)\r\n  // }\r\n\r\n  // deserialize(data: string) {\r\n  //     return JSON.parse(data)\r\n  // }\r\n\r\n  clone() {\r\n    return new ReplayState(this)\r\n  }\r\n}\r\n\r\nclass Replay {\r\n  header: any\r\n  mapName: string\r\n  directories: any\r\n\r\n  constructor(header: any, directories: any) {\r\n    this.header = header\r\n    this.mapName = this.header.mapName\r\n    this.directories = directories\r\n  }\r\n\r\n  static parseFromArrayBuffer(buffer: ArrayBuffer) {\r\n    let r = new Reader(buffer)\r\n    let magic = r.nstr(8)\r\n    if (magic !== 'HLDEMO') {\r\n      throw new Error('Invalid replay format')\r\n    }\r\n\r\n    let header: any = {}\r\n    header.demoProtocol = r.ui()\r\n    header.netProtocol = r.ui()\r\n    header.mapName = r.nstr(260)\r\n    header.modName = r.nstr(260)\r\n    header.mapCrc = r.i()\r\n    header.dirOffset = r.ui()\r\n\r\n    r.seek(header.dirOffset)\r\n    let directoryCount = r.ui()\r\n    let directories: any[] = []\r\n    for (let i = 0; i < directoryCount; ++i) {\r\n      directories.push({\r\n        id: r.ui(),\r\n        name: r.nstr(64),\r\n        flags: r.ui(),\r\n        cdTrack: r.i(),\r\n        time: r.f(),\r\n        frames: r.ui(),\r\n        offset: r.ui(),\r\n        length: r.ui(),\r\n        macros: []\r\n      })\r\n    }\r\n\r\n    for (let i = 0; i < directories.length; ++i) {\r\n      r.seek(directories[i].offset)\r\n\r\n      let isFinalMacroReached = false\r\n      while (!isFinalMacroReached) {\r\n        let macro: any = {\r\n          type: r.b(),\r\n          time: r.f(),\r\n          frame: r.ui()\r\n        }\r\n\r\n        switch (macro.type) {\r\n          case 0:\r\n          case 1: {\r\n            r.skip(4)\r\n            macro.camera = {\r\n              position: [r.f(), r.f(), r.f()],\r\n              orientation: [r.f(), r.f(), r.f()]\r\n            }\r\n            r.skip(436)\r\n            r.skip(r.ui())\r\n            break\r\n          }\r\n\r\n          case 2: {\r\n            // empty macro\r\n            // signals the beginning of directory entry\r\n            break\r\n          }\r\n\r\n          case 3: {\r\n            macro.command = r.nstr(64)\r\n            break\r\n          }\r\n\r\n          case 4: {\r\n            r.skip(32)\r\n            break\r\n          }\r\n\r\n          case 5: {\r\n            // empty macro that signals end of directory entry\r\n            isFinalMacroReached = true\r\n            break\r\n          }\r\n\r\n          case 6: {\r\n            r.skip(84)\r\n            break\r\n          }\r\n\r\n          case 7: {\r\n            r.skip(8)\r\n            break\r\n          }\r\n\r\n          case 8: {\r\n            r.skip(4)\r\n            r.skip(r.ui() + 16)\r\n            break\r\n          }\r\n\r\n          case 9: {\r\n            r.skip(r.ui())\r\n            break\r\n          }\r\n\r\n          default: {\r\n            const offset = Number(r.tell() - 9).toString(16)\r\n            const msg = [\r\n              `Unexpected macro (${macro.type})`,\r\n              ` at offset = ${offset}.`\r\n            ].join('')\r\n            throw new Error(msg)\r\n          }\r\n        }\r\n\r\n        directories[i].macros.push(macro)\r\n      }\r\n    }\r\n\r\n    return new Replay(header, directories)\r\n  }\r\n\r\n  static parseFullFromArrayBuffer(buffer: ArrayBuffer) {\r\n    let r = new Reader(buffer)\r\n    let magic = r.nstr(8)\r\n    if (magic !== 'HLDEMO') {\r\n      throw new Error('Invalid replay format')\r\n    }\r\n\r\n    let header: any = {}\r\n    header.demoProtocol = r.ui()\r\n    header.netProtocol = r.ui()\r\n    header.mapName = r.nstr(260)\r\n    header.modName = r.nstr(260)\r\n    header.mapCrc = r.i()\r\n    header.dirOffset = r.ui()\r\n\r\n    r.seek(header.dirOffset)\r\n    let directoryCount = r.ui()\r\n    let directories: any[] = []\r\n    for (let i = 0; i < directoryCount; ++i) {\r\n      directories.push({\r\n        id: r.ui(),\r\n        name: r.nstr(64),\r\n        flags: r.ui(),\r\n        cdTrack: r.i(),\r\n        time: r.f(),\r\n        frames: r.ui(),\r\n        offset: r.ui(),\r\n        length: r.ui(),\r\n        macros: []\r\n      })\r\n    }\r\n\r\n    let deltaDecoders = {\r\n      delta_description_t: [\r\n        {\r\n          name: 'flags',\r\n          bits: 32,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'name',\r\n          bits: 8,\r\n          divisor: 1,\r\n          flags: DT_STRING\r\n        },\r\n        {\r\n          name: 'offset',\r\n          bits: 16,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'size',\r\n          bits: 8,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'bits',\r\n          bits: 8,\r\n          divisor: 1,\r\n          flags: DT_INTEGER\r\n        },\r\n        {\r\n          name: 'divisor',\r\n          bits: 32,\r\n          divisor: 4000,\r\n          flags: DT_FLOAT\r\n        },\r\n        {\r\n          name: 'preMultiplier',\r\n          bits: 32,\r\n          divisor: 4000,\r\n          flags: DT_FLOAT\r\n        }\r\n      ]\r\n    }\r\n\r\n    let customMessages = []\r\n\r\n    for (let i = 0; i < directories.length; ++i) {\r\n      r.seek(directories[i].offset)\r\n\r\n      let isFinalMacroReached = false\r\n      while (!isFinalMacroReached) {\r\n        let macro: any = {\r\n          type: r.b(),\r\n          time: r.f(),\r\n          frame: r.ui()\r\n        }\r\n        switch (macro.type) {\r\n          case 0:\r\n          case 1: {\r\n            r.skip(4)\r\n            macro.camera = {\r\n              position: [r.f(), r.f(), r.f()],\r\n              orientation: [r.f(), r.f(), r.f()],\r\n              forward: [r.f(), r.f(), r.f()],\r\n              right: [r.f(), r.f(), r.f()],\r\n              up: [r.f(), r.f(), r.f()]\r\n            }\r\n\r\n            macro.RefParams = {\r\n              frametime: r.f(),\r\n              time: r.f(),\r\n              intermission: r.i(),\r\n              paused: r.i(),\r\n              spectator: r.i(),\r\n              onground: r.i(),\r\n              waterlevel: r.i(),\r\n              velocity: [r.f(), r.f(), r.f()],\r\n              origin: [r.f(), r.f(), r.f()],\r\n              viewHeight: [r.f(), r.f(), r.f()],\r\n              idealPitch: r.f(),\r\n              viewAngles: [r.f(), r.f(), r.f()],\r\n              health: r.i(),\r\n              crosshairAngle: [r.f(), r.f(), r.f()],\r\n              viewSize: r.f(),\r\n              punchAngle: [r.f(), r.f(), r.f()],\r\n              maxClients: r.i(),\r\n              viewEntity: r.i(),\r\n              playerCount: r.i(),\r\n              maxEntities: r.i(),\r\n              demoPlayback: r.i(),\r\n              hardware: r.i(),\r\n              smoothing: r.i(),\r\n              ptr_cmd: r.i(),\r\n              ptr_movevars: r.i(),\r\n              viewport: [r.i(), r.i(), r.i(), r.i()],\r\n              nextView: r.i(),\r\n              onlyClientDraw: r.i()\r\n            }\r\n\r\n            macro.UserCmd = {\r\n              lerp_msec: r.s(),\r\n              msec: r.ub(),\r\n              UNUSED1: r.ub(),\r\n              viewAngles: [r.f(), r.f(), r.f()],\r\n              forwardMove: r.f(),\r\n              sideMove: r.f(),\r\n              upMove: r.f(),\r\n              lightLevel: r.b(),\r\n              UNUSED2: r.ub(),\r\n              buttons: r.us(),\r\n              impulse: r.b(),\r\n              weaponSelect: r.b(),\r\n              UNUSED: r.s(),\r\n              impactIndex: r.i(),\r\n              impactPosition: [r.f(), r.f(), r.f()]\r\n            }\r\n\r\n            macro.MoveVars = {\r\n              gravity: r.f(),\r\n              stopSpeed: r.f(),\r\n              maxSpeed: r.f(),\r\n              spectatorMaxSpeed: r.f(),\r\n              acceleration: r.f(),\r\n              airAcceleration: r.f(),\r\n              waterAcceleration: r.f(),\r\n              friction: r.f(),\r\n              edgeFriction: r.f(),\r\n              waterFriction: r.f(),\r\n              entityGravity: r.f(),\r\n              bounce: r.f(),\r\n              stepSize: r.f(),\r\n              maxVelocity: r.f(),\r\n              zMax: r.f(),\r\n              waveHeight: r.f(),\r\n              footsteps: r.i(),\r\n              skyName: r.nstr(32),\r\n              rollAngle: r.f(),\r\n              rollSpeed: r.f(),\r\n              skyColor: [r.f(), r.f(), r.f()],\r\n              skyVec: [r.f(), r.f(), r.f()]\r\n            }\r\n\r\n            macro.view = [r.f(), r.f(), r.f()]\r\n            macro.viewModel = r.i()\r\n\r\n            macro.incoming_sequence = r.i()\r\n            macro.incoming_acknowledged = r.i()\r\n            macro.incoming_reliable_acknowledged = r.i()\r\n            macro.incoming_reliable_sequence = r.i()\r\n            macro.outgoing_sequence = r.i()\r\n            macro.reliable_sequence = r.i()\r\n            macro.last_reliable_sequence = r.i()\r\n\r\n            let frameDataLength = r.ui()\r\n            let frameDataEnd = frameDataLength + r.tell()\r\n            macro.frameData = []\r\n            while (r.tell() < frameDataEnd) {\r\n              let type = r.ub()\r\n              if (type === 1) {\r\n                continue // skip SVC_NOP\r\n              } else if (type >= 64) {\r\n                // TODO: parse custom message\r\n                if (customMessages[type] && customMessages[type].size > -1) {\r\n                  r.skip(customMessages[type].size)\r\n                } else {\r\n                  r.skip(r.ub())\r\n                }\r\n\r\n                continue\r\n              }\r\n\r\n              let frameData = FrameDataReader.read(r, type, deltaDecoders)\r\n              if (frameData) {\r\n                if (type === 39) {\r\n                  customMessages[frameData.index] = frameData\r\n                }\r\n                macro.frameData.push({ type, frameData })\r\n              } else {\r\n                r.seek(frameDataEnd)\r\n              }\r\n            }\r\n\r\n            // if r.tell() > frameDataEnd something wrong happened\r\n            r.seek(frameDataEnd)\r\n            break\r\n          }\r\n\r\n          case 2: {\r\n            // empty macro\r\n            // signals the beginning of directory entry\r\n            break\r\n          }\r\n\r\n          case 3: {\r\n            macro.command = r.nstr(64)\r\n            break\r\n          }\r\n\r\n          case 4: {\r\n            macro.clientData = {\r\n              position: [r.f(), r.f(), r.f()],\r\n              rotation: [r.f(), r.f(), r.f()],\r\n              weaponFlags: r.ui(),\r\n              fov: r.f()\r\n            }\r\n            break\r\n          }\r\n\r\n          case 5: {\r\n            // empty macro that signals end of directory entry\r\n            isFinalMacroReached = true\r\n            break\r\n          }\r\n\r\n          case 6: {\r\n            macro.event = {\r\n              flags: r.ui(),\r\n              index: r.ui(),\r\n              delay: r.f(),\r\n              args: {\r\n                flags: r.ui(),\r\n                entityIndex: r.ui(),\r\n                position: [r.f(), r.f(), r.f()],\r\n                rotation: [r.f(), r.f(), r.f()],\r\n                velocity: [r.f(), r.f(), r.f()],\r\n                ducking: r.ui(),\r\n                fparam1: r.f(),\r\n                fparam2: r.f(),\r\n                iparam1: r.i(),\r\n                iparam2: r.i(),\r\n                bparam1: r.i(),\r\n                bparam2: r.i()\r\n              }\r\n            }\r\n            break\r\n          }\r\n\r\n          case 7: {\r\n            macro.weaponAnimation = {\r\n              animation: r.i(),\r\n              body: r.i()\r\n            }\r\n            break\r\n          }\r\n\r\n          case 8: {\r\n            macro.sound = {\r\n              channel: r.i(),\r\n              sample: r.nstr(r.ui()),\r\n              attenuation: r.f(),\r\n              volume: r.f(),\r\n              flags: r.ui(),\r\n              pitch: r.i()\r\n            }\r\n            break\r\n          }\r\n\r\n          case 9: {\r\n            r.skip(r.ui())\r\n            break\r\n          }\r\n\r\n          default: {\r\n            const offset = Number(r.tell() - 9).toString(16)\r\n            const msg = [\r\n              `Unexpected macro (${macro.type})`,\r\n              ` at offset = ${offset}.`\r\n            ].join('')\r\n            throw new Error(msg)\r\n          }\r\n        }\r\n\r\n        directories[i].macros.push(macro)\r\n      }\r\n    }\r\n\r\n    return new Replay(header, directories)\r\n  }\r\n\r\n  static parseIntoChunks(buffer: ArrayBuffer) {\r\n    let r = new Reader(buffer)\r\n\r\n    if (!checkType(r)) {\r\n      throw new Error('Invalid replay file format')\r\n    }\r\n\r\n    let maps = []\r\n    let deltaDecoders = getInitialDeltaDecoders()\r\n    let customMessages: any[] = []\r\n\r\n    let header = readHeader(r)\r\n    let directories = readDirectories(r, header.dirOffset)\r\n\r\n    let currentMap: ReplayMap | undefined\r\n    let currentChunk\r\n    let lastFrame\r\n    let lastFrameOffset\r\n    let state = new ReplayState()\r\n\r\n    let directoryEndOffset\r\n\r\n    // read loading segment\r\n    directoryEndOffset = directories[0].offset + directories[0].length\r\n    r.seek(directories[0].offset)\r\n    while (r.tell() < directoryEndOffset) {\r\n      let frame = readFrame(r, deltaDecoders, customMessages)\r\n      state.feedFrame(frame)\r\n\r\n      if (frame.error) {\r\n        throw new Error('Encountered error while reading replay')\r\n      }\r\n\r\n      if (frame.type < 2 /* 0 or 1 */) {\r\n        let serverInfo = frame.data.find(\r\n          (msg: any) => msg.type === FrameDataReader.SVC.SERVERINFO\r\n        )\r\n        if (serverInfo) {\r\n          currentMap = new ReplayMap(serverInfo.data.mapFileName)\r\n          maps.push(currentMap)\r\n        }\r\n\r\n        let resourceList = frame.data.find(\r\n          (msg: any) => msg.type === FrameDataReader.SVC.RESOURCELIST\r\n        )\r\n        if (resourceList && currentMap) {\r\n          currentMap.setResources(resourceList.data)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!(currentMap instanceof ReplayMap)) {\r\n      throw new Error('Error while parsing replay.')\r\n    }\r\n\r\n    lastFrameOffset = r.tell()\r\n    currentChunk = new ReplayChunk(state, 0)\r\n    currentMap.addChunk(currentChunk)\r\n\r\n    // read playback segment\r\n    directoryEndOffset = directories[1].offset + directories[1].length\r\n    r.seek(directories[1].offset)\r\n    while (true) {\r\n      let offset = r.tell()\r\n      /*if (offset > 72000) {\r\n                debugger\r\n            }*/\r\n      if (offset >= directoryEndOffset) {\r\n        // set last and final chunks data\r\n        let timeLength = lastFrame.time - currentChunk.startTime\r\n        currentChunk.timeLength = timeLength\r\n        let lastFrameLength = offset - lastFrameOffset\r\n        r.seek(lastFrameOffset)\r\n        currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\r\n        r.seek(offset)\r\n\r\n        break\r\n      }\r\n\r\n      let frame = readFrame(r, deltaDecoders, customMessages)\r\n      state.feedFrame(frame)\r\n      lastFrame = frame\r\n\r\n      if (frame.error) {\r\n        throw new Error('Encountered error while reading replay')\r\n      }\r\n\r\n      if (frame.type < 2) {\r\n        let serverInfo = frame.data.find(\r\n          (msg: any) => msg.type === FrameDataReader.SVC.SERVERINFO\r\n        )\r\n        if (serverInfo) {\r\n          // create new map\r\n          currentMap = new ReplayMap(serverInfo.data.mapFileName)\r\n          maps.push(currentMap)\r\n\r\n          // set last chunks data\r\n          let timeLength = lastFrame.time - currentChunk.startTime\r\n          currentChunk.timeLength = timeLength\r\n          let lastFrameLength = offset - lastFrameOffset\r\n          let tempOffset = r.tell()\r\n          r.seek(lastFrameOffset)\r\n          currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\r\n          r.seek(tempOffset)\r\n\r\n          // create new chunk\r\n          lastFrameOffset = offset\r\n          currentChunk = new ReplayChunk(state, frame.time)\r\n          currentMap.addChunk(currentChunk)\r\n        }\r\n\r\n        let resourceList = frame.data.find(\r\n          (msg: any) => msg.type === FrameDataReader.SVC.RESOURCELIST\r\n        )\r\n        if (resourceList) {\r\n          currentMap.setResources(resourceList.data)\r\n        }\r\n\r\n        if (serverInfo) {\r\n          continue\r\n        }\r\n\r\n        for (let i = 0; i < frame.data.length; ++i) {\r\n          let message = frame.data[i]\r\n          if (\r\n            message.type === FrameDataReader.SVC.SOUND ||\r\n            message.type === FrameDataReader.SVC.SPAWNSTATICSOUND\r\n          ) {\r\n            let sound = currentMap.resources.sounds.find(\r\n              (s: any) => s.index === message.data.soundIndex\r\n            )\r\n            if (sound) {\r\n              sound.used = true\r\n            }\r\n          } else if (message.type === FrameDataReader.SVC.STUFFTEXT) {\r\n            let sounds = currentMap.resources.sounds\r\n            let commands = message.data.commands\r\n\r\n            for (let i = 0; i < commands.length; ++i) {\r\n              let command = commands[i]\r\n\r\n              let func = command.func\r\n              if (\r\n                (func === 'speak' || func === 'spk') &&\r\n                command.params.length === 1\r\n              ) {\r\n                let soundName = command.params[0] + '.wav'\r\n                let sound = sounds.find((s: any) => s.name === soundName)\r\n                if (sound) {\r\n                  sound.used = true\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else if (frame.type === 8) {\r\n        let sound = currentMap.resources.sounds.find(\r\n          (s: any) => s.name === frame.sound.sample\r\n        )\r\n        if (sound) {\r\n          sound.used = true\r\n        }\r\n      }\r\n\r\n      if (currentChunk.startTime + 10 < frame.time) {\r\n        // set last chunks data\r\n        let lastFrameLength = offset - lastFrameOffset\r\n        let tempOffset = r.tell()\r\n        r.seek(lastFrameOffset)\r\n        currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\r\n        r.seek(tempOffset)\r\n\r\n        // create new chunk\r\n        lastFrameOffset = offset\r\n        currentChunk = new ReplayChunk(state, frame.time)\r\n        currentMap.addChunk(currentChunk)\r\n      }\r\n    }\r\n\r\n    return {\r\n      length: directories[1].time,\r\n      maps,\r\n      deltaDecoders,\r\n      customMessages\r\n    }\r\n  }\r\n\r\n  static readHeader(r: Reader) {\r\n    return readHeader(r)\r\n  }\r\n\r\n  static readDirectories(r: Reader, offset: number) {\r\n    return readDirectories(r, offset)\r\n  }\r\n\r\n  static readFrame(r: Reader, deltaDecoders: any, customMessages: any) {\r\n    return readFrame(r, deltaDecoders, customMessages)\r\n  }\r\n\r\n  static readFrameData(r: Reader, deltaDecoders: any, customMessages: any) {\r\n    return readFrame(r, deltaDecoders, customMessages)\r\n  }\r\n}\r\n\r\nexport class ReplayChunk {\r\n  state: ReplayState\r\n  startTime: number\r\n  timeLength: number\r\n  data: Uint8Array | null\r\n  reader: Reader | null\r\n\r\n  constructor(initialState: ReplayState, startTime: number) {\r\n    this.state = initialState.clone()\r\n    this.startTime = startTime\r\n    this.timeLength = 10\r\n    this.data = null\r\n    this.reader = null\r\n  }\r\n\r\n  setData(data: Uint8Array) {\r\n    this.data = new Uint8Array(data.length)\r\n    for (let i = 0; i < data.length; ++i) {\r\n      this.data[i] = data[i]\r\n    }\r\n\r\n    this.reader = new Reader(this.data.buffer as ArrayBuffer)\r\n  }\r\n}\r\n\r\nexport class ReplayMap {\r\n  name: string\r\n  chunks: ReplayChunk[]\r\n  resources: any\r\n\r\n  constructor(mapFilePath: string) {\r\n    this.name = Path.basename(mapFilePath, '.bsp')\r\n    this.chunks = []\r\n    this.resources = {\r\n      sounds: [],\r\n      skins: [],\r\n      models: [],\r\n      decals: [],\r\n      custom: [],\r\n      events: []\r\n    }\r\n  }\r\n\r\n  setResources(resources: any[]) {\r\n    resources.forEach(res => {\r\n      switch (res.type) {\r\n        case 0: {\r\n          res.used = false\r\n          this.resources.sounds.push(res)\r\n          break\r\n        }\r\n        case 1: {\r\n          this.resources.skins.push(res)\r\n          break\r\n        }\r\n        case 2: {\r\n          this.resources.models.push(res)\r\n          break\r\n        }\r\n        case 3: {\r\n          this.resources.decals.push(res)\r\n          break\r\n        }\r\n        case 4: {\r\n          this.resources.custom.push(res)\r\n          break\r\n        }\r\n        case 5: {\r\n          this.resources.events.push(res)\r\n          break\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  addChunk(chunk: ReplayChunk) {\r\n    this.chunks.push(chunk)\r\n  }\r\n}\r\n\r\nexport { FrameDataReader, ReplayState, Replay }\r\n","import { EventEmitter } from 'events'\r\nimport { Sound } from './Sound'\r\n\r\nconst wnd: any = window\r\n\r\nconst polyfillAudioContext = wnd.AudioContext || wnd.webkitAudioContext\r\nconst audioContext: AudioContext = new polyfillAudioContext()\r\n\r\nclass SoundSystem {\r\n  context: AudioContext\r\n  channels: any[]\r\n  masterGain: GainNode\r\n  preMuteVolume: number\r\n  events: EventEmitter\r\n\r\n  constructor() {\r\n    this.context = audioContext\r\n\r\n    this.events = new EventEmitter()\r\n\r\n    const volume = parseFloat(localStorage.getItem('volume') || '0.3')\r\n    localStorage.setItem('volume', volume.toString())\r\n\r\n    this.channels = []\r\n\r\n    this.preMuteVolume = 1\r\n    this.masterGain = this.context.createGain()\r\n    this.masterGain.gain.value = volume\r\n    this.masterGain.connect(this.context.destination)\r\n\r\n    for (let i = 0; i < 8; ++i) {\r\n      this.channels.push({\r\n        source: null,\r\n        gain: this.context.createGain()\r\n      })\r\n      this.channels[i].gain.connect(this.masterGain)\r\n    }\r\n  }\r\n\r\n  static getContext() {\r\n    return audioContext\r\n  }\r\n\r\n  play(sound: Sound, channel: number, volume: number) {\r\n    this.stop(channel)\r\n\r\n    const gain = this.channels[channel].gain\r\n    gain.gain.value = Math.max(0, Math.min(1, volume))\r\n\r\n    const source = this.context.createBufferSource()\r\n    source.buffer = sound.buffer\r\n    source.connect(gain)\r\n    source.start(0)\r\n\r\n    this.channels[channel].source = source\r\n  }\r\n\r\n  stop(channel: number) {\r\n    const source = this.channels[channel].source\r\n    if (source) {\r\n      source.stop(0)\r\n    }\r\n  }\r\n\r\n  getVolume() {\r\n    return this.masterGain.gain.value\r\n  }\r\n\r\n  setVolume(value: number) {\r\n    const current = this.masterGain.gain.value\r\n    if (current > 0 && value === 0) {\r\n      this.preMuteVolume = current\r\n    }\r\n\r\n    this.masterGain.gain.value = value\r\n\r\n    localStorage.setItem('volume', value.toString())\r\n    this.events.emit('volumeChange', value)\r\n  }\r\n\r\n  toggleMute() {\r\n    if (this.getVolume() === 0) {\r\n      this.setVolume(this.preMuteVolume)\r\n    } else {\r\n      this.setVolume(0)\r\n    }\r\n  }\r\n}\r\n\r\nexport { SoundSystem }\r\n","import { Reader, ReaderDataType } from '../Reader'\nimport { paletteWithLastTransToRGBA, paletteToRGBA } from './Util'\n\ninterface SpriteHeader {\n  version: number\n  type: SpriteType\n  alphaType: SpriteAlphaType\n  radius: number\n  width: number\n  height: number\n  frameCount: number\n  beamLength: number\n  syncType: SpriteSyncType\n}\n\ninterface SpriteFrame {\n  group: number\n  position: number[]\n  width: number\n  height: number\n  data: Uint8Array\n}\n\nexport enum SpriteType {\n  VP_PARALLEL_UPRIGHT = 0,\n  FACING_UPRIGHT = 1,\n  VP_PARALLEL = 2,\n  ORIENTED = 3,\n  VP_PARALLEL_ORIENTED = 4\n}\n\nexport enum SpriteAlphaType {\n  SPR_NORMAL = 0,\n  SPR_ADDITIVE = 1,\n  SPR_INDEXALPHA = 2,\n  SPR_ALPHTEST = 3\n}\n\nexport enum SpriteSyncType {\n  SYNCHRONIZED = 0,\n  RANDOM = 1\n}\n\nexport class Sprite {\n  header: SpriteHeader\n  frames: SpriteFrame[]\n\n  constructor(header: SpriteHeader, frames: SpriteFrame[]) {\n    this.header = header\n    this.frames = frames\n  }\n\n  static parse(buffer: ArrayBuffer) {\n    const r = new Reader(buffer)\n\n    const magic = r.nstr(4)\n    if (magic !== 'IDSP') {\n      throw new Error('Invalid sprite file format')\n    }\n\n    const header: SpriteHeader = {\n      version: r.i(), // must be 2 (1 = Quake, 2 = Half-Life)\n      type: r.i(),\n      alphaType: r.i(),\n      radius: r.f(),\n      width: r.i(),\n      height: r.i(),\n      frameCount: r.i(),\n      beamLength: r.f(),\n      syncType: r.i()\n    }\n\n    const paletteSize = r.s()\n    const palette = r.arrx(paletteSize * 3, ReaderDataType.UByte)\n\n    const frames: SpriteFrame[] = []\n    for (let i = 0; i < header.frameCount; ++i) {\n      const frame = {\n        group: r.i(),\n        position: [r.i(), r.i()],\n        width: r.i(),\n        height: r.i(),\n        data: new Uint8Array(header.width * header.height * 4)\n      }\n\n      const pixels = r.arrx(header.width * header.height, ReaderDataType.UByte)\n\n      if (header.alphaType === SpriteAlphaType.SPR_ALPHTEST) {\n        frame.data = paletteWithLastTransToRGBA(pixels, palette)\n      } else {\n        frame.data = paletteToRGBA(pixels, palette)\n      }\n\n      frames.push(frame)\n    }\n\n    return new Sprite(header, frames)\n  }\n}\n","import { h, Component } from 'preact'\nimport { classes } from 'typestyle'\nimport { Game, PlayerMode } from '../../../Game'\nimport { SettingsButtonStyle as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\ninterface SettingsButtonProps {\n  game: Game\n}\n\ninterface SettingsButtonState {\n  isOpen: boolean\n}\n\nexport class SettingsButton extends Component<\n  SettingsButtonProps,\n  SettingsButtonState\n> {\n  onFreeModeClick = () => {\n    if (this.props.game.mode === PlayerMode.FREE) {\n      return\n    }\n\n    this.props.game.changeMode(PlayerMode.FREE)\n    this.props.game.player.pause()\n  }\n\n  onReplayModeClick = () => {\n    if (this.props.game.mode === PlayerMode.REPLAY) {\n      return\n    }\n\n    this.props.game.changeMode(PlayerMode.REPLAY)\n  }\n\n  toggleMenu = () => {\n    this.setState({ isOpen: !this.state.isOpen })\n  }\n\n  render() {\n    const hasReplay = !!this.props.game.player.replay\n\n    return (\n      <div class={s.settings}>\n        <div class={classes(cs.button, s.button)} onClick={this.toggleMenu}>\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              fill=\"#ffffff\"\n              d=\"M23.9 10.7c0-0.3-0.4-0.6-0.8-0.6 -1.1 0-2.1-0.6-2.5-1.6 -0.4-1-0.1-2.2 0.7-3 0.3-0.2 0.3-0.6 0.1-0.9 -0.6-0.7-1.2-1.4-1.9-1.9 -0.3-0.2-0.7-0.2-0.9 0.1 -0.7 0.8-2 1.1-3 0.7 -1-0.4-1.7-1.5-1.6-2.6 0-0.4-0.2-0.7-0.6-0.7 -0.9-0.1-1.8-0.1-2.7 0C10.4 0.1 10.1 0.4 10.1 0.8 10.1 1.9 9.5 2.9 8.5 3.3 7.5 3.7 6.2 3.4 5.5 2.6c-0.2-0.3-0.6-0.3-0.9-0.1 -0.7 0.6-1.4 1.2-1.9 1.9C2.4 4.8 2.5 5.2 2.7 5.4c0.8 0.8 1.1 2 0.7 3 -0.4 1-1.4 1.6-2.6 1.6 -0.4 0-0.7 0.2-0.7 0.6 -0.1 0.9-0.1 1.8 0 2.7 0 0.3 0.4 0.6 0.8 0.6 1 0 2 0.6 2.5 1.6 0.4 1 0.2 2.2-0.7 3 -0.3 0.2-0.3 0.6-0.1 0.9 0.6 0.7 1.2 1.4 1.9 1.9 0.3 0.2 0.7 0.2 0.9-0.1 0.7-0.8 2-1.1 3-0.7 1 0.4 1.7 1.5 1.6 2.6 0 0.4 0.2 0.7 0.6 0.7C11.1 24 11.5 24 12 24c0.4 0 0.9 0 1.3-0.1 0.3 0 0.6-0.3 0.6-0.7 0-1.1 0.6-2.1 1.6-2.6 1-0.4 2.3-0.1 3 0.7 0.2 0.3 0.6 0.3 0.9 0.1 0.7-0.6 1.4-1.2 1.9-1.9 0.2-0.3 0.2-0.7-0.1-0.9 -0.8-0.8-1.1-2-0.7-3 0.4-1 1.4-1.6 2.5-1.6l0.1 0c0.3 0 0.7-0.2 0.7-0.6C24 12.5 24 11.6 23.9 10.7zM12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6c3.3 0 6 2.7 6 6S15.3 18 12 18zM12 16\"\n            />\n          </svg>\n        </div>\n\n        <div class={this.state.isOpen ? s.menuOpen : s.menu}>\n          <span class={s.menuItemTitle}>Mode</span>\n          {hasReplay ? (\n            <span\n              class={\n                this.props.game.mode === PlayerMode.REPLAY\n                  ? s.menuItemSelected\n                  : s.menuItem\n              }\n              onClick={this.onReplayModeClick}\n            >\n              Replay\n            </span>\n          ) : (\n            <span />\n          )}\n          <span\n            class={\n              this.props.game.mode === PlayerMode.FREE\n                ? s.menuItemSelected\n                : s.menuItem\n            }\n            onClick={this.onFreeModeClick}\n          >\n            Free\n          </span>\n        </div>\n      </div>\n    )\n  }\n}\n","import { h, Component } from 'preact'\nimport { classes } from 'typestyle'\nimport { Fullscreen } from '../../../Fullscreen'\nimport { FullscreenButtonStyle as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\ninterface FullscreenButtonProps {\n  active: boolean\n  root: Element\n}\n\ninterface FullscreenButtonState {\n  isInFullscreen: boolean\n}\n\nexport class FullscreenButton extends Component<\n  FullscreenButtonProps,\n  FullscreenButtonState\n> {\n  state: FullscreenButtonState = {\n    isInFullscreen: false\n  }\n\n  componentDidMount() {\n    Fullscreen.onChange(this.onFullscreen)\n  }\n\n  componentWillUnmount() {\n    Fullscreen.onChangeRemove(this.onFullscreen)\n  }\n\n  onClick = () => {\n    if (Fullscreen.isInFullscreen()) {\n      Fullscreen.exit()\n    } else {\n      Fullscreen.enter(this.props.root)\n    }\n  }\n\n  onFullscreen = () => {\n    this.setState({\n      isInFullscreen: Fullscreen.isInFullscreen()\n    })\n  }\n\n  render() {\n    return (\n      <div class={classes(cs.button, s.button)} onClick={this.onClick}>\n        {this.state.isInFullscreen ? (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 64 64\"\n            fill=\"currentcolor\"\n          >\n            <path d=\"M0 22 L22 22 L22 0 L14 0 L14 14 L0 14 M42 0 L42 22 L64 22 L64 14 L50 14 L50 0 M14 50 L0 50 L0 42 L22 42 L22 64 L14 64 M42 64 L42 42 L64 42 L64 50 L50 50 L50 64 Z\" />\n          </svg>\n        ) : (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 64 64\"\n            fill=\"currentcolor\"\n          >\n            <path d=\"M0 22 L8 22 L8 8 L22 8 L22 0 L0 0 M42 0 L42 8 L56 8 L56 22 L64 22 L64 0 M0 64 L0 42 L8 42 L8 56 L22 56 L22 64 M64 64 L42 64 L42 56 L56 56 L56 42 L64 42 Z\" />\n          </svg>\n        )}\n      </div>\n    )\n  }\n}\n","const apis = [\r\n  {\r\n    enabled: 'fullscreenEnabled',\r\n    element: 'fullscreenElement',\r\n    request: 'requestFullscreen',\r\n    exit: 'exitFullscreen',\r\n    change: 'fullscreenchange',\r\n    error: 'fullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'mozFullScreenEnabled',\r\n    element: 'mozFullScreenElement',\r\n    request: 'mozRequestFullScreen',\r\n    exit: 'mozCancelFullScreen',\r\n    change: 'mozfullscreenchange',\r\n    error: 'mozfullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'webkitFullscreenEnabled',\r\n    element: 'webkitCurrentFullScreenElement',\r\n    request: 'webkitRequestFullscreen',\r\n    exit: 'webkitExitFullscreen',\r\n    change: 'webkitfullscreenchange',\r\n    error: 'webkitfullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'msFullscreenEnabled',\r\n    element: 'msFullscreenElement',\r\n    request: 'msRequestFullscreen',\r\n    exit: 'msExitFullscreen',\r\n    change: 'MSFullscreenChange',\r\n    error: 'MSFullscreenError'\r\n  }\r\n]\r\n\r\nlet apiIdx = 0\r\n\r\ninterface Doc {\r\n  [key: string]: any\r\n}\r\nconst doc: Doc = document\r\n\r\nfor (let i = 0; i < apis.length; ++i) {\r\n  if (typeof doc[apis[i].enabled] !== 'undefined') {\r\n    apiIdx = i\r\n    break\r\n  }\r\n}\r\n\r\nclass Fullscreen {\r\n  static element() {\r\n    return doc[apis[apiIdx].element]\r\n  }\r\n\r\n  static enabled() {\r\n    return doc[apis[apiIdx].enabled]\r\n  }\r\n\r\n  static isInFullscreen() {\r\n    return Fullscreen.element() !== null\r\n  }\r\n\r\n  static enter(node: any) {\r\n    node[apis[apiIdx].request]()\r\n  }\r\n\r\n  static exit() {\r\n    doc[apis[apiIdx].exit]()\r\n  }\r\n\r\n  static onChange(callback: () => void) {\r\n    return window.addEventListener(apis[apiIdx].change, callback)\r\n  }\r\n\r\n  static onChangeRemove(callback: () => void) {\r\n    window.removeEventListener(apis[apiIdx].change, callback)\r\n  }\r\n\r\n  static onError(callback: () => void) {\r\n    return window.addEventListener(apis[apiIdx].error, callback)\r\n  }\r\n}\r\n\r\nexport { Fullscreen }\r\n","import { Game } from './Game'\r\nimport { Config } from './Config'\r\nimport { PlayerInterface } from './PlayerInterface/index'\r\n\r\ndeclare var VERSION: string\r\n\r\nexport = class HLViewer {\r\n  static readonly VERSION = VERSION\r\n\r\n  game: Game\r\n  interface: PlayerInterface\r\n\r\n  constructor(rootSelector: string, params: Config | string) {\r\n    const config = Config.init(params)\r\n    this.game = new Game(config)\r\n    this.interface = new PlayerInterface(this.game)\r\n    this.interface.draw(rootSelector)\r\n    this.game.draw()\r\n  }\r\n\r\n  load(name: string) {\r\n    this.game.load(name)\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this.game.setTitle(title)\r\n  }\r\n\r\n  getTitle() {\r\n    return this.game.getTitle()\r\n  }\r\n}\r\n","import { Vector2 } from './Vector'\r\n\r\nexport class Mouse {\r\n  click: boolean\r\n  leftClick: boolean\r\n  rightClick: boolean\r\n  position: Vector2\r\n  delta: Vector2\r\n\r\n  constructor() {\r\n    this.click = false\r\n    this.leftClick = false\r\n    this.rightClick = false\r\n    this.position = new Vector2()\r\n    this.delta = new Vector2()\r\n  }\r\n}\r\n","export class Vector2 {\r\n  x: number\r\n  y: number\r\n\r\n  constructor() {\r\n    this.x = 0\r\n    this.y = 0\r\n  }\r\n}\r\n\r\nexport class Vector3 {\r\n  x: number\r\n  y: number\r\n  z: number\r\n\r\n  constructor() {\r\n    this.x = 0\r\n    this.y = 0\r\n    this.z = 0\r\n  }\r\n}\r\n","import { EventEmitter } from 'events'\nimport * as Path from 'path'\nimport { Game } from './Game'\nimport { Bsp } from './Bsp'\nimport { BspParser } from './Parsers/BspParser'\nimport { Replay } from './Replay'\nimport { Sound } from './Sound'\nimport { Tga } from './Parsers/Tga'\nimport { Wad } from './Parsers/Wad'\nimport { ProgressCallback, xhr } from './Xhr'\nimport { Sprite } from './Parsers/Sprite'\n\nenum LoadItemStatus {\n  Loading = 1,\n  Skipped = 2,\n  Error = 3,\n  Done = 4\n}\n\nclass LoadItemBase<T> {\n  name: string\n  progress: number\n  status: LoadItemStatus\n  data: T | null\n\n  constructor(name: string) {\n    this.name = name\n    this.progress = 0\n    this.status = LoadItemStatus.Loading\n    this.data = null\n  }\n\n  isLoading() {\n    return this.status === LoadItemStatus.Loading\n  }\n\n  skip() {\n    this.status = LoadItemStatus.Skipped\n  }\n\n  isSkipped() {\n    return this.status === LoadItemStatus.Skipped\n  }\n\n  // TODO: Add error reason\n  error() {\n    this.status = LoadItemStatus.Error\n  }\n\n  isError() {\n    return this.status === LoadItemStatus.Error\n  }\n\n  done(data: T) {\n    this.status = LoadItemStatus.Done\n    this.data = data\n  }\n\n  isDone() {\n    return this.status === LoadItemStatus.Done\n  }\n}\n\nclass LoadItemReplay extends LoadItemBase<any> {\n  type: 'replay' = 'replay'\n}\n\nclass LoadItemBsp extends LoadItemBase<Bsp> {\n  type: 'bsp' = 'bsp'\n}\n\nclass LoadItemSky extends LoadItemBase<Tga> {\n  type: 'sky' = 'sky'\n}\n\nclass LoadItemWad extends LoadItemBase<Wad> {\n  type: 'wad' = 'wad'\n}\n\nclass LoadItemSound extends LoadItemBase<Sound> {\n  type: 'sound' = 'sound'\n}\n\nclass LoadItemSprite extends LoadItemBase<Sprite> {\n  type: 'sprite' = 'sprite'\n}\n\nexport type LoadItem =\n  | LoadItemReplay\n  | LoadItemBsp\n  | LoadItemSky\n  | LoadItemWad\n  | LoadItemSound\n  | LoadItemSprite\n\nclass Loader {\n  game: Game\n\n  replay?: LoadItemReplay\n  map?: LoadItemBsp\n  skies: LoadItemSky[]\n  wads: LoadItemWad[]\n  sounds: LoadItemSound[]\n  sprites: { [name: string]: LoadItemSprite } = {}\n  events: EventEmitter\n\n  constructor(game: Game) {\n    this.game = game\n\n    this.replay = undefined\n    this.map = undefined\n    this.skies = []\n    this.wads = []\n    this.sounds = []\n\n    this.events = new EventEmitter()\n    this.events.addListener('error', (err: any) => {\n      console.error(err)\n    })\n  }\n\n  clear() {\n    this.replay = undefined\n    this.map = undefined\n    this.skies.length = 0\n    this.wads.length = 0\n    this.sounds.length = 0\n    this.sprites = {}\n  }\n\n  checkStatus() {\n    if (this.replay && !this.replay.isDone()) {\n      return\n    }\n\n    if (this.map && !this.map.isDone()) {\n      return\n    }\n\n    for (let i = 0; i < this.skies.length; ++i) {\n      if (this.skies[i].isLoading()) {\n        return\n      }\n    }\n\n    for (let i = 0; i < this.wads.length; ++i) {\n      if (this.wads[i].isLoading()) {\n        return\n      }\n    }\n\n    for (let i = 0; i < this.sounds.length; ++i) {\n      if (this.sounds[i].isLoading()) {\n        return\n      }\n    }\n\n    const sprites = Object.entries(this.sprites)\n    for (let i = 0; i < sprites.length; ++i) {\n      if (sprites[i][1].isLoading()) {\n        return\n      }\n    }\n\n    this.events.emit('loadall', this)\n  }\n\n  load(name: string) {\n    const extension = Path.extname(name)\n    if (extension === '.dem') {\n      this.loadReplay(name)\n    } else if (extension === '.bsp') {\n      this.loadMap(name)\n    } else {\n      this.events.emit('error', 'Invalid file extension', name)\n    }\n  }\n\n  async loadReplay(name: string) {\n    this.replay = new LoadItemReplay(name)\n    this.events.emit('loadstart', this.replay)\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      if (this.replay) {\n        this.replay.progress = progress\n      }\n\n      this.events.emit('progress', this.replay)\n    }\n\n    const replayPath = this.game.config.getReplaysPath()\n    const buffer = await xhr(`${replayPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      if (this.replay) {\n        this.replay.error()\n      }\n      this.events.emit('error', err, this.replay)\n    })\n\n    if (this.replay.isError()) {\n      return\n    }\n\n    const replay = await Replay.parseIntoChunks(buffer)\n    this.replay.done(replay)\n\n    this.loadMap(replay.maps[0].name + '.bsp')\n\n    const sounds = replay.maps[0].resources.sounds\n    sounds.forEach((sound: any) => {\n      if (sound.used) {\n        this.loadSound(sound.name, sound.index)\n      }\n    })\n\n    this.events.emit('load', this.replay)\n    this.checkStatus()\n  }\n\n  async loadMap(name: string) {\n    this.map = new LoadItemBsp(name)\n    this.events.emit('loadstart', this.map)\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      if (this.map) {\n        this.map.progress = progress\n      }\n\n      this.events.emit('progress', this.map)\n    }\n\n    const mapsPath = this.game.config.getMapsPath()\n    const buffer = await xhr(`${mapsPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch(err => {\n      if (this.map) {\n        this.map.error()\n      }\n\n      this.events.emit('error', err, this.map)\n    })\n\n    if (this.map.isError()) {\n      return\n    }\n\n    const map = await BspParser.parse(name, buffer)\n    this.map.done(map)\n\n    map.entities\n      .map((e: any) => {\n        if (typeof e.model === 'string' && e.model.indexOf('.spr') > -1) {\n          return e.model as string\n        }\n        return undefined\n      })\n      .filter(\n        (a: string | undefined, pos: number, arr: (string | undefined)[]) =>\n          a && arr.indexOf(a) === pos\n      )\n      .forEach((a: string) => this.loadSprite(a))\n\n    const skyname = map.entities[0].skyname\n    if (skyname) {\n      const sides =  ['bk', 'dn', 'ft', 'lf', 'rt', 'up']\n      sides\n        .map(a => `${skyname}${a}`)\n        .forEach(a => this.loadSky(a))\n    }\n\n    // check if there is at least one missing texture\n    // if yes then load wad files (textures should be there)\n    if (map.textures.find(a => a.isExternal)) {\n      const wads = map.entities[0].wad\n      const wadPromises = wads.map((w: string) => this.loadWad(w))\n      await Promise.all(wadPromises)\n    }\n\n    this.events.emit('load', this.map)\n    this.checkStatus()\n  }\n\n  async loadSprite(name: string) {\n    const item = new LoadItemSprite(name)\n    this.sprites[name] = item\n    this.events.emit('loadstart', item)\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      item.progress = progress\n      this.events.emit('progress', item)\n    }\n\n    const buffer = await xhr(`${this.game.config.getBasePath()}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      item.error()\n      this.events.emit('error', err, item)\n      this.checkStatus()\n    })\n\n    if (item.isError()) {\n      return\n    }\n\n    const sprite = Sprite.parse(buffer)\n    item.done(sprite)\n    this.events.emit('load', item)\n    this.checkStatus()\n  }\n\n  async loadSky(name: string) {\n    const item = new LoadItemSky(name)\n    this.skies.push(item)\n    this.events.emit('loadstart', item)\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      item.progress = progress\n      this.events.emit('progress', item)\n    }\n\n    const skiesPath = this.game.config.getSkiesPath()\n    const buffer = await xhr(`${skiesPath}/${name}.tga`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      item.error()\n      this.events.emit('error', err, item)\n      this.checkStatus()\n    })\n\n    if (item.isError()) {\n      return\n    }\n\n    const skyImage = Tga.parse(buffer, name)\n    item.done(skyImage)\n    this.events.emit('load', item)\n    this.checkStatus()\n  }\n\n  async loadWad(name: string) {\n    const wadItem = new LoadItemWad(name)\n    this.wads.push(wadItem)\n    this.events.emit('loadstart', wadItem)\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      wadItem.progress = progress\n      this.events.emit('progress', wadItem)\n    }\n\n    const wadsPath = this.game.config.getWadsPath()\n    const buffer = await xhr(`${wadsPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      wadItem.error()\n      this.events.emit('error', err, wadItem)\n      this.checkStatus()\n    })\n\n    if (wadItem.isError()) {\n      return\n    }\n\n    const wad = await Wad.parse(buffer)\n    wadItem.done(wad)\n\n    if (!this.map || !this.map.data) {\n      return\n    }\n\n    const map = this.map.data\n    const cmp = (a: any, b: any) => a.toLowerCase() === b.toLowerCase()\n    wad.entries.forEach(entry => {\n      if (entry.type !== 'texture') {\n        return\n      }\n\n      map.textures.forEach(texture => {\n        if (cmp(entry.name, texture.name)) {\n          texture.width = entry.width\n          texture.height = entry.height\n          texture.data = entry.data\n        }\n      })\n    })\n\n    this.events.emit('load', wadItem)\n    this.checkStatus()\n  }\n\n  async loadSound(name: string, index: number) {\n    const sound = new LoadItemSound(name)\n    this.sounds.push(sound)\n    this.events.emit('loadstart', sound)\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      sound.progress = progress\n      this.events.emit('progress', sound)\n    }\n\n    const soundsPath = this.game.config.getSoundsPath()\n    const buffer = await xhr(`${soundsPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      sound.error()\n      this.events.emit('error', err, sound)\n      this.checkStatus()\n    })\n\n    if (sound.isError()) {\n      return\n    }\n\n    const data = await Sound.create(buffer).catch((err: any) => {\n      sound.error()\n      this.events.emit('error', err, sound)\n      this.checkStatus()\n    })\n\n    if (!data || sound.isError()) {\n      return\n    }\n\n    data.index = index\n    data.name = name\n    sound.done(data)\n    this.events.emit('load', sound)\n    this.checkStatus()\n  }\n\n  addLoadStartListener(listener: (item: LoadItem) => void) {\n    this.events.addListener('loadstart', listener)\n  }\n\n  removeLoadStartListener(listener: (item: LoadItem) => void) {\n    this.events.removeListener('loadstart', listener)\n  }\n\n  addProgressListener(listener: (item: LoadItem) => void) {\n    this.events.addListener('progress', listener)\n  }\n\n  removeProgressListener(listener: (item: LoadItem) => void) {\n    this.events.removeListener('progress', listener)\n  }\n}\n\nexport { Loader }\n","import * as Path from 'path'\nimport { vdf } from '../Parsers/Vdf'\nimport { Reader, ReaderDataType } from '../Reader'\nimport { BspLightmapParser } from '../Parsers/BspLightmapParser'\nimport { paletteWithLastTransToRGBA, paletteToRGBA } from './Util'\nimport { BspTexture, Bsp } from '../Bsp'\n\nexport function parseModels(\n  models: BspLumpModel[],\n  faces: BspLumpFace[],\n  edges: BspLumpEdge[],\n  surfEdges: BspLumpSurfedge[],\n  vertices: BspLumpVertex[],\n  texinfo: BspLumpTexInfo[],\n  textures: BspTexture[],\n  lightmap: BspLightmapParser\n) {\n  const parsedModels = []\n\n  for (let i = 0; i < models.length; ++i) {\n    const model = models[i]\n\n    const _faces: {\n      buffer: Float32Array\n      textureIndex: number\n    }[] = []\n\n    const v0 = new Float32Array(3)\n    const v1 = new Float32Array(3)\n    const v2 = new Float32Array(3)\n    const uv0 = new Float32Array(2)\n    const uv1 = new Float32Array(2)\n    const uv2 = new Float32Array(2)\n    const luv0 = new Float32Array(2)\n    const luv1 = new Float32Array(2)\n    const luv2 = new Float32Array(2)\n\n    let origin =\n      i === 0\n        ? [0, 0, 0]\n        : [0, 0, 0].map(\n            (_, i) => (model.maxs[i] - model.mins[i]) / 2 + model.mins[i]\n          )\n\n    for (let i = model.firstFace; i < model.firstFace + model.faceCount; ++i) {\n      const faceData = {\n        // 3 floats vertices | 2 floats uvs | 2 floats luvs\n        buffer: new Float32Array((faces[i].edgeCount - 2) * 21),\n        textureIndex: -1\n      }\n\n      const faceTexInfo = texinfo[faces[i].textureInfo]\n      const faceTexture = textures[faceTexInfo.textureIndex]\n      const faceSurfEdges = surfEdges.slice(\n        faces[i].firstEdge,\n        faces[i].firstEdge + faces[i].edgeCount\n      )\n\n      const v0idx =\n        edges[Math.abs(faceSurfEdges[0])][faceSurfEdges[0] > 0 ? 0 : 1]\n      v0[0] = vertices[v0idx][0]\n      v0[1] = vertices[v0idx][1]\n      v0[2] = vertices[v0idx][2]\n\n      uv0[0] =\n        v0[0] * faceTexInfo.s[0] +\n        v0[1] * faceTexInfo.s[1] +\n        v0[2] * faceTexInfo.s[2] +\n        faceTexInfo.sShift\n      uv0[1] =\n        v0[0] * faceTexInfo.t[0] +\n        v0[1] * faceTexInfo.t[1] +\n        v0[2] * faceTexInfo.t[2] +\n        faceTexInfo.tShift\n\n      luv0[0] = 0\n      luv0[1] = 0\n\n      const v1idx =\n        edges[Math.abs(faceSurfEdges[1])][faceSurfEdges[1] > 0 ? 0 : 1]\n      v1[0] = vertices[v1idx][0]\n      v1[1] = vertices[v1idx][1]\n      v1[2] = vertices[v1idx][2]\n\n      uv1[0] =\n        v1[0] * faceTexInfo.s[0] +\n        v1[1] * faceTexInfo.s[1] +\n        v1[2] * faceTexInfo.s[2] +\n        faceTexInfo.sShift\n      uv1[1] =\n        v1[0] * faceTexInfo.t[0] +\n        v1[1] * faceTexInfo.t[1] +\n        v1[2] * faceTexInfo.t[2] +\n        faceTexInfo.tShift\n      luv1[0] = 0\n      luv1[1] = 0.999\n\n      let compIndex = 0\n      for (let j = 2; j < faces[i].edgeCount; ++j) {\n        const v2idx =\n          edges[Math.abs(faceSurfEdges[j])][faceSurfEdges[j] > 0 ? 0 : 1]\n        v2[0] = vertices[v2idx][0]\n        v2[1] = vertices[v2idx][1]\n        v2[2] = vertices[v2idx][2]\n        uv2[0] =\n          v2[0] * faceTexInfo.s[0] +\n          v2[1] * faceTexInfo.s[1] +\n          v2[2] * faceTexInfo.s[2] +\n          faceTexInfo.sShift\n        uv2[1] =\n          v2[0] * faceTexInfo.t[0] +\n          v2[1] * faceTexInfo.t[1] +\n          v2[2] * faceTexInfo.t[2] +\n          faceTexInfo.tShift\n        luv2[0] = 0.999\n        luv2[1] = 0.999\n\n        // vert1: coord, uv and luv\n        faceData.buffer[compIndex++] = v0[0]\n        faceData.buffer[compIndex++] = v0[1]\n        faceData.buffer[compIndex++] = v0[2]\n        faceData.buffer[compIndex++] = uv0[0]\n        faceData.buffer[compIndex++] = uv0[1]\n        faceData.buffer[compIndex++] = luv0[0]\n        faceData.buffer[compIndex++] = luv0[1]\n\n        // vert2\n        faceData.buffer[compIndex++] = v1[0]\n        faceData.buffer[compIndex++] = v1[1]\n        faceData.buffer[compIndex++] = v1[2]\n        faceData.buffer[compIndex++] = uv1[0]\n        faceData.buffer[compIndex++] = uv1[1]\n        faceData.buffer[compIndex++] = luv1[0]\n        faceData.buffer[compIndex++] = luv1[1]\n\n        // vert2\n        faceData.buffer[compIndex++] = v2[0]\n        faceData.buffer[compIndex++] = v2[1]\n        faceData.buffer[compIndex++] = v2[2]\n        faceData.buffer[compIndex++] = uv2[0]\n        faceData.buffer[compIndex++] = uv2[1]\n        faceData.buffer[compIndex++] = luv2[0]\n        faceData.buffer[compIndex++] = luv2[1]\n\n        v1[0] = v2[0]\n        v1[1] = v2[1]\n        v1[2] = v2[2]\n        uv1[0] = uv2[0]\n        uv1[1] = uv2[1]\n        luv1[0] = luv2[0]\n        luv1[1] = luv2[1]\n      }\n\n      // face has a lightmap if flag is equal to 0\n      if (faceTexInfo.flags === 0 || faceTexInfo.flags === -65536) {\n        lightmap.processFace(\n          faceData.buffer,\n          faceTexInfo,\n          faces[i].lightmapOffset\n        )\n      }\n\n      faceData.textureIndex = faceTexInfo.textureIndex\n\n      for (let j = 0; j < faceData.buffer.length / 7; ++j) {\n        faceData.buffer[j * 7] -= origin[0]\n        faceData.buffer[j * 7 + 1] -= origin[1]\n        faceData.buffer[j * 7 + 2] -= origin[2]\n        faceData.buffer[j * 7 + 3] /= faceTexture.width\n        faceData.buffer[j * 7 + 4] /= faceTexture.height\n      }\n\n      _faces.push(faceData)\n    }\n\n    parsedModels.push({\n      origin,\n      faces: _faces\n    })\n  }\n\n  return parsedModels\n}\n\nexport enum BspLumpIndex {\n  Entities = 0,\n  Planes = 1,\n  Textures = 2,\n  Vertices = 3,\n  Visibility = 4,\n  Nodes = 5,\n  TexInfo = 6,\n  Faces = 7,\n  Lighting = 8,\n  ClipNodes = 9,\n  Leaves = 10,\n  MarkSurfaces = 11,\n  Edges = 12,\n  SurfEdges = 13,\n  Models = 14\n}\n\ninterface BspLump {\n  offset: number\n  length: number\n}\n\nexport interface BspLumpFace {\n  plane: number\n  planeSide: number\n  firstEdge: number\n  edgeCount: number\n  textureInfo: number\n  styles: number[]\n  lightmapOffset: number\n}\n\nexport interface BspLumpModel {\n  mins: number[]\n  maxs: number[]\n  origin: number[]\n  headNodes: number[]\n  visLeaves: number\n  firstFace: number\n  faceCount: number\n}\n\nexport type BspLumpEdge = number[]\n\nexport type BspLumpSurfedge = number\n\nexport type BspLumpVertex = number[]\n\nexport interface BspLumpTexInfo {\n  s: number[]\n  sShift: number\n  t: number[]\n  tShift: number\n  textureIndex: number\n  flags: number\n}\n\nexport type BspLumpLightmap = Uint8Array\n\nexport class BspParser {\n  static parse(name: string, buffer: ArrayBuffer): Bsp {\n    const r = new Reader(buffer)\n    const version = r.ui()\n    if (version !== 30) {\n      throw new Error('Invalid map version')\n    }\n\n    const lumps: BspLump[] = []\n    for (let i = 0; i < 15; ++i) {\n      lumps.push({\n        offset: r.ui(),\n        length: r.ui()\n      })\n    }\n\n    const entities = this.loadEntities(\n      r,\n      lumps[BspLumpIndex.Entities].offset,\n      lumps[BspLumpIndex.Entities].length\n    )\n\n    const textures = this.loadTextures(r, lumps[BspLumpIndex.Textures].offset)\n\n    const models = this.loadModels(\n      r,\n      lumps[BspLumpIndex.Models].offset,\n      lumps[BspLumpIndex.Models].length\n    )\n\n    const faces = this.loadFaces(\n      r,\n      lumps[BspLumpIndex.Faces].offset,\n      lumps[BspLumpIndex.Faces].length\n    )\n\n    const edges = this.loadEdges(\n      r,\n      lumps[BspLumpIndex.Edges].offset,\n      lumps[BspLumpIndex.Edges].length\n    )\n\n    const surfEdges = this.loadSurfEdges(\n      r,\n      lumps[BspLumpIndex.SurfEdges].offset,\n      lumps[BspLumpIndex.SurfEdges].length\n    )\n\n    const vertices = this.loadVertices(\n      r,\n      lumps[BspLumpIndex.Vertices].offset,\n      lumps[BspLumpIndex.Vertices].length\n    )\n\n    const texinfo = this.loadTexInfo(\n      r,\n      lumps[BspLumpIndex.TexInfo].offset,\n      lumps[BspLumpIndex.TexInfo].length\n    )\n\n    const lightmap = this.loadLightmap(\n      r,\n      lumps[BspLumpIndex.Lighting].offset,\n      lumps[BspLumpIndex.Lighting].length\n    )\n\n    const parsedLightmap = BspLightmapParser.init(lightmap)\n\n    const parsedModels = parseModels(\n      models,\n      faces,\n      edges,\n      surfEdges,\n      vertices,\n      texinfo,\n      textures,\n      parsedLightmap\n    )\n\n    return new Bsp(name, entities, textures, parsedModels, {\n      width: BspLightmapParser.TEXTURE_SIZE,\n      height: BspLightmapParser.TEXTURE_SIZE,\n      data: parsedLightmap.getTexture()\n    })\n  }\n\n  private static loadFaces(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpFace[] {\n    r.seek(offset)\n\n    const faces = []\n    for (let i = 0; i < length / 20; ++i) {\n      faces.push({\n        plane: r.us(),\n        planeSide: r.us(),\n        firstEdge: r.ui(),\n        edgeCount: r.us(),\n        textureInfo: r.us(),\n        styles: [r.ub(), r.ub(), r.ub(), r.ub()],\n        lightmapOffset: r.ui()\n      })\n    }\n    return faces\n  }\n\n  private static loadModels(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpModel[] {\n    r.seek(offset)\n\n    const models = []\n    for (let i = 0; i < length / 64; ++i) {\n      models.push({\n        mins: [r.f(), r.f(), r.f()],\n        maxs: [r.f(), r.f(), r.f()],\n        origin: [r.f(), r.f(), r.f()],\n        headNodes: [r.i(), r.i(), r.i(), r.i()],\n        visLeaves: r.i(),\n        firstFace: r.i(),\n        faceCount: r.i()\n      })\n    }\n    return models\n  }\n\n  private static loadEdges(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpEdge[] {\n    r.seek(offset)\n\n    const edges = []\n    for (let i = 0; i < length / 4; ++i) {\n      edges.push([r.us(), r.us()])\n    }\n    return edges\n  }\n\n  private static loadSurfEdges(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpSurfedge[] {\n    r.seek(offset)\n\n    const surfEdges = []\n    for (let i = 0; i < length / 4; ++i) {\n      surfEdges.push(r.i())\n    }\n    return surfEdges\n  }\n\n  private static loadVertices(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpVertex[] {\n    r.seek(offset)\n\n    const vertices = []\n    for (let i = 0; i < length / 12; ++i) {\n      vertices.push([r.f(), r.f(), r.f()])\n    }\n    return vertices\n  }\n\n  private static loadTexInfo(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpTexInfo[] {\n    r.seek(offset)\n\n    const texinfo: BspLumpTexInfo[] = []\n    for (let i = 0; i < length / 40; ++i) {\n      texinfo.push({\n        s: [r.f(), r.f(), r.f()],\n        sShift: r.f(),\n        t: [r.f(), r.f(), r.f()],\n        tShift: r.f(),\n        textureIndex: r.i(),\n        flags: r.i()\n      })\n    }\n    return texinfo\n  }\n\n  private static loadLightmap(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpLightmap {\n    r.seek(offset)\n    return r.arrx(length, ReaderDataType.UByte)\n  }\n\n  private static loadTextureData(r: Reader) {\n    const name = r.nstr(16)\n    const width = r.ui()\n    const height = r.ui()\n\n    const isExternal = !r.ui() // if mipmap offset == 0\n    if (isExternal) {\n      const data = new Uint8Array(4)\n      data[0] = data[1] = data[2] = data[3] = 255\n\n      return { name, width, height, data, isExternal }\n    } else {\n      r.skip(3 * 4) // skip mipmap offsets\n\n      // read largest mipmap data\n      const pixelCount = width * height\n      const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\n\n      // skip other 3 mipmaps\n      r.skip(21 * (pixelCount / 64))\n\n      r.skip(2) // skip padding bytes\n\n      const palette = r.arrx(768, ReaderDataType.UByte)\n\n      const data =\n        name[0] === '{'\n          ? paletteWithLastTransToRGBA(pixels, palette)\n          : paletteToRGBA(pixels, palette)\n\n      return { name, width, height, data, isExternal }\n    }\n  }\n\n  private static loadTextures(r: Reader, offset: number) {\n    r.seek(offset)\n\n    const count = r.ui()\n    const offsets = []\n    for (let i = 0; i < count; ++i) {\n      offsets.push(r.ui())\n    }\n\n    const textures: BspTexture[] = []\n    for (let i = 0; i < count; ++i) {\n      if (offsets[i] === 0xffffffff) {\n        textures.push({\n          name: 'ERROR404',\n          width: 1,\n          height: 1,\n          data: new Uint8Array([0, 255, 0, 255]),\n          isExternal: false\n        })\n      } else {\n        r.seek(offset + offsets[i])\n        textures.push(this.loadTextureData(r))\n      }\n    }\n\n    return textures\n  }\n\n  private static loadEntities(r: Reader, offset: number, length: number) {\n    r.seek(offset)\n    const entities: any[] = vdf(r.nstr(length)) as any\n\n    const VECTOR_ATTRS = [\n      'origin',\n      'angles',\n      '_diffuse_light',\n      '_light',\n      'rendercolor',\n      'avelocity'\n    ]\n    const NUMBER_ATTRS = ['renderamt', 'rendermode', 'scale']\n\n    const worldSpawn = entities[0]\n    if (worldSpawn.classname === 'worldspawn') {\n      worldSpawn.model = '*0'\n      worldSpawn.wad = worldSpawn.wad || ''\n      worldSpawn.wad = worldSpawn.wad\n        .split(';')\n        .filter((w: string) => w.length)\n        .map((w: string) => w.replace(/\\\\/g, '/'))\n        .map((w: string) => Path.basename(w))\n    }\n\n    entities.forEach(e => {\n      if (e.model) {\n        if (typeof e.renderamt === 'undefined') {\n          e.renderamt = 0\n        }\n\n        if (typeof e.rendermode === 'undefined') {\n          e.rendermode = 0\n        }\n\n        if (typeof e.renderfx === 'undefined') {\n          e.renderfx = 0\n        }\n\n        if (typeof e.rendercolor === 'undefined') {\n          e.rendercolor = '0 0 0'\n        }\n      }\n\n      VECTOR_ATTRS.forEach(attr => {\n        if (e[attr]) {\n          e[attr] = e[attr].split(' ').map((v: string) => Number.parseFloat(v))\n        }\n      })\n\n      NUMBER_ATTRS.forEach(attr => {\n        if (e[attr]) {\n          e[attr] = Number.parseFloat(e[attr])\n        }\n      })\n    })\n\n    return entities\n  }\n}\n","export function vdf(input: string): {[name: string]: any}[] {\r\n  let state = 0\r\n  let key: string = ''\r\n  let val: string = ''\r\n  const objects: any[] = []\r\n\r\n  for (let i = 0; i < input.length; ++i) {\r\n    const c = input[i]\r\n\r\n    switch (state) {\r\n      case 0: {\r\n        // ROOT\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        } else if (c === '{') {\r\n          objects.push({})\r\n          state = 1\r\n        } else {\r\n          return []\r\n        }\r\n        break\r\n      }\r\n\r\n      case 1: {\r\n        // OBJECT\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        } else if (c === '}') {\r\n          state = 0\r\n        } else if (c === '\"') {\r\n          key = ''\r\n          state = 2\r\n        } else {\r\n          return []\r\n        }\r\n        break\r\n      }\r\n\r\n      case 2: {\r\n        // KEY\r\n        if (c === '\"') {\r\n          state = 3\r\n        } else {\r\n          key += c\r\n        }\r\n        break\r\n      }\r\n\r\n      case 3: {\r\n        // BETWEEN KEY AND VALUE\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        } else if (c === '\"') {\r\n          val = ''\r\n          state = 4\r\n        }\r\n        break\r\n      }\r\n\r\n      case 4: {\r\n        // VALUE\r\n        if (c === '\"') {\r\n          objects[objects.length - 1][key] = val\r\n          state = 1\r\n        } else {\r\n          val += c\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  return objects\r\n}\r\n","export interface BspLightmapNode {\n  children: BspLightmapNode[]\n  isFilled: boolean\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\nexport class BspLightmapParser {\n  static TEXTURE_SIZE = 1024\n\n  static init(lightmap: Uint8Array) {\n    return new BspLightmapParser(lightmap)\n  }\n\n  private lightmap: Uint8Array // entire lightmap of the bsp map\n  private texture: Uint8Array\n  private block = new Uint16Array(BspLightmapParser.TEXTURE_SIZE)\n\n  private constructor(lightmap: Uint8Array) {\n    this.lightmap = lightmap\n\n    this.texture = new Uint8Array(\n      BspLightmapParser.TEXTURE_SIZE * BspLightmapParser.TEXTURE_SIZE * 4\n    )\n    this.texture[this.texture.length - 4] = 255\n    this.texture[this.texture.length - 3] = 255\n    this.texture[this.texture.length - 2] = 255\n    this.texture[this.texture.length - 1] = 255\n  }\n\n  getTexture() {\n    return this.texture\n  }\n\n  processFace(\n    faceData: Float32Array,\n    texinfo: {\n      // TODO: MapTexInfo interface\n      s: number[]\n      sShift: number\n      t: number[]\n      tShift: number\n      textureIndex: number\n      flags: number\n    },\n    offset: number\n  ) {\n    const size = this.getDimensions(faceData)\n    const rect = this.readLightmap(offset, size.width, size.height)\n    if (rect) {\n      // Determine the correct TexCoords for the lightmap (I think this bit is bugged too)\n      for (let i = 0; i < faceData.length / 7; ++i) {\n        let lu =\n          faceData[i * 7] * texinfo.s[0] +\n          faceData[i * 7 + 1] * texinfo.s[1] +\n          faceData[i * 7 + 2] * texinfo.s[2] +\n          texinfo.sShift -\n          size.minU\n        lu += rect.x * 16 + 8\n        lu /= BspLightmapParser.TEXTURE_SIZE * 16\n\n        let lv =\n          faceData[i * 7] * texinfo.t[0] +\n          faceData[i * 7 + 1] * texinfo.t[1] +\n          faceData[i * 7 + 2] * texinfo.t[2] +\n          texinfo.tShift -\n          size.minV\n        lv += rect.y * 16 + 8\n        lv /= BspLightmapParser.TEXTURE_SIZE * 16\n\n        faceData[i * 7 + 5] = lu\n        faceData[i * 7 + 6] = lv\n      }\n    }\n  }\n\n  private getDimensions(faceData: Float32Array) {\n    // find the min and max UV's for a face\n    let minU = Math.floor(faceData[3])\n    let minV = Math.floor(faceData[4])\n    let maxU = Math.floor(faceData[3])\n    let maxV = Math.floor(faceData[4])\n\n    for (let i = 1; i < faceData.length / 7; ++i) {\n      if (Math.floor(faceData[i * 7 + 3]) < minU) {\n        minU = Math.floor(faceData[i * 7 + 3])\n      }\n      if (Math.floor(faceData[i * 7 + 4]) < minV) {\n        minV = Math.floor(faceData[i * 7 + 4])\n      }\n      if (Math.floor(faceData[i * 7 + 3]) > maxU) {\n        maxU = Math.floor(faceData[i * 7 + 3])\n      }\n      if (Math.floor(faceData[i * 7 + 4]) > maxV) {\n        maxV = Math.floor(faceData[i * 7 + 4])\n      }\n    }\n\n    // calculate the lightmap dimensions\n    return {\n      width: Math.ceil(maxU / 16) - Math.floor(minU / 16) + 1,\n      height: Math.ceil(maxV / 16) - Math.floor(minV / 16) + 1,\n      minU: Math.floor(minU),\n      minV: Math.floor(minV)\n    }\n  }\n\n  private readLightmap(\n    offset: number,\n    width: number,\n    height: number\n  ): {x: number, y: number} | null {\n    if (height <= 0 || width <= 0) {\n      return null\n    }\n\n    const block = this.findFreeSpace(width, height)\n\n    if (block) {\n      const o = [block.x, block.y]\n      const s = [width, height]\n      const d = [BspLightmapParser.TEXTURE_SIZE, BspLightmapParser.TEXTURE_SIZE]\n      const count = width * height\n      for (let i = 0; i < count; ++i) {\n        const p = o[1] * d[0] + o[0] + d[0] * Math.floor(i / s[0]) + (i % s[0])\n        this.texture[p * 4] = Math.min(255, this.lightmap[offset + i * 3] * 2)\n        this.texture[p * 4 + 1] = Math.min(\n          255,\n          this.lightmap[offset + i * 3 + 1] * 2\n        )\n        this.texture[p * 4 + 2] = Math.min(\n          255,\n          this.lightmap[offset + i * 3 + 2] * 2\n        )\n        this.texture[p * 4 + 3] = 255\n      }\n    }\n\n    return block\n  }\n\n  private findFreeSpace(w: number, h: number): { x: number; y: number } | null {\n    let x = 0\n    let y = 0\n\n    let bestHeight = BspLightmapParser.TEXTURE_SIZE\n    for (let i = 0; i < this.block.length - w; ++i) {\n      let tentativeHeight = 0\n\n      let j\n      for (j = 0; j < w; ++j) {\n        if (this.block[i + j] >= bestHeight) {\n          break\n        }\n        if (this.block[i + j] > tentativeHeight) {\n          tentativeHeight = this.block[i + j]\n        }\n      }\n\n      if (j === w) {\n        x = i\n        y = bestHeight = tentativeHeight\n      }\n    }\n\n    if (bestHeight + h > BspLightmapParser.TEXTURE_SIZE) {\n      return null\n    }\n\n    for (let i = 0; i < w; ++i) {\n      this.block[x + i] = bestHeight + h\n    }\n\n    return { x, y }\n  }\n}\n","import { Tga } from './Parsers/Tga'\nimport { Sprite } from './Parsers/Sprite'\nimport { BspLightmap } from './BspLightmap'\n\nexport interface BspTexture {\n  name: string\n  width: number\n  height: number\n  data: Uint8Array\n  isExternal: boolean\n}\n\nexport interface BspModel {\n  origin: number[]\n  faces: {\n    buffer: Float32Array\n    textureIndex: number\n  }[]\n}\n\nexport class Bsp {\n  name: string\n  entities: any[]\n  textures: BspTexture[]\n  models: BspModel[]\n  lightmap: BspLightmap\n  skies: Tga[] = []\n  sprites: { [name: string]: Sprite } = {}\n\n  constructor(\n    name: string,\n    entities: any[],\n    textures: BspTexture[],\n    models: BspModel[],\n    lightmap: BspLightmap\n  ) {\n    this.name = name\n    this.entities = entities\n    this.textures = textures\n    this.models = models\n    this.lightmap = lightmap\n  }\n}\n","class BitView {\r\n  static scratch = new DataView(new ArrayBuffer(8))\r\n\r\n  private view: Uint8Array\r\n\r\n  constructor(buffer: ArrayBuffer) {\r\n    this.view = new Uint8Array(buffer, 0, buffer.byteLength)\r\n  }\r\n\r\n  getBits(offset: number, bits: number, signed = false) {\r\n    const available = this.view.length * 8 - offset\r\n\r\n    if (bits > available) {\r\n      throw new Error('Bits out of bounds')\r\n    }\r\n\r\n    let value = 0\r\n    for (let i = 0; i < bits; ) {\r\n      const remaining = bits - i\r\n      const bitOffset = offset & 7\r\n      const currentByte = this.view[offset >> 3]\r\n\r\n      // the max number of bits we can read from the current byte\r\n      const read = Math.min(remaining, 8 - bitOffset)\r\n\r\n      // create a mask with the correct bit width\r\n      const mask = (1 << read) - 1\r\n      // shift bits we want to the start of the byte and mask of the rest\r\n      const readBits = (currentByte >> bitOffset) & mask\r\n      value |= readBits << i\r\n\r\n      offset += read\r\n      i += read\r\n    }\r\n\r\n    if (signed) {\r\n      // If we're not working with a full 32 bits, check the\r\n      // imaginary MSB for this bit count and convert to a\r\n      // valid 32-bit signed value if set.\r\n      if (bits !== 32 && value & (1 << (bits - 1))) {\r\n        value |= -1 ^ ((1 << bits) - 1)\r\n      }\r\n\r\n      return value\r\n    }\r\n\r\n    return value >>> 0\r\n  }\r\n\r\n  getInt8(offset: number) {\r\n    return this.getBits(offset, 8, true)\r\n  }\r\n\r\n  getUint8(offset: number) {\r\n    return this.getBits(offset, 8, false)\r\n  }\r\n\r\n  getInt16(offset: number) {\r\n    return this.getBits(offset, 16, true)\r\n  }\r\n\r\n  getUint16(offset: number) {\r\n    return this.getBits(offset, 16, false)\r\n  }\r\n\r\n  getInt32(offset: number) {\r\n    return this.getBits(offset, 32, true)\r\n  }\r\n\r\n  getUint32(offset: number) {\r\n    return this.getBits(offset, 32, false)\r\n  }\r\n\r\n  getFloat32(offset: number) {\r\n    BitView.scratch.setUint32(0, this.getUint32(offset))\r\n    return BitView.scratch.getFloat32(0)\r\n  }\r\n\r\n  getFloat64(offset: number) {\r\n    BitView.scratch.setUint32(0, this.getUint32(offset))\r\n    // DataView offset is in bytes.\r\n    BitView.scratch.setUint32(4, this.getUint32(offset + 32))\r\n    return BitView.scratch.getFloat64(0)\r\n  }\r\n}\r\n\r\nclass BitStream {\r\n  private view: BitView\r\n  index: number\r\n\r\n  constructor(source: ArrayBuffer) {\r\n    this.view = new BitView(source)\r\n    this.index = 0\r\n  }\r\n\r\n  readBits(bits: number, signed = false) {\r\n    const val = this.view.getBits(this.index, bits, signed)\r\n    this.index += bits\r\n    return val\r\n  }\r\n\r\n  readInt8() {\r\n    const val = this.view.getInt8(this.index)\r\n    this.index += 8\r\n    return val\r\n  }\r\n\r\n  readUint8() {\r\n    const val = this.view.getUint8(this.index)\r\n    this.index += 8\r\n    return val\r\n  }\r\n\r\n  readInt16() {\r\n    const val = this.view.getInt16(this.index)\r\n    this.index += 16\r\n    return val\r\n  }\r\n\r\n  readUint16() {\r\n    const val = this.view.getUint16(this.index)\r\n    this.index += 16\r\n    return val\r\n  }\r\n\r\n  readInt32() {\r\n    const val = this.view.getInt32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readUint32() {\r\n    const val = this.view.getUint32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readFloat32() {\r\n    const val = this.view.getFloat32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readFloat64() {\r\n    const val = this.view.getFloat64(this.index)\r\n    this.index += 64\r\n    return val\r\n  }\r\n\r\n  readString(bytes = 0, utf8 = false) {\r\n    let i = 0\r\n    const chars = []\r\n    let append = true\r\n\r\n    // Read while we still have space available, or until we've\r\n    // hit the fixed byte length passed in.\r\n    while (!bytes || (bytes && i < bytes)) {\r\n      const c = this.readUint8()\r\n\r\n      // Stop appending chars once we hit 0x00\r\n      if (c === 0x00) {\r\n        append = false\r\n\r\n        // If we don't have a fixed length to read, break out now.\r\n        if (!bytes) {\r\n          break\r\n        }\r\n      }\r\n      if (append) {\r\n        chars.push(c)\r\n      }\r\n\r\n      i++\r\n    }\r\n\r\n    const string = String.fromCharCode.apply(null, chars)\r\n    if (utf8) {\r\n      try {\r\n        // https://stackoverflow.com/a/17192845\r\n        return decodeURIComponent(string)\r\n      } catch (e) {\r\n        return string\r\n      }\r\n    } else {\r\n      return string\r\n    }\r\n  }\r\n}\r\n\r\nexport { BitView, BitStream }\r\n","import { SoundSystem } from './SoundSystem'\r\n\r\nexport class Sound {\r\n  index: number\r\n  name: string\r\n  buffer: AudioBuffer\r\n\r\n  constructor(buffer: AudioBuffer) {\r\n    this.index = -1\r\n    this.name = ''\r\n    this.buffer = buffer\r\n  }\r\n\r\n  static create(buffer: ArrayBuffer): Promise<Sound> {\r\n    return new Promise<Sound>((resolve, reject) => {\r\n      SoundSystem.getContext().decodeAudioData(\r\n        buffer,\r\n        (buffer: AudioBuffer) => {\r\n          resolve(new Sound(buffer))\r\n        },\r\n        (err: any) => {\r\n          reject(err)\r\n        }\r\n      )\r\n    })\r\n  }\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\n\r\nexport class Tga {\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n\r\n  constructor(name: string, width: number, height: number, data: Uint8Array) {\r\n    this.name = name\r\n    this.width = width\r\n    this.height = height\r\n    this.data = data\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer, name: string) {\r\n    let r = new Reader(buffer)\r\n\r\n    let header = {\r\n      idLength: r.ub(),\r\n      colorMapType: r.ub(),\r\n      imageType: r.ub(),\r\n      colorMap: {\r\n        firstEntryIndex: r.us(),\r\n        length: r.us(),\r\n        size: r.ub()\r\n      },\r\n      image: {\r\n        xOrigin: r.us(),\r\n        yOrigin: r.us(),\r\n        width: r.us(),\r\n        height: r.us(),\r\n        depth: r.ub(),\r\n        descriptor: r.ub()\r\n      }\r\n    }\r\n\r\n    // let imageId\r\n    if (header.idLength) {\r\n      // imageId = r.arrx(header.idLength, Reader.Type.UByte)\r\n      r.arrx(header.idLength, ReaderDataType.UByte)\r\n    }\r\n\r\n    if (header.colorMapType) {\r\n      throw new Error('Not implemented')\r\n    }\r\n\r\n    let w = header.image.width\r\n    let h = header.image.height\r\n    let pixelCount = w * h\r\n    let imageData\r\n\r\n    if (header.imageType === 0x02) {\r\n      let byteCount = (pixelCount * header.image.depth) / 8\r\n      imageData = r.arrx(byteCount, ReaderDataType.UByte)\r\n      if (header.image.depth === 24) {\r\n        let temp = new Uint8Array(pixelCount * 4)\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w; ++j) {\r\n            let dst = (h - 1 - i) * w + j\r\n            temp[dst * 4] = imageData[(i * w + j) * 3 + 2]\r\n            temp[dst * 4 + 1] = imageData[(i * w + j) * 3 + 1]\r\n            temp[dst * 4 + 2] = imageData[(i * w + j) * 3]\r\n            temp[dst * 4 + 3] = 255\r\n          }\r\n        }\r\n        imageData = temp\r\n      } else if (header.image.depth === 32) {\r\n        let temp = new Uint8Array(pixelCount * 4)\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w; ++j) {\r\n            let dst = (h - 1 - i) * w + j\r\n            temp[dst * 4] = imageData[(i * w + j) * 4 + 2]\r\n            temp[dst * 4 + 1] = imageData[(i * w + j) * 4 + 1]\r\n            temp[dst * 4 + 2] = imageData[(i * w + j) * 4]\r\n            temp[dst * 4 + 3] = 255\r\n          }\r\n        }\r\n        imageData = temp\r\n      }\r\n    } else if (header.imageType === 0x0a) {\r\n      imageData = new Uint8Array(pixelCount * 4)\r\n      if (header.image.depth === 24) {\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w /*++j*/; ) {\r\n            let repCount = r.ub()\r\n            if (repCount & 0x80) {\r\n              repCount = (repCount & 0x7f) + 1\r\n              let bl = r.ub()\r\n              let gr = r.ub()\r\n              let rd = r.ub()\r\n              while (j < w && repCount) {\r\n                let dst = (h - 1 - i) * w + j\r\n                imageData[dst * 4] = rd\r\n                imageData[dst * 4 + 1] = gr\r\n                imageData[dst * 4 + 2] = bl\r\n                imageData[dst * 4 + 3] = 255\r\n                ++j\r\n                --repCount\r\n              }\r\n            } else {\r\n              repCount = (repCount & 0x7f) + 1\r\n              while (j < w && repCount) {\r\n                let dst = (h - 1 - i) * w + j\r\n                imageData[dst * 4 + 2] = r.ub()\r\n                imageData[dst * 4 + 1] = r.ub()\r\n                imageData[dst * 4] = r.ub()\r\n                imageData[dst * 4 + 3] = 255\r\n                ++j\r\n                --repCount\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return new Tga(name, header.image.width, header.image.height, imageData)\r\n  }\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\nimport { paletteToRGBA, paletteWithLastTransToRGBA } from './Util'\r\n\r\nfunction parseDecal(r: Reader): WadDecal {\r\n  const name = r.nstr(16)\r\n\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n\r\n  r.skip(4 * 4) // skip mipmap offsets\r\n\r\n  // read largest mipmap data\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  // skip other 3 mipmaps\r\n  r.skip(21 * (pixelCount / 64))\r\n\r\n  r.skip(2) // skip padding bytes\r\n\r\n  const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n  const data =\r\n    name[0] === '{'\r\n      ? paletteWithLastTransToRGBA(pixels, palette)\r\n      : paletteToRGBA(pixels, palette)\r\n\r\n  return {\r\n    type: 'decal',\r\n    name,\r\n    width,\r\n    height,\r\n    data\r\n  }\r\n}\r\n\r\nfunction parseCache(_r: Reader, metadata: WadEntryMetadata): WadCache {\r\n  return {\r\n    type: 'cache',\r\n    name: metadata.name\r\n  }\r\n}\r\n\r\nfunction parseTexture(r: Reader): WadTexture {\r\n  const name = r.nstr(16)\r\n\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n\r\n  r.skip(4 * 4) // skip mipmap offsets\r\n\r\n  // read largest mipmap data\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  // skip other 3 mipmaps\r\n  r.skip(21 * (pixelCount / 64))\r\n\r\n  r.skip(2) // skip padding bytes\r\n\r\n  const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n  const data =\r\n    name[0] === '{'\r\n      ? paletteWithLastTransToRGBA(pixels, palette)\r\n      : paletteToRGBA(pixels, palette)\r\n\r\n  return {\r\n    type: 'texture',\r\n    name,\r\n    width,\r\n    height,\r\n    data\r\n  }\r\n}\r\n\r\nfunction parseFont(r: Reader, metadata: WadEntryMetadata): WadFont {\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n  const rowCount = r.ui()\r\n  const rowHeight = r.ui()\r\n\r\n  const glyphs = []\r\n  // hardcoded 256 number of glyphs\r\n  for (let i = 0; i < 256; ++i) {\r\n    glyphs.push({\r\n      offset: r.us(),\r\n      width: r.us()\r\n    })\r\n  }\r\n\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  r.skip(2)\r\n\r\n  const palette = r.arrx(256 * 3, ReaderDataType.UByte)\r\n\r\n  return {\r\n    type: 'font',\r\n    name: metadata.name,\r\n    width,\r\n    height,\r\n    rowCount,\r\n    rowHeight,\r\n    glyphs,\r\n    data: paletteToRGBA(pixels, palette)\r\n  }\r\n}\r\n\r\nfunction parseUnknown(r: Reader, metadata: WadEntryMetadata): WadUnknown {\r\n  return {\r\n    type: 'unknown',\r\n    name: metadata.name,\r\n    data: r.arrx(metadata.length, r.ub.bind(r))\r\n  }\r\n}\r\n\r\nfunction parseEntry(r: Reader, metadata: WadEntryMetadata): WadEntry {\r\n  r.seek(metadata.offset)\r\n  switch (metadata.type) {\r\n    case 0x40: {\r\n      return parseDecal(r)\r\n    }\r\n    case 0x42: {\r\n      return parseCache(r, metadata)\r\n    }\r\n    case 0x43: {\r\n      return parseTexture(r)\r\n    }\r\n    case 0x46: {\r\n      return parseFont(r, metadata)\r\n    }\r\n\r\n    default: {\r\n      // unknown data type; return array of bytes\r\n      return parseUnknown(r, metadata)\r\n    }\r\n  }\r\n}\r\n\r\nexport interface WadTexture {\r\n  type: 'texture'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadDecal {\r\n  type: 'decal'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadCache {\r\n  type: 'cache'\r\n  name: string\r\n}\r\n\r\nexport interface WadFont {\r\n  type: 'font'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  rowCount: number\r\n  rowHeight: number\r\n  glyphs: {\r\n    offset: number\r\n    width: number\r\n  }[]\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadUnknown {\r\n  type: 'unknown'\r\n  name: string\r\n  data: Uint8Array\r\n}\r\n\r\nexport type WadEntry = WadTexture | WadDecal | WadCache | WadFont | WadUnknown\r\n\r\ninterface WadEntryMetadata {\r\n  offset: number\r\n  diskLength: number\r\n  length: number\r\n  type: number\r\n  isCompressed: number\r\n  name: string\r\n}\r\n\r\nexport class Wad {\r\n  entries: WadEntry[]\r\n\r\n  constructor(entries: WadEntry[]) {\r\n    this.entries = entries\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n\r\n    const magic = r.nstr(4)\r\n    if (magic !== 'WAD3') {\r\n      throw new Error('Invalid WAD file format')\r\n    }\r\n\r\n    const entryCount = r.ui()\r\n    const directoryOffset = r.ui()\r\n    r.seek(directoryOffset)\r\n    const entriesMetadata: WadEntryMetadata[] = []\r\n    for (let i = 0; i < entryCount; ++i) {\r\n      const entry: WadEntryMetadata = {\r\n        offset: r.ui(),\r\n        diskLength: r.ui(),\r\n        length: r.ui(),\r\n        type: r.b(),\r\n        isCompressed: r.b(),\r\n        name: ''\r\n      }\r\n      r.skip(2)\r\n      entry.name = r.nstr(16)\r\n      entriesMetadata.push(entry)\r\n    }\r\n\r\n    const entries: WadEntry[] = entriesMetadata.map(e => parseEntry(r, e))\r\n\r\n    return new Wad(entries)\r\n  }\r\n}\r\n","interface ProgressCallback {\r\n  (request: XMLHttpRequest, progress: number): void\r\n}\r\n\r\ninterface XhrParams {\r\n  method: string\r\n  isBinary: boolean\r\n  progressCallback: ProgressCallback\r\n}\r\n\r\nfunction xhr(url: string, params: XhrParams): Promise<any> {\r\n  let method = params.method || 'GET'\r\n  let isBinary = params.isBinary\r\n  let progressCallback = params.progressCallback\r\n\r\n  if (!url) {\r\n    throw new Error('Url parameter missing')\r\n  }\r\n\r\n  return new Promise<string>((resolve, reject) => {\r\n    let request = new XMLHttpRequest()\r\n\r\n    if (isBinary) {\r\n      request.responseType = 'arraybuffer'\r\n    }\r\n\r\n    if (isBinary && progressCallback) {\r\n      request.addEventListener('progress', event => {\r\n        if (event.lengthComputable) {\r\n          progressCallback(request, event.loaded / event.total)\r\n        } else {\r\n          // HACK!\r\n          let totalStr = request.getResponseHeader('content-length')\r\n          let total = 0\r\n          if (totalStr) {\r\n            total = parseFloat(totalStr)\r\n          }\r\n          let encoding = request.getResponseHeader('content-encoding')\r\n          if (total && encoding && encoding.indexOf('gzip') > -1) {\r\n            // assuming average gzip compression ratio to be 25%\r\n            total *= 4\r\n            let loadedPercent = Math.min(0.99, event.loaded / total)\r\n            progressCallback(request, loadedPercent)\r\n            // END OF HACK\r\n          } else {\r\n            progressCallback(request, 0)\r\n          }\r\n        }\r\n      })\r\n    }\r\n\r\n    request.addEventListener('readystatechange', (event: any) => {\r\n      if (event.target.readyState !== 4) {\r\n        return\r\n      }\r\n\r\n      if (event.target.status === 200) {\r\n        if (progressCallback) {\r\n          progressCallback(request, 1)\r\n        }\r\n\r\n        resolve(event.target.response)\r\n      } else {\r\n        reject({\r\n          status: event.target.status\r\n        })\r\n      }\r\n    })\r\n\r\n    request.open(method, url, true)\r\n    request.send()\r\n  })\r\n}\r\n\r\nexport { ProgressCallback, XhrParams, xhr }\r\n","class Keyboard {\r\n  keys: Uint8Array\r\n\r\n  constructor() {\r\n    this.keys = new Uint8Array(256)\r\n    for (let i = 0; i < 256; ++i) {\r\n      this.keys[0] = 0\r\n    }\r\n  }\r\n}\r\n\r\nnamespace Keyboard {\r\n  export enum KEYS {\r\n    A = 'A'.charCodeAt(0),\r\n    B = 'B'.charCodeAt(0),\r\n    C = 'C'.charCodeAt(0),\r\n    D = 'D'.charCodeAt(0),\r\n    E = 'E'.charCodeAt(0),\r\n    F = 'F'.charCodeAt(0),\r\n    G = 'G'.charCodeAt(0),\r\n    H = 'H'.charCodeAt(0),\r\n    I = 'I'.charCodeAt(0),\r\n    J = 'J'.charCodeAt(0),\r\n    K = 'K'.charCodeAt(0),\r\n    L = 'L'.charCodeAt(0),\r\n    M = 'M'.charCodeAt(0),\r\n    N = 'N'.charCodeAt(0),\r\n    O = 'O'.charCodeAt(0),\r\n    P = 'P'.charCodeAt(0),\r\n    Q = 'Q'.charCodeAt(0),\r\n    R = 'R'.charCodeAt(0),\r\n    S = 'S'.charCodeAt(0),\r\n    T = 'T'.charCodeAt(0),\r\n    U = 'U'.charCodeAt(0),\r\n    V = 'V'.charCodeAt(0),\r\n    W = 'W'.charCodeAt(0),\r\n    X = 'X'.charCodeAt(0),\r\n    Y = 'Y'.charCodeAt(0),\r\n    Z = 'Z'.charCodeAt(0),\r\n    CTRL = 17,\r\n    ALT = 18,\r\n    SPACE = 32\r\n  }\r\n}\r\n\r\nexport { Keyboard }\r\n","import { glMatrix } from 'gl-matrix'\r\nimport { EventEmitter } from 'events'\r\nimport { Game } from './Game'\r\nimport { Replay, ReplayState } from './Replay'\r\n\r\nconst updateGame = (game: Game, state: ReplayState) => {\r\n  game.camera.position[0] = state.cameraPos[0]\r\n  game.camera.position[1] = state.cameraPos[1]\r\n  game.camera.position[2] = state.cameraPos[2]\r\n  game.camera.rotation[0] = glMatrix.toRadian(state.cameraRot[0])\r\n  game.camera.rotation[1] = glMatrix.toRadian(state.cameraRot[1])\r\n  game.camera.rotation[2] = glMatrix.toRadian(state.cameraRot[2])\r\n}\r\n\r\nclass ReplayPlayer {\r\n  game: Game\r\n  state: ReplayState\r\n  replay: any\r\n  events: EventEmitter\r\n\r\n  currentMap: number = 0\r\n  currentChunk: number = 0\r\n  currentTime: number = 0\r\n  currentTick: number = 0\r\n  isPlaying: boolean = false\r\n  isPaused: boolean = false\r\n  speed: number = 1\r\n\r\n  constructor(game: Game) {\r\n    this.reset()\r\n    this.game = game\r\n    this.state = new ReplayState()\r\n    this.replay = null\r\n    this.events = new EventEmitter()\r\n  }\r\n\r\n  reset() {\r\n    this.currentMap = 0\r\n    this.currentChunk = 0\r\n    this.currentTime = 0\r\n    this.currentTick = 0\r\n\r\n    this.isPlaying = false\r\n    this.isPaused = false\r\n    this.speed = 1\r\n\r\n    if (this.replay) {\r\n      let firstChunk = this.replay.maps[0].chunks[0]\r\n      firstChunk.reader.seek(0)\r\n      this.state = firstChunk.state.clone()\r\n    }\r\n  }\r\n\r\n  on(eventName: string, callback: any) {\r\n    return this.events.on(eventName, callback)\r\n  }\r\n\r\n  off(eventName: string, callback: any) {\r\n    this.events.removeListener(eventName, callback)\r\n  }\r\n\r\n  changeReplay(replay: Replay) {\r\n    this.replay = replay\r\n    this.reset()\r\n  }\r\n\r\n  play() {\r\n    if (!this.isPlaying) {\r\n      this.isPlaying = true\r\n    } else if (this.isPaused) {\r\n      this.isPaused = false\r\n    }\r\n\r\n    this.events.emit('play')\r\n  }\r\n\r\n  pause() {\r\n    if (this.isPlaying) {\r\n      this.isPaused = true\r\n    }\r\n\r\n    this.events.emit('pause')\r\n  }\r\n\r\n  stop() {\r\n    this.reset()\r\n    this.events.emit('stop')\r\n  }\r\n\r\n  speedUp() {\r\n    this.speed = Math.min(this.speed * 2, 4)\r\n  }\r\n\r\n  speedDown() {\r\n    this.speed = Math.max(this.speed / 2, 0.25)\r\n  }\r\n\r\n  seek(value: number) {\r\n    let t = Math.max(0, Math.min(this.replay.length, value))\r\n\r\n    let maps = this.replay.maps\r\n    for (let i = 0; i < maps.length; ++i) {\r\n      let chunks = maps[i].chunks\r\n      for (let j = 0; j < chunks.length; ++j) {\r\n        let chunk = chunks[j]\r\n        let startTime = chunk.startTime\r\n        let timeLimit = startTime + chunk.timeLength\r\n        if (t >= startTime && t < timeLimit) {\r\n          this.currentMap = i\r\n          this.currentChunk = j\r\n          this.currentTime = t\r\n\r\n          this.state = chunk.state.clone()\r\n          let deltaDecoders = this.replay.deltaDecoders\r\n          let customMessages = this.replay.customMessages\r\n          let r = chunk.reader\r\n          r.seek(0)\r\n          while (true) {\r\n            let offset = r.tell()\r\n            let frame = Replay.readFrame(r, deltaDecoders, customMessages)\r\n            if (frame.time <= t) {\r\n              this.state.feedFrame(frame)\r\n              this.currentTick = frame.tick\r\n            } else {\r\n              r.seek(offset)\r\n              break\r\n            }\r\n          }\r\n\r\n          updateGame(this.game, this.state)\r\n\r\n          return\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  seekByPercent(value: number) {\r\n    value = Math.max(0, Math.min(value, 100)) / 100\r\n    value *= this.replay.length\r\n    this.seek(value)\r\n  }\r\n\r\n  update(dt: number) {\r\n    if (!this.isPlaying || this.isPaused) {\r\n      return\r\n    }\r\n\r\n    let deltaDecoders = this.replay.deltaDecoders\r\n    let customMessages = this.replay.customMessages\r\n\r\n    let map = this.replay.maps[this.currentMap]\r\n    let chunk = map.chunks[this.currentChunk]\r\n    let r = chunk.reader\r\n\r\n    let endTime = this.currentTime + dt * this.speed\r\n\r\n    let hitStop = false\r\n\r\n    while (true) {\r\n      let offset = r.tell()\r\n      if (offset >= chunk.data.length) {\r\n        if (this.currentChunk === map.chunks.length - 1) {\r\n          if (this.currentMap === this.replay.maps.length - 1) {\r\n            hitStop = true\r\n            break\r\n          } else {\r\n            this.currentChunk = 0\r\n            this.currentMap++\r\n            map = this.replay.maps[this.currentMap]\r\n            chunk = map.chunks[this.currentChunk]\r\n          }\r\n        } else {\r\n          this.currentChunk++\r\n          chunk = map.chunks[this.currentChunk]\r\n        }\r\n\r\n        r = chunk.reader\r\n        r.seek(0)\r\n        offset = 0\r\n\r\n        continue\r\n      }\r\n\r\n      let sounds: any[] = this.game.sounds\r\n      let frame: any = Replay.readFrame(r, deltaDecoders, customMessages)\r\n      if (frame.type < 2) {\r\n        for (let i = 0; i < frame.data.length; ++i) {\r\n          let message = frame.data[i]\r\n          if (message.type === 6) {\r\n            // TODO: Magic number SVC_SOUND\r\n            let msgSound = message.data\r\n            let sound = sounds.find((s: any) => s.index === msgSound.soundIndex)\r\n            if (sound && sound.name !== 'common/null.wav') {\r\n              let channel = msgSound.channel\r\n              let volume = msgSound.volume\r\n              // TODO: Positional audio\r\n              this.game.soundSystem.play(sound, channel, volume)\r\n            }\r\n          } else if (message.type === 29) {\r\n            // TODO: Magic number\r\n            let msgSound = message.data\r\n            let sound = sounds.find((s: any) => s.index === msgSound.soundIndex)\r\n            if (sound && sound.name !== 'common/null.wav') {\r\n              // TODO: Use after implementing positional audio\r\n              // let volume = msgSound.volume\r\n              // this.game.soundSystem.play(sound, 6, volume)\r\n            }\r\n          } else if (message.type === 9) {\r\n            message.data.commands.forEach((command: any) => {\r\n              switch (command.func) {\r\n                case 'speak':\r\n                case 'spk':\r\n                case 'play': {\r\n                  let soundName = command.params[0] + '.wav'\r\n                  let sound = sounds.find((s: any) => s.name === soundName)\r\n                  if (!sound) {\r\n                    return\r\n                  }\r\n\r\n                  this.game.soundSystem.play(sound, 1, 0.7)\r\n                  break\r\n                }\r\n                case 'playvol': {\r\n                  let soundName = command.params[0] + '.wav'\r\n                  let volume\r\n                  if (isNaN(command.params[1])) {\r\n                    volume = 1\r\n                  } else {\r\n                    volume = parseFloat(command.params[1])\r\n                  }\r\n                  let sound = sounds.find((s: any) => s.name === soundName)\r\n                  if (!sound) {\r\n                    return\r\n                  }\r\n\r\n                  this.game.soundSystem.play(sound, 1, volume)\r\n                  break\r\n                }\r\n              }\r\n            })\r\n          }\r\n        }\r\n      } else if (frame.type === 8) {\r\n        let sample = frame.sound.sample\r\n        let sound = sounds.find(s => s.name === sample)\r\n        if (sound && sound.name !== 'common/null.wav') {\r\n          let channel = frame.sound.channel\r\n          let volume = frame.sound.volume\r\n          this.game.soundSystem.play(sound, channel, volume)\r\n        }\r\n      }\r\n      if (frame.time <= endTime) {\r\n        this.state.feedFrame(frame)\r\n        this.currentTick = frame.tick\r\n      } else {\r\n        r.seek(offset)\r\n        break\r\n      }\r\n    }\r\n\r\n    updateGame(this.game, this.state)\r\n\r\n    this.currentTime = endTime\r\n\r\n    if (hitStop) {\r\n      this.stop()\r\n    }\r\n  }\r\n}\r\n\r\nexport { ReplayPlayer }\r\n","import { glMatrix, vec3, mat4 } from 'gl-matrix'\n\nexport class Camera {\n  static init(aspect: number) {\n    return new Camera(aspect)\n  }\n\n  projectionMatrix: mat4 = mat4.create()\n  aspect: number\n  fov: number = glMatrix.toRadian(60)\n  near: number = 1.0\n  far: number = 8192.0\n\n  viewMatrix: mat4 = mat4.create()\n  position = vec3.create()\n  rotation = vec3.create()\n\n  private constructor(aspect: number) {\n    this.aspect = aspect\n    this.updateProjectionMatrix()\n  }\n\n  updateProjectionMatrix() {\n    mat4.perspective(\n      this.projectionMatrix,\n      this.fov,\n      this.aspect,\n      this.near,\n      this.far\n    )\n  }\n\n  updateViewMatrix() {\n    mat4.identity(this.viewMatrix)\n    mat4.rotateX(\n      this.viewMatrix,\n      this.viewMatrix,\n      this.rotation[0] - Math.PI / 2\n    )\n    mat4.rotateZ(\n      this.viewMatrix,\n      this.viewMatrix,\n      Math.PI / 2 - this.rotation[1]\n    )\n    mat4.translate(this.viewMatrix, this.viewMatrix, [\n      -this.position[0],\n      -this.position[1],\n      -this.position[2]\n    ])\n  }\n}\n","export interface Program {\n  handle: WebGLProgram\n  attributes: { [name: string]: number }\n  uniforms: { [name: string]: WebGLUniformLocation }\n}\n\nexport enum ShaderType {\n  VERTEX,\n  FRAGMENT\n}\n\nexport class Context {\n  static init(canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext('webgl', {\n      alpha: false\n    })\n    if (!gl) {\n      console.log('contextn\\'t')\n      return null\n    }\n    return new Context(gl)\n  }\n\n  readonly gl: WebGLRenderingContext\n\n  private constructor(gl: WebGLRenderingContext) {\n    this.gl = gl\n  }\n\n  createProgram(params: {\n    vertexShaderSrc: string\n    fragmentShaderSrc: string\n    attributeNames: string[]\n    uniformNames: string[]\n  }): Program | null {\n    const gl = this.gl\n    var program = gl.createProgram()\n    if (!program) {\n      console.error(\"gl.createProgramn't\")\n      return null\n    }\n\n    const vertexShader = this.createShader({\n      source: params.vertexShaderSrc,\n      type: ShaderType.VERTEX\n    })\n    if (!vertexShader) {\n      console.error('Failed to compile vertex shader')\n      return null\n    }\n    const fragmentShader = this.createShader({\n      source: params.fragmentShaderSrc,\n      type: ShaderType.FRAGMENT\n    })\n    if (!fragmentShader) {\n      console.error('Failed to compile fragment shader')\n      return null\n    }\n\n    gl.attachShader(program, vertexShader)\n    gl.attachShader(program, fragmentShader)\n    gl.linkProgram(program)\n    gl.validateProgram(program)\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      gl.deleteProgram(program)\n      gl.deleteShader(vertexShader)\n      gl.deleteShader(fragmentShader)\n\n      const reason = gl.getProgramInfoLog(program)\n      console.debug(`Could not initialize shader: ${reason}`)\n      return null\n    }\n\n    if (!gl.getProgramParameter(program, gl.VALIDATE_STATUS)) {\n      gl.deleteProgram(program)\n      gl.deleteShader(vertexShader)\n      gl.deleteShader(fragmentShader)\n\n      const reason = gl.getProgramInfoLog(program)\n      console.debug(`Could not initialize shader: ${reason}`)\n      return null\n    }\n\n    gl.useProgram(program)\n\n    const attributes: { [name: string]: number } = {}\n    for (let i = 0; i < params.attributeNames.length; ++i) {\n      const name = params.attributeNames[i]\n      const attr = gl.getAttribLocation(program, name)\n      if (attr === -1) {\n        console.error(`gl.getAttribLocation't named \"${name}\"`)\n        gl.deleteProgram(program)\n        return null\n      }\n      attributes[name] = attr\n    }\n\n    const uniforms: { [name: string]: WebGLUniformLocation } = {}\n    for (let i = 0; i < params.uniformNames.length; ++i) {\n      const name = params.uniformNames[i]\n      const uniform = gl.getUniformLocation(program, name)\n      if (uniform === null) {\n        console.error(`gl.getUniformLocation't named \"${name}\"`)\n        gl.deleteProgram(program)\n        return null\n      }\n      uniforms[name] = uniform\n    }\n\n    return {\n      handle: program,\n      attributes,\n      uniforms\n    }\n  }\n\n  createShader(params: { source: string; type: ShaderType }) {\n    const gl = this.gl\n    const shader =\n      params.type === ShaderType.VERTEX\n        ? gl.createShader(gl.VERTEX_SHADER)\n        : gl.createShader(gl.FRAGMENT_SHADER)\n    if (!shader) {\n      console.error('Failed to create shader program')\n      return null\n    }\n    gl.shaderSource(shader, params.source)\n    gl.compileShader(shader)\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.debug(gl.getShaderInfoLog(shader))\n      gl.deleteShader(shader)\n      return null\n    }\n\n    return shader\n  }\n\n  getAnisotropyExtension(): EXT_texture_filter_anisotropic | null {\n    return (\n      this.gl.getExtension('EXT_texture_filter_anisotropic') ||\n      this.gl.getExtension('MOZ_EXT_texture_filter_anisotropic') ||\n      this.gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')\n    )\n  }\n\n  getMaxAnisotropy(extension: EXT_texture_filter_anisotropic) {\n    return this.gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)\n  }\n}\n","import { Context } from './Context'\n\nexport class Renderer {\n  static init(context: Context): Renderer | null {\n    const gl = context.gl\n\n    gl.clearColor(0.0, 0.0, 0.0, 1.0)\n    gl.clearDepth(1.0)\n    gl.enable(gl.DEPTH_TEST)\n    gl.depthFunc(gl.LEQUAL)\n\n    gl.enable(gl.BLEND)\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n\n    gl.enable(gl.CULL_FACE)\n    gl.cullFace(gl.FRONT)\n\n    return new Renderer({ context })\n  }\n\n  private context: Context\n\n  private constructor(params: { context: Context }) {\n    this.context = params.context\n  }\n\n  draw = () => {\n    const gl = this.context.gl\n\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n  }\n}\n","import { Bsp } from '../Bsp'\nimport { Tga } from '../Parsers/Tga'\nimport { Camera } from './Camera'\nimport { Context } from './Context'\nimport { SkyShader } from './SkyShader/SkyShader'\n\nexport class SkyScene {\n  static init(context: Context): SkyScene | null {\n    const shader = SkyShader.init(context)\n    if (!shader) {\n      console.error(\"skyscenen't\")\n      return null\n    }\n\n    return new SkyScene({ context, shader })\n  }\n\n  private context: Context\n  private shader: SkyShader\n  private vertexBuffer: WebGLBuffer\n  private indexBuffer: WebGLBuffer\n  private texture: WebGLTexture\n  private isReady: boolean = false\n\n  private constructor(params: { context: Context; shader: SkyShader }) {\n    this.context = params.context\n    this.shader = params.shader\n  }\n\n  changeMap(bsp: Bsp) {\n    if (bsp.skies.length !== 6) {\n      this.isReady = false\n      return\n    }\n\n    const gl = this.context.gl\n    const vertexBuffer = gl.createBuffer()\n    const indexBuffer = gl.createBuffer()\n    const texture = gl.createTexture()\n    if (!vertexBuffer || !indexBuffer || !texture) {\n      // TODO\n      throw new Error('shouldnt happen')\n    }\n\n    // prettier-ignore\n    const indices = new Uint8Array([\n      0,  1,  2,      0,  2,  3,    // front\n      4,  5,  6,      4,  6,  7,    // back\n      8,  9,  10,     8,  10, 11,   // top\n      12, 13, 14,     12, 14, 15,   // bottom\n      16, 17, 18,     16, 18, 19,   // right\n      20, 21, 22,     20, 22, 23,   // left\n    ])\n    // prettier-ignore\n    const vertices = new Float32Array([\n      // Top face\n      -1.0, -1.0,  1.0, 0.499, 0.001,\n       1.0, -1.0,  1.0, 0.499, 0.249,\n       1.0,  1.0,  1.0, 0.001, 0.249,\n      -1.0,  1.0,  1.0, 0.001, 0.001,\n\n      // Bottom face\n      -1.0, -1.0, -1.0, 0.499, 0.749,\n      -1.0,  1.0, -1.0, 0.001, 0.749,\n       1.0,  1.0, -1.0, 0.001, 0.501,\n       1.0, -1.0, -1.0, 0.499, 0.501,\n\n      // Front face\n      -1.0,  1.0, -1.0, 0.501, 0.749,\n      -1.0,  1.0,  1.0, 0.501, 0.501,\n       1.0,  1.0,  1.0, 0.999, 0.501,\n       1.0,  1.0, -1.0, 0.999, 0.749,\n\n      // Back face\n      -1.0, -1.0, -1.0, 0.999, 0.249,\n       1.0, -1.0, -1.0, 0.501, 0.249,\n       1.0, -1.0,  1.0, 0.501, 0.001,\n      -1.0, -1.0,  1.0, 0.999, 0.001,\n\n      // Right face\n       1.0, -1.0, -1.0, 0.499, 0.499,\n       1.0,  1.0, -1.0, 0.001, 0.499,\n       1.0,  1.0,  1.0, 0.001, 0.251,\n       1.0, -1.0,  1.0, 0.499, 0.251,\n\n      // Left face\n      -1.0, -1.0, -1.0, 0.501, 0.499,\n      -1.0, -1.0,  1.0, 0.501, 0.251,\n      -1.0,  1.0,  1.0, 0.999, 0.251,\n      -1.0,  1.0, -1.0, 0.999, 0.499\n    ].map((a, i) => ((i % 5) < 3) ? a * 4096 : a))\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer)\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW)\n    gl.enableVertexAttribArray(0)\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer)\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW)\n\n    const canvas = document.createElement('canvas')\n    canvas.width = 512\n    canvas.height = 1024\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      throw new Error('sky ctx fail')\n    }\n\n    const coords: { [name: string]: number[] } = {\n      up: [0, 0],\n      rt: [0, 256],\n      dn: [0, 512],\n      ft: [256, 0],\n      lf: [256, 256],\n      bk: [256, 512]\n    }\n\n    bsp.skies.forEach((sky: Tga) => {\n      const smc = document.createElement('canvas')\n      const smctx = smc.getContext('2d')\n      if (!smctx) {\n        throw new Error('Runtime error.')\n      }\n      smc.width = sky.width\n      smc.height = sky.height\n      const imageData = smctx.getImageData(0, 0, smc.width, smc.height)\n      for (let i = 0; i < sky.data.length; ++i) {\n        imageData.data[i] = sky.data[i]\n      }\n      smctx.putImageData(imageData, 0, 0)\n\n      const side = sky.name.slice(-2)\n      const c = coords[side] ? coords[side] : []\n\n      // TODO: remove this check\n      if (!ctx) {\n        throw new Error('Runtime error.')\n      }\n      ctx.drawImage(smc, c[0], c[1])\n    })\n\n    const pixelData = ctx.getImageData(0, 0, 512, 1024).data\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      512,\n      1024,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      new Uint8Array(pixelData)\n    )\n    gl.generateMipmap(gl.TEXTURE_2D)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n    gl.texParameteri(\n      gl.TEXTURE_2D,\n      gl.TEXTURE_MIN_FILTER,\n      gl.LINEAR_MIPMAP_LINEAR\n    )\n    gl.texParameterf(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n    const anisotropy = this.context.getAnisotropyExtension()\n    if (anisotropy) {\n      gl.texParameteri(\n        gl.TEXTURE_2D,\n        anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\n        this.context.getMaxAnisotropy(anisotropy)\n      )\n    }\n\n    this.vertexBuffer = vertexBuffer\n    this.indexBuffer = indexBuffer\n    this.texture = texture\n    this.isReady = true\n  }\n\n  draw(camera: Camera) {\n    if (!this.isReady) {\n      return\n    }\n\n    const gl = this.context.gl\n    const shader = this.shader\n\n    shader.useProgram(gl)\n    gl.bindTexture(gl.TEXTURE_2D, this.texture)\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer)\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer)\n    shader.enableVertexAttribs(gl)\n    shader.setVertexAttribPointers(gl)\n    shader.setDiffuse(gl, 0)\n\n    const x = camera.position[0]\n    const y = camera.position[1]\n    const z = camera.position[2]\n    camera.position[0] = 0\n    camera.position[1] = 0\n    camera.position[2] = 0\n    camera.updateViewMatrix()\n    camera.position[0] = x\n    camera.position[1] = y\n    camera.position[2] = z\n\n    shader.setViewMatrix(gl, camera.viewMatrix)\n    shader.setProjectionMatrix(gl, camera.projectionMatrix)\n\n    gl.drawElements(gl.TRIANGLES, 36, gl.UNSIGNED_BYTE, 0)\n    gl.clear(gl.DEPTH_BUFFER_BIT)\n  }\n}\n","import { mat4 } from 'gl-matrix'\nimport { Context, Program } from '../Context'\n\nconst fragmentSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  gl_FragColor = vec4(diffuseColor.rgb, 1.0);\n}`\n\nconst vertexSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  gl_Position = projectionMatrix * viewMatrix * vec4(position, 1);\n}`\n\nexport class SkyShader {\n  static init(context: Context): SkyShader | null {\n    const attributeNames = ['position', 'texCoord']\n    const uniformNames: string[] = ['viewMatrix', 'projectionMatrix', 'diffuse']\n    const program = context.createProgram({\n      vertexShaderSrc: vertexSrc,\n      fragmentShaderSrc: fragmentSrc,\n      attributeNames,\n      uniformNames\n    })\n    if (!program) {\n      console.error(`Failed to create sky shader program`)\n      return null\n    }\n\n    return new SkyShader(program)\n  }\n\n  private program: WebGLProgram\n  private aPosition: number\n  private aTexCoord: number\n  private uViewMx: WebGLUniformLocation\n  private uProjectionMx: WebGLUniformLocation\n  private uDiffuse: WebGLUniformLocation\n\n  private constructor(program: Program) {\n    this.program = program.handle\n    this.aPosition = program.attributes['position']\n    this.aTexCoord = program.attributes['texCoord']\n    this.uViewMx = program.uniforms['viewMatrix']\n    this.uProjectionMx = program.uniforms['projectionMatrix']\n    this.uDiffuse = program.uniforms['diffuse']\n  }\n\n  useProgram(gl: WebGLRenderingContext) {\n    gl.useProgram(this.program)\n  }\n\n  setViewMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uViewMx, false, matrix)\n  }\n\n  setProjectionMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uProjectionMx, false, matrix)\n  }\n\n  setDiffuse(gl: WebGLRenderingContext, value: number) {\n    gl.uniform1i(this.uDiffuse, value)\n  }\n\n  enableVertexAttribs(gl: WebGLRenderingContext) {\n    gl.enableVertexAttribArray(this.aPosition)\n    gl.enableVertexAttribArray(this.aTexCoord)\n  }\n\n  setVertexAttribPointers(gl: WebGLRenderingContext) {\n    gl.vertexAttribPointer(this.aPosition, 3, gl.FLOAT, false, 5 * 4, 0)\n    gl.vertexAttribPointer(this.aTexCoord, 2, gl.FLOAT, false, 5 * 4, 3 * 4)\n  }\n}\n","import { mat4, vec3 } from 'gl-matrix'\nimport { Bsp } from '../Bsp'\nimport { Camera } from './Camera'\nimport { Context } from './Context'\nimport { MainShader } from './WorldShader/WorldShader'\nimport { RenderMode } from '../Parsers/BspEntityParser'\nimport { Sprite, SpriteType } from '../Parsers/Sprite'\nimport { isPowerOfTwo, nextPowerOfTwo, resizeTexture } from './Util'\n\ntype FaceInfo = {\n  offset: number\n  length: number\n  textureIndex: number\n}\ntype ModelInfo = {\n  origin: number[]\n  offset: number\n  length: number\n  isTransparent: boolean\n  faces: FaceInfo[]\n}\ntype SceneInfo = {\n  length: number\n  data: Float32Array\n  models: ModelInfo[]\n}\n\nexport class WorldScene {\n  static init(context: Context) {\n    const shader = MainShader.init(context)\n    if (!shader) {\n      console.error(\"shadern't\")\n      return null\n    }\n\n    shader.useProgram(context.gl)\n\n    const buffer = context.gl.createBuffer()\n    if (!buffer) {\n      console.error(\"buffern't\")\n      return null\n    }\n\n    return new WorldScene({ buffer, context, shader })\n  }\n\n  private buffer: WebGLBuffer\n  private context: Context\n  private shader: MainShader\n  private modelMatrix: mat4 = mat4.create()\n\n  private sceneInfo: SceneInfo = {\n    length: 0,\n    data: new Float32Array(0),\n    models: []\n  }\n  private bsp: Bsp | null\n  private textures: {\n    name: string\n    width: number\n    height: number\n    data: Uint8Array\n    handle: WebGLTexture\n  }[] = []\n  private sprites: { [name: string]: Sprite } = {}\n  private lightmap: {\n    data: Uint8Array\n    handle: WebGLTexture\n  } | null = null\n  private constructor(params: {\n    context: Context\n    buffer: WebGLBuffer\n    shader: MainShader\n  }) {\n    this.buffer = params.buffer\n    this.context = params.context\n    this.shader = params.shader\n  }\n\n  changeMap(bsp: Bsp) {\n    this.fillBuffer(bsp)\n    this.loadTextures(bsp)\n    this.loadSpriteTextures(bsp)\n    this.loadLightmap(bsp)\n    this.bsp = bsp\n  }\n\n  private fillBuffer(bsp: Bsp) {\n    const gl = this.context.gl\n    const models = bsp.models\n\n    const INVISIBLE_TEXTURES = [\n      'aaatrigger',\n      'clip',\n      'null',\n      'hint',\n      'nodraw',\n      'invisible',\n      'skip',\n      'trigger',\n      'sky',\n      'fog'\n    ]\n\n    // get total buffer size\n    let size = 0\n    for (let i = 0; i < models.length; ++i) {\n      const model = models[i]\n      for (let j = 0; j < model.faces.length; ++j) {\n        const texture = bsp.textures[model.faces[j].textureIndex]\n        if (INVISIBLE_TEXTURES.indexOf(texture.name) > -1) {\n          continue\n        }\n\n        size += model.faces[j].buffer.length\n      }\n    }\n\n    // add 6 vertex for a single quad that will be used to render sprites\n    size += 7 * 6\n\n    // init scene info structure and buffer with the appropriate size\n    const sceneInfo: SceneInfo = {\n      length: size,\n      data: new Float32Array(size),\n      models: []\n    }\n\n    // fill the scene info structure\n    let currentVertex = 0\n    for (let i = 0; i < bsp.models.length; ++i) {\n      const model = bsp.models[i]\n      const modelInfo: ModelInfo = {\n        origin: model.origin,\n        offset: currentVertex,\n        length: 0,\n        isTransparent: false,\n        faces: []\n      }\n\n      for (let j = 0; j < model.faces.length; ++j) {\n        const texture = bsp.textures[model.faces[j].textureIndex]\n        if (INVISIBLE_TEXTURES.indexOf(texture.name) > -1) {\n          continue\n        }\n\n        const faceInfo: FaceInfo = {\n          offset: currentVertex,\n          length: 0,\n          textureIndex: -1\n        }\n\n        for (let k = 0; k < model.faces[j].buffer.length; ++k) {\n          sceneInfo.data[currentVertex++] = model.faces[j].buffer[k]\n        }\n\n        if (\n          !modelInfo.isTransparent &&\n          bsp.textures[model.faces[j].textureIndex].name[0] === '{'\n        ) {\n          modelInfo.isTransparent = true\n        }\n\n        faceInfo.textureIndex = model.faces[j].textureIndex\n        faceInfo.length = currentVertex - faceInfo.offset\n        modelInfo.faces.push(faceInfo)\n      }\n\n      modelInfo.length = currentVertex - modelInfo.offset\n      sceneInfo.models.push(modelInfo)\n    }\n\n    // set data of the last quad used for rendering sprites\n    sceneInfo.models.push({\n      origin: [0, 0, 0],\n      offset: currentVertex,\n      length: 4,\n      isTransparent: false, // unused\n      faces: [\n        {\n          offset: currentVertex,\n          length: 4,\n          textureIndex: 0 // unused\n        }\n      ]\n    })\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    // sort each model's face in scene info structure by texture index\n    // and merge faces with same texture to lower draw calls\n    currentVertex = 0\n    const sortedSceneInfo: SceneInfo = {\n      data: new Float32Array(sceneInfo.data),\n      length: sceneInfo.length,\n      models: sceneInfo.models.map(model => ({\n        origin: [...model.origin],\n        offset: model.offset,\n        length: model.length,\n        isTransparent: model.isTransparent,\n        faces: model.faces.map(face => ({\n          offset: face.offset,\n          length: face.length,\n          textureIndex: face.textureIndex\n        }))\n      }))\n    }\n    for (let i = 0; i < sortedSceneInfo.models.length; ++i) {\n      const model = sortedSceneInfo.models[i]\n      model.faces.sort((a, b) => a.textureIndex - b.textureIndex)\n\n      for (let j = 0; j < model.faces.length; ++j) {\n        const face = model.faces[j]\n        const newOffset = currentVertex\n\n        for (let k = 0; k < face.length; ++k) {\n          sortedSceneInfo.data[currentVertex] = sceneInfo.data[face.offset + k]\n          currentVertex += 1\n        }\n\n        face.offset = newOffset\n      }\n\n      const newFaces: FaceInfo[] = []\n      let currentTextureIndex = -1\n      for (let j = 0; j < model.faces.length; ++j) {\n        const face = model.faces[j]\n\n        if (face.textureIndex === currentTextureIndex) {\n          newFaces[newFaces.length - 1].length += face.length\n        } else {\n          // merge\n          newFaces.push({\n            offset: face.offset,\n            length: face.length,\n            textureIndex: face.textureIndex\n          })\n          currentTextureIndex = face.textureIndex\n        }\n      }\n      model.faces = newFaces\n    }\n    this.sceneInfo = sortedSceneInfo\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer)\n    gl.bufferData(gl.ARRAY_BUFFER, this.sceneInfo.data, gl.STATIC_DRAW)\n  }\n\n  private loadTextures(bsp: Bsp) {\n    const gl = this.context.gl\n\n    for (let i = 0; i < bsp.textures.length; ++i) {\n      const glTexture = gl.createTexture()\n      if (!glTexture) {\n        // shouldnt happen\n        // TODO: handle better\n        throw new Error('fatal error')\n      }\n\n      const texture = bsp.textures[i]\n      if (!isPowerOfTwo(texture.width) || !isPowerOfTwo(texture.height)) {\n        const w = texture.width\n        const h = texture.height\n        const nw = nextPowerOfTwo(texture.width)\n        const nh = nextPowerOfTwo(texture.height)\n        texture.data = resizeTexture(texture.data, w, h, nw, nh)\n        texture.width = nw\n        texture.height = nh\n      }\n\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        texture.width,\n        texture.height,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        texture.data\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n      gl.texParameteri(\n        gl.TEXTURE_2D,\n        gl.TEXTURE_MIN_FILTER,\n        gl.LINEAR_MIPMAP_LINEAR\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n      gl.generateMipmap(gl.TEXTURE_2D)\n\n      const anisotropy = this.context.getAnisotropyExtension()\n      if (anisotropy) {\n        gl.texParameteri(\n          gl.TEXTURE_2D,\n          anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\n          this.context.getMaxAnisotropy(anisotropy)\n        )\n      }\n\n      this.textures.push({\n        name: texture.name,\n        width: texture.width,\n        height: texture.height,\n        data: texture.data,\n        handle: glTexture\n      })\n    }\n  }\n\n  private loadSpriteTextures(bsp: Bsp) {\n    const gl = this.context.gl\n\n    for (const [name, sprite] of Object.entries(bsp.sprites)) {\n      const glTexture = gl.createTexture()\n      if (!glTexture) {\n        // shouldnt happen\n        // TODO: handle better\n        throw new Error('fatal error')\n      }\n\n      const texture = sprite.frames[0]\n      if (!isPowerOfTwo(texture.width) || !isPowerOfTwo(texture.height)) {\n        const w = texture.width\n        const h = texture.height\n        const nw = nextPowerOfTwo(texture.width)\n        const nh = nextPowerOfTwo(texture.height)\n        texture.data = resizeTexture(texture.data, w, h, nw, nh)\n        texture.width = nw\n        texture.height = nh\n      }\n\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        texture.width,\n        texture.height,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        texture.data\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n      gl.texParameteri(\n        gl.TEXTURE_2D,\n        gl.TEXTURE_MIN_FILTER,\n        gl.LINEAR_MIPMAP_LINEAR\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n      gl.generateMipmap(gl.TEXTURE_2D)\n\n      const anisotropy = this.context.getAnisotropyExtension()\n      if (anisotropy) {\n        gl.texParameteri(\n          gl.TEXTURE_2D,\n          anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\n          this.context.getMaxAnisotropy(anisotropy)\n        )\n      }\n\n      this.textures.push({\n        name: name,\n        width: texture.width,\n        height: texture.height,\n        data: texture.data,\n        handle: glTexture\n      })\n      this.sprites[name] = sprite\n    }\n  }\n\n  private loadLightmap(bsp: Bsp) {\n    const gl = this.context.gl\n\n    const glLightmap = gl.createTexture()\n    if (!glLightmap) {\n      // shouldnt happen\n      // TODO: handle better\n      throw new Error('fatal error')\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, glLightmap)\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      bsp.lightmap.width,\n      bsp.lightmap.height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      bsp.lightmap.data\n    )\n    gl.generateMipmap(gl.TEXTURE_2D)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n    gl.texParameteri(\n      gl.TEXTURE_2D,\n      gl.TEXTURE_MIN_FILTER,\n      gl.LINEAR_MIPMAP_LINEAR\n    )\n\n    this.lightmap = {\n      data: bsp.lightmap.data,\n      handle: glLightmap\n    }\n  }\n\n  draw(camera: Camera, entities: any[]) {\n    if (!this.bsp || !this.lightmap) {\n      return\n    }\n\n    const gl = this.context.gl\n    const shader = this.shader\n\n    shader.useProgram(gl)\n\n    camera.updateProjectionMatrix()\n    camera.updateViewMatrix()\n\n    shader.setViewMatrix(gl, camera.viewMatrix)\n    shader.setProjectionMatrix(gl, camera.projectionMatrix)\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer)\n    shader.enableVertexAttribs(gl)\n    shader.setVertexAttribPointers(gl)\n\n    shader.setDiffuse(gl, 0)\n    shader.setLightmap(gl, 1)\n\n    gl.activeTexture(gl.TEXTURE1)\n    gl.bindTexture(gl.TEXTURE_2D, this.lightmap.handle)\n\n    gl.activeTexture(gl.TEXTURE0)\n\n    const opaqueEntities = []\n    const transparentEntities = []\n    for (let i = 1; i < entities.length; ++i) {\n      const e = entities[i]\n      if (e.model) {\n        if (\n          !e.rendermode ||\n          e.rendermode == RenderMode.Normal ||\n          e.rendermode == RenderMode.Solid\n        ) {\n          if (e.model[0] === '*') {\n            const model = this.sceneInfo.models[parseInt(e.model.substr(1))]\n            if (model.isTransparent) {\n              transparentEntities.push(e)\n              continue\n            }\n          } else if (e.model.indexOf('.spr') > -1) {\n            transparentEntities.push(e)\n            continue\n          }\n\n          opaqueEntities.push(e)\n        } else if (e.rendermode == RenderMode.Additive) {\n          transparentEntities.push(e)\n        } else {\n          transparentEntities.push(e)\n        }\n      }\n    }\n\n    shader.setOpacity(gl, 1.0)\n    this.renderWorldSpawn()\n    this.renderOpaqueEntities(camera, opaqueEntities)\n\n    if (transparentEntities.length) {\n      gl.depthMask(false)\n      this.renderTransparentEntities(transparentEntities, camera)\n      gl.depthMask(true)\n    }\n  }\n\n  private renderWorldSpawn() {\n    const model = this.sceneInfo.models[0]\n    const gl = this.context.gl\n\n    mat4.identity(this.modelMatrix)\n    this.shader.setModelMatrix(gl, this.modelMatrix)\n\n    for (let j = 0; j < model.faces.length; ++j) {\n      const face = model.faces[j]\n      gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\n      gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n    }\n  }\n\n  private renderOpaqueEntities(camera: Camera, entities: any[]) {\n    const gl = this.context.gl\n    const shader = this.shader\n    const mmx = this.modelMatrix\n\n    for (let i = 0; i < entities.length; ++i) {\n      const entity = entities[i]\n      const modelIndex = parseInt(entity.model.substr(1))\n      const model = this.sceneInfo.models[modelIndex]\n      if (model) {\n        const angles = entity.angles || [0, 0, 0]\n        const origin = entity.origin\n          ? vec3.fromValues(\n              entity.origin[0],\n              entity.origin[1],\n              entity.origin[2]\n            )\n          : vec3.create()\n        vec3.add(origin, origin, model.origin)\n\n        // TODO: this seems to work, but needs further research\n        mat4.identity(mmx)\n        mat4.translate(mmx, mmx, origin)\n        // mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180) // dunno this\n        mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180)\n        mat4.rotateX(\n          this.modelMatrix,\n          this.modelMatrix,\n          (angles[2] * Math.PI) / 180\n        )\n        shader.setModelMatrix(gl, this.modelMatrix)\n\n        for (let j = 0; j < model.faces.length; ++j) {\n          const face = model.faces[j]\n          gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\n          gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n        }\n      } else if (entity.model.indexOf('.spr') > -1) {\n        const texture = this.textures.find(a => a.name === entity.model)\n        const sprite = this.sprites[entity.model]\n        if (texture && sprite) {\n          const origin = entity.origin\n            ? vec3.fromValues(\n                entity.origin[0],\n                entity.origin[1],\n                entity.origin[2]\n              )\n            : vec3.create()\n          const scale = vec3.fromValues(texture.width, 1, texture.height)\n          const angles = entity.angles\n            ? vec3.fromValues(\n                entity.angles[0],\n                entity.angles[2],\n                entity.angles[1]\n              )\n            : vec3.create()\n          vec3.scale(scale, scale, entity.scale || 1)\n\n          mat4.identity(mmx)\n          mat4.translate(mmx, mmx, origin)\n\n          switch (sprite.header.type) {\n            case SpriteType.VP_PARALLEL_UPRIGHT: {\n              // TODO: incorrect, but will do for now\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.FACING_UPRIGHT: {\n              // TODO: fix incorrect\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL: {\n              mat4.rotateZ(\n                mmx,\n                mmx,\n                Math.atan2(\n                  origin[1] - camera.position[1],\n                  origin[0] - camera.position[0]\n                ) +\n                  Math.PI / 2\n              )\n              mat4.rotateX(\n                mmx,\n                mmx,\n                Math.atan2(\n                  camera.position[2] - origin[2],\n                  Math.sqrt(\n                    Math.pow(camera.position[0] - origin[0], 2) +\n                      Math.pow(camera.position[1] - origin[1], 2)\n                  )\n                )\n              )\n\n              break\n            }\n            case SpriteType.ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              mat4.rotateX(mmx, mmx, (angles[2] * Math.PI) / 180 - Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL_ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              break\n            }\n            default: {\n              throw new Error('Invalid sprite type')\n            }\n          }\n\n          mat4.scale(mmx, mmx, scale)\n          shader.setModelMatrix(gl, mmx)\n          shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n\n          const renderMode = entity.rendermode || RenderMode.Normal\n          switch (renderMode) {\n            case RenderMode.Normal: {\n              shader.setOpacity(gl, 1)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Color: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Texture: {\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Glow: {\n              // TODO: not properly implemented\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n            case RenderMode.Solid: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Additive: {\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n          }\n        }\n      }\n    }\n  }\n\n  private renderTransparentEntities(entities: any[], camera: Camera) {\n    const gl = this.context.gl\n    const shader = this.shader\n    const mmx = this.modelMatrix\n\n    // distances of all entities from the camera\n    const entityDistances: {\n      index: number\n      distance: number\n    }[] = entities\n      .map((e, i) => ({\n        index: i,\n        distance: vec3.dist(camera.position, e.origin || [0, 0, 0])\n      }))\n      .sort((a, b) => a.distance - b.distance)\n\n    for (let i = 0; i < entityDistances.length; ++i) {\n      const entity = entities[entityDistances[i].index]\n\n      const modelIndex = parseInt(entity.model.substr(1))\n      const model = this.sceneInfo.models[modelIndex]\n      if (model) {\n        const angles = entity.angles || [0, 0, 0]\n        const origin = entity.origin || [0, 0, 0]\n        origin[0] += model.origin[0]\n        origin[1] += model.origin[1]\n        origin[2] += model.origin[2]\n\n        // TODO: this seems to work, but needs further research\n        mat4.identity(mmx)\n        mat4.translate(mmx, mmx, origin)\n        mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180)\n        // mat4.rotateY(mmx, mmx, (angles[2] * Math.PI) / 180) // dunno this\n        mat4.rotateX(\n          this.modelMatrix,\n          this.modelMatrix,\n          (angles[2] * Math.PI) / 180\n        )\n        shader.setModelMatrix(gl, this.modelMatrix)\n\n        const renderMode = entity.rendermode || RenderMode.Normal\n        switch (renderMode) {\n          case RenderMode.Normal: {\n            shader.setOpacity(gl, 1)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Color: {\n            // TODO: not properly implemented\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Texture: {\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Glow: {\n            // TODO: not properly implemented\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Solid: {\n            // TODO: not properly implemented\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Additive: {\n            gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n            break\n          }\n        }\n      } else if (entity.model.indexOf('.spr') > -1) {\n        const texture = this.textures.find(a => a.name === entity.model)\n        const sprite = this.sprites[entity.model]\n        if (texture && sprite) {\n          const origin = entity.origin\n            ? vec3.fromValues(\n                entity.origin[0],\n                entity.origin[1],\n                entity.origin[2]\n              )\n            : vec3.create()\n          const scale = vec3.fromValues(texture.width, 1, texture.height)\n          const angles = entity.angles\n            ? vec3.fromValues(\n                entity.angles[0],\n                entity.angles[2],\n                entity.angles[1]\n              )\n            : vec3.create()\n          vec3.scale(scale, scale, entity.scale || 1)\n\n          mat4.identity(mmx)\n          mat4.translate(mmx, mmx, origin)\n\n          switch (sprite.header.type) {\n            case SpriteType.VP_PARALLEL_UPRIGHT: {\n              // TODO: incorrect, but will do for now\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.FACING_UPRIGHT: {\n              // TODO: fix incorrect\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL: {\n              mat4.rotateZ(\n                mmx,\n                mmx,\n                Math.atan2(\n                  origin[1] - camera.position[1],\n                  origin[0] - camera.position[0]\n                ) +\n                  Math.PI / 2\n              )\n              mat4.rotateX(\n                mmx,\n                mmx,\n                Math.atan2(\n                  camera.position[2] - origin[2],\n                  Math.sqrt(\n                    Math.pow(camera.position[0] - origin[0], 2) +\n                      Math.pow(camera.position[1] - origin[1], 2)\n                  )\n                )\n              )\n\n              break\n            }\n            case SpriteType.ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              mat4.rotateX(mmx, mmx, (angles[2] * Math.PI) / 180 - Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL_ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              break\n            }\n            default: {\n              throw new Error('Invalid sprite type')\n            }\n          }\n\n          mat4.scale(mmx, mmx, scale)\n          shader.setModelMatrix(gl, mmx)\n          shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n\n          const renderMode = entity.rendermode || RenderMode.Normal\n          switch (renderMode) {\n            case RenderMode.Normal: {\n              shader.setOpacity(gl, 1)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Color: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Texture: {\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Glow: {\n              // TODO: not properly implemented\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n            case RenderMode.Solid: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Additive: {\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","import { mat4 } from 'gl-matrix'\nimport { Context, Program } from '../Context'\n\nconst fragmentSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\nuniform sampler2D lightmap;\nuniform float opacity;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  vec4 lightColor = texture2D(lightmap, vLightmapCoord);\n\n  gl_FragColor = vec4(diffuseColor.rgb * lightColor.rgb, diffuseColor.a * opacity);\n}`\n\nconst vertexSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\nattribute vec2 texCoord2;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  vLightmapCoord = texCoord2;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1);\n}`\n\nexport class MainShader {\n  static init(context: Context): MainShader | null {\n    const attributeNames = ['position', 'texCoord', 'texCoord2']\n    const uniformNames: string[] = [\n      'modelMatrix',\n      'viewMatrix',\n      'projectionMatrix',\n      'diffuse',\n      'lightmap',\n      'opacity'\n    ]\n    const program = context.createProgram({\n      vertexShaderSrc: vertexSrc,\n      fragmentShaderSrc: fragmentSrc,\n      attributeNames,\n      uniformNames\n    })\n    if (!program) {\n      console.log(`programn't`)\n      return null\n    }\n\n    return new MainShader(program)\n  }\n\n  private program: WebGLProgram\n  private aPosition: number\n  private aTexCoord: number\n  private aTexCoord2: number\n  private uModelMx: WebGLUniformLocation\n  private uViewMx: WebGLUniformLocation\n  private uProjectionMx: WebGLUniformLocation\n  private uDiffuse: WebGLUniformLocation\n  private uLightmap: WebGLUniformLocation\n  private uOpacity: WebGLUniformLocation\n\n  private constructor(program: Program) {\n    this.program = program.handle\n    this.aPosition = program.attributes['position']\n    this.aTexCoord = program.attributes['texCoord']\n    this.aTexCoord2 = program.attributes['texCoord2']\n    this.uModelMx = program.uniforms['modelMatrix']\n    this.uViewMx = program.uniforms['viewMatrix']\n    this.uProjectionMx = program.uniforms['projectionMatrix']\n    this.uDiffuse = program.uniforms['diffuse']\n    this.uLightmap = program.uniforms['lightmap']\n    this.uOpacity = program.uniforms['opacity']\n  }\n\n  useProgram(gl: WebGLRenderingContext) {\n    gl.useProgram(this.program)\n  }\n\n  setModelMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uModelMx, false, matrix)\n  }\n\n  setViewMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uViewMx, false, matrix)\n  }\n\n  setProjectionMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uProjectionMx, false, matrix)\n  }\n\n  setDiffuse(gl: WebGLRenderingContext, value: number) {\n    gl.uniform1i(this.uDiffuse, value)\n  }\n\n  setLightmap(gl: WebGLRenderingContext, val: number) {\n    gl.uniform1i(this.uLightmap, val)\n  }\n\n  setOpacity(gl: WebGLRenderingContext, val: number) {\n    gl.uniform1f(this.uOpacity, val)\n  }\n\n  enableVertexAttribs(gl: WebGLRenderingContext) {\n    gl.enableVertexAttribArray(this.aPosition)\n    gl.enableVertexAttribArray(this.aTexCoord)\n    gl.enableVertexAttribArray(this.aTexCoord2)\n  }\n\n  setVertexAttribPointers(gl: WebGLRenderingContext) {\n    gl.vertexAttribPointer(this.aPosition, 3, gl.FLOAT, false, 7 * 4, 0)\n    gl.vertexAttribPointer(this.aTexCoord, 2, gl.FLOAT, false, 7 * 4, 3 * 4)\n    gl.vertexAttribPointer(this.aTexCoord2, 2, gl.FLOAT, false, 7 * 4, 5 * 4)\n  }\n}\n","export interface WorldSpawn {\n  classname: 'worldspawn'\n  wad: string[]\n  mapversion: number\n  skyname: string\n  maxRange: number\n  message: string\n  sounds: number\n  light: number\n  waveHeight: number\n  startDark: WorldSpawnStartDark\n  newUnit: WorldSpawnNewUnit\n  gameTitle: WorldSpawnGameTitle\n  defaultTeam: WorldSpawnDefaultTeam\n}\nexport enum WorldSpawnStartDark {\n  No = 0,\n  Yes = 1 // the level will start black with fade in\n}\nexport enum WorldSpawnGameTitle {\n  No = 0,\n  Yes = 1 // \"Half-Life\" will be displayed after the map loads\n}\nexport enum WorldSpawnNewUnit {\n  No = 0,\n  Yes = 1 // All previous global triggers will be removed\n}\nexport enum WorldSpawnDefaultTeam {\n  FewestPlayers = 0,\n  FirstTeam = 1\n}\n\nexport interface AiScriptedSequence {\n  classname: 'aiscripted_sequence'\n  m_iszEntity: string\n\tm_iszPlay: string\n\tm_flRadius: number\n\tm_flRepeat: number\n\tm_fMoveTo: AiScriptedSequenceMoveTo\n\tm_iFinishSchedule: AiScriptedSequenceFinishSchedule\n\tspawnflags: AiScriptedSequenceSpawnflags\n}\nexport enum AiScriptedSequenceMoveTo {\n  No = 0,\n  Walk = 1,\n  Run = 2,\n  Instantaneous = 4,\n  No_TurnToFace = 5\n}\nexport enum AiScriptedSequenceFinishSchedule {\n  DefaultAI = 0,\n  Ambush = 1\n}\nexport enum AiScriptedSequenceSpawnflags {\n  Repeatable = 4,\n  LeaveCorpse = 8\n}\n\nexport interface AmbientGeneric {\n  classname: 'ambient_generic'\n  origin: number[]\n  targetName: string\n  message: string\n  health: number\n  preset: AmbientGenericPreset\n  startVolume: number\n  fadeIn: number\n  fadeOut: number\n  pitch: number\n  pitchStart: number\n  spinUp: number\n  spinDown: number\n  lfoType: number\n  lfoRate: number\n  lfoModPitch: number\n  lfoModVolume: number\n  cSpinUp: number\n  spawnFlags: AmbientGenericSpawnFlags\n}\nexport enum AmbientGenericPreset {\n  None = 0,\n  HugeMachine = 1,\n  BigMachine = 2,\n  Machine = 3,\n  SlowFadeIn = 4,\n  FadeIn = 5,\n  QuickFadeIn = 6,\n  SlowPulse = 7,\n  Pulse = 8,\n  QuickPulse = 9,\n  SlowOscillator = 10,\n  Oscillator = 11,\n\tQuickOscillator = 12,\n\tGrungePitch = 13,\n\tVeryLowPitch = 14,\n\tLowPitch = 15,\n\tHighPitch = 16,\n\tVeryHighPitch = 17,\n\tScreamingPitch = 18,\n\tOscillateSpinUpDown = 19,\n\tPulseSpinUpDown = 20,\n\tRandomPitch = 21,\n\tRandomPitchFast = 22,\n\tIncrementalSpinup = 23,\n\tAlien = 24,\n\tBizzare = 25,\n\tPlanetX = 26,\n\tHaunted = 27\n}\nexport enum AmbientGenericSpawnFlags {\n  PlayEverywhere = 1,\n  SmallRadius = 2,\n  MediumRadius = 4,\n  LargeRadius = 8,\n  StartSilent = 16,\n  NotToggled = 32\n}\n\nexport interface Ammo357 {\n  classname: 'ammo_357'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface Ammo9mmAR {\n  classname: 'ammo_9mmAR'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface Ammo9mmBox {\n  classname: 'ammo_9mmbox'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface Ammo9mmClip {\n  classname: 'ammo_9mmclip'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoARGrenades {\n  classname: 'ammo_ARgrenades'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoBuckShot {\n  classname: 'ammo_buckshot'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoCrossBox {\n  classname: 'ammo_crossbow'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoGaussClip {\n  classname: 'ammo_gaussclip'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoRPGClip {\n  classname: 'ammo_rpgclip'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface ButtonTarget {\n  classname: 'button_target'\n  target: string\n  master: string\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n  zhltLightFlags: ZHLTLightFlags\n  lightOrigin: string\n  spawnFlags: ButtonTargetSpawnFlags\n}\nexport enum ButtonTargetSpawnFlags {\n  UseActivates = 1,\n  StartOn = 2\n}\n\nexport interface Cycler {\n  classname: 'cycler'\n  origin: number[]\n  angles: number[]\n  targetName: string\n  model: string\n  sequence: string\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport interface CyclerSprite {\n  classname: 'cycler_sprite'\n  origin: number[]\n  angles: number[]\n  targetName: string\n  model: string\n  framerate: number\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport interface CyclerWeapon {\n  classname: 'cycler_weapon'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  triggerTarget: string\n  triggerCondition: CyclerWeaponTriggerCondition\n  model: string\n  sequence: string\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport enum CyclerWeaponTriggerCondition {\n  NoTrigger = 0,\n  SeePlayerMadAtPlayer = 1,\n  TakeDamage = 2,\n  HalfHealthRemaining = 3,\n  Death = 4,\n  HearWorld = 7,\n  HearPlayer = 8,\n  HearCombat = 9,\n  SeePlayerUnconditional = 10,\n  SeePlayerNotInCombat = 11\n}\n\nexport interface CyclerWreckage {\n  classname: 'cycler_wreckage'\n  origin: number[]\n  angles: number[]\n  targetName: string\n  model: string\n  framerate: number\n  scale: number\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport interface EnvBeam {\n  classname: 'env_beam',\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n  radius: number\n\tlife: number\n\tboltWidth: number\n\tnoiseAmplitude: number\n\ttexture: string\n\ttextureScroll: number\n\tframeRate: number\n\tframeStart: number\n\tstrikeTime: number\n\tdamage: number\n\tspawnFlags: EnvBeamSpawnFlags\n}\n\nexport enum EnvBeamSpawnFlags {\n  StartOn = 1,\n  Toggle = 2,\n  RandomStrike = 4,\n  Ring = 8,\n  StartSparks = 16,\n  EndSparks = 32,\n  DecalEnd = 64,\n  FadeStart = 128,\n  FadeEnd = 256\n}\n\nexport enum ZHLTLightFlags {\n  Normal = 0,\n  EmbeddedFix = 1,\n  OpaqueBlockLight = 2,\n  OpaqueEmbeddedFix = 3,\n  OpaqueConcaveFix = 6\n}\n\nexport enum RenderEffect {\n  Normal = 0,\n\tSlowPulse = 1, //* Additive or Texture mode only.\n  FastPulse = 2, //* Additive or Texture mode only.\n  SlowWidePulse = 3, //* Additive or Texture mode only.\n  FastWidePulse = 4,  //* Additive or Texture mode only.\n  SlowFadeAway = 5,\n\tFastFadeAway = 6,\n  SlowBecomeSolid = 7,\n  FastBecomeSolid = 8,\n  SlowStrobe = 9,\n  FastStrobe = 10,\n  FasterStrobe = 11,\n  SlowFlicker = 12,\n  FastFlicker = 13,\n  //* Constant Glow only affects the Glow rendermode. With this setting, Glow mode behaves\n  //* exactly like Additive mode - except that (as is usual for Glow mode) the sprite isn't\n  //* obscured by intervening sprites or models.\n  ConstantGlow = 14,\n  DistortModels = 15,\n  HologramDistort = 16\n}\n\nexport enum RenderMode {\n  Normal = 0,\n  Color = 1,\n  Texture = 2,\n  Glow = 3,\n  Solid = 4,\n  Additive = 5\n}\n\nconst parseNumberArray = (a: string) => a.split(' ').map(b => parseFloat(b))\n\nconst parsers: {\n  worldspawn: (entityData: {[name: string]: any}) => WorldSpawn\n  aiscripted_sequence: (entityData: {[name: string]: any}) => AiScriptedSequence\n  ambient_generic: (entityData: {[name: string]: any}) => AmbientGeneric\n  ammo_357: (entityData: {[name: string]: any}) => Ammo357\n  ammo_9mmAR: (entityData: {[name: string]: any}) => Ammo9mmAR\n  ammo_9mmbox: (entityData: {[name: string]: any}) => Ammo9mmBox\n  ammo_9mmclip: (entityData: {[name: string]: any}) => Ammo9mmClip\n  ammo_ARgrenades: (entityData: {[name: string]: any}) => AmmoARGrenades\n  ammo_buckshot: (entityData: {[name: string]: any}) => AmmoBuckShot\n  ammo_crossbow: (entityData: {[name: string]: any}) => AmmoCrossBox\n  ammo_gaussclip: (entityData: {[name: string]: any}) => AmmoGaussClip\n  ammo_rpgclip: (entityData: {[name: string]: any}) => AmmoRPGClip\n  button_target: (entityData: {[name: string]: any}) => ButtonTarget\n  cycler: (entityData: {[name: string]: any}) => Cycler\n  cycler_sprite: (entityData: {[name: string]: any}) => CyclerSprite\n  cyclear_weapon: (entityData: {[name: string]: any}) => CyclerWeapon\n  cyclear_wreckage: (entityData: {[name: string]: any}) => CyclerWreckage\n  env_beam: (entityData: {[name: string]: any}) => EnvBeam\n} = {\n  worldspawn: (e) => ({\n    classname: 'worldspawn',\n    wad: e.wad\n      .split(';')\n      .filter((a: string) => a.length)\n      .map((w: string) => w.replace(/\\\\/g, '/')),\n    mapversion: parseInt(e.mapversion),\n    skyname: e.skyname,\n    maxRange: parseFloat(e.MaxRange) || 8192,\n    message: e.message || '',\n    sounds: parseInt(e.sounds) || 0,\n    light: parseInt(e.light) || 0,\n    waveHeight: parseFloat(e.WaveHeight) || 0,\n    startDark: parseInt(e.startdark) || 0,\n    newUnit: parseInt(e.newunit) || 0,\n    defaultTeam: parseInt(e.defaultteam) || 0,\n    gameTitle: parseInt(e.gametitle) || 0\n  }),\n  aiscripted_sequence: (e) => ({\n    classname: 'aiscripted_sequence',\n    spawnflags: parseInt(e.spawnflags),\n    m_iszEntity: e.m_iszEntity,\n    m_iszPlay: e.m_iszPlay || '',\n    m_flRadius: parseInt(e.m_flRadius) || 512,\n    m_flRepeat: parseInt(e.m_flRepeat) || 0,\n    m_fMoveTo: parseInt(e.m_fMoveTo) || 0,\n    m_iFinishSchedule: parseInt(e.m_iFinishSchedule) || 0,\n  }),\n  ambient_generic: (e) => ({\n    classname: 'ambient_generic',\n    origin: parseNumberArray(e.origin),\n    targetName: e.targetname,\n    message: e.message,\n    health: parseInt(e.health) || 10,\n    preset: parseInt(e.preset) || 0,\n    startVolume: parseInt(e.volstart) || 0,\n    fadeIn: parseInt(e.fadein),\n    fadeOut: parseInt(e.fadeout),\n    pitch: parseInt(e.pitch),\n    pitchStart: parseInt(e.pitchstart),\n    spinUp: parseInt(e.spinup),\n    spinDown: parseInt(e.spindown),\n    lfoType: parseInt(e.lfotype),\n    lfoRate: parseInt(e.lforate),\n    lfoModPitch: parseInt(e.lfomodpitch),\n    lfoModVolume: parseInt(e.lfomodvolume),\n    cSpinUp: parseInt(e.cspinup),\n    spawnFlags: parseInt(e.spawnflags)\n  }),\n  ammo_357: (e) => ({\n    classname: 'ammo_357',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_9mmAR: (e) => ({\n    classname: 'ammo_9mmAR',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_9mmbox: (e) => ({\n    classname: 'ammo_9mmbox',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_9mmclip: (e) => ({\n    classname: 'ammo_9mmclip',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_ARgrenades: (e) => ({\n    classname: 'ammo_ARgrenades',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_buckshot: (e) => ({\n    classname: 'ammo_buckshot',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_crossbow: (e) => ({\n    classname: 'ammo_crossbow',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_gaussclip: (e) => ({\n    classname: 'ammo_gaussclip',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_rpgclip: (e) => ({\n    classname: 'ammo_rpgclip',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  button_target: (e) => ({\n    classname: 'button_target',\n    target: e.target,\n    master: e.master,\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0'),\n    zhltLightFlags: parseInt(e.zhlt_lightflags) || 0,\n    lightOrigin: e.light_origin,\n    spawnFlags: parseInt(e.spawnflags) || 1\n  }),\n  cycler: (e) => ({\n    classname: 'cycler',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    targetName: e.targetname,\n    model: e.model,\n    sequence: e.sequence || '',\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  cycler_sprite: (e) => ({\n    classname: 'cycler_sprite',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    targetName: e.targetname,\n    model: e.model,\n    framerate: parseInt(e.framerate || '10'),\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  cyclear_weapon: (e) => ({\n    classname: 'cycler_weapon',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname,\n    triggerTarget: e.TriggerTarget || '',\n    triggerCondition: parseInt(e.TriggerCondition) || 0,\n    model: e.model,\n    sequence: e.sequence,\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  cyclear_wreckage: (e) => ({\n    classname: 'cycler_wreckage',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    targetName: e.targetname,\n    model: e.model,\n    framerate: parseInt(e.framerate) || 10,\n    scale: parseFloat(e.scale) || 1.0,\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  env_beam: (e) => ({\n    classname: 'env_beam',\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0'),\n    radius: parseFloat(e.Radius) || 256,\n    life: parseInt(e.life) || 1,\n    boltWidth: parseInt(e.BoltWidth) || 20,\n    noiseAmplitude: parseInt(e.NoiseAmplitude) || 0,\n    texture: e.texture || 'sprites/laserbeam.spr',\n    textureScroll: parseInt(e.TextureScroll) || 35,\n    frameRate: parseInt(e.framerate) || 0,\n    frameStart: parseInt(e.framestart) || 0,\n    strikeTime: parseInt(e.StrikeTime) || 1,\n    damage: parseInt(e.damage) || 1,\n    spawnFlags: parseInt(e.spawnflags)\n  })\n}\n\n// env_beverage (Half-Life)\n// env_blood (Half-Life)\n// env_bubbles (Half-Life)\n// env_explosion (Half-Life)\n// env_fade (Half-Life)\n// env_funnel (Half-Life)\n// env_global (Half-Life)\n// env_glow (Half-Life)\n// env_laser (Half-Life)\n// env_message (Half-Life)\n// env_render (Half-Life)\n// env_shake (Half-Life)\n// env_shooter (Half-Life)\n// env_sound (Half-Life)\n// env_spark (Half-Life)\n// env_sprite (Half-Life)\n// func_breakable (Half-Life)\n// func_button (Half-Life)\n// func_conveyor (Half-Life)\n// func_door (Half-Life)\n// func_door_rotating (Half-Life)\n// func_friction (Half-Life)\n// func_guntarget (Half-Life)\n// func_healthcharge (Half-Life)\n// func_illusionary (Half-Life)\n// func_ladder (Half-Life)\n// func_minicompo (Half-Life)\n// func_monsterclip (Half-Life)\n// func_mortar_field (Half-Life)\n// func_pendulum (Half-Life)\n// func_plat (Half-Life)\n// func_platrot (Half-Life)\n// func_pushable (Half-Life)\n// func_recharge (Half-Life)\n// func_rot_button (Half-Life)\n// func_rotating (Half-Life)\n// func_tank (Half-Life)\n// func_tankcontrols (Half-Life)\n// func_tanklaser (Half-Life)\n// func_tankmortar (Half-Life)\n// func_tankrocket (Half-Life)\n// func_trackautochange (Half-Life)\n// func_trackchange (Half-Life)\n// func_tracktrain (Half-Life)\n// func_train (Half-Life)\n// func_traincontrols (Half-Life)\n// func_wall (Half-Life)\n// func_wall_toggle (Half-Life)\n// func_water (Half-Life)\n// game_counter (Half-Life)\n// game_counter_set (Half-Life)\n// game_end (Half-Life)\n// game_player_equip (Half-Life)\n// game_player_hurt (Half-Life)\n// game_player_team (Half-Life)\n// game_score (Half-Life)\n// game_team_master (Half-Life)\n// game_team_set (Half-Life)\n// game_text (Half-Life)\n// game_zone_player (Half-Life)\n// gibshooter (Half-Life)\n// info_bigmomma (Half-Life)\n// info_intermission (Half-Life)\n// info_landmark (Half-Life)\n// info_node (Half-Life)\n// info_node_air (Half-Life)\n// info_null (Half-Life)\n// info_player_coop (Half-Life)\n// info_player_deathmatch (Half-Life)\n// info_player_start (Half-Life)\n// info_target (Half-Life)\n// info_teleport_destination (Half-Life)\n// info_texlights (Half-Life)\n// infodecal (Half-Life)\n// item_airtank (Half-Life)\n// item_antidote (Half-Life)\n// item_battery (Half-Life)\n// item_healthkit (Half-Life)\n// item_longjump (Half-Life)\n// item_security (Half-Life)\n// item_sodacan (Half-Life)\n// item_suit (Half-Life)\n// light (Half-Life)\n// light_environment (Half-Life)\n// light_spot (Half-Life)\n// momentary_door (Half-Life)\n// momentary_rot_button (Half-Life)\n// monster_alien_controller (Half-Life)\n// monster_alien_grunt (Half-Life)\n// monster_alien_slave (Half-Life)\n// monster_apache (Half-Life)\n// monster_babycrab (Half-Life)\n// monster_barnacle (Half-Life)\n// monster_barney (Half-Life)\n// monster_barney_dead (Half-Life)\n// monster_bigmomma (Half-Life)\n// monster_bloater (Half-Life)\n// monster_bullchicken (Half-Life)\n// monster_cockroach (Half-Life)\n// monster_flyer_flock (Half-Life)\n// monster_furniture (Half-Life)\n// monster_gargantua (Half-Life)\n// monster_generic (Half-Life)\n// monster_gman (Half-Life)\n// monster_grunt_repel (Half-Life)\n// monster_handgrenade (Half-Life)\n// monster_headcrab (Half-Life)\n// monster_hevsuit_dead (Half-Life)\n// monster_hgrunt_dead (Half-Life)\n// monster_houndeye (Half-Life)\n// monster_human_assassin (Half-Life)\n// monster_human_grunt (Half-Life)\n// monster_ichthyosaur (Half-Life)\n// monster_leech (Half-Life)\n// monster_miniturret (Half-Life)\n// monster_nihilanth (Half-Life)\n// monster_osprey (Half-Life)\n// monster_rat (Half-Life)\n// monster_satchelcharge (Half-Life)\n// monster_scientist (Half-Life)\n// monster_scientist_dead (Half-Life)\n// monster_sentry (Half-Life)\n// monster_sitting_scientist (Half-Life)\n// monster_snark (Half-Life)\n// monster_tentacle (Half-Life)\n// monster_tripmine (Half-Life)\n// monster_turret (Half-Life)\n// monster_zombie (Half-Life)\n// monstermaker (Half-Life)\n// multi_manager (Half-Life)\n// multisource (Half-Life)\n// path_corner (Half-Life)\n// path_track (Half-Life)\n// player_loadsaved (Half-Life)\n// player_weaponstrip (Half-Life)\n// scripted_sentence (Half-Life)\n// scripted_sequence (Half-Life)\n// speaker (Half-Life)\n// target_cdaudio (Half-Life)\n// trigger_auto (Half-Life)\n// trigger_autosave (Half-Life)\n// trigger_camera (Half-Life)\n// trigger_cdaudio (Half-Life)\n// trigger_changelevel (Half-Life)\n// trigger_changetarget (Half-Life)\n// trigger_counter (Half-Life)\n// trigger_endsection (Half-Life)\n// trigger_gravity (Half-Life)\n// trigger_hurt (Half-Life)\n// trigger_monsterjump (Half-Life)\n// trigger_multiple (Half-Life)\n// trigger_once (Half-Life)\n// trigger_push (Half-Life)\n// trigger_relay (Half-Life)\n// trigger_teleport (Half-Life)\n// trigger_transition (Half-Life)\n// weapon_357 (Half-Life)\n// weapon_9mmAR (Half-Life)\n// weapon_9mmhandgun (Half-Life)\n// weapon_crossbow (Half-Life)\n// weapon_crowbar (Half-Life)\n// weapon_egon (Half-Life)\n// weapon_gauss (Half-Life)\n// weapon_handgrenade (Half-Life)\n// weapon_hornetgun (Half-Life)\n// weapon_rpg (Half-Life)\n// weapon_satchel (Half-Life)\n// weapon_shotgun (Half-Life)\n// weapon_snark (Half-Life)\n// weapon_tripmine (Half-Life)\n// weaponbox (Half-Life)\n// world_items (Half-Life)\n// worldspawn (Half-Life)\n// xen_hair (Half-Life)\n// xen_plantlight (Half-Life)\n// xen_spore_large (Half-Life)\n// xen_spore_medium (Half-Life)\n// xen_spore_small (Half-Life)\n// xen_tree (Half-Life)\n\nexport interface FuncBreakable {\n  classname: 'func_breakable'\n}\n\nexport interface BadEntity {\n  classname: '!'\n  data: any\n}\n\nexport interface UnknownEntity {\n  classname: '?'\n  originalClassname: string\n  data: any\n}\n\nexport type Entity = WorldSpawn | FuncBreakable | BadEntity | UnknownEntity\n\nexport class BspEntityParser {\n  static parse(entities: any[]): Entity[] {\n    const arr: Entity[] = []\n\n    for (let i = 0; i < entities.length; ++i) {\n      const e = entities[i]\n\n      if (!e.classname) {\n        arr.push({\n          classname: '!',\n          data: e\n        })\n      }\n\n      if ((parsers as any)[e.classname]) {\n        arr.push((parsers as any)[e.classname](e))\n      } else {\n        arr.push({\n          classname: '?',\n          originalClassname: e.classname,\n          data: e\n        })\n      }\n    }\n\n    return arr\n  }\n}\n","export const resizeTexture = (\n  pixels: Uint8Array,\n  width: number,\n  height: number,\n  newWidth: number,\n  newHeight: number\n) => {\n  const canvas = document.createElement('canvas')\n  const ctx = canvas.getContext('2d')\n  if (!ctx) {\n    throw new Error('Runtime error.')\n  }\n  canvas.width = width\n  canvas.height = height\n\n  const nc = document.createElement('canvas')\n  const nctx = nc.getContext('2d')\n  if (!nctx) {\n    throw new Error('Runtime error.')\n  }\n  nc.width = newWidth\n  nc.height = newHeight\n\n  const cid = ctx.createImageData(width, height)\n  for (let i = 0, size = width * height * 4; i < size; i += 4) {\n    cid.data[i] = pixels[i]\n    cid.data[i + 1] = pixels[i + 1]\n    cid.data[i + 2] = pixels[i + 2]\n    cid.data[i + 3] = pixels[i + 3]\n  }\n  ctx.putImageData(cid, 0, 0)\n\n  nctx.drawImage(canvas, 0, 0, newWidth, newHeight)\n\n  return new Uint8Array(nctx.getImageData(0, 0, newWidth, newHeight).data)\n}\n\nexport const isPowerOfTwo = (n: number) => (n & (n - 1)) === 0\n\nexport const nextPowerOfTwo = (n: number) => {\n  --n\n  for (let i = 1; i < 32; i <<= 1) {\n    n = n | (n >> i)\n  }\n  return n + 1\n}","type ConfigPaths = {\n  base: string\n  replays: string\n  maps: string\n  wads: string\n  skies: string\n  sounds: string\n}\n\nexport class Config {\n  public static init(params: any): Config {\n    if (typeof params === 'string') {\n      return new Config({\n        paths: {\n          base: params,\n          replays: `${params}/replays`,\n          maps: `${params}/maps`,\n          wads: `${params}/wads`,\n          skies: `${params}/skies`,\n          sounds: `${params}/sounds`\n        }\n      })\n    } else {\n      return new Config({\n        paths: {\n          base: (params && params.paths && params.paths.base) || '',\n          replays: (params && params.paths && params.paths.replays) || '/replays',\n          maps: (params && params.paths && params.paths.maps) || '/maps',\n          wads: (params && params.paths && params.paths.wads) || '/wads',\n          skies: (params && params.paths && params.paths.skies) || '/skies',\n          sounds: (params && params.paths && params.paths.sounds) || '/sounds'\n        }\n      })\n    }\n  }\n\n  private paths: ConfigPaths\n\n  constructor(params: { paths: ConfigPaths }) {\n    this.paths = { ...params.paths }\n  }\n\n  getBasePath() {\n    return this.paths.base\n  }\n  getReplaysPath() {\n    return this.paths.replays\n  }\n  getMapsPath() {\n    return this.paths.maps\n  }\n  getWadsPath() {\n    return this.paths.wads\n  }\n  getSkiesPath() {\n    return this.paths.skies\n  }\n  getSoundsPath() {\n    return this.paths.sounds\n  }\n}\n","import { h, render } from 'preact'\nimport { Game } from '../Game'\nimport { Root } from './Root'\n\nexport class PlayerInterface {\n  private game: Game\n  private rootNode: Element\n\n  constructor(game: Game) {\n    this.game = game\n  }\n\n  getRootNode() {\n    return this.rootNode\n  }\n\n  draw(selector: string) {\n    const element = document.querySelector(selector)\n    if (element) {\n      this.rootNode = element\n      render(<Root game={this.game} root={this.rootNode} />, element)\n    }\n    // TODO: else throw\n  }\n}\n","import { h, Component } from 'preact'\nimport { Loading } from './Loading'\nimport { FreeMode } from './FreeMode'\nimport { ReplayMode } from './ReplayMode'\nimport { Fullscreen } from '../Fullscreen'\nimport { Game, PlayerMode } from '../Game'\nimport { RootStyle as s } from './Root.style'\n\ninterface RootProps {\n  game: Game\n  root: Element\n}\n\ninterface RootState {\n  title: string\n  isActive: boolean\n  isLoading: boolean\n  isMouseOver: boolean\n  isVisible: boolean\n}\n\nexport class Root extends Component<RootProps, RootState> {\n  private node: HTMLDivElement\n  private fadeOut: any = 0\n\n  constructor(props: RootProps) {\n    super(props)\n\n    this.state = {\n      title: props.game.title,\n      isActive: false,\n      isLoading: false,\n      isMouseOver: false,\n      isVisible: false\n    }\n  }\n\n  componentDidMount() {\n    if (!this.node) {\n      return\n    }\n\n    const game = this.props.game\n    const root = this.props.root\n\n    this.node.appendChild(game.getCanvas())\n\n    game.on('loadstart', this.onLoadStart)\n    game.on('load', this.onLoadEnd)\n    game.on('modechange', this.onModeChange)\n    game.on('titlechange', this.onTitleChange)\n\n    root.addEventListener('click', this.onRootClick)\n    window.addEventListener('click', this.onWindowClick)\n    window.addEventListener('keydown', this.onKeyDown)\n    document.addEventListener(\n      'pointerlockchange',\n      this.onPointerLockChange,\n      false\n    )\n\n    root.addEventListener('mouseover', this.onMouseEnter)\n    root.addEventListener('mousemove', this.onMouseMove)\n    root.addEventListener('mouseout', this.onMouseLeave)\n    root.addEventListener('contextmenu', this.onContextMenu)\n  }\n\n  componentWillUnmount() {\n    const game = this.props.game\n    const root = this.props.root\n\n    game.off('loadstart', this.onLoadStart)\n    game.off('load', this.onLoadEnd)\n    game.off('modechange', this.onModeChange)\n    game.off('titlechange', this.onTitleChange)\n\n    root.removeEventListener('click', this.onRootClick)\n    window.removeEventListener('click', this.onWindowClick)\n    window.removeEventListener('keydown', this.onKeyDown)\n    document.removeEventListener(\n      'pointerlockchange',\n      this.onPointerLockChange,\n      false\n    )\n\n    root.removeEventListener('mouseover', this.onMouseEnter)\n    root.removeEventListener('mousemove', this.onMouseMove)\n    root.removeEventListener('mouseout', this.onMouseLeave)\n    root.removeEventListener('contextmenu', this.onContextMenu)\n  }\n\n  onPointerLockChange = () => {\n    if (document.pointerLockElement === this.props.root) {\n      this.props.game.pointerLocked = true\n    } else {\n      this.props.game.pointerLocked = false\n    }\n  }\n\n  onContextMenu = (e: Event) => {\n    e.preventDefault()\n  }\n\n  onWindowClick = () => {\n    this.setState({ isActive: false })\n  }\n\n  onRootClick = (e: MouseEvent) => {\n    e.stopPropagation()\n    this.setState({ isActive: true })\n    this.fadeReset()\n  }\n\n  onKeyDown = (e: KeyboardEvent) => {\n    if (!this.state.isActive) {\n      return\n    }\n\n    const game = this.props.game\n\n    switch (e.which) {\n      case 70: {\n        // F\n        if (Fullscreen.isInFullscreen()) {\n          Fullscreen.exit()\n        } else {\n          Fullscreen.enter(this.props.root)\n        }\n        this.fadeReset()\n        break\n      }\n\n      case 77: {\n        // M\n        game.soundSystem.toggleMute()\n        this.fadeReset()\n        break\n      }\n\n      case 38: {\n        // arrow up\n        game.soundSystem.setVolume(game.soundSystem.getVolume() + 0.05)\n        this.fadeReset()\n        break\n      }\n      case 40: {\n        // arrow down\n        game.soundSystem.setVolume(game.soundSystem.getVolume() - 0.05)\n        this.fadeReset()\n        break\n      }\n\n      case 74: // J\n      case 37: {\n        // arrow left\n        game.player.seek(game.player.currentTime - 5)\n        this.fadeReset()\n        break\n      }\n      case 76: // L\n      case 39: {\n        // arrow right\n        game.player.seek(game.player.currentTime + 5)\n        this.fadeReset()\n        break\n      }\n\n      case 75: // K\n      case 32: {\n        // space\n        if (this.props.game.mode !== PlayerMode.REPLAY) {\n          return\n        }\n\n        if (!game.player.isPlaying || game.player.isPaused) {\n          game.player.play()\n        } else {\n          game.player.pause()\n        }\n        break\n      }\n    }\n  }\n\n  onModeChange = () => {\n    this.forceUpdate()\n  }\n\n  onLoadStart = () => {\n    this.setState({ isLoading: true })\n  }\n\n  onLoadEnd = () => {\n    this.setState({ isLoading: false })\n  }\n\n  onTitleChange = (title: string) => {\n    this.setState({ title })\n  }\n\n  onMouseEnter = () => {\n    this.setState({ isMouseOver: true })\n    this.fadeReset()\n  }\n\n  onMouseMove = () => {\n    if (this.state.isMouseOver && !Fullscreen.isInFullscreen()) {\n      this.fadeReset()\n    }\n  }\n\n  onMouseLeave = () => {\n    this.setState({\n      isMouseOver: false,\n      isVisible: false\n    })\n\n    clearTimeout(this.fadeOut)\n    this.fadeOut = 0\n  }\n\n  fadeReset = () => {\n    if (!this.state.isVisible) {\n      this.setState({ isVisible: true })\n    }\n\n    clearTimeout(this.fadeOut)\n    this.fadeOut = setTimeout(() => {\n      this.setState({ isVisible: false })\n      this.fadeOut = 0\n    }, 5000)\n  }\n\n  onScreenClick = () => {\n    switch (this.props.game.mode) {\n      case PlayerMode.REPLAY: {\n        const player = this.props.game.player\n        if (!player.isPlaying || player.isPaused) {\n          player.play()\n        } else {\n          player.pause()\n        }\n        break\n      }\n\n      case PlayerMode.FREE: {\n        this.props.root.requestPointerLock()\n\n        break\n      }\n    }\n  }\n\n  onScreenDblClick = () => {\n    if (Fullscreen.isInFullscreen()) {\n      Fullscreen.exit()\n    } else {\n      Fullscreen.enter(this.props.root)\n    }\n  }\n\n  render() {\n    const game = this.props.game\n    const isVisible = this.state.isVisible\n\n    return (\n      <div class={isVisible ? s.rootVisible : s.root}>\n        <div class={isVisible ? s.titleVisible : s.title}>\n          {this.state.title}\n        </div>\n\n        <Loading game={game} visible={this.state.isLoading} />\n\n        <div\n          class={s.screen}\n          ref={node => (this.node = node)}\n          onClick={this.onScreenClick}\n          onDblClick={this.onScreenDblClick}\n        />\n\n        {game.mode === PlayerMode.FREE ? (\n          <FreeMode\n            class={isVisible ? s.controlsVisible : s.controls}\n            game={game}\n            root={this.props.root}\n          />\n        ) : (\n          <ReplayMode\n            class={isVisible ? s.controlsVisible : s.controls}\n            game={game}\n            root={this.props.root}\n            visible={this.state.isMouseOver}\n          />\n        )}\n      </div>\n    )\n  }\n}\n","import { h, Component } from 'preact'\nimport { Game } from '../../Game'\nimport { LoadItem } from '../../Loader'\nimport { LoadingStyle as s } from './style'\n\ninterface LoadingProps {\n  game: Game\n  visible: boolean\n}\n\ninterface LoadingState {\n  items: {\n    [name: string]: {\n      name: string\n      progress: number\n    }[]\n  }\n}\n\nconst itemTypeGroupName: { [name: string]: string } = {\n  replay: 'Replay',\n  bsp: 'Map',\n  sound: 'Sounds',\n  sky: 'Skybox',\n  sprite: 'Sprites',\n  wad: 'Wads'\n}\n\nexport class Loading extends Component<LoadingProps, LoadingState> {\n  state: LoadingState = {\n    items: {}\n  }\n\n  componentDidMount() {\n    const loader = this.props.game.loader\n    loader.addLoadStartListener(this.onItemLoad)\n    loader.addProgressListener(this.onItemProgress)\n  }\n\n  componentWillUnmount() {\n    const loader = this.props.game.loader\n    loader.removeLoadStartListener(this.onItemLoad)\n    loader.removeProgressListener(this.onItemProgress)\n  }\n\n  onItemLoad = (item: LoadItem) => {\n    const items = this.state.items[item.type] ? this.state.items[item.type] : []\n\n    for (let i = 0; i < items.length; ++i) {\n      if (items[i] === item) {\n        return\n      }\n    }\n\n    items.push({\n      name: item.name,\n      progress: 0\n    })\n\n    this.setState({\n      items: {\n        ...this.state.items,\n        [item.type]: items\n      }\n    })\n  }\n\n  onItemProgress = (item: any) => {\n    if (!this.state.items[item.type]) {\n      return\n    }\n\n    const items = this.state.items[item.type]\n\n    for (let i = 0; i < items.length; ++i) {\n      if (items[i].name === item.name) {\n        items[i].progress = item.progress\n        break\n      }\n    }\n\n    this.forceUpdate()\n  }\n\n  formatItem(name: string, progress: number) {\n    name = itemTypeGroupName[name]\n    const status = Math.round(progress * 100) + '%'\n\n    let length = 29 - name.length - status.length\n    if (length < 2) {\n      length = 9 - status.length\n    }\n\n    const dots = Array(length).join('.')\n\n    return `${name}${dots}${status}`\n  }\n\n  render() {\n    return (\n      <div class={this.props.visible ? s.loading : s.loadingHidden}>\n        <div class={s.spinner}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            x=\"0px\"\n            y=\"0px\"\n            width=\"80px\"\n            height=\"80px\"\n            viewBox=\"0 0 80 80\"\n            xmlSpace=\"preserve\"\n          >\n            <path\n              fill=\"#ffffff\"\n              width=\"10px\"\n              d=\"M40,72C22.4,72,8,57.6,8,40C8,22.4,22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z\"\n            />\n          </svg>\n        </div>\n\n        <ul class={s.log}>\n          {Object.entries(this.state.items).map(([name, items]) => (\n            <li key={name} class={s.logItem}>\n              {this.formatItem(\n                name,\n                items.reduce((prev, cur) => prev + cur.progress, 0) /\n                  items.length\n              )}\n            </li>\n          ))}\n        </ul>\n      </div>\n    )\n  }\n}\n","import { stylesheet, keyframes } from 'typestyle'\n\nconst loadingStyle = () => ({\n  position: 'relative' as 'relative',\n  width: '100%',\n  height: '100%',\n  opacity: 1,\n  transition: 'opacity 2s ease, z-index 1s linear',\n  zIndex: 30\n})\n\nexport const LoadingStyle = stylesheet({\n  loading: {\n    ...loadingStyle()\n  },\n  loadingHidden: {\n    ...loadingStyle(),\n    opacity: 0,\n    userSelect: 'none',\n    zIndex: 0\n  },\n  spinner: {\n    position: 'absolute',\n    left: '50%',\n    top: '50%',\n    marginLeft: '-40px',\n    marginTop: '-40px',\n    animation: 'rotate 1s linear 0s infinite',\n    height: '80px',\n    width: '80px',\n    animationName: keyframes({\n      from: { transform: 'rotate(0deg)' },\n      to: { transform: 'rotate(360deg)' }\n    })\n  },\n  log: {\n    position: 'absolute',\n    background: 'rgba(0,0,0,0.4)',\n    padding: '10px',\n    fontFamily: 'monospace',\n    margin: '0',\n    top: '16px',\n    right: 0,\n    paddingLeft: '16px',\n    listStyle: 'none'\n  },\n  logItem: {\n    display: 'block'\n  }\n})\n","import { h } from 'preact'\nimport { classes } from 'typestyle'\nimport { Game } from '../../Game'\nimport { FreeModeStyle as s } from './style'\nimport { ControlsStyle as cs } from '../Controls.style'\nimport { SettingsButton } from '../Buttons/SettingsButton'\nimport { FullscreenButton } from '../Buttons/FullscreenButton'\n\nexport function FreeMode(props: { class: string; game: Game; root: Element }) {\n  return (\n    <div class={classes(props.class, s.controls)}>\n      <div class={cs.buttons}>\n        <div class={cs.left} />\n        <div class={cs.right}>\n          <SettingsButton game={props.game} />\n          <FullscreenButton active={false} root={props.root} />\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { stylesheet } from 'typestyle'\n\nexport const FreeModeStyle = stylesheet({\n  controls: {\n    height: '44px'\n  }\n})\n","import { stylesheet } from 'typestyle'\n\nconst menuStyle = () => ({\n  display: 'none',\n  position: 'absolute' as 'absolute',\n  left: '-38px',\n  bottom: '48px',\n  padding: '2px 6px',\n  fontSize: '14px',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  flexFlow: 'column',\n  minWidth: '100px'\n})\n\nconst menuItemStyle = () => ({\n  cursor: 'pointer',\n  margin: '4px 0',\n  padding: '4px',\n  $nest: {\n    '&:last-child': {\n      marginTop: 0\n    },\n    '&:hover': {\n      backgroundColor: 'rgba(255, 255, 255, 0.1)'\n    }\n  }\n})\n\nexport const SettingsButtonStyle = stylesheet({\n  settings: {\n    position: 'relative'\n  },\n  menu: {\n    ...menuStyle()\n  },\n  menuOpen: {\n    ...menuStyle(),\n    display: 'flex'\n  },\n  menuItemTitle: {\n    padding: '6px 4px',\n    borderBottom: '1px solid white',\n    fontWeight: 'bold'\n  },\n  menuItem: {\n    ...menuItemStyle()\n  },\n  menuItemSelected: {\n    ...menuItemStyle(),\n    backgroundColor: 'rgba(255, 255, 255, 0.2) !important'\n  },\n  button: {\n    width: '32px',\n    height: '32px',\n    padding: '5px'\n  }\n})\n","import { stylesheet } from 'typestyle'\n\nexport const FullscreenButtonStyle = stylesheet({\n  button: {\n    width: '30px',\n    minWidth: '30px',\n    height: '30px',\n    padding: '5px'\n  }\n})\n","import { h, Component } from 'preact'\nimport { Time } from '../Time'\nimport { Game } from '../../Game'\nimport { TimeLine } from '../TimeLine'\nimport { VolumeControl } from '../VolumeControl'\nimport { PlayButton } from '../Buttons/PlayButton'\nimport { PauseButton } from '../Buttons/PauseButton'\nimport { VolumeButton } from '../Buttons/VolumeButton'\nimport { SpeedUpButton } from '../Buttons/SpeedUpButton'\nimport { SpeedDownButton } from '../Buttons/SpeedDownButton'\nimport { SettingsButton } from '../Buttons/SettingsButton'\nimport { FullscreenButton } from '../Buttons/FullscreenButton'\nimport { ControlsStyle as cs } from '../Controls.style'\n\ninterface ReplayModeProps {\n  class: string\n  game: Game\n  root: Element\n  visible: boolean\n}\n\nexport class ReplayMode extends Component<ReplayModeProps> {\n  componentDidMount() {\n    this.props.game.player.on('play', this.onPlayStateChange)\n    this.props.game.player.on('pause', this.onPlayStateChange)\n    this.props.game.player.on('stop', this.onPlayStateChange)\n  }\n\n  componentWillUnmount() {\n    this.props.game.player.off('play', this.onPlayStateChange)\n    this.props.game.player.off('pause', this.onPlayStateChange)\n    this.props.game.player.off('stop', this.onPlayStateChange)\n  }\n\n  onPlayClick = () => {\n    this.props.game.player.play()\n  }\n\n  onPauseClick = () => {\n    this.props.game.player.pause()\n  }\n\n  onSpeedDown = () => {\n    this.props.game.player.speedDown()\n  }\n\n  onSpeedUp = () => {\n    this.props.game.player.speedUp()\n  }\n\n  onVolumeClick = () => {\n    this.props.game.soundSystem.toggleMute()\n  }\n\n  onPlayStateChange = () => {\n    this.forceUpdate()\n  }\n\n  render() {\n    const game = this.props.game\n    const player = game.player\n    const playing = player.isPlaying\n    const paused = player.isPaused\n\n    return (\n      <div class={this.props.class}>\n        <TimeLine game={game} />\n\n        <div class={cs.buttons}>\n          <div class={cs.left}>\n            <SpeedDownButton onClick={this.onSpeedDown} />\n            {paused || !playing ? (\n              <PlayButton onClick={this.onPlayClick} />\n            ) : (\n              <PauseButton onClick={this.onPauseClick} />\n            )}\n            <SpeedUpButton onClick={this.onSpeedUp} />\n            <VolumeButton onClick={this.onVolumeClick} />\n            <VolumeControl game={game} />\n            <Time player={player} />\n          </div>\n\n          <div class={cs.right}>\n            <SettingsButton game={game} />\n            <FullscreenButton active={true} root={this.props.root} />\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","import { h, Component } from 'preact'\nimport { formatTime } from '../../Time'\nimport { ReplayPlayer } from '../../ReplayPlayer'\nimport { Time as s } from './style'\n\ninterface TimeProps {\n  player: ReplayPlayer\n}\n\ninterface TimeState {\n  isPlaying: boolean\n}\n\nexport class Time extends Component<TimeProps, TimeState> {\n  componentDidMount() {\n    this.props.player.events.on('play', this.onPlay)\n    this.props.player.events.on('pause', this.onPauseOrStop)\n    this.props.player.events.on('stop', this.onPauseOrStop)\n  }\n\n  componentWillUnmount() {\n    this.props.player.events.removeListener('play', this.onPlay)\n    this.props.player.events.removeListener('pause', this.onPauseOrStop)\n    this.props.player.events.removeListener('stop', this.onPauseOrStop)\n  }\n\n  onPlay = () => {\n    this.setState(\n      {\n        isPlaying: true\n      },\n      this.update\n    )\n  }\n\n  onPauseOrStop = () => {\n    this.setState({\n      isPlaying: false\n    })\n  }\n\n  update = () => {\n    if (!this.state.isPlaying) {\n      return\n    }\n\n    this.forceUpdate()\n    setTimeout(this.update, 100)\n  }\n\n  render() {\n    const current = formatTime(this.props.player.currentTime)\n    const total = formatTime(this.props.player.replay.length)\n\n    return (\n      <div class={s.time}>\n        {current} / {total}\n      </div>\n    )\n  }\n}\n","import { stylesheet } from 'typestyle'\n\nexport const Time = stylesheet({\n  time: {\n    fontFamily: `'Roboto', Arial, Helvetica, sans-serif`,\n    fontSize: '10pt'\n  }\n})\n","import { h, Component } from 'preact'\nimport { Game } from '../../Game'\nimport { TimeLine as s } from './style'\n\ninterface TimeLineProps {\n  game: Game\n}\n\ninterface TimeLineState {\n  progress: number\n  ghostKnobActive: boolean\n  ghostKnobPos: string\n}\n\nexport class TimeLine extends Component<TimeLineProps, TimeLineState> {\n  constructor(props: TimeLineProps) {\n    super(props)\n\n    this.state = {\n      progress: 0,\n      ghostKnobActive: false,\n      ghostKnobPos: '0%'\n    }\n  }\n\n  componentDidMount() {\n    this.props.game.on('postupdate', this.onPostUpdate)\n  }\n\n  componentWillUnmount() {\n    this.props.game.off('postupdate', this.onPostUpdate)\n  }\n\n  onPostUpdate = () => {\n    const player = this.props.game.player\n    this.setState({\n      progress: player.currentTime / player.replay.length\n    })\n  }\n\n  onClick = (e: any) => {\n    const rects = e.currentTarget.getClientRects()[0]\n    const progress = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    this.props.game.player.seekByPercent(progress * 100)\n    this.props.game.player.pause()\n  }\n\n  onMouseEnter = () => {\n    this.setState({\n      ghostKnobActive: true\n    })\n  }\n\n  onMouseMove = (e: any) => {\n    if (!this.state.ghostKnobActive) {\n      return\n    }\n\n    const rects = e.currentTarget.getClientRects()[0]\n    const progressPos = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    const pos = progressPos * 100 + '%'\n    this.setState({\n      ghostKnobPos: pos\n    })\n  }\n\n  onMouseLeave = () => {\n    this.setState({\n      ghostKnobActive: false\n    })\n  }\n\n  render() {\n    const timePos = this.state.progress * 100\n    const knobOff = timePos + '%'\n    const lineOff = 100 - timePos + '%'\n\n    return (\n      <div\n        class={s.timeline}\n        onClick={this.onClick}\n        onMouseEnter={this.onMouseEnter}\n        onMouseMove={this.onMouseMove}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <div class={s.ghostLine} />\n        <div class={s.line} style={{ right: lineOff }} />\n        <div class={s.knob} style={{ left: knobOff }} />\n        <div class={s.ghostKnob} style={{ left: this.state.ghostKnobPos }} />\n      </div>\n    )\n  }\n}\n","import { stylesheet } from 'typestyle'\n\nexport const TimeLine = stylesheet({\n  timeline: {\n    display: 'flex',\n    alignItems: 'center',\n    position: 'relative',\n    height: '26px',\n    cursor: 'pointer'\n  },\n  line: {\n    height: '4px',\n    backgroundColor: '#fff',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  ghostLine: {\n    height: '4px',\n    backgroundColor: 'rgba(255, 255, 255, 0.5)',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  knob: {\n    position: 'absolute',\n    width: '12px',\n    height: '12px',\n    backgroundColor: '#fff',\n    borderRadius: '6px',\n    left: '100%',\n    marginLeft: '-6px'\n  },\n  ghostKnob: {\n    position: 'absolute',\n    width: '8px',\n    height: '8px',\n    backgroundColor: '#fff',\n    boxSizing: 'border-box',\n    borderRadius: '8px',\n    left: '0',\n    marginLeft: '-4px',\n    display: 'none',\n    $nest: {\n      '&:hover': {\n        display: 'block'\n      }\n    }\n  }\n})\n","import { h, Component } from 'preact'\nimport { Game } from '../../Game'\nimport { VolumeControl as s } from './style'\n\ninterface VolumeControlProps {\n  game: Game\n}\n\ninterface VolumeControlState {\n  volume: number\n  ghostKnobActive: boolean\n  ghostKnobPos: string\n}\n\nexport class VolumeControl extends Component<\n  VolumeControlProps,\n  VolumeControlState\n> {\n  constructor(props: VolumeControlProps) {\n    super(props)\n\n    this.state = {\n      volume: props.game.soundSystem.getVolume(),\n      ghostKnobActive: false,\n      ghostKnobPos: '5%'\n    }\n  }\n\n  componentDidMount() {\n    this.props.game.soundSystem.events.on('volumeChange', this.onVolumeChange)\n  }\n\n  componentWillUnmount() {\n    this.props.game.soundSystem.events.removeListener(\n      'volumeChange',\n      this.onVolumeChange\n    )\n  }\n\n  onVolumeChange = () => {\n    this.setState({\n      volume: this.props.game.soundSystem.getVolume()\n    })\n  }\n\n  onClick = (e: any) => {\n    const rects = e.currentTarget.getClientRects()[0]\n    const volume = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    this.props.game.soundSystem.setVolume(volume)\n  }\n\n  onMouseEnter = () => {\n    this.setState({\n      ghostKnobActive: true\n    })\n  }\n\n  onMouseMove = (e: any) => {\n    if (!this.state.ghostKnobActive) {\n      return\n    }\n\n    const rects = e.currentTarget.getClientRects()[0]\n    const volumePos = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    const pos = Math.min(95, Math.max(5, volumePos * 100)) + '%'\n    this.setState({\n      ghostKnobPos: pos\n    })\n  }\n\n  onMouseLeave = () => {\n    this.setState({\n      ghostKnobActive: false\n    })\n  }\n\n  render() {\n    const volumePos = this.state.volume * 100\n    const knobOff = Math.min(95, Math.max(5, volumePos)) + '%'\n    const lineOff = Math.min(95, Math.max(5, 100 - volumePos)) + '%'\n\n    return (\n      <div\n        class={s.control}\n        onClick={this.onClick}\n        onMouseEnter={this.onMouseEnter}\n        onMouseMove={this.onMouseMove}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <div class={s.ghostLine} />\n        <div class={s.line} style={{ right: lineOff }} />\n        <div class={s.knob} style={{ left: knobOff }} />\n        <div class={s.ghostKnob} style={{ left: this.state.ghostKnobPos }} />\n      </div>\n    )\n  }\n}\n","import { stylesheet } from 'typestyle'\n\nexport const VolumeControl = stylesheet({\n  control: {\n    display: 'flex',\n    alignItems: 'center',\n    position: 'relative',\n    width: '80px',\n    height: '26px',\n    marginLeft: '6px',\n    marginRight: '14px',\n    cursor: 'pointer'\n  },\n  line: {\n    height: '4px',\n    backgroundColor: '#fff',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  ghostLine: {\n    height: '4px',\n    backgroundColor: 'rgba(255, 255, 255, 0.5)',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  knob: {\n    position: 'absolute',\n    width: '12px',\n    height: '12px',\n    backgroundColor: '#fff',\n    borderRadius: '6px',\n    left: '100%',\n    marginLeft: '-6px'\n  },\n  ghostKnob: {\n    position: 'absolute',\n    width: '8px',\n    height: '8px',\n    backgroundColor: '#fff',\n    boxSizing: 'border-box',\n    borderRadius: '8px',\n    left: '0',\n    marginLeft: '-4px',\n    display: 'none',\n    $nest: {\n      '&:hover': {\n        display: 'block'\n      }\n    }\n  }\n})\n","import { h } from 'preact'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function PlayButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={cs.button} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L64 32 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { h } from 'preact'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function PauseButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={cs.button} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L20 64 L20 0 M44 0 L64 0 L64 64 L44 64 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { h } from 'preact'\nimport { classes } from 'typestyle'\nimport { VolumeButton as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function VolumeButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={classes(cs.button, s.button)} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 48 48\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z\" />\n      </svg>\n    </div>\n  )\n}\n","import { stylesheet } from 'typestyle'\n\nexport const VolumeButton = stylesheet({\n  button: {\n    width: '28px',\n    height: '28px',\n    padding: '2px',\n    marginRight: '5px'\n  }\n})\n","import { h } from 'preact'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function SpeedUpButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={cs.button} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { h } from 'preact'\nimport { classes } from 'typestyle'\nimport { SpeedDownButtonStyle as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function SpeedDownButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={classes(cs.button, s.button)} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { stylesheet } from 'typestyle'\n\nexport const SpeedDownButtonStyle = stylesheet({\n  button: {\n    transform: 'rotate(180deg)'\n  }\n})\n","import { stylesheet } from 'typestyle'\n\nconst rootStyle = () => ({\n  position: 'relative' as 'relative',\n  color: 'white',\n  width: '100%',\n  height: '100%',\n  cursor: 'none',\n  userSelect: 'none' as 'none'\n})\n\nconst titleStyle = () => ({\n  position: 'absolute' as 'absolute',\n  top: '20px',\n  left: '0',\n  zIndex: 20,\n  padding: '10px 10px 10px 20px',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  fontSize: '13pt',\n  fontFamily: `'Roboto', Arial, Helvetica, sans-serif`,\n  opacity: 0,\n  transition: 'opacity 0.2s'\n})\n\nconst controlsStyle = () => ({\n  zIndex: 30,\n  position: 'absolute' as 'absolute',\n  width: '100%',\n  bottom: 0,\n  padding: '0 16px',\n  boxSizing: 'border-box' as 'border-box',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  userSelect: 'none' as 'none',\n  opacity: 0,\n  transition: 'opacity 0.2s'\n})\n\nexport const RootStyle = stylesheet({\n  root: {\n    ...rootStyle()\n  },\n  rootVisible: {\n    ...rootStyle(),\n    cursor: 'default'\n  },\n\n  title: {\n    ...titleStyle()\n  },\n  titleVisible: {\n    ...titleStyle(),\n    opacity: 1\n  },\n\n  controls: {\n    ...controlsStyle()\n  },\n  controlsVisible: {\n    ...controlsStyle(),\n    opacity: 1\n  },\n\n  screen: {\n    position: 'absolute' as 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    zIndex: 10\n  }\n})\n"],"sourceRoot":""}